<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.5.57">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <meta name="author" content="Simon Oiry">
    <meta name="author" content="Bede Ffinian Rowe Davies">
    <meta name="author" content="Ana I. Sousa">
    <meta name="author" content="Philippe Rosa">
    <meta name="author" content="Maria Laura Zoffoli">
    <meta name="author" content="Guillaume Brunier">
    <meta name="author" content="Pierre Gernez">
    <meta name="author" content="Laurent Barillé">
    <meta name="dcterms.date" content="2024-10-14">
    <meta name="keywords" content="Drone, Remote Sensing, Seagrass, Coastal Ecosystems, Neural Network">

    <title>Draft – Discriminating Seagrasses From Green Macroalgae in European Intertidal areas using high resolution multispectral drone imagery – Draft</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      /* CSS for citations */
      div.csl-bib-body { }
      div.csl-entry {
        clear: both;
        margin-bottom: 0em;
      }
      .hanging-indent div.csl-entry {
        margin-left:2em;
        text-indent:-2em;
      }
      div.csl-left-margin {
        min-width:2em;
        float:left;
      }
      div.csl-right-inline {
        margin-left:2em;
        padding-left:1em;
      }
      div.csl-indent {
        margin-left: 2em;
      }    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
     <script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>   <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script> 
      <meta name="citation_title" content="Draft -- Discriminating Seagrasses From Green Macroalgae in European Intertidal areas using high resolution multispectral drone imagery -- Draft">
<meta name="citation_abstract" content="Coastal areas support seagrass meadows, which offer crucial ecosystem services including erosion control and carbon sequestration. However, these areas are increasingly impacted by human activities, leading to habitat fragmentation and seagrass decline. In situ surveys, traditionally performed to monitor these ecosystems face limitations on temporal and spatial coverage, particularly in intertidal zones, prompting the addition of satellite data within monitoring programs. Yet, satellite remote sensing can be limited by too coarse spatial and/or spectral resolution, making it difficult to discriminate seagrass from other macrophytes in highly heterogenous meadows. Drone (unmanned aerial vehicles – UAV) images at a very high spatial resolution offer a promising solution to address challenges related to spatial heterogeneity and intrapixel mixture. This study focuses on using drone acquisitions with a ten spectral band sensor similar to that onboard Sentinel-2, for mapping intertidal macrophytes at low tide (i.e. during a period of emersion) and effectively discriminating between seagrass and green macroalgae. Nine drone flights were conducted at two different altitudes (12 m and 120 m) across heterogeneous intertidal European habitats in France and Portugal, providing multispectral reflectance observation at very high spatial resolution (8 mm and 80 mm respectively). Taking advantage of their extremly high spatial resolution; the low altitude flights were used to train a Neural Network classifier to discrimintate five taxonomic classes of intertidal vegetation: Magnoliopsida (Seagrass), Chlorophyceae (Green macroalgae), Phaeophyceae (Brown algae), Rhodophyceae (Red macroalgae) and benthic Bacillariophyceae (Diatoms), and validated using concomitant field measurements. Classification of drone imagery resulted in an overall accuracy of 94% across all sites and images, covering a total area of 467 000 m². The model exhibited an accuracy of 96.4% in identifying seagrass. In particular , seagrass and green algae can be discriminated. The very high spatial resolution of the drone data made it possible to assess the influence of spatial resolution on the classification outputs, showing a limited loss in seagrass detection up to about 10m. Altogether, out findings suggest that the Multi-Spectral Instrument (MSI) onboard Sentinel-2 offers a relevant trade-off between its spatial and spectral resolution, thus offering promising perspectives for satellite remote sensing of intertidal biodiversity over lager scales.
">
<meta name="citation_keywords" content="Drone,Remote Sensing,Seagrass,Coastal Ecosystems,Neural Network">
<meta name="citation_author" content="Simon Oiry">
<meta name="citation_author" content="Bede Ffinian Rowe Davies">
<meta name="citation_author" content="Ana I. Sousa">
<meta name="citation_author" content="Philippe Rosa">
<meta name="citation_author" content="Maria Laura Zoffoli">
<meta name="citation_author" content="Guillaume Brunier">
<meta name="citation_author" content="Pierre Gernez">
<meta name="citation_author" content="Laurent Barillé">
<meta name="citation_publication_date" content="2024-10-14">
<meta name="citation_cover_date" content="2024-10-14">
<meta name="citation_year" content="2024">
<meta name="citation_online_date" content="2024-10-14">
<meta name="citation_language" content="en">
<meta name="citation_journal_title" content="Remote Sensing of Environment">
<meta name="citation_reference" content="citation_title=Seaweeds of the british isles: Tribophyceae (xanthophyceae);,citation_author=Tyge Christensen;,citation_author=Peter Stanley Dixon;,citation_author=Linda M Irvine;,citation_publication_date=1977;,citation_cover_date=1977;,citation_year=1977;,citation_volume=4;">
<meta name="citation_reference" content="citation_title=Regulation of intertidal microphytobenthos photosynthesis over a diel emersion period is strongly affected by diatom migration patterns;,citation_author=Paulo Cartaxana;,citation_author=Sónia Cruz;,citation_author=Carla Gameiro;,citation_author=Michael Kühl;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_volume=7;,citation_journal_title=Frontiers in microbiology;,citation_publisher=Frontiers Media SA;">
<meta name="citation_reference" content="citation_title=In vivo estimation of pigment composition and optical absorption cross-section by spectroradiometry in four aquatic photosynthetic micro-organisms;,citation_author=Vona Méléder;,citation_author=Martin Laviale;,citation_author=Bruno Jesus;,citation_author=Jean Luc Mouget;,citation_author=Johann Lavaud;,citation_author=Farzaneh Kazemipour;,citation_author=Patrick Launeau;,citation_author=Laurent Barillé;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_volume=129;,citation_journal_title=Journal of Photochemistry and Photobiology B: Biology;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=‘Blue carbon’and nutrient stocks of salt marshes at a temperate coastal lagoon (Ria de Aveiro, Portugal);,citation_author=Ana I Sousa;,citation_author=Danielle B Santos;,citation_author=Eduardo Ferreira Silva;,citation_author=Lisa P Sousa;,citation_author=Daniel FR Cleary;,citation_author=Amadeu MVM Soares;,citation_author=Ana I Lillebø;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=1;,citation_volume=7;,citation_journal_title=Scientific reports;,citation_publisher=Nature Publishing Group UK London;">
<meta name="citation_reference" content="citation_title=Blue Carbon stock in Zostera noltei meadows at Ria de Aveiro coastal lagoon (Portugal) over a decade;,citation_author=Ana I Sousa;,citation_author=José Figueiredo Silva;,citation_author=Ana Azevedo;,citation_author=Ana I Lillebø;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=1;,citation_volume=9;,citation_journal_title=Scientific reports;,citation_publisher=Nature Publishing Group UK London;">
<meta name="citation_reference" content="citation_title=fastai;,citation_author=Jeremy Howard;,citation_author=others;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_publisher=https://github.com/fastai/fastai; GitHub;">
<meta name="citation_reference" content="citation_title=Agisoft Metashape;,citation_author=undefined Agisoft;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://www.agisoft.com/;">
<meta name="citation_reference" content="citation_title=A review of photogrammetry and photorealistic 3D models in education from a psychological perspective;,citation_author=Steve Nebel;,citation_author=Maik Beege;,citation_author=Sascha Schneider;,citation_author=Günter Daniel Rey;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_volume=5;,citation_conference_title=Frontiers in education;,citation_conference=Frontiers Media SA;">
<meta name="citation_reference" content="citation_title=NIH Image to ImageJ: 25 years of image analysis;,citation_author=Caroline A Schneider;,citation_author=Wayne S Rasband;,citation_author=Kevin W Eliceiri;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;,citation_issue=7;,citation_volume=9;,citation_journal_title=Nature methods;,citation_publisher=Nature Publishing Group;">
<meta name="citation_reference" content="citation_title=The planetary role of seagrass conservation;,citation_author=Richard KF Unsworth;,citation_author=Leanne C Cullen-Unsworth;,citation_author=Benjamin LH Jones;,citation_author=Richard J Lilley;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_issue=6606;,citation_volume=377;,citation_journal_title=Science;,citation_publisher=American Association for the Advancement of Science;">
<meta name="citation_reference" content="citation_title=Global wetland outlook: state of the world’s wetlands and their services to people;,citation_author=Royal C Gardner;,citation_author=C Finlayson;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;">
<meta name="citation_reference" content="citation_title=Remote sensing in seagrass ecology: coupled dynamics between migratory herbivorous birds and intertidal meadows observed by satellite during four decades;,citation_author=Maria Laura Zoffoli;,citation_author=Pierre Gernez;,citation_author=Simon Oiry;,citation_author=Laurent Godet;,citation_author=Sébastien Dalloyau;,citation_author=Bede Ffinian Rowe Davies;,citation_author=Laurent Barillé;,citation_publication_date=2022-12;,citation_cover_date=2022-12;,citation_year=2022;,citation_doi=10.1002/rse2.319;,citation_issn=2056-3485;,citation_journal_title=Remote Sensing in Ecology and Conservation;">
<meta name="citation_reference" content="citation_title=Stabilizing effects of seagrass meadows on coastal water benthic food webs;,citation_author=Emilia Jankowska;,citation_author=Loı̈c N Michel;,citation_author=Gilles Lepoint;,citation_author=Maria Włodarska-Kowalczuk;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_volume=510;,citation_journal_title=Journal of Experimental Marine Biology and Ecology;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Seagrasses in an era of ocean warming: a review;,citation_author=Hung Manh Nguyen;,citation_author=Peter J Ralph;,citation_author=Lázaro Marı́n-Guirao;,citation_author=Mathieu Pernice;,citation_author=Gabriele Procaccini;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_issue=5;,citation_volume=96;,citation_journal_title=Biological Reviews;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Latitudinal patterns in european seagrass carbon reserves: influence of seasonal fluctuations versus short-term stress and disturbance events;,citation_author=Laura M Soissons;,citation_author=Eeke P Haanstra;,citation_author=Marieke M Van Katwijk;,citation_author=Ragnhild Asmus;,citation_author=Isabelle Auby;,citation_author=Laurent Barillé;,citation_author=Fernando G Brun;,citation_author=Patricia G Cardoso;,citation_author=Nicolas Desroy;,citation_author=Jerome Fournier;,citation_author=others;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_volume=9;,citation_journal_title=Frontiers in Plant Science;,citation_publisher=Frontiers Media SA;">
<meta name="citation_reference" content="citation_title=A global crisis for seagrass ecosystems;,citation_author=Robert J Orth;,citation_author=Tim JB Carruthers;,citation_author=William C Dennison;,citation_author=Carlos M Duarte;,citation_author=James W Fourqurean;,citation_author=Kenneth L Heck;,citation_author=A Randall Hughes;,citation_author=Gary A Kendrick;,citation_author=W Judson Kenworthy;,citation_author=Suzanne Olyarnik;,citation_author=others;,citation_publication_date=2006;,citation_cover_date=2006;,citation_year=2006;,citation_issue=12;,citation_volume=56;,citation_journal_title=Bioscience;,citation_publisher=American Institute of Biological Sciences;">
<meta name="citation_reference" content="citation_title=Which genes in a typical intertidal seagrass (Zostera japonica) indicate copper-, lead-, and cadmium pollution?;,citation_author=Haiying Lin;,citation_author=Tao Sun;,citation_author=Yi Zhou;,citation_author=Ruiting Gu;,citation_author=Xiaomei Zhang;,citation_author=Wei Yang;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_volume=9;,citation_journal_title=Frontiers in Plant Science;,citation_publisher=Frontiers Media SA;">
<meta name="citation_reference" content="citation_title=Toward a coordinated global observing system for seagrasses and marine macroalgae;,citation_author=J Emmett Duffy;,citation_author=Lisandro Benedetti-Cecchi;,citation_author=Joaquin Trinanes;,citation_author=Frank E Muller-Karger;,citation_author=Rohani Ambo-Rappe;,citation_author=Christoffer Boström;,citation_author=Alejandro H Buschmann;,citation_author=Jarrett Byrnes;,citation_author=Robert G Coles;,citation_author=Joel Creed;,citation_author=others;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_volume=6;,citation_journal_title=Frontiers in Marine Science;,citation_publisher=Frontiers Media SA;">
<meta name="citation_reference" content="citation_title=Recent trend reversal for declining European seagrass meadows;,citation_author=Carmen B Los Santos;,citation_author=Dorte Krause-Jensen;,citation_author=Teresa Alcoverro;,citation_author=Núria Marbà;,citation_author=Carlos M Duarte;,citation_author=Marieke M Van Katwijk;,citation_author=Marta Pérez;,citation_author=Javier Romero;,citation_author=José L Sánchez-Lizaso;,citation_author=Guillem Roca;,citation_author=others;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=1;,citation_volume=10;,citation_journal_title=Nature communications;,citation_publisher=Nature Publishing Group UK London;">
<meta name="citation_reference" content="citation_title=Decadal increase in the ecological status of a North-Atlantic intertidal seagrass meadow observed with multi-mission satellite time-series;,citation_abstract=Seagrass meadows are monitored in the frame of several environmental programs worldwide, including the Water Framework Directive (WFD), to evaluate the ecological status of European coastal and transitional water bodies. The large size, spatial complexity, and interannual variability of seagrass ecosystems significantly challenge field monitoring. In this study, a multi-mission satellite time-series was used to estimate long-term changes in seagrass status in a macrotidal system dominated by Zostera noltei, at Bourgneuf Bay (French Atlantic coast). Metrics of seagrass extent and density were obtained from Earth Observation (EO) using validated and inter-calibrated Landsat, SPOT and Sentinel2 data from 1985 to 2020. The information provided by satellite data made it possible to compute and compare several seagrass indicators currently in use in several European countries (France, Portugal and UK) within the WFD. Both the seagrass extent and meadow-averaged density displayed increasing trends since 1985. A time-series of merged observations from various satellites revealed a high degree of interannual variability in seagrass extent, with abrupt losses (up to 50;,citation_author=Maria Laura Zoffoli;,citation_author=Pierre Gernez;,citation_author=Laurent Godet;,citation_author=Steef Peters;,citation_author=Simon Oiry;,citation_author=Laurent Barillé;,citation_publication_date=2021-11;,citation_cover_date=2021-11;,citation_year=2021;,citation_fulltext_html_url=https://linkinghub.elsevier.com/retrieve/pii/S1470160X21006981;,citation_doi=10.1016/j.ecolind.2021.108033;,citation_issn=1470160X;,citation_volume=130;,citation_journal_title=Ecological Indicators;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Assessment of global habitat suitability and risk of ocean green tides;,citation_author=Zhongyuan Wang;,citation_author=Zhixiang Fang;,citation_author=Jianfeng Liang;,citation_author=Xiao Song;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_volume=119;,citation_journal_title=Harmful Algae;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Essential ocean variables for global sustained observations of biodiversity and ecosystem changes;,citation_abstract=Sustained observations of marine biodiversity and ecosystems focused on specific conservation and management problems are needed around the world to effectively mitigate or manage changes resulting from anthropogenic pressures. These observations, while complex and expensive, are required by the international scientific, governance and policy communities to provide baselines against which the effects of human pressures and climate change may be measured and reported, and resources allocated to implement solutions. To identify biological and ecological essential ocean variables (EOVs) for implementation within a global ocean observing system that is relevant for science, informs society, and technologically feasible, we used a driver-pressure-state-impact-response (DPSIR) model. We (1) examined relevant international agreements to identify societal drivers and pressures on marine resources and ecosystems, (2) evaluated the temporal and spatial scales of variables measured by 100+ observing programs, and (3) analysed the impact and scalability of these variables and how they contribute to address societal and scientific issues. EOVs were related to the status of ecosystem components (phytoplankton and zooplankton biomass and diversity, and abundance and distribution of fish, marine turtles, birds and mammals), and to the extent and health of ecosystems (cover and composition of hard coral, seagrass, mangrove and macroalgal canopy). Benthic invertebrate abundance and distribution and microbe diversity and biomass were identified as emerging EOVs to be developed based on emerging requirements and new technologies. The temporal scale at which any shifts in biological systems will be detected will vary across the EOVs, the properties being monitored and the length of the existing time-series. Global implementation to deliver useful products will require collaboration of the scientific and policy sectors and a significant commitment to improve human and infrastructure capacity across the globe, including the development of new, more automated observing technologies, and encouraging the application of international standards and best practices.;,citation_author=Patricia Miloslavich;,citation_author=Nicholas J. Bax;,citation_author=Samantha E. Simmons;,citation_author=Eduardo Klein;,citation_author=Ward Appeltans;,citation_author=Octavio Aburto-Oropeza;,citation_author=Melissa Andersen Garcia;,citation_author=Sonia D. Batten;,citation_author=Lisandro Benedetti-Cecchi;,citation_author=David M. Checkley;,citation_author=Sanae Chiba;,citation_author=J. Emmett Duffy;,citation_author=Daniel C. Dunn;,citation_author=Albert Fischer;,citation_author=John Gunn;,citation_author=Raphael Kudela;,citation_author=Francis Marsac;,citation_author=Frank E. Muller-Karger;,citation_author=David Obura;,citation_author=Yunne Jai Shin;,citation_publication_date=2018-06;,citation_cover_date=2018-06;,citation_year=2018;,citation_fulltext_html_url=https://onlinelibrary.wiley.com/doi/full/10.1111/gcb.14108 https://onlinelibrary.wiley.com/doi/abs/10.1111/gcb.14108 https://onlinelibrary.wiley.com/doi/10.1111/gcb.14108;,citation_doi=10.1111/GCB.14108;,citation_issn=1365-2486;,citation_volume=24;,citation_journal_title=Global Change Biology;,citation_publisher=John Wiley &amp;amp;amp; Sons, Ltd;">
<meta name="citation_reference" content="citation_title=Essential biodiversity variables;,citation_author=Henrique Miguel Pereira;,citation_author=Simon Ferrier;,citation_author=Michele Walters;,citation_author=Gary N Geller;,citation_author=Rob HG Jongman;,citation_author=Robert J Scholes;,citation_author=Michael William Bruford;,citation_author=Neil Brummitt;,citation_author=Stuart HM Butchart;,citation_author=AC Cardoso;,citation_author=others;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_issue=6117;,citation_volume=339;,citation_journal_title=Science;,citation_publisher=American Association for the Advancement of Science;">
<meta name="citation_reference" content="citation_title=Satellite remote sensing of canopy-forming kelp on a complex coastline: a novel procedure using the Landsat image archive;,citation_author=Wiebe Nijland;,citation_author=Luba Reshitnyk;,citation_author=Emily Rubidge;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_volume=220;,citation_journal_title=Remote Sensing of Environment;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Long-term changes in the unique and largest seagrass meadows in the Bohai sea (China) using satellite (1974–2019) and sonar data: Implication for conservation and restoration;,citation_author=Shaochun Xu;,citation_author=Shuai Xu;,citation_author=Yi Zhou;,citation_author=Shidong Yue;,citation_author=Xiaomei Zhang;,citation_author=Ruiting Gu;,citation_author=Yu Zhang;,citation_author=Yongliang Qiao;,citation_author=Mingjie Liu;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_issue=5;,citation_volume=13;,citation_journal_title=Remote Sensing;,citation_publisher=MDPI;">
<meta name="citation_reference" content="citation_title=Mapping Mediterranean seagrasses with Sentinel-2 imagery;,citation_abstract=Mediterranean seagrasses have been hailed for their numerous ecosystem services, yet they are undergoing a decline in their coverage. The major complication with resolving this tendency is the sparsity of data on their overall distribution. This study addresses the suitability of the recently launched Sentinel-2 satellite for mapping the distribution of Mediterranean seagrass meadows. A comprehensive methodology is presented which applies atmospheric and analytical water column corrections and compares the performance of three different supervised classifiers. Remote sensing of the Thermaikos Gulf, northwestern Aegean Sea (Greece, eastern Mediterranean Sea) reveals that the utilization of Support Vector Machines on water column corrected reflectances yields best accuracies. Two Mediterranean seagrasses, Posidonia oceanica and Cymodocea nodosa, cover a total submerged area of 1.48 km2 between depths of 1.4–16.5 m. With its 10-m spatial resolution and 5-day revisit frequency, Sentinel-2 imagery can mitigate the Mediterranean seagrass distribution data gap and allow better management and conservation in the future in a retrospective, time- and cost-effective fashion.;,citation_author=Dimosthenis Traganos;,citation_author=Peter Reinartz;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_doi=10.1016/j.marpolbul.2017.06.075;,citation_issn=18793363;,citation_volume=134;,citation_journal_title=Marine Pollution Bulletin;,citation_publisher=Elsevier Ltd;">
<meta name="citation_reference" content="citation_title=Providing a framework for seagrass mapping in United States coastal ecosystems using high spatial resolution satellite imagery;,citation_author=Megan M Coffer;,citation_author=David D Graybill;,citation_author=Peter J Whitman;,citation_author=Blake A Schaeffer;,citation_author=Wilson B Salls;,citation_author=Richard C Zimmerman;,citation_author=Victoria Hill;,citation_author=Marie Cindy Lebrasse;,citation_author=Jiang Li;,citation_author=Darryl J Keith;,citation_author=others;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_volume=337;,citation_journal_title=Journal of Environmental Management;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Operation of the xanthophyll cycle in the seagrass Zostera marina in response to variable irradiance;,citation_author=PJ Ralph;,citation_author=SM Polk;,citation_author=KA Moore;,citation_author=RJ Orth;,citation_author=WO Smith Jr;,citation_publication_date=2002;,citation_cover_date=2002;,citation_year=2002;,citation_issue=2;,citation_volume=271;,citation_journal_title=Journal of Experimental Marine Biology and Ecology;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=New Hyperspectral Procedure to Discriminate Intertidal Macroalgae;,citation_abstract=The recent development and miniaturization of hyperspectral sensors embedded in drones has allowed the acquisition of hyperspectral images with high spectral and spatial resolution. The characteristics of both the embedded sensors and drones (viewing angle, flying altitude, resolution) create opportunities to consider the use of hyperspectral imagery to map and monitor macroalgae communities. In general, the overflight of the areas to be mapped is conconmittently associated accompanied with measurements carried out in the field to acquire the spectra of previously identified objects. An alternative to these simultaneous acquisitions is to use a hyperspectral library made up of pure spectra of the different species in place, that would spare field acquisition of spectra during each flight. However, the use of such a technique requires developed appropriate procedure for testing the level of species classification that can be achieved, as well as the reproducibility of the classification over time. This study presents a novel classification approach based on the use of reflectance spectra of macroalgae acquired in controlled conditions. This overall approach developed is based on both the use of the spectral angle mapper (SAM) algorithm applied on first derivative hyperspectral data. The efficiency of this approach has been tested on a hyperspectral library composed of 16 macroalgae species, and its temporal reproducibility has been tested on a monthly survey of the spectral response of different macro-algae species. In addition, the classification results obtained with this new approach were also compared to the results obtained through the use of the most recent and robust procedure published. The classification obtained shows that the developed approach allows to perfectly discriminate the different phyla, whatever the period. At the species level, the classification approach is less effective when the individuals studied belong to phylogenetically close species (i.e., Fucus spiralis and Fucus serratus).;,citation_author=Florian Douay;,citation_author=Charles Verpoorter;,citation_author=Gwendoline Duong;,citation_author=Nicolas Spilmont;,citation_author=François Gevaert;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://www.mdpi.com/2072-4292/14/2/346;,citation_issue=2;,citation_doi=10.3390/rs14020346;,citation_issn=2072-4292;,citation_volume=14;,citation_journal_title=Remote Sensing;">
<meta name="citation_reference" content="citation_title=Multi- and hyperspectral classification of soft-bottom intertidal vegetation using a spectral library for coastal biodiversity remote sensing;,citation_abstract=Monitoring biodiversity and how anthropogenic pressures impact this is critical, especially as anthropogenically driven climate change continues to affect all ecosystems. Intertidal areas are exposed to particularly high levels of pressures owing to increased population density in coastal areas. Traditional methods of monitoring intertidal areas do not provide datasets with full coverage in a cost-effective or timely manner, and so the use of remote sensing to monitor these areas is becoming more common. Monitoring of ecologically important monospecific habitats, such as seagrass beds, using remote sensing techniques is well documented. However, the ability for multispectral data to distinguish efficiently and accurately between classes of vegetation with similar pigment composition, such as seagrass and green algae, has proved difficult, often requiring hyperspectral data. A machine learning approach was used to differentiate between soft-bottom intertidal vegetation classes when exposed at low tide, comparing 6 different multi- and hyperspectral remote and in situ sensors. For the library of 366 spectra, collected across Northern Europe, high accuracy (&amp;amp;amp;gt;80;,citation_author=B F R Davies;,citation_author=Pierre Gernez;,citation_author=Andréa Geraud;,citation_author=Simon Oiry;,citation_author=Philippe Rosa;,citation_author=Maria Laura Zoffoli;,citation_author=Laurent Barillé;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S0034425723001050;,citation_doi=10.1016/j.rse.2023.113554;,citation_issn=0034-4257;,citation_volume=290;,citation_journal_title=Remote Sensing of Environment;">
<meta name="citation_reference" content="citation_title=The capabilities of Sentinel-MSI (2A/2B) and Landsat-OLI (8/9) in seagrass and algae species differentiation using spectral reflectance;,citation_author=Abderrazak Bannari;,citation_author=Thamer Salim Ali;,citation_author=Asma Abahussain;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_issue=2;,citation_volume=18;,citation_journal_title=Ocean Science;,citation_publisher=Copernicus GmbH;">
<meta name="citation_reference" content="citation_title=Drastic decadal decline of the seagrass Cymodocea nodosa at Gran Canaria (eastern Atlantic): interactions with the green algae Caulerpa prolifera;,citation_author=Fernando Tuya;,citation_author=Harue Hernandez-Zerpa;,citation_author=Fernando Espino;,citation_author=Ricardo Haroun;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_volume=105;,citation_journal_title=Aquatic Botany;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Drone-based large-scale particle image velocimetry applied to tidal stream energy resource assessment;,citation_author=Iain Fairley;,citation_author=Benjamin J Williamson;,citation_author=Jason McIlvenny;,citation_author=Nicholas King;,citation_author=Ian Masters;,citation_author=Matthew Lewis;,citation_author=Simon Neill;,citation_author=David Glasby;,citation_author=Daniel Coles;,citation_author=Ben Powell;,citation_author=others;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_volume=196;,citation_journal_title=Renewable Energy;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Use of a drone for mapping and time series image acquisition of tidal zones;,citation_author=Jaehong Oh;,citation_author=Duk-jin Kim;,citation_author=Hyoseong Lee;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=2;,citation_volume=27;,citation_journal_title=Journal of the Korean Institute of Intelligent Systems;,citation_publisher=Korean Institute of Intelligent Systems;">
<meta name="citation_reference" content="citation_title=Unmanned Aerial Vehicle (UAV) applications in coastal zone management—A review;,citation_author=Richard Adade;,citation_author=Abiodun Musa Aibinu;,citation_author=Bernard Ekumah;,citation_author=Jerry Asaana;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_volume=193;,citation_journal_title=Environmental Monitoring and Assessment;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Accuracy of sand beach topography surveying by drones and photogrammetry;,citation_author=Elisa Casella;,citation_author=Jan Drechsel;,citation_author=Christian Winter;,citation_author=Markus Benninghoff;,citation_author=Alessio Rovere;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_volume=40;,citation_journal_title=Geo-Marine Letters;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Satellite, drone and video camera multi-platform monitoring of coastal erosion at an engineered pocket beach: A showcase for coastal management at Elmina Bay, Ghana (West Africa);,citation_author=Donatus B Angnuureng;,citation_author=KE Brempong;,citation_author=PN Jayson-Quashigah;,citation_author=OA Dada;,citation_author=SGI Akuoko;,citation_author=J Frimpomaa;,citation_author=PA Mattah;,citation_author=Rafaël Almar;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_volume=53;,citation_journal_title=Regional Studies in Marine Science;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=The unique value proposition for using drones to map coastal ecosystems;,citation_author=Karen E Joyce;,citation_author=Kate C Fickas;,citation_author=Michelle Kalamandeen;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_volume=1;,citation_journal_title=Cambridge Prisms: Coastal Futures;,citation_publisher=Cambridge University Press;">
<meta name="citation_reference" content="citation_title=Application of Deep Learning for Classification of Intertidal Eelgrass from Drone-Acquired Imagery;,citation_author=Krti Tallam;,citation_author=Nam Nguyen;,citation_author=Jonathan Ventura;,citation_author=Andrew Fricker;,citation_author=Sadie Calhoun;,citation_author=Jennifer O’Leary;,citation_author=Mauriça Fitzgibbons;,citation_author=Ian Robbins;,citation_author=Ryan K Walter;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=9;,citation_volume=15;,citation_journal_title=Remote Sensing;,citation_publisher=MDPI;">
<meta name="citation_reference" content="citation_title=Monitoring the marine invasive alien species Rugulopteryx okamurae using unmanned aerial vehicles and satellites;,citation_abstract=&amp;amp;amp;lt;p&amp;gt; &amp;lt;italic&amp;gt;Rugulopteryx okamurae</italic> is a species of brown macroalgae belonging to the <italic>Dictyotaceae</italic> family and native to the north-western Pacific. As an Invasive Alien Species (IAS), it was first detected in the Strait of Gibraltar in 2015. Since then, <italic>R. okamurae</italic> has been spreading rapidly through the submerged euphotic zone, colonizing from 0 to 50 m depth and generating substantial economic and environmental impacts on the Andalusian coasts (southern Spain). More than 40;,citation_author=Mar Roca;,citation_author=Martha Bonnet Dunbar;,citation_author=Alejandro Román;,citation_author=Isabel Caballero;,citation_author=Maria Laura Zoffoli;,citation_author=Pierre Gernez;,citation_author=Gabriel Navarro;,citation_publication_date=2022-10;,citation_cover_date=2022-10;,citation_year=2022;,citation_doi=10.3389/fmars.2022.1004012;,citation_issn=2296-7745;,citation_volume=9;,citation_journal_title=Frontiers in Marine Science;">
<meta name="citation_reference" content="citation_title=Using a UAV-Mounted multispectral camera for the monitoring of marine macrophytes;,citation_author=Alejandro Román;,citation_author=Antonio Tovar-Sánchez;,citation_author=Irene Olivé;,citation_author=Gabriel Navarro;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_journal_title=Frontiers in Marine Science;,citation_publisher=Frontiers;">
<meta name="citation_reference" content="citation_title=Topographic Analysis of Intertidal Polychaete Reefs (Sabellaria alveolata) at a Very High Spatial Resolution;,citation_abstract=In temperate coastal regions of Western Europe, the polychaete Sabellaria alveolata (Linn&amp;amp;amp;eacute;) builds large intertidal reefs of several hectares on soft-bottom substrates. These reefs are protected by the European Habitat Directive EEC/92/43 under the status of biogenic structures hosting a high biodiversity and providing ecological functions such as protection against coastal erosion. As an alternative to time-consuming field campaigns, a UAV-based Structure-from-Motion photogrammetric survey was carried out in October 2020 over Noirmoutier Island (France) where the second-largest known European reef is located in a tidal delta. A DJI Phantom 4 Multispectral UAV provided a topographic dataset at very high resolutions of 5 cm/pixel for the Digital Surface Model (DSM) and 2.63 cm/pixel for the multispectral orthomosaic images. The reef footprint was mapped using a combination of two topographic indices: the Topographic Openness Index and the Topographic Position Index. The reef structures covered an area of 8.15 ha, with 89;,citation_author=Guillaume Brunier;,citation_author=Simon Oiry;,citation_author=Yves Gruet;,citation_author=Stanislas F. Dubois;,citation_author=Laurent Barillé;,citation_publication_date=2022-01;,citation_cover_date=2022-01;,citation_year=2022;,citation_fulltext_html_url=https://www.mdpi.com/2072-4292/14/2/307;,citation_doi=10.3390/RS14020307;,citation_issn=2072-4292;,citation_volume=14;,citation_journal_title=Remote Sensing 2022, Vol. 14, Page 307;,citation_publisher=Multidisciplinary Digital Publishing Institute;">
<meta name="citation_reference" content="citation_title=Improving intertidal reef mapping using UAV surface, red edge, and near-infrared data;,citation_author=Antoine Collin;,citation_author=Stanislas Dubois;,citation_author=Dorothée James;,citation_author=Thomas Houet;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=3;,citation_volume=3;,citation_journal_title=Drones;,citation_publisher=MDPI;">
<meta name="citation_reference" content="citation_title=UAV-mounted hyperspectral mapping of intertidal macroalgae;,citation_author=Thomas Rossiter;,citation_author=Thomas Furey;,citation_author=Tim McCarthy;,citation_author=Dagmar B Stengel;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_volume=242;,citation_journal_title=Estuarine, Coastal and Shelf Science;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Benthic Intertidal Vegetation from the Tagus Estuary and Aveiro Lagoon;,citation_author=B F R Davies;,citation_author=A I. Sousa;,citation_author=R Figueira;,citation_author=S Oiry;,citation_author=P Gernez;,citation_author=L Barillé;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_doi=10.15468/n4ak6x;,citation_publisher=Université de Nantes via GBIF.org;">
<meta name="citation_reference" content="citation_title=Spatiotemporal index standardization improves the stock assessment of northern shrimp in the Gulf of Maine;,citation_abstract=&amp;amp;amp;lt;p&amp;gt;Estimated trends in relative stock abundance are a primary input to fish stock assessments. Accurate and precise estimates are essential for successful conservation and management. Scientifically designed data collection ensures that estimates of relative abundance are unbiased. However, the statistical efficiency of a design-based estimator may be low under certain circumstances. We apply a recently developed spatiotemporal model that incorporates habitat variables to estimate a model-based abundance index for northern shrimp (Pandalus borealis) in the Gulf of Maine. We contrast this spatiotemporal index with a classical design-based index and evaluate the impacts of differences between the two abundance indices on the stock assessment. We show that using the spatiotemporal index in the assessment model greatly alters the estimates of recruitment and spawning stock biomass and the determination of stock status. Also, incorporating the spatiotemporal index leads to less retrospective bias and outperforms the model with design-based index in terms of predictive performance through a retrospective cross-validation test. Our results suggest that temporal variability of population abundance could be exaggerated by the design-based estimator, and such imprecision may greatly affect the performance of a stock assessment and subsequent development of management decisions.&amp;lt;/p&amp;gt;;,citation_author=Jie Cao;,citation_author=James T. Thorson;,citation_author=R. Anne Richards;,citation_author=Yong Chen;,citation_publication_date=2017-11;,citation_cover_date=2017-11;,citation_year=2017;,citation_doi=10.1139/cjfas-2016-0137;,citation_issn=0706-652X;,citation_volume=74;,citation_journal_title=Canadian Journal of Fisheries and Aquatic Sciences;">
<meta name="citation_reference" content="citation_title=Seasonal spectral variation of Zostera noltii and its influence on pigment-based Vegetation Indices;,citation_author=A Bargain;,citation_author=M Robin;,citation_author=V Méléder;,citation_author=P Rosa;,citation_author=E Le Menn;,citation_author=N Harin;,citation_author=L Barillé;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_volume=446;,citation_journal_title=Journal of experimental marine biology and ecology;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Light and photosynthesis in aquatic ecosystems;,citation_author=John TO Kirk;,citation_publication_date=1994;,citation_cover_date=1994;,citation_year=1994;">
<meta name="citation_reference" content="citation_title=Influence of three-dimensional coral structures on hyperspectral benthic reflectance and water-leaving reflectance;,citation_author=John D Hedley;,citation_author=Maryam Mirhakak;,citation_author=Adam Wentworth;,citation_author=Heidi M Dierssen;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=12;,citation_volume=8;,citation_journal_title=Applied Sciences;,citation_publisher=MDPI;">
<meta name="citation_reference" content="citation_title=In vivo absorbance spectra and the ecophysiology of reef macroalgae;,citation_author=KS Beach;,citation_author=HB Borgeas;,citation_author=NJ Nishimura;,citation_author=CM Smith;,citation_publication_date=1997;,citation_cover_date=1997;,citation_year=1997;,citation_volume=16;,citation_journal_title=Coral Reefs;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Seagrass ecophysiological performance under ocean warming and acidification;,citation_author=Tiago Repolho;,citation_author=Bernardo Duarte;,citation_author=Gisela Dionı́sio;,citation_author=José Ricardo Paula;,citation_author=Ana R Lopes;,citation_author=Inês C Rosa;,citation_author=Tiago F Grilo;,citation_author=Isabel Caçador;,citation_author=Ricardo Calado;,citation_author=Rui Rosa;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=1;,citation_volume=7;,citation_journal_title=Scientific Reports;,citation_publisher=Nature Publishing Group UK London;">
<meta name="citation_reference" content="citation_title=Eutrophication and warming-driven green tides (Ulva rigida) are predicted to increase under future climate change scenarios;,citation_author=Guang Gao;,citation_author=Anthony S Clare;,citation_author=Craig Rose;,citation_author=Gary S Caldwell;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=1;,citation_volume=114;,citation_journal_title=Marine Pollution Bulletin;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Nutrients and Eutrophication;,citation_author=Michelle Devlin;,citation_author=Jon Brodie;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_inbook_title=Marine Pollution–Monitoring, Management and Mitigation;">
<meta name="citation_reference" content="citation_title=Spatial and temporal variation in spectral reflectance: Are seagrass species spectrally distinct?;,citation_author=SK Fyfe;,citation_publication_date=2003;,citation_cover_date=2003;,citation_year=2003;,citation_issue=1part2;,citation_volume=48;,citation_journal_title=Limnology and Oceanography;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Use of hyperspectral reflectance to non-destructively estimate seagrass Zostera noltei biomass;,citation_abstract=Seagrasses are marine plants ranked worldwide amongst the most valuable coastal ecosystems. The global conservation effort requires accurate estimation of seagrass abundance and taxonomic composition. Hyperspectral reflectance has been used to estimate seagrass biomass, despite requiring destructive laboratory measurements that goes against conservation principles. Therefore, we assessed the efficiency of Zostera noltei hyperspectral reflectance to estimate its aboveground biomass in intertidal areas, having Ria de Aveiro coastal lagoon (Portugal) as a case study, with seasonal samplings during a whole year comparing (non-destructive) field- and (destructive) laboratory-based measurements of the spectral signature. Several vegetation indices (VIs) that focus on the spectral absorption of specific pigments were also tested: Normalized Difference Vegetation Indices (NDVI)-like ratios, Double Difference (DD)-like Ratios and Simple Ratios (SR). Here we show that Z. noltei hyperspectral signature, measured in the field and in the laboratory, is clearly related to the aboveground biomass of the plant along the year. We found that among the VIs, NDVI-like ratios showed higher correlation with Z. noltei aboveground biomass than the other types of VIs. Taking into consideration the sensitivity to biomass saturation, the NDVI705 was identified as the best vegetation index to estimate Z. noltei biomass during the whole year and in both type of measurements, up to a saturation level, also demonstrating the successful use of non-destructive methods. The suitability of hyperspectral reflectance measurements in order to estimate Z. noltei aboveground biomass was confirmed, confirming also the potential efficient use of field-based measurements (non-destructive) for conservation practices and sustainable management of the species in intertidal ecosystems and allowing aboveground biomass to be potentially proposed as a metric for the evaluation of seagrass healthy condition under EU policies (e.g. Water Framework Directive, Marine Strategy Framework Directive).;,citation_author=Valentina Costa;,citation_author=João Serôdio;,citation_author=Ana I. Lillebø;,citation_author=Ana I. Sousa;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S1470160X20309572;,citation_doi=https://doi.org/10.1016/j.ecolind.2020.107018;,citation_issn=1470-160X;,citation_volume=121;,citation_journal_title=Ecological Indicators;">
<meta name="citation_reference" content="citation_title=Impact of radiometric variability on ultra-high resolution hyperspectral imagery over aquatic vegetation: preliminary results;,citation_author=Erika Piaser;,citation_author=Andrea Berton;,citation_author=Rossano Bolpagni;,citation_author=Michele Caccia;,citation_author=Maria Beatrice Castellani;,citation_author=Andrea Coppi;,citation_author=Alice Dalla Vecchia;,citation_author=Francesca Gallivanone;,citation_author=Giovanna Sona;,citation_author=Paolo Villa;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_journal_title=IEEE Journal of Selected Topics in Applied Earth Observations and Remote Sensing;,citation_publisher=IEEE;">
<meta name="citation_reference" content="citation_title=Remote sensing of coastal vegetation phenology in a cold temperate intertidal system: implications for classification of coastal habitats;,citation_author=Brigitte Légaré;,citation_author=Simon Bélanger;,citation_author=Rakesh Kumar Singh;,citation_author=Pascal Bernatchez;,citation_author=Mathieu Cusson;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_issue=13;,citation_volume=14;,citation_journal_title=Remote Sensing;,citation_publisher=MDPI;">
<meta name="citation_reference" content="citation_title=Satellite sensor requirements for monitoring essential biodiversity variables of coastal ecosystems;,citation_author=Frank E Muller-Karger;,citation_author=Erin Hestir;,citation_author=Christiana Ade;,citation_author=Kevin Turpie;,citation_author=Dar A Roberts;,citation_author=David Siegel;,citation_author=Robert J Miller;,citation_author=David Humm;,citation_author=Noam Izenberg;,citation_author=Mary Keller;,citation_author=others;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=3;,citation_volume=28;,citation_journal_title=Ecological applications;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Remote Sensing and Invasive Plants in Coastal Ecosystems: What We Know So Far and Future Prospects;,citation_author=Priscila Villalobos Perna;,citation_author=Mirko Di Febbraro;,citation_author=Maria Laura Carranza;,citation_author=Flavio Marzialetti;,citation_author=Michele Innangi;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=2;,citation_volume=12;,citation_journal_title=Land;,citation_publisher=MDPI;">
<meta name="citation_reference" content="citation_title=Spatiotemporally explicit prediction of future ecosystem service provisioning in response to climate change, sea level rise, and adaptation strategies;,citation_abstract=We present a framework to relate the provision of multiple, interacting ecosystem services to climate change and land use adaptation, by combining hydrological process models with statistical species’ distribution models and transfer functions to upscale plot data to the landscape scale. Functional traits of the projected plant communities predict provisional and species conservation services, whereas the hydrological model predicts water-related regulatory services. We applied the framework to coastal areas of the Baltic Sea to predict future ecosystem service outputs in yearly time steps from 2010 to 2100, based on a “high emissions” climate change scenario, a projected sea-level rise of 1.05&nbsp;m, and four land-management options corresponding to future coastal adaptation strategies. The “Hold the line” strategy implies continual pumping of excess rainwater into the sea to allow farm income from grassland usage, together with high conservation values for rare plants and meadow birds. Towards the end of the century, with an increasing sea-level rise, this results in reverse groundwater flows from sea to land and soil salinization of grasslands. Conversely, “managed realignment” implies the abandonment of pumping, thereby changing grasslands to reeds, reducing farm income and species conservation values, but promoting water retention and carbon sequestration by peat production. Between 2010 and 2100, the time series averaged across all landscape patches masked substantial spatial shifts in the outputs of ecosystem services from lower to higher elevations, emphasizing the relevance of considering both time and space. Multifunctional landscapes, by compromising between provisioning and regulatory ecosystem services, may create the response diversity needed to successfully adapt to climate change and sea-level rise.;,citation_author=Anett Schibalski;,citation_author=Michael Kleyer;,citation_author=Martin Maier;,citation_author=Boris Schröder;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S2212041622000109;,citation_doi=https://doi.org/10.1016/j.ecoser.2022.101414;,citation_issn=2212-0416;,citation_volume=54;,citation_journal_title=Ecosystem Services;">
<meta name="citation_reference" content="citation_title=A predictive model based on multiple coastal anthropogenic pressures explains the degradation status of a marine ecosystem: Implications for management and conservation;,citation_author=Florian Holon;,citation_author=Guilhem Marre;,citation_author=Valeriano Parravicini;,citation_author=Nicolas Mouquet;,citation_author=Thomas Bockel;,citation_author=Pierre Descamp;,citation_author=Anne-Sophie Tribot;,citation_author=Pierre Boissery;,citation_author=Julie Deter;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_volume=222;,citation_journal_title=Biological Conservation;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Global change and acceleration of anthropic pressures on Patagonian ecosystems;,citation_author=Pablo A Marquet;,citation_author=Alejandro H Buschmann;,citation_author=Derek Corcoran;,citation_author=Patricio Andrés Dı́az;,citation_author=Taryn Fuentes-Castillo;,citation_author=René Garreaud;,citation_author=Patricio Pliscoff;,citation_author=Alejandro Salazar;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_inbook_title=Conservation in Chilean Patagonia: Assessing the State of Knowledge, Opportunities, and Challenges;">
<meta name="citation_reference" content="citation_title=Using sentinel-2 satellite imagery to develop microphytobenthos-based water quality indices in estuaries;,citation_author=Simon Oiry;,citation_author=Laurent Barillé;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_volume=121;,citation_journal_title=Ecological Indicators;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Satellite-assisted monitoring of water quality to support the implementation of the Water Framework Directive;,citation_author=E Papathanasopoulou;,citation_author=SGH Simis;,citation_author=K Alikas;,citation_author=A Ansper;,citation_author=J Anttila;,citation_author=A Barillé;,citation_author=L Barillé;,citation_author=V Brando;,citation_author=M Bresciani;,citation_author=M Bučas;,citation_author=others;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_journal_title=EOMORES white paper;">
<meta name="citation_reference" content="citation_title=Monitoring and modelling marine zooplankton in a changing climate;,citation_author=Lavenia Ratnarajah;,citation_author=Rana Abu-Alhaija;,citation_author=Angus Atkinson;,citation_author=Sonia Batten;,citation_author=Nicholas J Bax;,citation_author=Kim S Bernard;,citation_author=Gabrielle Canonico;,citation_author=Astrid Cornils;,citation_author=Jason D Everett;,citation_author=Maria Grigoratou;,citation_author=others;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=1;,citation_volume=14;,citation_journal_title=Nature Communications;,citation_publisher=Nature Publishing Group UK London;">
<meta name="citation_reference" content="citation_title=Sentinel-2 remote sensing of Zostera noltei-dominated intertidal seagrass meadows;,citation_abstract=Accurate habitat mapping methods are urgently required for the monitoring, conservation, and management of blue carbon ecosystems and their associated services. This study focuses on exposed intertidal seagrass meadows, which play a major role in the functioning of nearshore ecosystems. Using Sentinel-2 (S2) data, we demonstrate that satellite remote sensing can be used to map seagrass percent cover (SPC) and leaf biomass (SB), and to characterize its seasonal dynamics. In situ radiometric and biological data were acquired from three intertidal meadows of Zostera noltei along the European Atlantic coast in the summers of 2018 and 2019. This information allowed algorithms to estimate SPC and SB from a vegetation index to be developed and assessed. Importantly, a single SPC algorithm could consistently be used to study Z. noltei-dominated meadows at several sites along the European Atlantic coast. To analyze the seagrass seasonal cycle and to select images corresponding to its maximal development, a two-year&nbsp;S2 dataset was acquired for a French study site in Bourgneuf Bay. The potential of S2 to characterize the Z. noltei seasonal cycle was demonstrated for exposed intertidal meadows. The SPC map that best represented seagrass growth annual maximum was validated using in situ measurements, resulting in a root mean square difference of 14;,citation_author=Maria Laura Zoffoli;,citation_author=Pierre Gernez;,citation_author=Philippe Rosa;,citation_author=Anthony Le Bris;,citation_author=Vittorio E. Brando;,citation_author=Anne-Laure Barillé;,citation_author=Nicolas Harin;,citation_author=Steef Peters;,citation_author=Kathrin Poser;,citation_author=Lazaros Spaias;,citation_author=Gloria Peralta;,citation_author=Laurent Barillé;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S0034425720303904;,citation_doi=https://doi.org/10.1016/j.rse.2020.112020;,citation_issn=0034-4257;,citation_volume=251;,citation_journal_title=Remote Sensing of Environment;">
<meta name="citation_reference" content="citation_title=“DIRECTIVE 2000/60/EC OF THE EUROPEAN PARLIAMENT AND OF THE COUNCIL of 23 October 2000 establishing a framework for Community action in the field of water policy” or, in short, the EU Water Framework Directive;,citation_author=undefined European-Commission;,citation_publication_date=2000;,citation_cover_date=2000;,citation_year=2000;,citation_issue=1;,citation_volume=L 327;,citation_journal_title=Official Journal of the European Communities;">
<meta name="citation_reference" content="citation_title=Angiosperms (seagrass) within the EU water framework directive: a UK perspective;,citation_author=Jo Foden;,citation_author=DP Brazier;,citation_publication_date=2007;,citation_cover_date=2007;,citation_year=2007;,citation_issue=1-6;,citation_volume=55;,citation_journal_title=Marine Pollution Bulletin;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=One hundred priority questions for advancing seagrass conservation in Europe;,citation_author=Lina Mtwana Nordlund;,citation_author=Richard KF Unsworth;,citation_author=Sieglind Wallner-Hahn;,citation_author=Lavenia Ratnarajah;,citation_author=Pedro Beca-Carretero;,citation_author=Elmira Boikova;,citation_author=James C Bull;,citation_author=Rosa M Chefaoui;,citation_author=Carmen B Santos;,citation_author=Karine Gagnon;,citation_author=others;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_journal_title=Plants, People, Planet;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=The global distribution of seagrass meadows;,citation_author=Len J McKenzie;,citation_author=Lina M Nordlund;,citation_author=Benjamin L Jones;,citation_author=Leanne C Cullen-Unsworth;,citation_author=Chris Roelfsema;,citation_author=Richard KF Unsworth;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_issue=7;,citation_volume=15;,citation_journal_title=Environmental Research Letters;,citation_publisher=IOP Publishing;">
<meta name="citation_reference" content="citation_title=Estimating near-infrared leaf reflectance from leaf structural characteristics;,citation_abstract=The relationship between near-infrared reflectance at 800 nm (NIRR) from leaves and characteristics of leaf structure known to affect photosynthesis was investigated in 48 species of alpine angiosperms. This wavelength was selected to discriminate the effects of leaf structure vs. chemical or water content on leaf reflectance. A quantitative model was first constructed correlating NIRR with leaf structural characteristics for six species, and then validated using all 48 species. Among the structural characteristics tested in the reflectance model were leaf trichome density, the presence or absence of both leaf bicoloration and a thick leaf cuticle (&amp;amp;amp;gt;1 μm), leaf thickness, the ratio of palisade mesophyll to spongy mesophyll thickness (PM/SM), the proportion of the mesophyll occupied by intercellular air spaces (%IAS), and the ratio of mesophyll cell surface area exposed to IAS (Ames) per unit leaf surface area (A), or Ames/A. Multiple regression analysis showed that measured NIRR was highly correlated with Ames/A, leaf bicoloration, and the presence of a thick leaf cuticle (r2 = 0.93). In contrast, correlations between NIRR and leaf trichome density, leaf thickness, the PM/SM ratio, or %IAS were relatively weak (r2 &amp;lt; 0.25). A model incorporating Ames/A, leaf bicoloration, and cuticle thickness predicted NIRR accurately for 48 species (r2 = 0.43; P &amp;lt; 0.01) and may be useful for linking remotely sensed data to plant structure and function.;,citation_author=Michèle R. Slaton;,citation_author=E. Raymond Hunt Jr.;,citation_author=William K. Smith;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;,citation_fulltext_html_url=https://bsapubs.onlinelibrary.wiley.com/doi/abs/10.2307/2657019;,citation_issue=2;,citation_doi=https://doi.org/10.2307/2657019;,citation_volume=88;,citation_journal_title=American Journal of Botany;">
<meta name="citation_reference" content="citation_title=Growth and Labelling of Cell Wall Components of the Brown Alga Ectocarpus in Microfluidic Chips;,citation_author=Bénédicte Charrier;,citation_author=Samuel Boscq;,citation_author=Bradley J Nelson;,citation_author=Nino F Läubli;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_volume=8;,citation_journal_title=Frontiers in Marine Science;,citation_publisher=Frontiers Media SA;">
<meta name="citation_reference" content="citation_title=Spectrometric constraint in analysis of benthic diatom biomass using monospecific cultures;,citation_author=V Méléder;,citation_author=L Barillé;,citation_author=P Launeau;,citation_author=V Carrère;,citation_author=Y Rincé;,citation_publication_date=2003;,citation_cover_date=2003;,citation_year=2003;,citation_issue=4;,citation_volume=88;,citation_journal_title=Remote Sensing of Environment;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Long-term climate-associated dynamics of a tropical seagrass meadow: implications for the future;,citation_author=Michael A Rasheed;,citation_author=Richard KF Unsworth;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_volume=422;,citation_journal_title=Marine Ecology Progress Series;">
<meta name="citation_reference" content="citation_title=Dramatic loss of seagrass habitat under projected climate change in the Mediterranean Sea;,citation_author=Rosa M Chefaoui;,citation_author=Carlos M Duarte;,citation_author=Ester A Serrão;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=10;,citation_volume=24;,citation_journal_title=Global change biology;,citation_publisher=Wiley Online Library;">
<meta name="citation_reference" content="citation_title=Opportunities for seagrass research derived from remote sensing: A review of current methods;,citation_author=Bijeesh Kozhikkodan Veettil;,citation_author=Raymond D Ward;,citation_author=Mariana Do Amaral Camara Lima;,citation_author=Milica Stankovic;,citation_author=Pham Ngoc Hoai;,citation_author=Ngo Xuan Quang;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_volume=117;,citation_journal_title=Ecological Indicators;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Variable importance analysis: A comprehensive review;,citation_abstract=Measuring variable importance for computational models or measured data is an important task in many applications. It has drawn our attention that the variable importance analysis (VIA) techniques were developed independently in many disciplines. We are strongly aware of the necessity to aggregate all the good practices in each discipline, and compare the relative merits of each method, so as to instruct the practitioners to choose the optimal methods to meet different analysis purposes, and to guide current research on VIA. To this end, all the good practices, including seven groups of methods, i.e., the difference-based variable importance measures (VIMs), parametric regression and related VIMs, nonparametric regression techniques, hypothesis test techniques, variance-based VIMs, moment-independent VIMs and graphic VIMs, are reviewed and compared with a numerical test example set in two situations (independent and dependent cases). For ease of use, the recommendations are provided for different types of applications, and packages as well as software for implementing these VIA techniques are collected. Prospects for future study of VIA techniques are also proposed.;,citation_author=Pengfei Wei;,citation_author=Zhenzhou Lu;,citation_author=Jingwen Song;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S0951832015001672;,citation_doi=https://doi.org/10.1016/j.ress.2015.05.018;,citation_issn=0951-8320;,citation_volume=142;,citation_journal_title=Reliability Engineering and System Safety;">
<meta name="citation_reference" content="citation_title=“Green tides” are overwhelming the coastline of our blue planet: taking the world’s largest example;,citation_author=Nai-hao Ye;,citation_author=Xiao-wen Zhang;,citation_author=Yu-ze Mao;,citation_author=Cheng-wei Liang;,citation_author=Dong Xu;,citation_author=Jian Zou;,citation_author=Zhi-meng Zhuang;,citation_author=Qing-yin Wang;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_volume=26;,citation_journal_title=Ecological Research;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Nitrogen and phosphorus in Ulva sp. in the Galician Rias Bajas (northwest Spain): Seasonal fluctuations and influence on growth;,citation_author=R Villares;,citation_author=X Puente;,citation_author=A Carballeira;,citation_publication_date=1999;,citation_cover_date=1999;,citation_year=1999;,citation_issue=1/4;,citation_volume=15;,citation_journal_title=Boletin-Instituto Español de Oceanografia;">
<meta name="citation_reference" content="citation_title=Les marées vertes: 40 clés pour comprendre;,citation_author=Alain Ménesguen;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;">
<meta name="citation_reference" content="citation_title=European Nitrogen Assessement-Summary for policy makers;,citation_author=Mark A Sutton;,citation_author=H Van Grinsven;,citation_author=G Billen;,citation_author=A Bleeker;,citation_author=AF Bouwman;,citation_author=O Oenema;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_inbook_title=the European Nitrogen Assessment. Sources, Effects and Policy Perspectives;">
<meta name="citation_reference" content="citation_title=Sargassum invasion of coastal environments: a growing concern;,citation_author=Clifford Louime;,citation_author=Jodany Fortune;,citation_author=Gary Gervais;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=1;,citation_volume=13;,citation_journal_title=American Journal of Environmental Sciences;,citation_publisher=Science Publications;">
<meta name="citation_reference" content="citation_title=Remote sensing of algal blooms: an overview with case studies;,citation_author=Victor Klemas;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;,citation_issue=1A;,citation_volume=28;,citation_journal_title=Journal of coastal research;,citation_publisher=The Coastal Education; Research Foundation 1656 Cypress Row Drive, West&nbsp;…;">
<meta name="citation_reference" content="citation_title=Spotting Green Tides over Brittany from Space: Three Decades of Monitoring with Landsat Imagery;,citation_abstract=Green tides of macroalgae have been negatively affecting the coasts of Brittany, France, for at least five decades, caused by excessive nitrogen inputs from the farming sector. Regular areal estimates of green tide surfaces are publicly available but only from 2002 onwards. Using free and openly accessible Landsat satellite imagery archives over 35 years (1984–2019), this study explores the potential of remote sensing for detection and long-term monitoring of green macroalgae blooms. By using a Google Earth Engine (GEE) script, we were able to detect and quantify green tide surfaces using the Normalized Difference Vegetation Index (NDVI) and Normalized Difference Water Index (NDWI) at four highly affected beaches in Northern Brittany. Mean green tide coverage was derived and analyzed from 1984 to 2019, at both monthly and annual scales. Our results show important interannual and seasonal fluctuations in estimated macroalgae cover. In terms of trends over time, green tide events did not show a decrease in extent at three out of four studied sites. The observed decrease in nitrogen concentrations for the rivers draining the study sites has not resulted in a reduction of green tide extents.;,citation_author=Louise Schreyers;,citation_author=Tim Emmerik;,citation_author=Lauren Biermann;,citation_author=Yves-François Le Lay;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://www.mdpi.com/2072-4292/13/8/1408;,citation_issue=8;,citation_doi=10.3390/rs13081408;,citation_issn=2072-4292;,citation_volume=13;,citation_journal_title=Remote Sensing;">
<meta name="citation_reference" content="citation_title=Monitoring intertidal golden tides dominated by Ectocarpus siliculosus using Sentinel-2 imagery;,citation_abstract=Golden seaweed tides are a global environmental and social problem, that have been occurring along Ireland’s eastern coastline since the 1990s. This study focused on analysing the spatiotemporal dynamics of golden seaweed (Ectocarpus siliculosus) coverage at Dollymount Strand in Dublin Bay (Ireland), between 2016 and 2022, and its relationship with meteorological conditions. Hyperspectral measurements in the field and Sentinel-2 imagery were utilized to monitor macroalgal blooms with a spatiotemporal resolution of 10&nbsp;m and minimum costs. The normalized difference vegetation index (NDVI) values filtered between 0.1 and 1 were used to identify the coverage of golden seaweeds. The results showed that the golden seaweed coverage extended over 99;,citation_author=Sara Haro;,citation_author=Ricardo Bermejo;,citation_author=Robert Wilkes;,citation_author=Lorraine Bull;,citation_author=Liam Morrison;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S1569843223002753;,citation_doi=https://doi.org/10.1016/j.jag.2023.103451;,citation_issn=1569-8432;,citation_volume=122;,citation_journal_title=International Journal of Applied Earth Observation and Geoinformation;">
<meta name="citation_reference" content="citation_title=BioIntertidal Mapper software: A satellite approach for NDVI-based intertidal habitat mapping;,citation_author=Sara Haro;,citation_author=Jonathan Jimenez-Reina;,citation_author=Ricardo Bermejo;,citation_author=Liam Morrison;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_volume=24;,citation_journal_title=SoftwareX;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=A sentinel watching over inter-tidal seagrass phenology across Western Europe and North Africa;,citation_author=Bede Ffinian Rowe Davies;,citation_author=Simon Oiry;,citation_author=Philippe Rosa;,citation_author=Maria Laura Zoffoli;,citation_author=Ana I Sousa;,citation_author=Oliver R Thomas;,citation_author=Dan A Smale;,citation_author=Melanie C Austen;,citation_author=Lauren Biermann;,citation_author=Martin J Attrill;,citation_author=others;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_issue=1;,citation_volume=5;,citation_journal_title=Communications Earth &amp;amp;amp; Environment;,citation_publisher=Nature Publishing Group UK London;">
<meta name="citation_reference" content="citation_title=Intertidal seagrass extent from Sentinel-2 time-series show distinct trajectories in Western Europe;,citation_author=Bede Ffinian Rowe Davies;,citation_author=Simon Oiry;,citation_author=Philippe Rosa;,citation_author=Maria Laura Zoffoli;,citation_author=Ana I Sousa;,citation_author=Oliver R Thomas;,citation_author=Dan A Smale;,citation_author=Melanie C Austen;,citation_author=Lauren Biermann;,citation_author=Martin J Attrill;,citation_author=others;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_volume=312;,citation_journal_title=Remote Sensing of Environment;,citation_publisher=Elsevier;">
</head>

  <body class="quarto-notebook">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> Article Notebook</h6>

            <a href="./index.qmd" class="btn btn-primary quarto-download-embed" download="index.qmd">Download Source</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Draft – Discriminating Seagrasses From Green Macroalgae in European Intertidal areas using high resolution multispectral drone imagery – Draft</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Authors</div>
          <div class="quarto-title-meta-heading">Affiliations</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Simon Oiry <a href="mailto:oirysimon@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0001-7161-5246" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Bede Ffinian Rowe Davies </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Ana I. Sousa </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        ECOMARE - Laboratory for Innovation and Sustainability of Marine Biological Resources, CESAM – Centre for Environmental and Marine Studies, Department of Biology, University of Aveiro, Campus Universitário de Santiago, 3810-193 Aveiro, Portugal
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Philippe Rosa </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Maria Laura Zoffoli </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Consiglio Nazionale delle Ricerche, Istituto di Scienze Marine (CNR-ISMAR), 00133 Rome, Italy
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Guillaume Brunier </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        BRGM French Geological Survey, Cayenne 97300, French Guiana
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Pierre Gernez </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Laurent Barillé </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Institut des Substances et Organismes de la Mer, ISOMer, Nantes Université, UR 2160, F-44000 Nantes, France
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
                <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">October 14, 2024</p>
            </div>
          </div>
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>

    <div>
      <div class="abstract">
        <div class="block-title">Abstract</div>
        <p>Coastal areas support seagrass meadows, which offer crucial ecosystem services including erosion control and carbon sequestration. However, these areas are increasingly impacted by human activities, leading to habitat fragmentation and seagrass decline. In situ surveys, traditionally performed to monitor these ecosystems face limitations on temporal and spatial coverage, particularly in intertidal zones, prompting the addition of satellite data within monitoring programs. Yet, satellite remote sensing can be limited by too coarse spatial and/or spectral resolution, making it difficult to discriminate seagrass from other macrophytes in highly heterogenous meadows. Drone (unmanned aerial vehicles – UAV) images at a very high spatial resolution offer a promising solution to address challenges related to spatial heterogeneity and intrapixel mixture. This study focuses on using drone acquisitions with a ten spectral band sensor similar to that onboard Sentinel-2, for mapping intertidal macrophytes at low tide (i.e.&nbsp;during a period of emersion) and effectively discriminating between seagrass and green macroalgae. Nine drone flights were conducted at two different altitudes (12 m and 120 m) across heterogeneous intertidal European habitats in France and Portugal, providing multispectral reflectance observation at very high spatial resolution (8 mm and 80 mm respectively). Taking advantage of their extremly high spatial resolution; the low altitude flights were used to train a Neural Network classifier to discrimintate five taxonomic classes of intertidal vegetation: Magnoliopsida (Seagrass), Chlorophyceae (Green macroalgae), Phaeophyceae (Brown algae), Rhodophyceae (Red macroalgae) and benthic Bacillariophyceae (Diatoms), and validated using concomitant field measurements. Classification of drone imagery resulted in an overall accuracy of 94% across all sites and images, covering a total area of 467 000 m². The model exhibited an accuracy of 96.4% in identifying seagrass. In particular , seagrass and green algae can be discriminated. The very high spatial resolution of the drone data made it possible to assess the influence of spatial resolution on the classification outputs, showing a limited loss in seagrass detection up to about 10m. Altogether, out findings suggest that the Multi-Spectral Instrument (MSI) onboard Sentinel-2 offers a relevant trade-off between its spatial and spectral resolution, thus offering promising perspectives for satellite remote sensing of intertidal biodiversity over lager scales.</p>
      </div>
    </div>

    <div>
      <div class="keywords">
        <div class="block-title">Keywords</div>
        <p>Drone, Remote Sensing, Seagrass, Coastal Ecosystems, Neural Network</p>
      </div>
    </div>

    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#material-methods" id="toc-material-methods" class="nav-link" data-scroll-target="#material-methods"><span class="header-section-number">2</span> Material &amp; Methods</a>
  <ul class="collapse">
  <li><a href="#study-sites" id="toc-study-sites" class="nav-link" data-scroll-target="#study-sites"><span class="header-section-number">2.1</span> Study sites</a></li>
  <li><a href="#field-sampling" id="toc-field-sampling" class="nav-link" data-scroll-target="#field-sampling"><span class="header-section-number">2.2</span> Field sampling</a>
  <ul class="collapse">
  <li><a href="#drone-acquisition" id="toc-drone-acquisition" class="nav-link" data-scroll-target="#drone-acquisition"><span class="header-section-number">2.2.1</span> Drone acquisition</a></li>
  <li><a href="#ground-control-points" id="toc-ground-control-points" class="nav-link" data-scroll-target="#ground-control-points"><span class="header-section-number">2.2.2</span> Ground Control Points</a></li>
  </ul></li>
  <li><a href="#drone-processing" id="toc-drone-processing" class="nav-link" data-scroll-target="#drone-processing"><span class="header-section-number">2.3</span> Drone Processing</a></li>
  <li><a href="#general-workflow" id="toc-general-workflow" class="nav-link" data-scroll-target="#general-workflow"><span class="header-section-number">2.4</span> General Workflow</a>
  <ul class="collapse">
  <li><a href="#training-dataset-building" id="toc-training-dataset-building" class="nav-link" data-scroll-target="#training-dataset-building"><span class="header-section-number">2.4.1</span> Training dataset building</a></li>
  <li><a href="#model-building" id="toc-model-building" class="nav-link" data-scroll-target="#model-building"><span class="header-section-number">2.4.2</span> Model building</a></li>
  <li><a href="#validation" id="toc-validation" class="nav-link" data-scroll-target="#validation"><span class="header-section-number">2.4.3</span> Validation</a></li>
  </ul></li>
  <li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance"><span class="header-section-number">2.5</span> Variable Importance</a></li>
  <li><a href="#influence-of-the-spatial-resolution-on-classification" id="toc-influence-of-the-spatial-resolution-on-classification" class="nav-link" data-scroll-target="#influence-of-the-spatial-resolution-on-classification"><span class="header-section-number">2.6</span> Influence of the spatial resolution on classification</a></li>
  <li><a href="#impact-of-mixed-vegetation-cover-on-the-prediction" id="toc-impact-of-mixed-vegetation-cover-on-the-prediction" class="nav-link" data-scroll-target="#impact-of-mixed-vegetation-cover-on-the-prediction"><span class="header-section-number">2.7</span> Impact of mixed vegetation cover on the prediction</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">3</span> Results</a>
  <ul class="collapse">
  <li><a href="#reflectance-comparison-between-the-two-different-altitudes" id="toc-reflectance-comparison-between-the-two-different-altitudes" class="nav-link" data-scroll-target="#reflectance-comparison-between-the-two-different-altitudes"><span class="header-section-number">3.1</span> Reflectance comparison between the two different altitudes</a></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification"><span class="header-section-number">3.2</span> Classification</a></li>
  <li><a href="#validation-of-the-model" id="toc-validation-of-the-model" class="nav-link" data-scroll-target="#validation-of-the-model"><span class="header-section-number">3.3</span> Validation of the model</a></li>
  <li><a href="#variable-importance-1" id="toc-variable-importance-1" class="nav-link" data-scroll-target="#variable-importance-1"><span class="header-section-number">3.4</span> Variable importance</a></li>
  <li><a href="#effect-of-spatial-resolution-on-the-classification" id="toc-effect-of-spatial-resolution-on-the-classification" class="nav-link" data-scroll-target="#effect-of-spatial-resolution-on-the-classification"><span class="header-section-number">3.5</span> Effect of spatial resolution on the classification</a></li>
  <li><a href="#effect-of-the-percent-cover-on-the-prediction" id="toc-effect-of-the-percent-cover-on-the-prediction" class="nav-link" data-scroll-target="#effect-of-the-percent-cover-on-the-prediction"><span class="header-section-number">3.6</span> Effect of the percent cover on the prediction</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="header-section-number">4</span> Discussion</a>
  <ul class="collapse">
  <li><a href="#vegetation-discrimination" id="toc-vegetation-discrimination" class="nav-link" data-scroll-target="#vegetation-discrimination"><span class="header-section-number">4.1</span> Vegetation Discrimination</a></li>
  <li><a href="#altitude-and-temporal-effects-on-vegetation-prediction-accuracy" id="toc-altitude-and-temporal-effects-on-vegetation-prediction-accuracy" class="nav-link" data-scroll-target="#altitude-and-temporal-effects-on-vegetation-prediction-accuracy"><span class="header-section-number">4.2</span> Altitude and Temporal Effects on Vegetation Prediction Accuracy</a></li>
  <li><a href="#impact-of-pixel-resolution-on-the-prediction-and-implications-for-satellite-remote-sensing" id="toc-impact-of-pixel-resolution-on-the-prediction-and-implications-for-satellite-remote-sensing" class="nav-link" data-scroll-target="#impact-of-pixel-resolution-on-the-prediction-and-implications-for-satellite-remote-sensing"><span class="header-section-number">4.3</span> Impact of Pixel Resolution on the prediction and Implications for Satellite Remote Sensing</a></li>
  <li><a href="#towards-climate-and-biodiversity-applications" id="toc-towards-climate-and-biodiversity-applications" class="nav-link" data-scroll-target="#towards-climate-and-biodiversity-applications"><span class="header-section-number">4.4</span> Towards climate and biodiversity applications</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">5</span> Conclusion</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <div class="cell-container"><div class="cell-decorator"><pre>In [1]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ purrr::compose() masks flextable::compose()
✖ dplyr::filter()  masks stats::filter()
✖ dplyr::lag()     masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyterra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'tidyterra'

L'objet suivant est masqué depuis 'package:stats':

    filter</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidymodels)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Utilities.Package) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : cowplot

Attachement du package : 'cowplot'

L'objet suivant est masqué depuis 'package:lubridate':

    stamp

Le chargement a nécessité le package : patchwork</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'patchwork' a été compilé avec la version R 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'patchwork'

L'objet suivant est masqué depuis 'package:cowplot':

    align_plots

Le chargement a nécessité le package : magrittr

Attachement du package : 'magrittr'

L'objet suivant est masqué depuis 'package:purrr':

    set_names

L'objet suivant est masqué depuis 'package:tidyr':

    extract</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.3.1; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth) </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'rnaturalearthdata'

L'objet suivant est masqué depuis 'package:rnaturalearth':

    countries110</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce) </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>terra 1.7.78

Attachement du package : 'terra'

Les objets suivants sont masqués depuis 'package:magrittr':

    extract, inset

L'objet suivant est masqué depuis 'package:patchwork':

    area

L'objet suivant est masqué depuis 'package:tidyr':

    extract

Les objets suivants sont masqués depuis 'package:flextable':

    align, colorize, rotate, width</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'gt' a été compilé avec la version R 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'gt'

L'objet suivant est masqué depuis 'package:cowplot':

    as_gtable</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'scales'

L'objet suivant est masqué depuis 'package:terra':

    rescale

L'objet suivant est masqué depuis 'package:purrr':

    discard

L'objet suivant est masqué depuis 'package:readr':

    col_factor</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magick)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'magick' a été compilé avec la version R 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to ImageMagick 6.9.12.98
Enabled features: cairo, freetype, fftw, ghostscript, heic, lcms, pango, raw, rsvg, webp
Disabled features: fontconfig, x11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'grid'

L'objet suivant est masqué depuis 'package:terra':

    depth</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(statebins)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terrainr)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggpmisc)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'broom' a été compilé avec la version R 4.4.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'stars' a été compilé avec la version R 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : abind</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'abind' a été compilé avec la version R 4.4.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : lattice

Attachement du package : 'caret'

L'objet suivant est masqué depuis 'package:purrr':

    lift</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstudioapi)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MapRs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : shiny</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'shiny' a été compilé avec la version R 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : plotly</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'plotly' a été compilé avec la version R 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'plotly'

L'objet suivant est masqué depuis 'package:ggplot2':

    last_plot

Les objets suivants sont masqués depuis 'package:flextable':

    highlight, style

L'objet suivant est masqué depuis 'package:stats':

    filter

L'objet suivant est masqué depuis 'package:graphics':

    layout

Le chargement a nécessité le package : zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'zoo' a été compilé avec la version R 4.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'zoo'

L'objet suivant est masqué depuis 'package:terra':

    time&lt;-

Les objets suivants sont masqués depuis 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">100000000</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># terraOptions(cores = 12)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>my_comma<span class="ot">&lt;-</span>scales<span class="sc">::</span><span class="fu">label_comma</span>(<span class="at">accuracy =</span> <span class="cn">NULL</span>, <span class="at">big.mark =</span> <span class="st">","</span>,<span class="at">decimal.mark =</span> <span class="st">"."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Coastal areas are vital hotspots for marine biodiversity, with intertidal seagrass meadows playing a crucial role at the interface between land and ocean <span class="citation" data-cites="unsworth2022">(<a href="#ref-unsworth2022" role="doc-biblioref">Unsworth et al., 2022</a>)</span>. Seagrass meadows provide a myriad of ecosystem services, including carbon sequestration, oxygen production, protection against sea-level rise and coastline erosion, and mitigation of eutrophication <span class="citation" data-cites="unsworth2022 sousa2019blue">(<a href="#ref-sousa2019blue" role="doc-biblioref">Sousa et al., 2019</a>; <a href="#ref-unsworth2022" role="doc-biblioref">Unsworth et al., 2022</a>)</span>. They serve as vital habitats for a diverse array of marine and terrestrial species, providing living, breeding, and feeding grounds <span class="citation" data-cites="gardner2018 Zoffoli2022 jankowska2019">(<a href="#ref-gardner2018" role="doc-biblioref">Gardner and Finlayson, 2018</a>; <a href="#ref-jankowska2019" role="doc-biblioref">Jankowska et al., 2019</a>; <a href="#ref-Zoffoli2022" role="doc-biblioref">Zoffoli et al., 2022</a>)</span>. Due to the concentration of human activities in coastal zones, seagrass meadows are directly exposed to and impacted by anthropogenic pressures. Global regression and fragmentation of seagrass meadows are currently observed due to climate change, diseases, urbanization, land reclamation, dredging, competition with alien species, and reduction in water quality <span class="citation" data-cites="nguyen2021 soissons2018 orth2006 lin2018 duffy2019 rasheed2011long chefaoui2018dramatic sousa2019blue">(<a href="#ref-chefaoui2018dramatic" role="doc-biblioref">Chefaoui et al., 2018</a>; <a href="#ref-duffy2019" role="doc-biblioref">Duffy et al., 2019</a>; <a href="#ref-lin2018" role="doc-biblioref">Lin et al., 2018</a>; <a href="#ref-nguyen2021" role="doc-biblioref">Nguyen et al., 2021</a>; <a href="#ref-orth2006" role="doc-biblioref">Orth et al., 2006</a>; <a href="#ref-rasheed2011long" role="doc-biblioref">Rasheed and Unsworth, 2011</a>; <a href="#ref-soissons2018" role="doc-biblioref">Soissons et al., 2018</a>; <a href="#ref-sousa2019blue" role="doc-biblioref">Sousa et al., 2019</a>)</span>. Both habitat fragmentation and reduction, in turn, can severely compromise the effectiveness of ecosystem services provided by seagrass meadows. While improvements in water quality and hydrodynamics have been recently reported in Europe, allowing an overall recovery of seagrass ecosystems at local and European scales, many coastal waters worldwide are still subjected to strong eutrophication processes <span class="citation" data-cites="deSantos2019 Zoffoli2021 sousa2019blue">(<a href="#ref-deSantos2019" role="doc-biblioref">Los Santos et al., 2019</a>; <a href="#ref-sousa2019blue" role="doc-biblioref">Sousa et al., 2019</a>; <a href="#ref-Zoffoli2021" role="doc-biblioref">Zoffoli et al., 2021</a>)</span>. Coastal eutrophication has been associated to excessive accumulation of green macroalgae, so-called green tides <span class="citation" data-cites="devlin2023nutrients">(<a href="#ref-devlin2023nutrients" role="doc-biblioref">Devlin and Brodie, 2023</a>)</span>. Green tides produce shade and suffocation over seagrass individuals, thus threatening the health of seagrass ecosystems <span class="citation" data-cites="wang2022">(<a href="#ref-wang2022" role="doc-biblioref">Wang et al., 2022</a>)</span>.</p>
<p>The importance of seagrass meadows and the variety of ecosystem services they provide have led to the enhancement of both global and regional programs to monitor Essential Oceanic Variable (EOVs) such as seagrass composition <span class="citation" data-cites="Miloslavich2018">(<a href="#ref-Miloslavich2018" role="doc-biblioref">Miloslavich et al., 2018</a>)</span>, as well as Essential Biodiversity Variable (EBVs) such as seagrass taxonomic diversity, species distribution, population abundance, and phenology <span class="citation" data-cites="Pereira2013">(<a href="#ref-Pereira2013" role="doc-biblioref">Pereira et al., 2013</a>)</span>. Traditionally, indicators of seagrass status have been quantified using <em>in situ</em> measurements. However, the acquisition of field measurements in intertidal zones is notoriously challenging. Intertidal seagrass meadows are only exposed during low tide and can be situated in difficult-to-reach mudflats, potentially leading to inaccurate and limited estimations with conventional sampling techniques <span class="citation" data-cites="nijland2019">(<a href="#ref-nijland2019" role="doc-biblioref">Nijland et al., 2019</a>)</span>. Satellite observations have been proven effective in complementing <em>in situ</em> sampling, allowing for near real-time and consistent retrieval of seagrass EOVs and EBVs over extensive meadows <span class="citation" data-cites="Zoffoli2021 xu2021 Traganos2018 coffer2023 davies2024intertidal davies2024sentinel">(<a href="#ref-coffer2023" role="doc-biblioref">Coffer et al., 2023</a>; <a href="#ref-davies2024intertidal" role="doc-biblioref">Davies et al., 2024a</a>, <a href="#ref-davies2024sentinel" role="doc-biblioref">2024b</a>; <a href="#ref-Traganos2018" role="doc-biblioref">Traganos and Reinartz, 2018</a>; <a href="#ref-xu2021" role="doc-biblioref">Xu et al., 2021</a>; <a href="#ref-Zoffoli2021" role="doc-biblioref">Zoffoli et al., 2021</a>)</span>.</p>
<p>While satellite remote sensing (RS) provides temporally consistent observations over large spatial scales, its utilization over intertidal areas is limited by several constraints. Satellite missions with a high temporal resolution (e.g.&nbsp;daily MODIS observation) are limited by too coarse spatial resolution (&gt;100 m) to accurately map patchy seagrass meadows. Missions with a high spatial resolution such as Sentinel-2 (10 m) or Landsat8/9 (30 m) can be limited by low spectral resolution. The limited number of spectral bands challenges accurate discrimination of seagrass from other co-existing macrophytes. In particular, Chlorophyceae (green algae) and marine Magnoliopsida (seagrass) share the same pigment composition <span class="citation" data-cites="ralph2002 Douay2022">(<a href="#ref-Douay2022" role="doc-biblioref">Douay et al., 2022</a>; <a href="#ref-ralph2002" role="doc-biblioref">Ralph et al., 2002</a>)</span>, resulting in a similar spectral signature in terms of reflectance, especially in the visible range <span class="citation" data-cites="Davies2023 bannari2022">(<a href="#ref-bannari2022" role="doc-biblioref">Bannari et al., 2022</a>; <a href="#ref-Davies2023" role="doc-biblioref">Davies et al., 2023a</a>)</span>. Recently, using advanced machine-learning algorithms trained with a large hyperspectral library of more than 300 field reflectance spectra, <span class="citation" data-cites="Davies2023">Davies et al. (<a href="#ref-Davies2023" role="doc-biblioref">2023a</a>)</span> demonstrated that it was possible to discriminate Magnoliopsida from Chlorophyceae using reflectance spectra at Sentinel-2 ’s spectral resolution. However the application of this approach to satellite RS remains to be validated. Moreover patches of green algae can develop at small spatial scales that are not observable using Sentinel-2 and/or Landsat-8/9 images <span class="citation" data-cites="tuya2013">(<a href="#ref-tuya2013" role="doc-biblioref">Tuya et al., 2013</a>)</span>, especially during the initial stage of a green tide.</p>
<p>Drones (Unmanned Aerial Vehicles – UAVs) can potentially fill the data gaps left by satellite RS and <em>in situ</em> measurements, due to their ability to provide spatially-explicit observations at very high spatial resolutions (pixel size from mm to cm) while capturing data at multi-spectral resolution <span class="citation" data-cites="fairley2022drone oh2017use">(<a href="#ref-fairley2022drone" role="doc-biblioref">Fairley et al., 2022</a>; <a href="#ref-oh2017use" role="doc-biblioref">Oh et al., 2017</a>)</span>. The versatility of drones allows for their application across a diverse thematic range , from coastal zone management <span class="citation" data-cites="adade2021 casella2020 angnuureng2022">(<a href="#ref-adade2021" role="doc-biblioref">Adade et al., 2021</a>; <a href="#ref-angnuureng2022" role="doc-biblioref">Angnuureng et al., 2022</a>; <a href="#ref-casella2020" role="doc-biblioref">Casella et al., 2020</a>)</span> to mapping species distribution <span class="citation" data-cites="joyce2023 tallam2023 Roca2022 Roman2021 Brunier2022Topographic sousa2019blue">(<a href="#ref-Brunier2022Topographic" role="doc-biblioref">Brunier et al., 2022</a>; <a href="#ref-joyce2023" role="doc-biblioref">Joyce et al., 2023</a>; <a href="#ref-Roca2022" role="doc-biblioref">Roca et al., 2022</a>; <a href="#ref-Roman2021" role="doc-biblioref">Román et al., 2021</a>; <a href="#ref-sousa2019blue" role="doc-biblioref">Sousa et al., 2019</a>; <a href="#ref-tallam2023" role="doc-biblioref">Tallam et al., 2023</a>)</span>. However, when applied to coastal habitat mapping, previous case studies were mostly limited to a low number of flights over a single study site, restricting the generalizability of their application over wider geographical scales <span class="citation" data-cites="Roman2021 collin2019improving rossiter2020uav Brunier2022Topographic">(<a href="#ref-Brunier2022Topographic" role="doc-biblioref">Brunier et al., 2022</a>; <a href="#ref-collin2019improving" role="doc-biblioref">Collin et al., 2019</a>; <a href="#ref-Roman2021" role="doc-biblioref">Román et al., 2021</a>; <a href="#ref-rossiter2020uav" role="doc-biblioref">Rossiter et al., 2020</a>)</span>. The present study aimed at analyzing the potential of multispectral drone RS to map intertidal macrophytes over a diverse biogeographical range, with a particular focus on discriminating Magnoliopsida and Chlorophyceae (Seagrass and Green Algae, respectively). Nine drone flights were performed over soft-bottom intertidal areas along the Atlantic coastlines of two European countries (France and Portugal), covering a wide range of habitats, from monospecific seagrass meadows to meadows mixed with green, or red macroalgae. A deep learning algorithm was trained and validated for macrophyte discrimination, emphasizing applicability across diverse sites without a loss of prediction accuracy. The classification maps obtained at a very high spatial resolution with the drone were spatially degraded to satellite resolutions, making it possible to assess the effect of spatial resolution on classification accuracy, and provide insights for coastal habitat mapping using satellite remote sensing.</p>
</section>
<section id="material-methods" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Material &amp; Methods</h1>
<section id="study-sites" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="study-sites"><span class="header-section-number">2.1</span> Study sites</h2>
<p>Seven study sites distributed between France and Portugal were selected for their extensive intertidal seagrass beds. Two sites were located in the Gulf of Morbihan, France (<a href="#fig-map" class="quarto-xref">Figure&nbsp;1</a> A : 47.5791°N, 2.8018°W). This gulf covers an area of 115 km² and is only connected to the sea through a 900 m wide channel. A total of 53 small islands are scattered across the gulf leading to 250 km of shorelines. Patchy seagrass meadows can be found on many of these islands. One of the sites within the gulf was on one its islands (Arz) and the other was located further south on a mainland beach area (Duer). The Gulf of Morbihan is a Natura 2000 site and a Regional Protected Area due to its rich biodiversity, including its seagrass meadows, and is also classified as a RAMSAR site, which highlights its significance as a wetland of international importance. Two other sites were located in Bourgneuf Bay, France (<a href="#fig-map" class="quarto-xref">Figure&nbsp;1</a> B : 46.9849°N, 2.1488°W) which is a 340 km² semi-enclosed macrotidal bay, protected from waves by Noirmoutier Island. Bourgneuf bay hosts a large intertidal seagrass meadow of about 6 km² <span class="citation" data-cites="ZOFFOLI2020112020">(<a href="#ref-ZOFFOLI2020112020" role="doc-biblioref">Zoffoli et al., 2020</a>)</span>. Within this meadow, the sites observed by drones (L’Epine and Barbatre) contained monospecific beds of <em>Nanozostera noltei</em> (dwarf eelgrass, syn. <em>Zostera noltei</em>) with very little mixing with other macrophytes. Bourgneuf Bay is also part of the Natura 2000 network and serves as a RAMSAR site due to its critical habitat for migratory bird species and its extensive seagrass meadows <span class="citation" data-cites="Zoffoli2022">(<a href="#ref-Zoffoli2022" role="doc-biblioref">Zoffoli et al., 2022</a>)</span>. Three sites were surveyed in the Ria de Aveiro Coastal Lagoon in Portugal (<a href="#fig-map" class="quarto-xref">Figure&nbsp;1</a> C : 40.6887°N, 8.6810°W). The extent of this lagoon is ~83 km² (at low tide) with many narrow channels, large salt marshes and many mudflats that uncover at low tide <span class="citation" data-cites="sousa2017blue">(<a href="#ref-sousa2017blue" role="doc-biblioref">Sousa et al., 2017</a>)</span>. It is connected to the open sea through a single channel, with a tidal lag between the North and the South of the lagoon. The southernmost site (Gafanha) is a mudflat located in the Mira channel (one of the four main channels of the lagoon) whereas the two other sites (Mataducos and Marinha Lanzarote) were situated in the middle of the lagoon and only accessible by boat. These Portuguese sites are characterized by a more diverse intertidal vegetation, where patches of seagrass intermingle with red, brown, and green macroalgae. The Aveiro Lagoon, like the other study areas, is a Natura 2000 site and a RAMSAR wetland, recognized for its rich mosaic of habitats and importance for biodiversity, including migratory bird species and intertidal vegetation.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [3]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>world_map <span class="ot">&lt;-</span> sovereignty10 <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(SOVEREIGNT<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"Spain"</span>,<span class="st">"France"</span>,<span class="st">"Portugal"</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Italy"</span>,<span class="st">"Andorra"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"United Kingdom"</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Switzerland"</span>,<span class="st">"Belgium"</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Germany"</span>,<span class="st">"Luxembourg"</span>) ) </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>bbox_europe <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">ymin =</span> <span class="dv">34</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmax =</span> <span class="dv">20</span>, <span class="at">ymax =</span> <span class="dv">55</span>) ,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="fu">st_crs</span>(world_map) ) </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>world_map<span class="ot">&lt;-</span><span class="fu">st_make_valid</span>(world_map) </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>european_union_map_cropped <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(world_map, bbox_europe)  <span class="sc">%&gt;%</span> </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>)  </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>UnitedKingdom<span class="ot">&lt;-</span>sovereignty10 <span class="sc">%&gt;%</span> </span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(SOVEREIGNT<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"United Kingdom"</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>bbox_UK <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">ymin =</span> <span class="dv">45</span>,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmax =</span> <span class="dv">20</span>, <span class="at">ymax =</span> <span class="dv">55</span>) ,</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="fu">st_crs</span>(UnitedKingdom) ) </span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>UnitedKingdom<span class="ot">&lt;-</span><span class="fu">st_make_valid</span>(UnitedKingdom) </span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>UK_map_cropped <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(UnitedKingdom, bbox_UK)  <span class="sc">%&gt;%</span> </span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>) </span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>Europe_sf<span class="ot">&lt;-</span>european_union_map_cropped <span class="sc">%&gt;%</span> </span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(UK_map_cropped) </span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>Projects<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name=</span><span class="fu">c</span>(</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Portugal - Aveiro Lagoon Flights</span><span class="sc">\n</span><span class="st">Lower-Resolution: 4</span><span class="sc">\n</span><span class="st">Higher-Resolution: 1"</span>,</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"France - Morbihan Gulf Flights</span><span class="sc">\n</span><span class="st">Lower-Resolution: 3</span><span class="sc">\n</span><span class="st">Higher-Resolution: 3"</span>,</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"France - Bourgneuf Bay Flights</span><span class="sc">\n</span><span class="st">Lower-Resolution: 4</span><span class="sc">\n</span><span class="st">Higher-Resolution: 0"</span></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>  ) ,</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">Long=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.745730</span>,</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fl">2.840592</span>, </span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fl">2.111868</span>) ,</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lat=</span><span class="fu">c</span>(<span class="fl">40.617610</span>, </span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>        <span class="fl">47.578736</span>,</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>        <span class="fl">47.024719</span>) </span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Long"</span>,<span class="st">"Lat"</span>) )  <span class="sc">%&gt;%</span> </span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">"EPSG:4326"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>)  </span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>Projects_df<span class="ot">&lt;-</span>Projects <span class="sc">%&gt;%</span></span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lon =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">1</span>],</span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Name, <span class="at">into=</span><span class="fu">c</span>(<span class="st">"Country"</span>,<span class="st">"Bay"</span>) ,<span class="at">sep=</span><span class="st">" - "</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Country=</span><span class="fu">as.factor</span>(Country) ,</span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>                <span class="at">Bay=</span><span class="fu">as.factor</span>(Bay) ) </span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>Miniworld_map <span class="ot">&lt;-</span> sovereignty10 <span class="sc">%&gt;%</span> </span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>bbox_EU <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">30</span>, <span class="at">ymin =</span> <span class="dv">20</span>,</span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmax =</span> <span class="dv">50</span>, <span class="at">ymax =</span> <span class="dv">70</span>) ,</span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="fu">st_crs</span>(Miniworld_map) ) </span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a>  MiniEU_map<span class="ot">&lt;-</span><span class="fu">st_crop</span>(Miniworld_map, bbox_EU)  <span class="sc">%&gt;%</span> </span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>)  </span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a>  df_P1<span class="ot">&lt;-</span>Projects_df <span class="sc">%&gt;%</span> </span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Site =</span> <span class="fu">case_when</span>(ID <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Aveiro Lagoon"</span>,</span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a>                            ID <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Morbihan Gulf"</span>,</span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a>                            ID <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Bourgneuf Bay"</span>,</span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>),</span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a>           <span class="at">ID =</span> <span class="fu">case_when</span>(ID <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"C"</span>,</span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a>                          ID <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"A"</span>,</span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"B"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(lon,lat,ID,Site))</span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a>    scaleFUN <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, x),<span class="st">"°N"</span>)</span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-87"><a href="#cb43-87" aria-hidden="true" tabindex="-1"></a>p1  <span class="ot">&lt;-</span></span>
<span id="cb43-88"><a href="#cb43-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(MiniEU_map) <span class="sc">+</span></span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">linewidth=</span><span class="fl">0.5</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,</span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill=</span><span class="st">"#CFCFCF"</span>,<span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb43-91"><a href="#cb43-91" aria-hidden="true" tabindex="-1"></a>    ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>df_P1,</span>
<span id="cb43-92"><a href="#cb43-92" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x=</span>lon,</span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>lat,</span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> ID,</span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true" tabindex="-1"></a>                     <span class="at">description=</span>Site) ,</span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linewidth=</span><span class="fl">0.3</span>,</span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill=</span><span class="st">"goldenrod"</span>,</span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend=</span>F,</span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.size =</span> <span class="dv">2</span>,</span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb43-102"><a href="#cb43-102" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fontsize =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">20</span>),</span>
<span id="cb43-103"><a href="#cb43-103" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">expand =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">radius =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb43-106"><a href="#cb43-106" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb43-107"><a href="#cb43-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.fill =</span> <span class="st">"grey90"</span>)<span class="sc">+</span></span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">2600000</span>,<span class="dv">4100000</span>) ,</span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">1600000</span>,<span class="dv">3100000</span>))<span class="sc">+</span></span>
<span id="cb43-110"><a href="#cb43-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb43-111"><a href="#cb43-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Longitude"</span>,</span>
<span id="cb43-112"><a href="#cb43-112" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Latitude"</span>)<span class="sc">+</span></span>
<span id="cb43-113"><a href="#cb43-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scaleFUN)<span class="sc">+</span></span>
<span id="cb43-114"><a href="#cb43-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>), <span class="st">"cm"</span>),</span>
<span id="cb43-115"><a href="#cb43-115" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb43-116"><a href="#cb43-116" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb43-117"><a href="#cb43-117" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>) )</span>
<span id="cb43-118"><a href="#cb43-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-119"><a href="#cb43-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-120"><a href="#cb43-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-121"><a href="#cb43-121" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/High_res/Figure1/Map_Drone_Sites.png"</span>,p1,<span class="at">width=</span> <span class="dv">10</span>, <span class="at">height=</span><span class="dv">10</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [4]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>world_map <span class="ot">&lt;-</span> sovereignty10 <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(SOVEREIGNT<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"Spain"</span>,<span class="st">"France"</span>,<span class="st">"Portugal"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Italy"</span>,<span class="st">"Andorra"</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"United Kingdom"</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Switzerland"</span>,<span class="st">"Belgium"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Germany"</span>,<span class="st">"Luxembourg"</span>) ) </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>bbox_europe <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">ymin =</span> <span class="dv">34</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmax =</span> <span class="dv">20</span>, <span class="at">ymax =</span> <span class="dv">55</span>) ,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="fu">st_crs</span>(world_map) ) </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>world_map<span class="ot">&lt;-</span><span class="fu">st_make_valid</span>(world_map) </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>european_union_map_cropped <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(world_map, bbox_europe)  <span class="sc">%&gt;%</span> </span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>)  </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>UnitedKingdom<span class="ot">&lt;-</span>sovereignty10 <span class="sc">%&gt;%</span> </span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(SOVEREIGNT<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"United Kingdom"</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) </span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>bbox_UK <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">ymin =</span> <span class="dv">45</span>,</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmax =</span> <span class="dv">20</span>, <span class="at">ymax =</span> <span class="dv">55</span>) ,</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="fu">st_crs</span>(UnitedKingdom) ) </span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>UnitedKingdom<span class="ot">&lt;-</span><span class="fu">st_make_valid</span>(UnitedKingdom) </span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>UK_map_cropped <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(UnitedKingdom, bbox_UK)  <span class="sc">%&gt;%</span> </span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>) </span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>Europe_sf<span class="ot">&lt;-</span>european_union_map_cropped <span class="sc">%&gt;%</span> </span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(UK_map_cropped) </span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>Projects<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name=</span><span class="fu">c</span>(</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Portugal - Aveiro Lagoon Flights</span><span class="sc">\n</span><span class="st">Lower-Resolution: 4</span><span class="sc">\n</span><span class="st">Higher-Resolution: 1"</span>,</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"France - Morbihan Gulf Flights</span><span class="sc">\n</span><span class="st">Lower-Resolution: 3</span><span class="sc">\n</span><span class="st">Higher-Resolution: 3"</span>,</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"France - Bourgneuf Bay Flights</span><span class="sc">\n</span><span class="st">Lower-Resolution: 4</span><span class="sc">\n</span><span class="st">Higher-Resolution: 0"</span></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>  ) ,</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">Long=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.745730</span>,</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fl">2.840592</span>, </span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fl">2.111868</span>) ,</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lat=</span><span class="fu">c</span>(<span class="fl">40.617610</span>, </span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>        <span class="fl">47.578736</span>,</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>        <span class="fl">47.024719</span>) </span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Long"</span>,<span class="st">"Lat"</span>) )  <span class="sc">%&gt;%</span> </span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">"EPSG:4326"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>)  </span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>Projects_df<span class="ot">&lt;-</span>Projects <span class="sc">%&gt;%</span></span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lon =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">1</span>],</span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Name, <span class="at">into=</span><span class="fu">c</span>(<span class="st">"Country"</span>,<span class="st">"Bay"</span>) ,<span class="at">sep=</span><span class="st">" - "</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Country=</span><span class="fu">as.factor</span>(Country) ,</span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>                <span class="at">Bay=</span><span class="fu">as.factor</span>(Bay) ) </span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a>Miniworld_map <span class="ot">&lt;-</span> sovereignty10 <span class="sc">%&gt;%</span> </span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a>bbox_EU <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">30</span>, <span class="at">ymin =</span> <span class="dv">20</span>,</span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xmax =</span> <span class="dv">50</span>, <span class="at">ymax =</span> <span class="dv">70</span>) ,</span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="fu">st_crs</span>(Miniworld_map) ) </span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a>  MiniEU_map<span class="ot">&lt;-</span><span class="fu">st_crop</span>(Miniworld_map, bbox_EU)  <span class="sc">%&gt;%</span> </span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs "</span>)  </span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a>  df_P2<span class="ot">&lt;-</span>Projects_df <span class="sc">%&gt;%</span> </span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Site =</span> <span class="fu">case_when</span>(ID <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Aveiro Lagoon"</span>,</span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a>                            ID <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Morbihan Gulf"</span>,</span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a>                            ID <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Bourgneuf Bay"</span>,</span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>),</span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a>           <span class="at">ID =</span> <span class="fu">case_when</span>(ID <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Portugal"</span>,</span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a>                          ID <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"France"</span>,</span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"France"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(lon,lat,ID,Site))</span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a>    scaleFUN <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, x),<span class="st">"°N"</span>)</span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-87"><a href="#cb44-87" aria-hidden="true" tabindex="-1"></a>p2  <span class="ot">&lt;-</span></span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(MiniEU_map) <span class="sc">+</span></span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">linewidth=</span><span class="fl">0.5</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,</span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill=</span><span class="st">"#CFCFCF"</span>,<span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a>    ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>df_P2,</span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x=</span>lon,</span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>lat,</span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> ID,</span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a>                     <span class="at">description=</span>Site) ,</span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linewidth=</span><span class="fl">0.3</span>,</span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.width =</span> <span class="dv">20</span>,</span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill=</span><span class="st">"goldenrod"</span>,</span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend=</span>F,</span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.size =</span> <span class="dv">2</span>,</span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fontsize =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">20</span>),</span>
<span id="cb44-104"><a href="#cb44-104" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb44-105"><a href="#cb44-105" aria-hidden="true" tabindex="-1"></a>                 <span class="at">expand =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true" tabindex="-1"></a>                 <span class="at">radius =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">10</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb44-108"><a href="#cb44-108" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fill =</span> <span class="st">"grey90"</span>)<span class="sc">+</span></span>
<span id="cb44-109"><a href="#cb44-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">2600000</span>,<span class="dv">4100000</span>) ,</span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">1600000</span>,<span class="dv">3100000</span>))<span class="sc">+</span></span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Longitude"</span>,</span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Latitude"</span>)<span class="sc">+</span></span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scaleFUN)</span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># theme(plot.margin = unit(c(0.1,0.1,0.1,0.1), "cm"),</span></span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       axis.title = element_blank(),</span></span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       axis.text.x = element_text(size = 20),</span></span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       axis.text.y = element_text(size = 20) )</span></span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-120"><a href="#cb44-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-121"><a href="#cb44-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-122"><a href="#cb44-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-123"><a href="#cb44-123" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/High_res/Figure1/Graphical_Abstract_Map.png"</span>,p2,<span class="at">width=</span> <span class="dv">10</span>, <span class="at">height=</span><span class="dv">10</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [5]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>filelist<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="st">"Data/shp/"</span>, <span class="at">pattern =</span> <span class="st">".shp"</span>, <span class="at">recursive =</span> T,<span class="at">full.names =</span> T)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>mask_aveiro <span class="ot">&lt;-</span> filelist[<span class="fu">str_detect</span>(filelist,<span class="st">"mask_land_intertidal_Aveiro"</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>Flight_aveiro<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name=</span><span class="fu">c</span>(</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gafanha"</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Mataducos"</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Marinha Lanzarote"</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  ) ,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(<span class="st">"12m and 120m Flights"</span>,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"120m Flight"</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"120m Flight"</span>),</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Long=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.742485</span>,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fl">8.646980</span>, </span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fl">8.690677</span>) ,</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lat=</span><span class="fu">c</span>(<span class="fl">40.597599</span>, </span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>        <span class="fl">40.666634</span>,</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>        <span class="fl">40.665120</span>) </span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Long"</span>,<span class="st">"Lat"</span>) )  <span class="sc">%&gt;%</span> </span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">"EPSG:4326"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">crs</span>(mask_aveiro))  <span class="sc">%&gt;%</span> </span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lon =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">1</span>],</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>aveiro_plot <span class="ot">&lt;-</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>),</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#CFCFCF"</span>))<span class="sc">+</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mask_aveiro, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),<span class="at">linewidth=</span><span class="fl">0.05</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,<span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">519749</span>,<span class="dv">535233</span>) ,</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">4493310</span>,<span class="dv">4508794</span>) )<span class="sc">+</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>Flight_aveiro,</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x=</span>lon,</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>lat,</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> Name,</span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> Name),</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># description=Description),</span></span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size=</span><span class="fl">0.3</span>,</span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend=</span>F,</span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fontsize =</span> <span class="dv">25</span>,</span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.size =</span> <span class="dv">2</span>,</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">expand =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">radius =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.fill =</span> <span class="st">"grey90"</span>,</span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"mm"</span>)) <span class="sc">+</span></span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># theme_void()+</span></span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Longitude"</span>,</span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Latitude"</span>)<span class="sc">+</span></span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">521000</span>, <span class="at">y =</span> <span class="dv">4507794</span>, <span class="at">label =</span> <span class="st">"C"</span>), <span class="at">size =</span> <span class="dv">20</span>)<span class="sc">+</span></span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">8.70</span>, <span class="sc">-</span><span class="fl">8.60</span>, <span class="at">by =</span> <span class="fl">0.10</span>))<span class="sc">+</span></span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>), <span class="st">"cm"</span>) ,</span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/High_res/Figure1/Map_Aveiro.png"</span>,aveiro_plot,<span class="at">width=</span> <span class="dv">10</span>, <span class="at">height=</span><span class="dv">10</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>filelist<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="st">"Data/shp/"</span>, <span class="at">pattern =</span> <span class="st">".shp"</span>, <span class="at">recursive =</span> T,<span class="at">full.names =</span> T)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>mask_BB <span class="ot">&lt;-</span> filelist[<span class="fu">str_detect</span>(filelist,<span class="st">"mask_land_intertidal_BB"</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>Flight_BB<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name=</span><span class="fu">c</span>(</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Barbâtre"</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L'Epine"</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  ) ,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(<span class="st">"120m Flight"</span>,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"120m Flight"</span>),</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Long=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.166313</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fl">2.228239</span>) ,</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lat=</span><span class="fu">c</span>(<span class="fl">46.956420</span>, </span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>        <span class="fl">46.989515</span>) </span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Long"</span>,<span class="st">"Lat"</span>) )  <span class="sc">%&gt;%</span> </span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">"EPSG:4326"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">crs</span>(mask_BB))  <span class="sc">%&gt;%</span> </span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lon =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">1</span>],</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>BB_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>),</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#CFCFCF"</span>))<span class="sc">+</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mask_BB, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),<span class="at">linewidth=</span><span class="fl">0.05</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,<span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">550609</span>,<span class="dv">579539</span>) ,</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">5189447</span>,<span class="dv">5218377</span>) )<span class="sc">+</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>Flight_BB,</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x=</span>lon,</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>lat,</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> Name,</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> Name),</span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># description=Description),</span></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size=</span><span class="fl">0.3</span>,</span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend=</span>F,</span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.size =</span> <span class="dv">2</span>,</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fontsize =</span> <span class="dv">25</span>,</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">expand =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">radius =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.fill =</span> <span class="st">"grey90"</span>,</span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"mm"</span>)) <span class="sc">+</span></span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Longitude"</span>,</span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Latitude"</span>)<span class="sc">+</span></span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">553460</span>, <span class="at">y =</span> <span class="dv">5216442</span>, <span class="at">label =</span> <span class="st">"B"</span>), <span class="at">size =</span> <span class="dv">20</span>)<span class="sc">+</span></span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>), <span class="st">"cm"</span>) ,</span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.95</span>,<span class="fl">0.2</span>),</span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span>  <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>, </span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">linetype=</span><span class="st">"solid"</span>, </span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colour =</span><span class="st">"black"</span>),</span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb46-64"><a href="#cb46-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-65"><a href="#cb46-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-66"><a href="#cb46-66" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/High_res/Figure1/Map_BB.png"</span>,<span class="at">width=</span> <span class="dv">10</span>, <span class="at">height=</span><span class="dv">10</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [7]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>filelist<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="st">"Data/shp/"</span>, <span class="at">pattern =</span> <span class="st">".shp"</span>, <span class="at">recursive =</span> T,<span class="at">full.names =</span> T)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>mask_Morb <span class="ot">&lt;-</span> filelist[<span class="fu">str_detect</span>(filelist,<span class="st">"mask_land_intertidal_Morbihan"</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>Flight_Morbihan<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name=</span><span class="fu">c</span>(</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Arz"</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Duer"</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  ) ,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(<span class="st">"12m Flight"</span>,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"12m and 120m Flight"</span>),</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Long=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.795961</span>,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fl">2.746186</span>) ,</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lat=</span><span class="fu">c</span>(<span class="fl">47.603260</span>, </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>        <span class="fl">47.543877</span>) </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Long"</span>,<span class="st">"Lat"</span>) )  <span class="sc">%&gt;%</span> </span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">"EPSG:4326"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">crs</span>(mask_Morb))  <span class="sc">%&gt;%</span> </span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lon =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">1</span>],</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>Morbihan_plot<span class="ot">&lt;-</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land mask"</span>),</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#CFCFCF"</span>))<span class="sc">+</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mask_Morb, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),<span class="at">linewidth=</span><span class="fl">0.05</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,<span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">503019</span>,<span class="dv">526177</span>) ,</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">5257824</span>,<span class="dv">5280982</span>))<span class="sc">+</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>Flight_Morbihan,</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x=</span>lon,</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>lat,</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> Name,</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> Name),</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># description=Description),</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size=</span><span class="fl">0.3</span>,</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend=</span>F,</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.size =</span> <span class="dv">2</span>,</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fontsize =</span> <span class="dv">25</span>,</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">expand =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">radius =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.fill =</span> <span class="st">"grey90"</span>,</span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"mm"</span>)) <span class="sc">+</span></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Longitude"</span>,</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Latitude"</span>)<span class="sc">+</span></span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">505000</span>, <span class="at">y =</span> <span class="dv">5280982-1981</span>, <span class="at">label =</span> <span class="st">"A"</span>), <span class="at">size =</span> <span class="dv">20</span>)<span class="sc">+</span></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="fl">2.6</span>, <span class="at">by =</span> <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>), <span class="st">"cm"</span>),</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">"Figures/High_res/Figure1/Map_Morbihan.png"</span>,<span class="at">width=</span> <span class="dv">10</span>, <span class="at">height=</span><span class="dv">10</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">10</span>),</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">l =</span> <span class="dv">11</span>, <span class="at">b =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">20</span>),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">11</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">20</span>, <span class="at">r =</span> <span class="dv">10</span>),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">11</span>, <span class="at">l =</span> <span class="dv">11</span>, <span class="at">b =</span> <span class="dv">20</span>, <span class="at">r =</span> <span class="dv">20</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(layout)</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>Tot <span class="ot">&lt;-</span> magick<span class="sc">::</span><span class="fu">image_ggplot</span>(magick<span class="sc">::</span><span class="fu">image_read</span>(<span class="st">"Figures/High_res/Figure1/Map_Drone_Sites.png"</span>), <span class="at">interpolate =</span> T)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>BB <span class="ot">&lt;-</span> magick<span class="sc">::</span><span class="fu">image_ggplot</span>(magick<span class="sc">::</span><span class="fu">image_read</span>(<span class="st">"Figures/High_res/Figure1/Map_BB.png"</span>), <span class="at">interpolate =</span> T)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>Mor <span class="ot">&lt;-</span> magick<span class="sc">::</span><span class="fu">image_ggplot</span>(magick<span class="sc">::</span><span class="fu">image_read</span>(<span class="st">"Figures/High_res/Figure1/Map_Morbihan.png"</span>), <span class="at">interpolate =</span> T)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>Av <span class="ot">&lt;-</span> magick<span class="sc">::</span><span class="fu">image_ggplot</span>(magick<span class="sc">::</span><span class="fu">image_read</span>(<span class="st">"Figures/High_res/Figure1/Map_Aveiro.png"</span>), <span class="at">interpolate =</span> T)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span>Tot<span class="sc">+</span>Mor<span class="sc">+</span>BB<span class="sc">+</span>Av<span class="sc">+</span>patchwork<span class="sc">::</span><span class="fu">plot_layout</span>(<span class="at">design=</span>layout)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"./Figures/High_res/Figure1/Fig1_Map_Drone_Sites.png"</span>,a, <span class="at">width=</span> <span class="dv">10</span>, <span class="at">height=</span><span class="dv">10</span>, <span class="at">dpi =</span> <span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div id="cell-fig-map" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"./Figures/Low_res/Fig1_Map_Drone_Sites.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="./Figures/Low_res/Fig1_Map_Drone_Sites.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: Location of drone flights in France and Portugal. A: Gulf of Morbihan (Two sites), B: Bourngeuf Bay (Two sites), C: Ria de Aveiro Coastal Lagoon (Three sites). Green areas represents the intertidal zone."><img src="./Figures/Low_res/Fig1_Map_Drone_Sites.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Location of drone flights in France and Portugal. A: Gulf of Morbihan (Two sites), B: Bourngeuf Bay (Two sites), C: Ria de Aveiro Coastal Lagoon (Three sites). Green areas represents the intertidal zone.
</figcaption>
</figure>
</div>
</div>
</div></div>
</section>
<section id="field-sampling" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="field-sampling"><span class="header-section-number">2.2</span> Field sampling</h2>
<section id="drone-acquisition" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="drone-acquisition"><span class="header-section-number">2.2.1</span> Drone acquisition</h3>
<p>At each location, a DJI Matrice 200 quadcopter drone equipped with a Micasense RedEdge Dual MX multispectral camera was flown to take 1.2 million pixel reflectance photographs with ten spectral bands ranging from the blue to the near infrared (NIR): 444, 475, 531, 560, 650, 668, 705, 717, 740 and 840 nm. To ensure consistent lighting conditions across flight paths, the drone’s trajectory was aligned to maintain a solar azimuth angle of 90 degrees. An overlap of 70% and 80% (side and front respectively) between each image was set for each flight. A downwelling light sensor (DLS2) was used to acquire irradiance data concomitantly with the camera measurements. Raw data were calibrated in reflectance using a calibration panel reflective at ~50% provided by the manufacturer. Across all sites, flights were made at two different altitudes : 12 m or/and 120 m, with a spatial resolution of 8 mm and 80 mm, respectively (<a href="#tbl-flights" class="quarto-xref">Table&nbsp;1</a>).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [10]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Country =</span> <span class="fu">c</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="st">"France"</span>,<span class="dv">5</span>),</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="st">"Portugal"</span>,<span class="dv">4</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Site =</span> <span class="fu">c</span>(</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="st">"Gulf of Morbihan"</span>,<span class="dv">3</span>),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="st">"Bourgneuf Bay"</span>,<span class="dv">2</span>),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="st">"Aveiro Lagoon"</span>,<span class="dv">4</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name =</span> <span class="fu">c</span>(</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Arz Island"</span>,</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Duer"</span>,</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Duer"</span>,</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Barbâtre"</span>,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"L'Epine"</span>,</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Marinha Lanzarote"</span>,</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mataducos"</span>,</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gafanha"</span>,</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gafanha"</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">Altitude =</span> <span class="fu">c</span>(</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"12m"</span>,</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"12m"</span>,</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"120m"</span>,</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"120m"</span>,</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"120m"</span>,</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"120m"</span>,</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"120m"</span>,</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"120m"</span>,</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"12m"</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">Utility =</span> <span class="fu">c</span>(</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Training"</span>,</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Training"</span>,</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Validation"</span>,</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Validation"</span>,</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Validation"</span>,</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Validation"</span>,</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Validation"</span>,</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Validation"</span>,</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Training"</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date =</span> <span class="fu">c</span>(</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"29/09/2022"</span>,</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"14/07/2022"</span>,</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"14/07/2022"</span>,</span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">"07/09/2021"</span>,</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"08/07/2021"</span>,</span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"17/06/2022"</span>,</span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"16/06/2022"</span>,</span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"15/06/2022"</span>,</span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"15/06/2022"</span></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a>brdr1 <span class="ot">&lt;-</span> <span class="fu">fp_border_default</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.5</span>)</span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a>brdr2 <span class="ot">&lt;-</span> <span class="fu">fp_border_default</span>(<span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">width =</span> <span class="dv">1</span>)</span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a>brdr3 <span class="ot">&lt;-</span> <span class="fu">fp_border_default</span>(<span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">width =</span> <span class="dv">1</span>)</span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a> i <span class="ot">=</span> <span class="fl">16.5</span> <span class="co"># width of the side borders in the word_document output (in centimeters)</span></span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a> w <span class="ot">=</span> i<span class="sc">*</span><span class="fl">0.3937</span> <span class="co"># width of the side borders in the word_document output (in inches)</span></span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a>flx1<span class="ot">&lt;-</span><span class="fu">flextable</span>(df)  <span class="sc">%&gt;%</span></span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">width</span>(<span class="at">width =</span> (w<span class="sc">/</span>(<span class="fu">ncol</span>(df)))) <span class="sc">%&gt;%</span> </span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge_v</span>(<span class="at">j =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge_v</span>(<span class="at">j =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">border_remove</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline_top</span>(<span class="at">border=</span>brdr1) <span class="sc">%&gt;%</span></span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline</span>(<span class="at">i=</span><span class="dv">5</span>, <span class="at">border=</span>brdr1) <span class="sc">%&gt;%</span></span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline</span>(<span class="at">i=</span><span class="dv">1</span>,<span class="at">j =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">border=</span>brdr2) <span class="sc">%&gt;%</span></span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline</span>(<span class="at">i=</span><span class="dv">2</span>, <span class="at">border=</span>brdr2) <span class="sc">%&gt;%</span></span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline</span>(<span class="at">i=</span><span class="dv">3</span>, <span class="at">j =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">border=</span>brdr3) <span class="sc">%&gt;%</span></span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline</span>(<span class="at">i=</span><span class="dv">4</span>, <span class="at">j =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">border=</span>brdr2) <span class="sc">%&gt;%</span></span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline</span>(<span class="at">i=</span><span class="dv">6</span>, <span class="at">border=</span>brdr2) <span class="sc">%&gt;%</span></span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline</span>(<span class="at">i=</span><span class="dv">6</span>, <span class="at">j =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">border=</span>brdr1) <span class="sc">%&gt;%</span></span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline</span>(<span class="at">i=</span><span class="dv">7</span>, <span class="at">border=</span>brdr2) <span class="sc">%&gt;%</span></span>
<span id="cb50-78"><a href="#cb50-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline</span>(<span class="at">i=</span><span class="dv">8</span>, <span class="at">border=</span>brdr2) <span class="sc">%&gt;%</span></span>
<span id="cb50-79"><a href="#cb50-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline</span>(<span class="at">i=</span><span class="dv">9</span>, <span class="at">border=</span>brdr1) <span class="sc">%&gt;%</span></span>
<span id="cb50-80"><a href="#cb50-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vline</span>(<span class="at">j=</span><span class="dv">2</span>, <span class="at">border =</span> brdr1) <span class="sc">%&gt;%</span></span>
<span id="cb50-81"><a href="#cb50-81" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">align</span>(<span class="at">align =</span> <span class="st">"center"</span>,<span class="at">part =</span> <span class="st">"all"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-82"><a href="#cb50-82" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">align</span>(<span class="at">align =</span> <span class="st">"center"</span>,<span class="at">part =</span> <span class="st">"header"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-83"><a href="#cb50-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set_caption(caption = "Table 1 List of drone Flight, summarising the date, the altitude and the purpose of each flight.") %&gt;%</span></span>
<span id="cb50-84"><a href="#cb50-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_table_properties</span>(<span class="at">layout =</span> <span class="st">"autofit"</span>) </span>
<span id="cb50-85"><a href="#cb50-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-86"><a href="#cb50-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-87"><a href="#cb50-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-88"><a href="#cb50-88" aria-hidden="true" tabindex="-1"></a><span class="fu">save_as_image</span>(flx1, <span class="st">"Figures/High_res/Table1/table_flights.png"</span>, <span class="at">res =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [11]:</pre></div><div class="cell">

<div class="cell-container"><div class="cell-decorator"><pre>In [12]:</pre></div><div class=""><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figures/High_res/Table1/table_flights.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div><div id="tbl-flights" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-flights-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: List of drone flight, summarising the date, the altitude, and the purpose of each flight. 12 m and 120 m flights have a spatial resolution of 8 and 80 mm respectively.
</figcaption>
<div aria-describedby="tbl-flights-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<div class="cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="Figures/High_res/Table1/table_flights.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Table&nbsp;1: List of drone flight, summarising the date, the altitude, and the purpose of each flight. 12 m and 120 m flights have a spatial resolution of 8 and 80 mm respectively."><img src="Figures/High_res/Table1/table_flights.png" class="img-fluid figure-img" width="995"></a></p>
</figure>
</div>
</div>
</div>
</figure>
</div></div></div>
</div></div>
</section>
<section id="ground-control-points" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="ground-control-points"><span class="header-section-number">2.2.2</span> Ground Control Points</h3>
<p>Before each flight, targets used as ground control points were distributed over the study site and georeferenced with a Trimble © Geo XH 6000 differential GPS (dGPS). Ground control points were used to correct georeferencing imprecision of orthomosaics with an horizontal and vertical accuracy of 10cm. A dGPS was also used to georeference quadrats of 0.25 m² ,which assessed the presence or absence of five key taxonomic classes of intertidal vegetation : Bacillariophyceae (unicellular benthic diatoms forming biofilms at the sediment surface during low tide), Phaeophyceae (brown macroalgae), Magnoliopsida (dwarf eelgrass), Chlorophyceae (green macroalgae) and Rhodophyceae (red macroalgae) (<a href="#fig-vegetation" class="quarto-xref">Figure&nbsp;2</a>). Only homogeneous vegetation patches extending over several meters were selected as ground control points. Pictures of each quadrat were uploaded online to the open-portal Global Biodiversity Information Facility (GBIF) platform <span class="citation" data-cites="BedeGbif">(<a href="#ref-BedeGbif" role="doc-biblioref">Davies et al., 2023b</a>)</span>. Each photograph was also processed to estimate the percent cover of each type of vegetation using an image processing software <span class="citation" data-cites="schneider2012nih">(ImageJ, <a href="#ref-schneider2012nih" role="doc-biblioref">Schneider et al., 2012</a>)</span>. Hyperspectral reflectance signatures of each vegetation class were recorded using an ASD FieldSpec HandHeld 2 spectroradiometer, which acquires reflectance between 325 and 1075 nm, with 1 nm of spectral resolution. Hyperspectral signatures served dual purposes: they validate the radiometric calibration of drone data and contribute to misclassification reduction in photo interpretations.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [13]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>micasense<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">"Wavelength_Micasense_DualMX.csv"</span>,<span class="at">recursive =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.delim</span>(<span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>gaf_low_multi<span class="ot">&lt;-</span> <span class="st">"./Data/BiCOME_Flights/Aveiro/Aveiro_MULTI_12m_ortho_1801.tif"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>() </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gaf_low_multi)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"B"</span>,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)))</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a> Gafanha_low_pred<span class="ot">&lt;-</span><span class="st">"./Data/BiCOME_Flights/Aveiro/AveiroLowPrediction_nnNewStanRawMetrics_Preds_NoXantho_7.tif"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rast</span>()</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">names</span>(Gafanha_low_pred)<span class="ot">&lt;-</span><span class="st">"pred"</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co"># arz_multi&lt;- imglist %&gt;% </span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(site == "Arz", </span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co">#          type == "ortho") %&gt;% </span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice(1) %&gt;% </span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(path) %&gt;% </span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   rast()</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  names(arz_multi)&lt;-c(paste0("B",c(1:10)))</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="co"># arz_pred&lt;- imglist %&gt;% </span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(site == "Arz", </span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="co">#          type == "Pred",</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="co">#          str_detect(path, "7by7")) %&gt;% </span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice(1) %&gt;% </span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull(path) %&gt;% </span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   rast()</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="co">#  names(arz_pred)&lt;-"pred"</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>gaf<span class="ot">&lt;-</span><span class="fu">rast</span>(<span class="fu">list</span>(gaf_low_multi,Gafanha_low_pred)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">xy =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>  dtplyr<span class="sc">::</span><span class="fu">lazy_dt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(B1 <span class="sc">!=</span> <span class="dv">65535</span>,</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>                pred <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Class =</span> <span class="st">"pred"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pxl_ID =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Class,pxl_ID), <span class="at">names_to =</span> <span class="st">"band"</span>,<span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(micasense, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"band"</span> <span class="ot">=</span> <span class="st">"Band_ID"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Class, Wavelength) <span class="sc">%&gt;%</span> </span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sd =</span> <span class="fu">sd</span>(value),</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>                   <span class="at">max =</span> <span class="fu">max</span>(value),</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>                   <span class="at">min =</span> <span class="fu">min</span>(value),</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>                   <span class="at">median =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span>  </span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">case_when</span>(Class <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Bare Sediment"</span>,</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>                              Class <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"D - Chloropyceae"</span>,</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>                              Class <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Bare Sediment"</span>,</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>                              Class <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"A - MagnoliopsidaL"</span>,</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>                              Class <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"E - Microphytobenthos"</span>,</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>                              Class <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"A - Magnoliopsida"</span>,</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>                              Class <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"B - Phaeophyceae"</span>,</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>                              Class <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"C - Rhodophyceae"</span>,</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>                              Class <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Sun Glint"</span>,</span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>                              Class <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Water"</span>,</span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a>                              Class <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>))</span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a>spectra<span class="ot">&lt;-</span>gaf <span class="sc">%&gt;%</span> </span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">!=</span> <span class="st">"Bare Sediment"</span>,</span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"Sun Glint"</span>,</span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"A - MagnoliopsidaL"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Wavelength, <span class="at">y =</span> mean<span class="sc">/</span><span class="dv">10000</span>, <span class="at">color =</span> Class), <span class="at">linewidth =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">x=</span> <span class="dv">470</span>,<span class="at">y=</span><span class="fl">0.7</span>, <span class="at">label =</span> <span class="st">"F"</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#389318"</span>, <span class="st">"#873e23"</span>, <span class="st">"#b3002d"</span>, <span class="st">"#b3ff1a"</span>, <span class="st">"#DAA520"</span>))<span class="sc">+</span></span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Reflectance"</span>)<span class="sc">+</span></span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Wavelength (nm)"</span>)<span class="sc">+</span></span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.7</span>),</span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>, <span class="at">alpha=</span><span class="dv">0</span>), <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">"cm"</span>),</span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text.align =</span> <span class="dv">0</span>,</span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color=</span><span class="st">"black"</span>))</span>
<span id="cb52-88"><a href="#cb52-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-89"><a href="#cb52-89" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/High_res/Figure2/Spectral_shapes.png"</span>,spectra, <span class="at">bg =</span> <span class="st">"transparent"</span>,  <span class="at">height =</span> <span class="dv">2</span>, <span class="at">width =</span> <span class="dv">3</span>, <span class="at">dpi =</span> <span class="dv">2000</span>)</span>
<span id="cb52-90"><a href="#cb52-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-91"><a href="#cb52-91" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">image_ggplot</span>(magick<span class="sc">::</span><span class="fu">image_read</span>(<span class="st">"Figures/High_res/Figure2/Spectral_shapes.png"</span>), <span class="at">interpolate =</span> T)</span>
<span id="cb52-92"><a href="#cb52-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-93"><a href="#cb52-93" aria-hidden="true" tabindex="-1"></a><span class="co"># sp&lt;-ggplot()+</span></span>
<span id="cb52-94"><a href="#cb52-94" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_spatraster_rgb(data = rast("Figures/Spectral_shapes.png"),maxcell = 4009008)+</span></span>
<span id="cb52-95"><a href="#cb52-95" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_equal()+</span></span>
<span id="cb52-96"><a href="#cb52-96" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme_void()+</span></span>
<span id="cb52-97"><a href="#cb52-97" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text = element_blank(), </span></span>
<span id="cb52-98"><a href="#cb52-98" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.title = element_blank(), </span></span>
<span id="cb52-99"><a href="#cb52-99" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.ticks = element_blank(),</span></span>
<span id="cb52-100"><a href="#cb52-100" aria-hidden="true" tabindex="-1"></a><span class="co">#         panel.background = element_rect(fill='transparent'),</span></span>
<span id="cb52-101"><a href="#cb52-101" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.background = element_rect(fill='transparent', color=NA),</span></span>
<span id="cb52-102"><a href="#cb52-102" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.ticks.length = unit(0, "pt"),</span></span>
<span id="cb52-103"><a href="#cb52-103" aria-hidden="true" tabindex="-1"></a><span class="co">#         panel.grid.major=element_blank(), </span></span>
<span id="cb52-104"><a href="#cb52-104" aria-hidden="true" tabindex="-1"></a><span class="co">#         panel.grid.minor=element_blank(), </span></span>
<span id="cb52-105"><a href="#cb52-105" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.margin = margin(0, 0, 0, 0, "pt"))</span></span>
<span id="cb52-106"><a href="#cb52-106" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-107"><a href="#cb52-107" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-108"><a href="#cb52-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Magno &lt;- magick::image_read("Data/Pictures/Figure2/Magnoliopsida_cropped2.png")%&gt;%</span></span>
<span id="cb52-109"><a href="#cb52-109" aria-hidden="true" tabindex="-1"></a><span class="co">#   # magick::image_rotate(90)%&gt;%</span></span>
<span id="cb52-110"><a href="#cb52-110" aria-hidden="true" tabindex="-1"></a><span class="co">#   grid::rasterGrob()</span></span>
<span id="cb52-111"><a href="#cb52-111" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-112"><a href="#cb52-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Brown &lt;- magick::image_read("Data/Pictures/Figure2/Phaeophyceae_cropped.png")%&gt;%</span></span>
<span id="cb52-113"><a href="#cb52-113" aria-hidden="true" tabindex="-1"></a><span class="co">#   grid::rasterGrob()</span></span>
<span id="cb52-114"><a href="#cb52-114" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-115"><a href="#cb52-115" aria-hidden="true" tabindex="-1"></a><span class="co"># Red &lt;- magick::image_read("Data/Pictures/Figure2/Rhodophyceae_cropped.png")%&gt;% </span></span>
<span id="cb52-116"><a href="#cb52-116" aria-hidden="true" tabindex="-1"></a><span class="co">#   grid::rasterGrob()</span></span>
<span id="cb52-117"><a href="#cb52-117" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-118"><a href="#cb52-118" aria-hidden="true" tabindex="-1"></a><span class="co"># green &lt;- magick::image_read("Data/Pictures/Figure2/Chlorophyceae_cropped.png")%&gt;% </span></span>
<span id="cb52-119"><a href="#cb52-119" aria-hidden="true" tabindex="-1"></a><span class="co">#   grid::rasterGrob()</span></span>
<span id="cb52-120"><a href="#cb52-120" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-121"><a href="#cb52-121" aria-hidden="true" tabindex="-1"></a><span class="co"># MPB &lt;- magick::image_read("Data/Pictures/Figure2/Bacillariophyceae_cropped.png")%&gt;% </span></span>
<span id="cb52-122"><a href="#cb52-122" aria-hidden="true" tabindex="-1"></a><span class="co">#   grid::rasterGrob()</span></span>
<span id="cb52-123"><a href="#cb52-123" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-124"><a href="#cb52-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Lines&lt;-data.frame(x=c(10,20,10),</span></span>
<span id="cb52-125"><a href="#cb52-125" aria-hidden="true" tabindex="-1"></a><span class="co">#                   y=c(-0.1,-0.1,10),</span></span>
<span id="cb52-126"><a href="#cb52-126" aria-hidden="true" tabindex="-1"></a><span class="co">#                   xend=c(10,20,30),</span></span>
<span id="cb52-127"><a href="#cb52-127" aria-hidden="true" tabindex="-1"></a><span class="co">#                   yend=c(20,20,10))</span></span>
<span id="cb52-128"><a href="#cb52-128" aria-hidden="true" tabindex="-1"></a><span class="co"># labels&lt;-data.frame(name = c("A","B","C","D","E"),</span></span>
<span id="cb52-129"><a href="#cb52-129" aria-hidden="true" tabindex="-1"></a><span class="co">#                    x= c(1,11,21,11,21),</span></span>
<span id="cb52-130"><a href="#cb52-130" aria-hidden="true" tabindex="-1"></a><span class="co">#                    y=c(19,19,19,1,1))</span></span>
<span id="cb52-131"><a href="#cb52-131" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-132"><a href="#cb52-132" aria-hidden="true" tabindex="-1"></a><span class="co"># a&lt;-ggplot(expand_grid(x = 0:30,y=0:20),aes(x = x, y = y) ) +</span></span>
<span id="cb52-133"><a href="#cb52-133" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(alpha=0) +</span></span>
<span id="cb52-134"><a href="#cb52-134" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_fixed()+</span></span>
<span id="cb52-135"><a href="#cb52-135" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(Magno, 0,10, 0, 20) +</span></span>
<span id="cb52-136"><a href="#cb52-136" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(green, 10,20, 10, 20)+</span></span>
<span id="cb52-137"><a href="#cb52-137" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(Red, 10,20, 0, 10)+</span></span>
<span id="cb52-138"><a href="#cb52-138" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(Brown, 20,30, 10, 20)+</span></span>
<span id="cb52-139"><a href="#cb52-139" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(MPB, 20,30, 0,10)+</span></span>
<span id="cb52-140"><a href="#cb52-140" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_segment(data=Lines,aes(x=x,y=y,xend=xend,yend=yend),</span></span>
<span id="cb52-141"><a href="#cb52-141" aria-hidden="true" tabindex="-1"></a><span class="co">#                colour="white",linewidth=2)+</span></span>
<span id="cb52-142"><a href="#cb52-142" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(ggplotGrob(spectra), 5,25, 5,15)+</span></span>
<span id="cb52-143"><a href="#cb52-143" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_label(data=labels,aes(x=x,y=y,label=name), size = 10)+</span></span>
<span id="cb52-144"><a href="#cb52-144" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_void()+</span></span>
<span id="cb52-145"><a href="#cb52-145" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.title.x = element_blank(),</span></span>
<span id="cb52-146"><a href="#cb52-146" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.title.y = element_blank(),</span></span>
<span id="cb52-147"><a href="#cb52-147" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.x = element_blank(),</span></span>
<span id="cb52-148"><a href="#cb52-148" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_blank(),</span></span>
<span id="cb52-149"><a href="#cb52-149" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.ticks.x = element_blank(),</span></span>
<span id="cb52-150"><a href="#cb52-150" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.ticks.y = element_blank(),</span></span>
<span id="cb52-151"><a href="#cb52-151" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.margin = grid::unit(c(0.01,0.01,0.01,0.01), "mm"),</span></span>
<span id="cb52-152"><a href="#cb52-152" aria-hidden="true" tabindex="-1"></a><span class="co">#         # rect = element_blank(),</span></span>
<span id="cb52-153"><a href="#cb52-153" aria-hidden="true" tabindex="-1"></a><span class="co">#         panel.margin = grid::unit(c(0.01, 0.01, 0.01, 0.01), "mm"))</span></span>
<span id="cb52-154"><a href="#cb52-154" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-155"><a href="#cb52-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Lines1&lt;-data.frame(x=c(0,10,20,30),</span></span>
<span id="cb52-156"><a href="#cb52-156" aria-hidden="true" tabindex="-1"></a><span class="co">#                   y=c(10,0,0,0),</span></span>
<span id="cb52-157"><a href="#cb52-157" aria-hidden="true" tabindex="-1"></a><span class="co">#                   xend=c(40.1,10,20,30),</span></span>
<span id="cb52-158"><a href="#cb52-158" aria-hidden="true" tabindex="-1"></a><span class="co">#                   yend=c(10,10,10,10))</span></span>
<span id="cb52-159"><a href="#cb52-159" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-160"><a href="#cb52-160" aria-hidden="true" tabindex="-1"></a><span class="co"># labels1&lt;-data.frame(name = c("A","B","C","D","E"),</span></span>
<span id="cb52-161"><a href="#cb52-161" aria-hidden="true" tabindex="-1"></a><span class="co">#                    x= c(1,1,11,21,31),</span></span>
<span id="cb52-162"><a href="#cb52-162" aria-hidden="true" tabindex="-1"></a><span class="co">#                    y=c(29,9,9,9,9))</span></span>
<span id="cb52-163"><a href="#cb52-163" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-164"><a href="#cb52-164" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(expand_grid(x = 0:40,y=0:30),aes(x = x, y = y) ) +</span></span>
<span id="cb52-165"><a href="#cb52-165" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(alpha=0) +</span></span>
<span id="cb52-166"><a href="#cb52-166" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_fixed()+</span></span>
<span id="cb52-167"><a href="#cb52-167" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(Magno, 0,10, 10, 30) +</span></span>
<span id="cb52-168"><a href="#cb52-168" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(Brown, 0,10, 0, 10)+</span></span>
<span id="cb52-169"><a href="#cb52-169" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(Red, 10,20, 0, 10)+</span></span>
<span id="cb52-170"><a href="#cb52-170" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(green, 20,30, 0, 10)+</span></span>
<span id="cb52-171"><a href="#cb52-171" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(MPB, 30,40, 0,10)+</span></span>
<span id="cb52-172"><a href="#cb52-172" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_segment(data=Lines1,aes(x=x,y=y,xend=xend,yend=yend),</span></span>
<span id="cb52-173"><a href="#cb52-173" aria-hidden="true" tabindex="-1"></a><span class="co">#                colour="white",linewidth=2)+</span></span>
<span id="cb52-174"><a href="#cb52-174" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot2::annotation_custom(ggplotGrob(spectra), 10,40, 10,30)+</span></span>
<span id="cb52-175"><a href="#cb52-175" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_label(data=labels1,aes(x=x,y=y,label=name), size = 10)+</span></span>
<span id="cb52-176"><a href="#cb52-176" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_void()+</span></span>
<span id="cb52-177"><a href="#cb52-177" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.title.x = element_blank(),</span></span>
<span id="cb52-178"><a href="#cb52-178" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.title.y = element_blank(),</span></span>
<span id="cb52-179"><a href="#cb52-179" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.x = element_blank(),</span></span>
<span id="cb52-180"><a href="#cb52-180" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_blank(),</span></span>
<span id="cb52-181"><a href="#cb52-181" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.ticks.x = element_blank(),</span></span>
<span id="cb52-182"><a href="#cb52-182" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.ticks.y = element_blank(),</span></span>
<span id="cb52-183"><a href="#cb52-183" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.margin = grid::unit(c(0.01,0.01,0.01,0.01), "mm"),</span></span>
<span id="cb52-184"><a href="#cb52-184" aria-hidden="true" tabindex="-1"></a><span class="co">#         # rect = element_blank(),</span></span>
<span id="cb52-185"><a href="#cb52-185" aria-hidden="true" tabindex="-1"></a><span class="co">#         panel.margin = grid::unit(c(0.01, 0.01, 0.01, 0.01), "mm"),</span></span>
<span id="cb52-186"><a href="#cb52-186" aria-hidden="true" tabindex="-1"></a><span class="co">#         legend.text.align = 0)</span></span>
<span id="cb52-187"><a href="#cb52-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-188"><a href="#cb52-188" aria-hidden="true" tabindex="-1"></a>Magno<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb52-189"><a href="#cb52-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> <span class="fu">rast</span>(<span class="st">"Data/Pictures/Figure2/Magnoliopsida_cropped2.png"</span>))<span class="sc">+</span></span>
<span id="cb52-190"><a href="#cb52-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb52-191"><a href="#cb52-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">50</span>,<span class="at">y=</span> <span class="dv">950</span>, <span class="at">label =</span> <span class="st">"A"</span>))<span class="sc">+</span></span>
<span id="cb52-192"><a href="#cb52-192" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb52-193"><a href="#cb52-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-194"><a href="#cb52-194" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-195"><a href="#cb52-195" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-196"><a href="#cb52-196" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>),</span>
<span id="cb52-197"><a href="#cb52-197" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major=</span><span class="fu">element_blank</span>(), </span>
<span id="cb52-198"><a href="#cb52-198" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(), </span>
<span id="cb52-199"><a href="#cb52-199" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"pt"</span>))</span>
<span id="cb52-200"><a href="#cb52-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-201"><a href="#cb52-201" aria-hidden="true" tabindex="-1"></a>Brown<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb52-202"><a href="#cb52-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> <span class="fu">rast</span>(<span class="st">"Data/Pictures/Figure2/Pheophyceae_cropped.png"</span>))<span class="sc">+</span></span>
<span id="cb52-203"><a href="#cb52-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb52-204"><a href="#cb52-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">50</span>,<span class="at">y=</span><span class="dv">450</span>, <span class="at">label =</span> <span class="st">"B"</span>))<span class="sc">+</span></span>
<span id="cb52-205"><a href="#cb52-205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb52-206"><a href="#cb52-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-207"><a href="#cb52-207" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-208"><a href="#cb52-208" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-209"><a href="#cb52-209" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>),</span>
<span id="cb52-210"><a href="#cb52-210" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major=</span><span class="fu">element_blank</span>(),</span>
<span id="cb52-211"><a href="#cb52-211" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(),</span>
<span id="cb52-212"><a href="#cb52-212" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"pt"</span>))</span>
<span id="cb52-213"><a href="#cb52-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-214"><a href="#cb52-214" aria-hidden="true" tabindex="-1"></a>Red <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb52-215"><a href="#cb52-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> <span class="fu">rast</span>(<span class="st">"Data/Pictures/Figure2/Rodophyceae_cropped.png"</span>))<span class="sc">+</span></span>
<span id="cb52-216"><a href="#cb52-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb52-217"><a href="#cb52-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">50</span>,<span class="at">y=</span><span class="dv">450</span>, <span class="at">label =</span> <span class="st">"C"</span>))<span class="sc">+</span></span>
<span id="cb52-218"><a href="#cb52-218" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb52-219"><a href="#cb52-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-220"><a href="#cb52-220" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-221"><a href="#cb52-221" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-222"><a href="#cb52-222" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>),</span>
<span id="cb52-223"><a href="#cb52-223" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major=</span><span class="fu">element_blank</span>(), </span>
<span id="cb52-224"><a href="#cb52-224" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(), </span>
<span id="cb52-225"><a href="#cb52-225" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"pt"</span>))</span>
<span id="cb52-226"><a href="#cb52-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-227"><a href="#cb52-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-228"><a href="#cb52-228" aria-hidden="true" tabindex="-1"></a>green <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb52-229"><a href="#cb52-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> <span class="fu">rast</span>(<span class="st">"Data/Pictures/Figure2/Chlorophyceae_cropped.png"</span>))<span class="sc">+</span></span>
<span id="cb52-230"><a href="#cb52-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb52-231"><a href="#cb52-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">50</span>,<span class="at">y=</span><span class="dv">450</span>, <span class="at">label =</span> <span class="st">"D"</span>))<span class="sc">+</span></span>
<span id="cb52-232"><a href="#cb52-232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb52-233"><a href="#cb52-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-234"><a href="#cb52-234" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-235"><a href="#cb52-235" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-236"><a href="#cb52-236" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>),</span>
<span id="cb52-237"><a href="#cb52-237" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major=</span><span class="fu">element_blank</span>(), </span>
<span id="cb52-238"><a href="#cb52-238" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(), </span>
<span id="cb52-239"><a href="#cb52-239" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"pt"</span>))</span>
<span id="cb52-240"><a href="#cb52-240" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-241"><a href="#cb52-241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-242"><a href="#cb52-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-243"><a href="#cb52-243" aria-hidden="true" tabindex="-1"></a>MPB <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb52-244"><a href="#cb52-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> <span class="fu">rast</span>(<span class="st">"Data/Pictures/Figure2/Bacillariophyceae_cropped.png"</span>))<span class="sc">+</span></span>
<span id="cb52-245"><a href="#cb52-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb52-246"><a href="#cb52-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">50</span>,<span class="at">y=</span><span class="dv">450</span>, <span class="at">label =</span> <span class="st">"E"</span>))<span class="sc">+</span></span>
<span id="cb52-247"><a href="#cb52-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb52-248"><a href="#cb52-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-249"><a href="#cb52-249" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-250"><a href="#cb52-250" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb52-251"><a href="#cb52-251" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>),</span>
<span id="cb52-252"><a href="#cb52-252" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major=</span><span class="fu">element_blank</span>(), </span>
<span id="cb52-253"><a href="#cb52-253" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(), </span>
<span id="cb52-254"><a href="#cb52-254" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"pt"</span>))</span>
<span id="cb52-255"><a href="#cb52-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-256"><a href="#cb52-256" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb52-257"><a href="#cb52-257" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">10</span>, <span class="at">l =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">30</span>, <span class="at">r =</span> <span class="dv">10</span>),</span>
<span id="cb52-258"><a href="#cb52-258" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">0</span>, <span class="at">l =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">10</span>),</span>
<span id="cb52-259"><a href="#cb52-259" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">0</span>, <span class="at">l =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">20</span>),</span>
<span id="cb52-260"><a href="#cb52-260" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">0</span>, <span class="at">l =</span> <span class="dv">20</span>, <span class="at">b =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">30</span>),</span>
<span id="cb52-261"><a href="#cb52-261" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">0</span>, <span class="at">l =</span> <span class="dv">30</span>, <span class="at">b =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">40</span>),</span>
<span id="cb52-262"><a href="#cb52-262" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">10</span>, <span class="at">l =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="dv">30</span>, <span class="at">r =</span> <span class="dv">40</span>)</span>
<span id="cb52-263"><a href="#cb52-263" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-264"><a href="#cb52-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-265"><a href="#cb52-265" aria-hidden="true" tabindex="-1"></a>layout1 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb52-266"><a href="#cb52-266" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">20</span>, <span class="at">r =</span> <span class="dv">10</span>),</span>
<span id="cb52-267"><a href="#cb52-267" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">20</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">29</span>, <span class="at">r =</span> <span class="dv">10</span>),</span>
<span id="cb52-268"><a href="#cb52-268" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">20</span>, <span class="at">l =</span> <span class="dv">9</span>, <span class="at">b =</span> <span class="dv">29</span>, <span class="at">r =</span> <span class="dv">18</span>),</span>
<span id="cb52-269"><a href="#cb52-269" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">20</span>, <span class="at">l =</span> <span class="dv">17</span>, <span class="at">b =</span> <span class="dv">29</span>, <span class="at">r =</span> <span class="dv">26</span>),</span>
<span id="cb52-270"><a href="#cb52-270" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">20</span>, <span class="at">l =</span> <span class="dv">25</span>, <span class="at">b =</span> <span class="dv">29</span>, <span class="at">r =</span> <span class="dv">34</span>),</span>
<span id="cb52-271"><a href="#cb52-271" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">l =</span> <span class="dv">9</span>, <span class="at">b =</span> <span class="dv">20</span>, <span class="at">r =</span> <span class="dv">34</span>)</span>
<span id="cb52-272"><a href="#cb52-272" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-273"><a href="#cb52-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-274"><a href="#cb52-274" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(layout1)</span></span>
<span id="cb52-275"><a href="#cb52-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-276"><a href="#cb52-276" aria-hidden="true" tabindex="-1"></a>plot<span class="ot">&lt;-</span>Magno<span class="sc">+</span></span>
<span id="cb52-277"><a href="#cb52-277" aria-hidden="true" tabindex="-1"></a>  Brown<span class="sc">+</span></span>
<span id="cb52-278"><a href="#cb52-278" aria-hidden="true" tabindex="-1"></a>  Red<span class="sc">+</span></span>
<span id="cb52-279"><a href="#cb52-279" aria-hidden="true" tabindex="-1"></a>  green<span class="sc">+</span></span>
<span id="cb52-280"><a href="#cb52-280" aria-hidden="true" tabindex="-1"></a>  MPB<span class="sc">+</span></span>
<span id="cb52-281"><a href="#cb52-281" aria-hidden="true" tabindex="-1"></a>  sp<span class="sc">+</span></span>
<span id="cb52-282"><a href="#cb52-282" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">plot_layout</span>(<span class="at">design=</span>layout1)</span>
<span id="cb52-283"><a href="#cb52-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-284"><a href="#cb52-284" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/High_res/Figure2/Spectral_shapes_total.png"</span>,plot, <span class="at">height =</span> <span class="dv">7</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">dpi =</span> <span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [14]:</pre></div><div id="cell-fig-vegetation" class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figures/Low_res/Spectral_shapes_total.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-vegetation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-vegetation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figures/Low_res/Spectral_shapes_total.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;2: The five taxonomic classes of vegetation used to train the Neural Network model and their raw spectral signatures at the spectral resolution of the Micasense RedEdge Dual MX. A : Magnoliopsida (Nanozostera noltei syn. Zostera noltei) ; B : Phaeophyceae (Fucus sp.) ; C : Rhodophyceae (Gracilaria vermiculophylla) ; D : Chlorophyceae (Ulva sp.) ; E : Bacillariophyceae (Diatoms - MPB)"><img src="Figures/Low_res/Spectral_shapes_total.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vegetation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: The five taxonomic classes of vegetation used to train the Neural Network model and their raw spectral signatures at the spectral resolution of the Micasense RedEdge Dual MX. A : Magnoliopsida (Nanozostera noltei syn. Zostera noltei) ; B : Phaeophyceae (Fucus sp.) ; C : Rhodophyceae (Gracilaria vermiculophylla) ; D : Chlorophyceae (Ulva sp.) ; E : Bacillariophyceae (Diatoms - MPB)
</figcaption>
</figure>
</div>
</div>
</div></div>
</section>
</section>
<section id="drone-processing" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="drone-processing"><span class="header-section-number">2.3</span> Drone Processing</h2>
<p>A structure-from-motion photogrammetry software <span class="citation" data-cites="agisoft">(Agisoft Metashape, <a href="#ref-agisoft" role="doc-biblioref">Agisoft, 2019</a>)</span> was used to process images to obtain multispectral orthomosaics of each flight. The process for orthomosaicking was identical for every flight. First, key tying points were detected inside of each image and between overlapping images in order to obtain a sparse point cloud. This cloud was cleaned using a reprojection accuracy metric in order to remove noisy points. A dense point cloud was then produced using a structure from motion algorithm. A surface interpolation of this dense point cloud was made to obtain a digital surface model (DSM), used to reconstruct the multispectral ortho-image <span class="citation" data-cites="nebel2020review">(<a href="#ref-nebel2020review" role="doc-biblioref">Nebel et al., 2020</a>)</span>. Low altitude drone flights produced ortho-images with a very high spatial resolution (8 mm per pixel), making it efficient to visually distinguish between the various types of vegetation. High altitude flights allowed to cover larger areas and produced images with a pixel size of 80 mm (<a href="#tbl-flights" class="quarto-xref">Table&nbsp;1</a>).</p>
</section>
<section id="general-workflow" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="general-workflow"><span class="header-section-number">2.4</span> General Workflow</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [15]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>layout<span class="ot">&lt;-</span><span class="st">"Data/Figure2_Workflow"</span> <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">"V4.txt"</span>,<span class="at">full.names =</span> T, <span class="at">recursive =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_delim</span>(<span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">trim_ws =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Evaluate <span class="sc">==</span> T)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>layout<span class="sc">$</span>Text<span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"alaligne"</span>,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, layout<span class="sc">$</span>Text)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>boxes<span class="ot">&lt;-</span> layout <span class="sc">%&gt;%</span> </span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">==</span> <span class="st">"Box"</span>,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>                shape <span class="sc">==</span> <span class="st">"square"</span>)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>text<span class="ot">&lt;-</span> layout <span class="sc">%&gt;%</span> </span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">==</span> <span class="st">"Box"</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>diamonds<span class="ot">&lt;-</span> layout <span class="sc">%&gt;%</span> </span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">==</span> <span class="st">"Box"</span>,</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>                shape <span class="sc">==</span> <span class="st">"diamond"</span>)</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>diff <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(diamonds)) {</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  diam_a<span class="ot">&lt;-</span>diamonds[i,]</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(  </span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(diam_a<span class="sc">$</span>xmin <span class="sc">-</span> diff, diam_a<span class="sc">$</span>xmin <span class="sc">+</span> diff, diam_a<span class="sc">$</span>xmax <span class="sc">+</span> diff, diam_a<span class="sc">$</span>xmax <span class="sc">-</span> diff),</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(diam_a<span class="sc">$</span>ymin, diam_a<span class="sc">$</span>ymax, diam_a<span class="sc">$</span>ymax, diam_a<span class="sc">$</span>ymin),</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type =</span> <span class="fu">rep</span>(diam_a<span class="sc">$</span>Type,<span class="dv">4</span>),</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Text =</span> <span class="fu">rep</span>(diam_a<span class="sc">$</span>Text,<span class="dv">4</span>),</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">Color =</span> <span class="fu">rep</span>(diam_a<span class="sc">$</span>color,<span class="dv">4</span>),</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">Evaluate =</span> <span class="fu">rep</span>(diam_a<span class="sc">$</span>Evaluate,<span class="dv">4</span>),</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">Resolution =</span>  <span class="fu">rep</span>(diam_a<span class="sc">$</span>Resolution,<span class="dv">4</span>),</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">Evaluate_bigbox =</span> <span class="fu">rep</span>(diam_a<span class="sc">$</span>Evaluate_bigbox,<span class="dv">4</span>),</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fu">rep</span>(diam_a<span class="sc">$</span>alpha,<span class="dv">4</span>),</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span>  <span class="fu">rep</span>(diam_a<span class="sc">$</span>shape,<span class="dv">4</span>)</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>    diamond_list<span class="ot">&lt;-</span><span class="fu">list</span>(df)</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>    diamond_list[[i]]<span class="ot">&lt;-</span>df</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>Arrows<span class="ot">&lt;-</span> layout <span class="sc">%&gt;%</span> </span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">==</span> <span class="st">"Arrow"</span>,</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>                Evaluate <span class="sc">==</span> T)</span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a>Group_box<span class="ot">&lt;-</span>layout <span class="sc">%&gt;%</span> </span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">==</span> <span class="st">"Box"</span>,</span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a>                Evaluate_bigbox <span class="sc">==</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Group) <span class="sc">%&gt;%</span> </span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">xmin =</span> <span class="fu">min</span>(xmin)<span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xmax =</span> <span class="fu">max</span>(xmax)<span class="sc">+</span><span class="fl">0.1</span>,</span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ymin =</span> <span class="fu">min</span>(ymin)<span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ymax =</span> <span class="fu">max</span>(ymax)<span class="sc">+</span><span class="fl">0.1</span>,</span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>                   <span class="at">alpha =</span> <span class="fl">0.1</span>,</span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> color)</span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>resolution_box<span class="ot">&lt;-</span>layout <span class="sc">%&gt;%</span> </span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">==</span> <span class="st">"Box"</span>,</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a>                Resolution <span class="sc">!=</span> <span class="st">"NA"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Resolution) <span class="sc">%&gt;%</span> </span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">xmin =</span> <span class="fu">min</span>(xmin)<span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xmax =</span> <span class="fu">max</span>(xmax)<span class="sc">+</span><span class="fl">0.1</span>,</span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ymin =</span> <span class="fu">min</span>(ymin)<span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ymax =</span> <span class="fu">max</span>(ymax)<span class="sc">+</span><span class="fl">0.1</span>,</span>
<span id="cb54-69"><a href="#cb54-69" aria-hidden="true" tabindex="-1"></a>                   <span class="at">alpha =</span> <span class="fl">0.1</span>,</span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> color)</span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a>legend <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">color =</span> <span class="fu">unique</span>(layout<span class="sc">$</span>color)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(color)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">case_when</span>(color <span class="sc">==</span> <span class="st">"#EA6155"</span> <span class="sc">~</span> <span class="st">"Input Data"</span>,</span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a>                           color <span class="sc">==</span> <span class="st">"#DC9614"</span> <span class="sc">~</span> <span class="st">"Pre-processing"</span>,</span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a>                           color <span class="sc">==</span> <span class="st">"#52A4DA"</span> <span class="sc">~</span> <span class="st">"Model Building"</span>,</span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a>                           color <span class="sc">==</span> <span class="st">"#79DA52"</span> <span class="sc">~</span> <span class="st">"Validation"</span>,</span>
<span id="cb54-78"><a href="#cb54-78" aria-hidden="true" tabindex="-1"></a>                           color <span class="sc">==</span> <span class="st">"#DA9652"</span> <span class="sc">~</span> <span class="st">"Output Data"</span>,</span>
<span id="cb54-79"><a href="#cb54-79" aria-hidden="true" tabindex="-1"></a>                           color <span class="sc">==</span> <span class="st">"darkcyan"</span> <span class="sc">~</span> <span class="st">"Final Product"</span>,</span>
<span id="cb54-80"><a href="#cb54-80" aria-hidden="true" tabindex="-1"></a>                           color <span class="sc">==</span> <span class="st">"#DA5273"</span>  <span class="sc">~</span> <span class="st">"Prediction"</span>,</span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a>  arrange</span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a>segment<span class="ot">&lt;-</span>layout <span class="sc">%&gt;%</span> </span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">==</span> <span class="st">"Segment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [16]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>building <span class="ot">&lt;-</span> F</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(building <span class="sc">==</span> T){</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>text_size <span class="ot">=</span> <span class="dv">6</span> <span class="do">#### 6 to plot it fullscreen in R,  1.8 for exporting with ggsave</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>line_size <span class="ot">=</span><span class="dv">1</span> <span class="do">####arrow_size 0.3 to export  1 to for R plotting</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>legend_size <span class="ot">=</span> <span class="dv">1</span> <span class="do">#### 0.3 to export, 1 for R ploting</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>legend_text <span class="ot">=</span> <span class="dv">10</span> <span class="do">#### 4 to export, 10 for R ploting</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>text_size <span class="ot">=</span> <span class="fl">1.85</span> <span class="do">#### 6 to plot it fullscreen in R,  1.8 for exporting with ggsave</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>line_size <span class="ot">=</span><span class="fl">0.3</span> <span class="do">####arrow_size 0.3 to export  1 to for R plotting</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>legend_size <span class="ot">=</span> <span class="fl">0.3</span> <span class="do">#### 0.3 to export, 1 for R ploting</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>legend_text <span class="ot">=</span> <span class="dv">5</span> <span class="do">#### 5 to export, 10 for R ploting</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  statebins<span class="sc">:::</span><span class="fu">geom_rrect</span>(<span class="at">data =</span> Group_box,</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xmin =</span> xmin,</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xmax=</span> xmax,</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymin =</span> ymin,</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymax =</span> ymax),</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.05</span>,</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">0.2</span>,</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.legend =</span> F,</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> Group_box<span class="sc">$</span>color,</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>    statebins<span class="sc">:::</span><span class="fu">geom_rrect</span>(<span class="at">data =</span> resolution_box,</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xmin =</span> xmin,</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xmax=</span> xmax,</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymin =</span> ymin,</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymax =</span> ymax,</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>                          <span class="at">alpha =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Input Data"</span>, <span class="st">"Pre-processing"</span>, <span class="st">"Model Building"</span>, <span class="st">"Prediction"</span>, <span class="st">"Validation"</span>, <span class="st">"Output Data"</span>, <span class="st">"Final Product"</span>),<span class="dv">2</span>)),</span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"NA"</span>,</span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="dv">2</span>,</span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">0.4</span>,</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">name =</span> <span class="st">""</span>, </span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Input Data"</span>, <span class="st">"Pre-Processing"</span>, <span class="st">"Model Building"</span>, <span class="st">"Prediction"</span>, <span class="st">"Validation"</span>, <span class="st">"Output Data"</span>, <span class="st">"Final Product"</span>),</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"#f94144"</span>, <span class="st">"#f3722c"</span>, <span class="st">"#f8961e"</span>, <span class="st">"#f9c74f"</span>, <span class="st">"#90be6d"</span>, <span class="st">"#43aa8b"</span>, <span class="st">"#577590"</span>),</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>                                                                        <span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>),</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>                                                                        <span class="at">linetype =</span> <span class="fu">c</span>(<span class="dv">1</span>),</span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>                                                                        <span class="at">alpha =</span> <span class="fu">c</span>(<span class="fl">0.5</span>)</span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a>                                                                        )</span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>                                          )</span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a>                     )<span class="sc">+</span></span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a>  statebins<span class="sc">:::</span><span class="fu">geom_rrect</span>(<span class="at">data =</span> boxes,</span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xmin =</span> xmin,</span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xmax=</span> xmax,</span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymin =</span> ymin,</span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymax =</span> ymax</span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a>                          ),</span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">0.2</span>,</span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fu">as.numeric</span>(boxes<span class="sc">$</span>alpha),</span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> boxes<span class="sc">$</span>color,</span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(diamond_list)){</span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a>    poly_i<span class="ot">&lt;-</span>diamond_list[[i]]</span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a>    a<span class="ot">&lt;-</span>a<span class="sc">+</span></span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_polygon</span>(<span class="at">data =</span> poly_i, </span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, </span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">y =</span> y</span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a>                                 ),</span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="fl">0.2</span>,</span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a>                   <span class="at">alpha =</span> poly_i<span class="sc">$</span>alpha,</span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> poly_i<span class="sc">$</span>Color,</span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(building <span class="sc">==</span> T){</span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a>    a<span class="ot">&lt;-</span>a<span class="sc">+</span></span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> (xmax<span class="sc">+</span>xmin)<span class="sc">/</span><span class="dv">2</span>, <span class="at">y =</span> (ymax <span class="sc">+</span> ymin)<span class="sc">/</span><span class="dv">2</span>, <span class="at">label =</span> (ID)), <span class="at">size =</span> text_size)</span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a>    a<span class="ot">&lt;-</span>a<span class="sc">+</span></span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> (xmax<span class="sc">+</span>xmin)<span class="sc">/</span><span class="dv">2</span>, <span class="at">y =</span> (ymax <span class="sc">+</span> ymin)<span class="sc">/</span><span class="dv">2</span>, <span class="at">label =</span> (Text)), <span class="at">size =</span> text_size)</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span>a<span class="sc">+</span></span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="at">data =</span> Arrows, <span class="fu">aes</span>( <span class="at">x =</span> xmin, <span class="at">xend =</span> xmax, <span class="at">y =</span> ymin, <span class="at">yend =</span> ymax),</span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">size=</span>line_size, <span class="at">linejoin =</span> <span class="st">"mitre"</span>, <span class="at">lineend =</span> <span class="st">"butt"</span>,</span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"mm"</span>), <span class="at">type=</span> <span class="st">"closed"</span>)</span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="at">data =</span> segment, <span class="fu">aes</span>( <span class="at">x =</span> xmin, <span class="at">xend =</span> xmax, <span class="at">y =</span> ymin, <span class="at">yend =</span> ymax),</span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">size=</span>line_size, <span class="at">linejoin =</span> <span class="st">"mitre"</span>, <span class="at">lineend =</span> <span class="st">"square"</span></span>
<span id="cb55-100"><a href="#cb55-100" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb55-101"><a href="#cb55-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-102"><a href="#cb55-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">5.4</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">label =</span> <span class="st">"Flight height: 12 m </span><span class="sc">\n</span><span class="st"> Pixel size : 8 mm"</span>, <span class="at">angle =</span> <span class="dv">90</span>), <span class="at">size =</span> text_size<span class="sc">+</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-103"><a href="#cb55-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-104"><a href="#cb55-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">5.4</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">6.8</span>, <span class="at">label =</span> <span class="st">"Flight height: 120 m </span><span class="sc">\n</span><span class="st"> Pixel size : 80 mm"</span>, <span class="at">angle =</span> <span class="dv">90</span>), <span class="at">size =</span> text_size<span class="sc">+</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb55-105"><a href="#cb55-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-106"><a href="#cb55-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="fl">1.75</span>, <span class="at">label =</span> <span class="st">"Pre Processing"</span>), <span class="at">size =</span> text_size)</span>
<span id="cb55-107"><a href="#cb55-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-108"><a href="#cb55-108" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(building <span class="sc">==</span> F){</span>
<span id="cb55-109"><a href="#cb55-109" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span> a<span class="sc">+</span> <span class="fu">theme_void</span>()</span>
<span id="cb55-110"><a href="#cb55-110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-111"><a href="#cb55-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-112"><a href="#cb55-112" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span>a<span class="sc">+</span></span>
<span id="cb55-113"><a href="#cb55-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.88</span>,<span class="fl">0.3</span>),</span>
<span id="cb55-114"><a href="#cb55-114" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> legend_text),</span>
<span id="cb55-115"><a href="#cb55-115" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(legend_size, <span class="st">'cm'</span>)</span>
<span id="cb55-116"><a href="#cb55-116" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">+</span></span>
<span id="cb55-117"><a href="#cb55-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_width</span>(<span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb55-118"><a href="#cb55-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_width</span>(<span class="fl">0.5</span>))</span>
<span id="cb55-119"><a href="#cb55-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-120"><a href="#cb55-120" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(building <span class="sc">==</span> T){</span>
<span id="cb55-121"><a href="#cb55-121" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb55-122"><a href="#cb55-122" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb55-123"><a href="#cb55-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">"Figures/Figure3_workflow.png"</span>,a, <span class="at">width =</span> <span class="dv">1920</span>, <span class="at">height =</span> <span class="dv">1129</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb55-124"><a href="#cb55-124" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<p>The spectral similarities of the reflectance signatures at the spectral resolution of the micasense senor between intertidal green macrophytes (Magnoliopsida and Chlorophyceae) make their discrimination challenging using simple classification algorithms (<a href="#fig-vegetation" class="quarto-xref">Figure&nbsp;2</a> F). To overcome this challenge, a deep learning classification method was trained, validated, and applied to each drone flight (<a href="#fig-workflow" class="quarto-xref">Figure&nbsp;3</a>).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [17]:</pre></div><div id="cell-fig-workflow" class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"./Figures/Low_res/Figure3_workflow.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-workflow" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="./Figures/Low_res/Figure3_workflow.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;3: Schematic representation of the workflow. Parallelograms represent input or output data, and rectangles represent Python processing algorithms. The overall workflow of this study is divided into two distinct parts based on the spatial resolution of the drone flights: high-resolution flights (pixel size: 8 mm) were utilized for training and prediction of the Neural Network model, whereas lower-resolution flights (pixel size: 80 mm) were solely employed for prediction purposes. Validation has been performed on both high and low resolution flights."><img src="./Figures/Low_res/Figure3_workflow.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Schematic representation of the workflow. Parallelograms represent input or output data, and rectangles represent Python processing algorithms. The overall workflow of this study is divided into two distinct parts based on the spatial resolution of the drone flights: high-resolution flights (pixel size: 8 mm) were utilized for training and prediction of the Neural Network model, whereas lower-resolution flights (pixel size: 80 mm) were solely employed for prediction purposes. Validation has been performed on both high and low resolution flights.
</figcaption>
</figure>
</div>
</div>
</div></div>
<section id="training-dataset-building" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="training-dataset-building"><span class="header-section-number">2.4.1</span> Training dataset building</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [18]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df_training<span class="ot">&lt;-</span><span class="st">"Data/training/TrainandValid_NewStanRawMetrics.csv"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_delim</span>(<span class="at">delim =</span> <span class="st">";"</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>, <span class="at">trim_ws =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(True_Class <span class="sc">!=</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                True_Class <span class="sc">!=</span> <span class="st">"Deep_Sediment"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                True_Class <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                True_Class <span class="sc">!=</span> <span class="st">"SunGlint"</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                True_Class <span class="sc">!=</span> <span class="st">"Bare_Sediment"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">True_Class =</span> <span class="fu">case_when</span>(True_Class <span class="sc">==</span> <span class="st">"Clorophyta"</span> <span class="sc">~</span> <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>                               True_Class <span class="sc">==</span> <span class="st">"Rhodphyta"</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>                               True_Class <span class="sc">==</span> <span class="st">"MPB"</span> <span class="sc">~</span> <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>                               True_Class <span class="sc">==</span> <span class="st">"Magnoliosida"</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>                               True_Class <span class="sc">==</span> <span class="st">"Phaeophyta"</span> <span class="sc">~</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>                               True_Class <span class="sc">==</span> <span class="st">"Low_SPC"</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>                               <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>                               )) <span class="sc">%&gt;%</span> </span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(True_Class) <span class="sc">%&gt;%</span> </span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">True =</span> <span class="st">"True_Class"</span>, </span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">Training_Pixels =</span> <span class="st">"n"</span>)</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_training,<span class="st">"Data/training/TrainandValid_NewStanRawMetrics_Processed.csv"</span>,<span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [19]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>df_training<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"Data/training/TrainandValid_NewStanRawMetrics_Processed.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [20]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df_validation<span class="ot">&lt;-</span><span class="st">"Data/accuracy_assesment_low&amp;high_flights.csv"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_delim</span>(<span class="at">delim =</span> <span class="st">","</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>, <span class="at">trim_ws =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(True <span class="sc">!=</span> <span class="st">"Sediment"</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                True <span class="sc">!=</span> <span class="st">"Sun Glint"</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                True <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                True <span class="sc">!=</span> <span class="st">"Xanthophyceae"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">True =</span> <span class="fu">case_when</span>(True <span class="sc">==</span> <span class="st">"Green Algae"</span> <span class="sc">~</span> <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>                          True <span class="sc">==</span> <span class="st">"Microphytobenthos"</span> <span class="sc">~</span> <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>                          True <span class="sc">==</span> <span class="st">"Rodophyceae"</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>                          True <span class="sc">==</span> <span class="st">"Pheophyceae"</span> <span class="sc">~</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> True)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(True) <span class="sc">%&gt;%</span> </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) </span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_validation,<span class="st">"Data/training/TrainandValid_NewStanRawMetrics_Processed_valid.csv"</span>,<span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [21]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df_validation<span class="ot">&lt;-</span><span class="st">"Output/Validation_data"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">"ResultsNewNN_NoXanthowithNDVIWithOldandBoat.csv"</span>,<span class="at">recursive =</span> T, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Truth_ID =</span> <span class="st">"Truth"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Truth =</span>  <span class="fu">case_when</span>(Truth_ID <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Bare_Sediment"</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Bare_Sediment"</span>,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"SunGlint"</span>,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Water"</span>,</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"Spartina"</span>,</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">41</span> <span class="sc">~</span> <span class="st">"Bleached seagrasses"</span>,</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>),</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">Pred_Class =</span> <span class="fu">case_when</span>(Pred_Class <span class="sc">==</span> <span class="st">"Clorophyta"</span> <span class="sc">~</span> <span class="st">"Chlorophyta"</span>,</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>                                Pred_Class <span class="sc">==</span> <span class="st">"Rhodphyta"</span> <span class="sc">~</span> <span class="st">"Rhodphyta"</span>,</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>                                Pred_Class <span class="sc">==</span> <span class="st">"Deep_Sediment"</span> <span class="sc">~</span> <span class="st">"Bare_Sediment"</span>,</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>                                Pred_Class <span class="sc">==</span> <span class="st">"MPB"</span> <span class="sc">~</span> <span class="st">"Bare_Sediment"</span>,</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>                                (Pred_Class <span class="sc">==</span> <span class="st">"Low_SPC"</span> <span class="sc">&amp;</span> NDVI <span class="sc">&gt;</span> <span class="fl">0.2</span>) <span class="sc">~</span> <span class="st">"Magnoliosida"</span>,</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>                                (Pred_Class <span class="sc">==</span> <span class="st">"Low_SPC"</span> <span class="sc">&amp;</span> NDVI <span class="sc">&lt;=</span> <span class="fl">0.2</span> )<span class="sc">~</span> <span class="st">"Bare_Sediment"</span>,</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> Pred_Class)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Truth <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>                Truth  <span class="sc">!=</span> <span class="st">"Spartina"</span>,</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>                Truth <span class="sc">!=</span> <span class="st">"SunGlint"</span>,</span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>                Truth <span class="sc">!=</span> <span class="st">"Bleached seagrasses"</span>,</span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>                Truth <span class="sc">!=</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Pred_Class != "Low_SPC",</span></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>                Pred_Class <span class="sc">!=</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>                 Pred_Class <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>                 Pred_Class <span class="sc">!=</span> <span class="st">"SunGlint"</span>,</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>Flight <span class="sc">==</span> <span class="st">"Handfisher_1_old"</span>,</span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>Flight <span class="sc">==</span> <span class="st">"Handfisher_2_old"</span>,</span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>Flight <span class="sc">==</span> <span class="st">"Handfisher_2"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>NDVI) <span class="sc">%&gt;%</span> </span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Truth) <span class="sc">%&gt;%</span> </span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">validation_pixels =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">True =</span> <span class="st">"Truth"</span>)</span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a> i <span class="ot">=</span> <span class="fl">16.5</span> <span class="co"># width of the side borders in the word_document output (in centimeters)</span></span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a> w <span class="ot">=</span> i<span class="sc">*</span><span class="fl">0.3937</span> <span class="co"># width of the side borders in the word_document output (in inches)</span></span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a>df_flx2<span class="ot">&lt;-</span>df_training <span class="sc">%&gt;%</span> </span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_validation, <span class="at">by =</span> <span class="st">"True"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Validation Pixels</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"validation_pixels"</span>,</span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">Class =</span> <span class="st">"True"</span>,</span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Training Pixels</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Training_Pixels"</span>)</span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a>flx2 <span class="ot">&lt;-</span> df_flx2 <span class="sc">%&gt;%</span> </span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">width</span>(<span class="at">width =</span> (w<span class="sc">/</span>(<span class="fu">ncol</span>(df_flx2)))) <span class="sc">%&gt;%</span> </span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># border_remove() %&gt;%</span></span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">align</span>(<span class="at">align =</span> <span class="st">"center"</span>,<span class="at">part =</span> <span class="st">"all"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">align</span>(<span class="at">align =</span> <span class="st">"center"</span>,<span class="at">part =</span> <span class="st">"header"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_table_properties</span>(<span class="at">layout =</span> <span class="st">"autofit"</span>) </span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a><span class="fu">save_as_image</span>(flx2, <span class="st">"Figures/High_res/table_validation_px.png"</span>, <span class="at">res =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [22]:</pre></div><div class="cell">

<div class="cell-container"><div class="cell-decorator"><pre>In [23]:</pre></div><div class=""><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figures/High_res/table_validation_px.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div><div id="tbl-validationPX" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-validationPX-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Vegetation Classes of the model and the number of pixels used to train and validate each class
</figcaption>
<div aria-describedby="tbl-validationPX-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<div class="cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="Figures/High_res/table_validation_px.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Table&nbsp;2: Vegetation Classes of the model and the number of pixels used to train and validate each class"><img src="Figures/High_res/table_validation_px.png" class="img-fluid figure-img" width="995"></a></p>
</figure>
</div>
</div>
</div>
</figure>
</div></div></div>
</div></div>
<p>A dataset containing photo-interpreted drone reflectance pixels was built to train a Neural Network model. The training pixels were categorized into seven different classes, representing the various habitats encountered at the different study sites: Sediment, Water, Chlorophyceae, Magnoliopsida, Bacillariophyceae, Phaeophyceae and Rhodophyceae. Only data from the low-altitude flights (<a href="#tbl-flights" class="quarto-xref">Table&nbsp;1</a>) were used for training because their 8 mm spatial resolution allowed to avoid spectral sub-pixel mixing and to accurately identify vegetation classes. More than 418,000 pixels at 8 mm resolution from the 3 training flights were used to train the model (<a href="#tbl-validationPX" class="quarto-xref">Table&nbsp;2</a>). Twenty one variables were used by the model as predictors: the ten raw spectral bands of the Micasense RedEdge Dual MX multispectral camera (ranging from 444 nm to 840 nm), the same ten spectral bands standardized using a min/max transformation (<a href="#eq-std" class="quarto-xref">Equation&nbsp;1</a> ; <span class="citation" data-cites="Cao2017">Cao et al. (<a href="#ref-Cao2017" role="doc-biblioref">2017</a>)</span>) and the Normalized difference vegetation index (NDVI, <a href="#eq-ndvi" class="quarto-xref">Equation&nbsp;2</a>). Standardisation of spectral bands is commonly used to eliminate the scaling differences between spectra and to limit the effect of biomass on the spectra shape <span class="citation" data-cites="Douay2022 Davies2023">(<a href="#ref-Davies2023" role="doc-biblioref">Davies et al., 2023a</a>; <a href="#ref-Douay2022" role="doc-biblioref">Douay et al., 2022</a>)</span>.</p>
<p><span id="eq-std"><span class="math display">\[
R_{i}^{*}(\lambda) = \frac{R_{i}(\lambda) - min(R_{i})}{max(R_{i})- min(R_{i})}
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(R_{i}(\lambda)\)</span> is the reflectance at the wavelength <span class="math inline">\((\lambda)\)</span> of each individual spectra <span class="math inline">\((i)\)</span>, <span class="math inline">\(min(R_{i})\)</span>, and <span class="math inline">\(max(R_{i})\)</span> are the minimum and maximum value of the spectra <span class="math inline">\((i)\)</span></p>
<p><span id="eq-ndvi"><span class="math display">\[
NDVI = \frac{R(840nm)-R(668nm)}{R(840nm)+R(668nm)}
\tag{2}\]</span></span></p>
<p>where <span class="math inline">\(R(840nm)\)</span> is the reflectance at 840 nm and <span class="math inline">\(R(668nm)\)</span> is the reflectance at 668 nm.</p>
</section>
<section id="model-building" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="model-building"><span class="header-section-number">2.4.2</span> Model building</h3>
<p>A neural network classification model was built using the fastai workflow <span class="citation" data-cites="howard2018fastai">(<a href="#ref-howard2018fastai" role="doc-biblioref">Howard et al., 2018</a>)</span>. This model was composed of 2 hidden layers and have a total of 26 054 trainable parameters. Parameters have been fine tuned using 12 epoch to minimize the error rate. This model has been called DISCOV, standing for Drone Intertidal Substrat Classification Of Vegetation.</p>
</section>
<section id="validation" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="validation"><span class="header-section-number">2.4.3</span> Validation</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [24]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="st">"Output/Validation_data"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">"ResultsNewNN_NoXanthowithNDVIWithOldandBoat.csv"</span>,<span class="at">recursive =</span> T, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Truth_ID =</span> <span class="st">"Truth"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Truth =</span>  <span class="fu">case_when</span>(Truth_ID <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Bare_Sediment"</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Chlorophyta"</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Bare_Sediment"</span>,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Magnoliosida"</span>,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Bare_Sediment"</span>,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Magnoliosida"</span>,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Phaeophyta"</span>,</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Rhodphyta"</span>,</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"SunGlint"</span>,</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Water"</span>,</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"Spartina"</span>,</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">41</span> <span class="sc">~</span> <span class="st">"Bleached seagrasses"</span>,</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>),</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">Pred_Class =</span> <span class="fu">case_when</span>(Pred_Class <span class="sc">==</span> <span class="st">"Clorophyta"</span> <span class="sc">~</span> <span class="st">"Chlorophyta"</span>,</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>                                Pred_Class <span class="sc">==</span> <span class="st">"Rhodphyta"</span> <span class="sc">~</span> <span class="st">"Rhodphyta"</span>,</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>                                Pred_Class <span class="sc">==</span> <span class="st">"Deep_Sediment"</span> <span class="sc">~</span> <span class="st">"Bare_Sediment"</span>,</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>                                Pred_Class <span class="sc">==</span> <span class="st">"MPB"</span> <span class="sc">~</span> <span class="st">"Bare_Sediment"</span>,</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>                                (Pred_Class <span class="sc">==</span> <span class="st">"Low_SPC"</span> <span class="sc">&amp;</span> NDVI <span class="sc">&gt;</span> <span class="fl">0.2</span>) <span class="sc">~</span> <span class="st">"Magnoliosida"</span>,</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>                                (Pred_Class <span class="sc">==</span> <span class="st">"Low_SPC"</span> <span class="sc">&amp;</span> NDVI <span class="sc">&lt;=</span> <span class="fl">0.2</span> )<span class="sc">~</span> <span class="st">"Bare_Sediment"</span>,</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> Pred_Class)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Truth <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>                Truth  <span class="sc">!=</span> <span class="st">"Spartina"</span>,</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>                Truth <span class="sc">!=</span> <span class="st">"SunGlint"</span>,</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>                Truth <span class="sc">!=</span> <span class="st">"Bleached seagrasses"</span>,</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>                Truth <span class="sc">!=</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Pred_Class != "Low_SPC",</span></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>                Pred_Class <span class="sc">!=</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>                 Pred_Class <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>                 Pred_Class <span class="sc">!=</span> <span class="st">"SunGlint"</span>,</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>Flight <span class="sc">==</span> <span class="st">"Handfisher_1_old"</span>,</span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>Flight <span class="sc">==</span> <span class="st">"Handfisher_2_old"</span>,</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>Flight <span class="sc">==</span> <span class="st">"Handfisher_2"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>NDVI)</span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>count_validation_pixel<span class="ot">&lt;-</span><span class="fu">nrow</span>(df)</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(count_validation_pixel,<span class="st">"Output/count_validation_pixel.csv"</span>, <span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [25]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>count_validation_pixel<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"Output/count_validation_pixel.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [26]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="st">"Output/Validation_data"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">"ResultsNewNN_NoXanthowithNDVIWithOldandBoat.csv"</span>,<span class="at">recursive =</span> T, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Truth_ID =</span> <span class="st">"Truth"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Truth =</span>  <span class="fu">case_when</span>(Truth_ID <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Sediment"</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Sediment"</span>,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"SunGlint"</span>,</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Water"</span>,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"Spartina"</span>,</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>                          Truth_ID <span class="sc">==</span> <span class="dv">41</span> <span class="sc">~</span> <span class="st">"Bleached seagrasses"</span>,</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>),</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">Pred_Class =</span> <span class="fu">case_when</span>(Pred_Class <span class="sc">==</span> <span class="st">"Clorophyta"</span> <span class="sc">~</span> <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>                                Pred_Class <span class="sc">==</span> <span class="st">"Phaeophyta"</span> <span class="sc">~</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>                                Pred_Class <span class="sc">==</span> <span class="st">"Rhodphyta"</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>                                Pred_Class <span class="sc">==</span> <span class="st">"Deep_Sediment"</span> <span class="sc">~</span> <span class="st">"Sediment"</span>,</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>                                Pred_Class <span class="sc">==</span> <span class="st">"MPB"</span> <span class="sc">~</span> <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>                                Pred_Class <span class="sc">==</span> <span class="st">"Bare_Sediment"</span> <span class="sc">~</span> <span class="st">"Sediment"</span>,</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>                                 Pred_Class <span class="sc">==</span> <span class="st">"Magnoliosida"</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>                                (Pred_Class <span class="sc">==</span> <span class="st">"Low_SPC"</span> <span class="sc">&amp;</span> NDVI <span class="sc">&gt;</span> <span class="fl">0.2</span>) <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>                                (Pred_Class <span class="sc">==</span> <span class="st">"Low_SPC"</span> <span class="sc">&amp;</span> NDVI <span class="sc">&lt;=</span> <span class="fl">0.2</span> )<span class="sc">~</span> <span class="st">"Sediment"</span>,</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> Pred_Class)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Truth <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>                Truth  <span class="sc">!=</span> <span class="st">"Spartina"</span>,</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>                Truth <span class="sc">!=</span> <span class="st">"SunGlint"</span>,</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>                Truth <span class="sc">!=</span> <span class="st">"Bleached seagrasses"</span>,</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>                Truth <span class="sc">!=</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Pred_Class != "Low_SPC",</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>                Pred_Class <span class="sc">!=</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>                 Pred_Class <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>                 Pred_Class <span class="sc">!=</span> <span class="st">"SunGlint"</span>,</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>Flight <span class="sc">==</span> <span class="st">"Handfisher_1_old"</span>,</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>Flight <span class="sc">==</span> <span class="st">"Handfisher_2_old"</span>,</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>Flight <span class="sc">==</span> <span class="st">"Handfisher_2"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>NDVI)</span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span><span class="fu">as.character</span>(<span class="fu">unique</span>(df<span class="sc">$</span>Truth))</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>b<span class="ot">&lt;-</span><span class="fu">as.character</span>(<span class="fu">unique</span>(df<span class="sc">$</span>Pred_Class))</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>ab<span class="ot">&lt;-</span><span class="fu">setdiff</span>(a,b)</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>ba<span class="ot">&lt;-</span><span class="fu">setdiff</span>(b,a)</span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="fu">length</span>(ab) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">length</span>(ba) <span class="sc">==</span> <span class="dv">0</span>)) {</span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>lines_to_add<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Pred_Class =</span> <span class="fu">c</span>(ab,ba),</span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Pred_ID =</span> <span class="cn">NA</span>,</span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Flight =</span> <span class="cn">NA</span>,</span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Truth_ID =</span> <span class="cn">NA</span>,</span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Truth =</span> <span class="fu">c</span>(ab,ba))</span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(lines_to_add)</span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(lines_to_add)</span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a>  df<span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pred_Class =</span> <span class="fu">as_factor</span>(Pred_Class),</span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a>         <span class="at">Truth =</span> <span class="fu">as_factor</span>(Truth),</span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a>         <span class="at">Truth =</span> <span class="fu">fct_relevel</span>(Truth, <span class="fu">c</span>(<span class="st">"Sediment"</span>,<span class="st">"Bacillariophyceae"</span>,<span class="st">"Chlorophyceae"</span>,<span class="st">"Magnoliopsida"</span>,<span class="st">"Rhodophyceae"</span>,<span class="st">"Phaeophyceae"</span>)),</span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a>         <span class="at">Pred_Class =</span> <span class="fu">fct_relevel</span>(Pred_Class, <span class="fu">c</span>(<span class="st">"Sediment"</span>,<span class="st">"Bacillariophyceae"</span>,<span class="st">"Chlorophyceae"</span>,<span class="st">"Magnoliopsida"</span>,<span class="st">"Rhodophyceae"</span>,<span class="st">"Phaeophyceae"</span>)),</span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a>         <span class="at">Flight =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(Flight, <span class="st">"Boat"</span>) <span class="sc">~</span> <span class="st">"Boat"</span>,</span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> Flight))</span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a><span class="do">####### GafanahaLow #######</span></span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a>df_GafanhaLow<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"GafanhaLow"</span>)</span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a>validation_metrics_GafanhaLow<span class="ot">&lt;-</span><span class="fu">confusionMatrix</span>(df_GafanhaLow<span class="sc">$</span>Pred_Class,df_GafanhaLow<span class="sc">$</span>Truth)</span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a>conf_mat_GafanhaLow<span class="ot">&lt;-</span>validation_metrics_GafanhaLow[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a>conf_mat_GafanhaLow[<span class="dv">6</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a>conf_mat_GafanhaLow[,<span class="dv">6</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(conf_mat_GafanhaLow))){</span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a>    df_sum<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">row =</span> <span class="cn">NA</span>,</span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_GafanhaLow[i,],<span class="at">na.rm =</span> T)</span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_GafanhaLow[,i],<span class="at">na.rm =</span> T)</span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true" tabindex="-1"></a>conf_mat_std_GafanhaLow<span class="ot">&lt;-</span>conf_mat_GafanhaLow</span>
<span id="cb64-97"><a href="#cb64-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-98"><a href="#cb64-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_mat_std_GafanhaLow)){</span>
<span id="cb64-99"><a href="#cb64-99" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(conf_mat_std_GafanhaLow)){</span>
<span id="cb64-100"><a href="#cb64-100" aria-hidden="true" tabindex="-1"></a>    conf_mat_std_GafanhaLow[row,col]<span class="ot">&lt;-</span>conf_mat_std_GafanhaLow[row,col]<span class="sc">/</span>((df_sum<span class="sc">$</span>row[row] <span class="sc">+</span> df_sum<span class="sc">$</span>col[col])<span class="sc">-</span>conf_mat_std_GafanhaLow[row,col])</span>
<span id="cb64-101"><a href="#cb64-101" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb64-102"><a href="#cb64-102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-103"><a href="#cb64-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-104"><a href="#cb64-104" aria-hidden="true" tabindex="-1"></a>confmat_rast_GafanhaLow<span class="ot">&lt;-</span>conf_mat_std_GafanhaLow <span class="sc">%&gt;%</span> </span>
<span id="cb64-105"><a href="#cb64-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb64-106"><a href="#cb64-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb64-107"><a href="#cb64-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb64-108"><a href="#cb64-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-109"><a href="#cb64-109" aria-hidden="true" tabindex="-1"></a>confmat_rast_GafanhaLow<span class="ot">&lt;-</span><span class="fu">subst</span>(confmat_rast_GafanhaLow, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb64-110"><a href="#cb64-110" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(confmat_rast_GafanhaLow)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb64-111"><a href="#cb64-111" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(confmat_rast_GafanhaLow)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">18.1</span>,<span class="fl">21.9</span>,<span class="fl">8.2</span>,<span class="fl">11.8</span>)</span>
<span id="cb64-112"><a href="#cb64-112" aria-hidden="true" tabindex="-1"></a>confmat_rast_GafanhaLow_sf<span class="ot">&lt;-</span><span class="fu">as.polygons</span>(confmat_rast_GafanhaLow,<span class="at">aggregate=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb64-113"><a href="#cb64-113" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb64-114"><a href="#cb64-114" aria-hidden="true" tabindex="-1"></a>confmat_rast_GafanhaLow_centroid<span class="ot">&lt;-</span><span class="fu">st_centroid</span>(confmat_rast_GafanhaLow_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_GafanhaLow)[<span class="fu">values</span>(confmat_rast_GafanhaLow) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_GafanhaLow)[<span class="fu">values</span>(confmat_rast_GafanhaLow) <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="do">####### GafanhaHigh #######</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>df_GafanhaHigh<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"GafanhaHigh"</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>validation_metrics_GafanhaHigh<span class="ot">&lt;-</span><span class="fu">confusionMatrix</span>(df_GafanhaHigh<span class="sc">$</span>Pred_Class,df_GafanhaHigh<span class="sc">$</span>Truth)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>conf_mat_GafanhaHigh<span class="ot">&lt;-</span>validation_metrics_GafanhaHigh[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>conf_mat_GafanhaHigh[<span class="dv">6</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>conf_mat_GafanhaHigh[,<span class="dv">6</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(conf_mat_GafanhaHigh))){</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    df_sum<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">row =</span> <span class="cn">NA</span>,</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_GafanhaHigh[i,],<span class="at">na.rm =</span> T)</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_GafanhaHigh[,i],<span class="at">na.rm =</span> T)</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>conf_mat_std_GafanhaHigh<span class="ot">&lt;-</span>conf_mat_GafanhaHigh</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_mat_std_GafanhaHigh)){</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(conf_mat_std_GafanhaHigh)){</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>    conf_mat_std_GafanhaHigh[row,col]<span class="ot">&lt;-</span>conf_mat_std_GafanhaHigh[row,col]<span class="sc">/</span>((df_sum<span class="sc">$</span>row[row] <span class="sc">+</span> df_sum<span class="sc">$</span>col[col])<span class="sc">-</span>conf_mat_std_GafanhaHigh[row,col])</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>confmat_rast_GafanhaHigh<span class="ot">&lt;-</span>conf_mat_std_GafanhaHigh <span class="sc">%&gt;%</span> </span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>confmat_rast_GafanhaHigh<span class="ot">&lt;-</span><span class="fu">subst</span>(confmat_rast_GafanhaHigh, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(confmat_rast_GafanhaHigh)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(confmat_rast_GafanhaHigh)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">14.1</span>,<span class="fl">17.9</span>,<span class="fl">8.2</span>,<span class="fl">11.8</span>)</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>confmat_rast_GafanhaHigh_sf<span class="ot">&lt;-</span><span class="fu">as.polygons</span>(confmat_rast_GafanhaHigh,<span class="at">aggregate=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>confmat_rast_GafanhaHigh_centroid<span class="ot">&lt;-</span><span class="fu">st_centroid</span>(confmat_rast_GafanhaHigh_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_GafanhaHigh)[<span class="fu">values</span>(confmat_rast_GafanhaHigh) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_GafanhaHigh)[<span class="fu">values</span>(confmat_rast_GafanhaHigh) <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_matrix_GafanhaHigh &lt;-</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot()+</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_spatraster(data = (confmat_rast_GafanhaHigh),</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                   show.legend = F,</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.rm = TRUE</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                   )+</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_Bede("mixed", </span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                   discrete = F,</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.value = "white",</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                   trans = "sqrt",</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                   labels = c("5","25", "50", "75", "100"),</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                   breaks = c(0.05,0.25,0.50,0.75,0.9999))+</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(fill = "Proportion \n of pixels (%)")+</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Sediment","Chlorophyceae","Magnoliopsida","Rhodophyceae","Phaeophyceae"),</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0),</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                      position = "top",</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Phaeophyceae","Rhodophyceae","Magnoliopsida","Chlorophyceae","Sediment"),</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0.1),</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     data = data.frame(</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a><span class="co">#       x = c(0,10,0,10,0,10,0,10,0,10,0,10,0,0,2,2,4,4,6,6,8,8,10,10),</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a><span class="co">#       y = c(0,0,2,2,4,4,6,6,8,8,10,10,0,10,0,10,0,10,0,10,0,10,0,10),</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a><span class="co">#       group = c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12)</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       ),</span></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     aes(x,y,group= group),</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     linewidth = 1</span></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     )+</span></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_void()+</span></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Gafanha Low")+</span></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.margin = unit(c(0,30,0,30), "pt"))</span></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a><span class="do">####### DuerLow #######</span></span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a>df_DuerLow<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"DuerLow"</span>)</span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a>validation_metrics_DuerLow<span class="ot">&lt;-</span><span class="fu">confusionMatrix</span>(df_DuerLow<span class="sc">$</span>Pred_Class,df_DuerLow<span class="sc">$</span>Truth)</span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a>conf_mat_DuerLow<span class="ot">&lt;-</span>validation_metrics_DuerLow[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true" tabindex="-1"></a>conf_mat_DuerLow[<span class="dv">5</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb68-58"><a href="#cb68-58" aria-hidden="true" tabindex="-1"></a>conf_mat_DuerLow[,<span class="dv">5</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb68-59"><a href="#cb68-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-60"><a href="#cb68-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(conf_mat_DuerLow))){</span>
<span id="cb68-61"><a href="#cb68-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb68-62"><a href="#cb68-62" aria-hidden="true" tabindex="-1"></a>    df_sum<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">row =</span> <span class="cn">NA</span>,</span>
<span id="cb68-63"><a href="#cb68-63" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb68-64"><a href="#cb68-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-65"><a href="#cb68-65" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_DuerLow[i,], <span class="at">na.rm =</span> T)</span>
<span id="cb68-66"><a href="#cb68-66" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_DuerLow[,i], <span class="at">na.rm =</span> T)</span>
<span id="cb68-67"><a href="#cb68-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-68"><a href="#cb68-68" aria-hidden="true" tabindex="-1"></a>conf_mat_std_DuerLow<span class="ot">&lt;-</span>conf_mat_DuerLow</span>
<span id="cb68-69"><a href="#cb68-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-70"><a href="#cb68-70" aria-hidden="true" tabindex="-1"></a><span class="co"># for(row in 1:nrow(conf_mat_std_DuerLow)){</span></span>
<span id="cb68-71"><a href="#cb68-71" aria-hidden="true" tabindex="-1"></a><span class="co">#   for(col in 1:ncol(conf_mat_std_DuerLow)){</span></span>
<span id="cb68-72"><a href="#cb68-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     conf_mat_std_DuerLow[row,col]&lt;-conf_mat_std_DuerLow[row,col]/((df_sum$row[row] + df_sum$col[col])-conf_mat_std_DuerLow[row,col])</span></span>
<span id="cb68-73"><a href="#cb68-73" aria-hidden="true" tabindex="-1"></a><span class="co">#     }</span></span>
<span id="cb68-74"><a href="#cb68-74" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb68-75"><a href="#cb68-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-76"><a href="#cb68-76" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_mat_std_DuerLow)){</span>
<span id="cb68-77"><a href="#cb68-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(conf_mat_std_DuerLow)){</span>
<span id="cb68-78"><a href="#cb68-78" aria-hidden="true" tabindex="-1"></a>    conf_mat_std_DuerLow[row,col]<span class="ot">&lt;-</span>conf_mat_std_DuerLow[row,col]<span class="sc">/</span>((df_sum<span class="sc">$</span>col[col]))</span>
<span id="cb68-79"><a href="#cb68-79" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb68-80"><a href="#cb68-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-81"><a href="#cb68-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-82"><a href="#cb68-82" aria-hidden="true" tabindex="-1"></a>confmat_rast_DuerLow<span class="ot">&lt;-</span>conf_mat_std_DuerLow <span class="sc">%&gt;%</span> </span>
<span id="cb68-83"><a href="#cb68-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb68-84"><a href="#cb68-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb68-85"><a href="#cb68-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb68-86"><a href="#cb68-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-87"><a href="#cb68-87" aria-hidden="true" tabindex="-1"></a>confmat_rast_DuerLow<span class="ot">&lt;-</span><span class="fu">subst</span>(confmat_rast_DuerLow, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb68-88"><a href="#cb68-88" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(confmat_rast_DuerLow)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb68-89"><a href="#cb68-89" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(confmat_rast_DuerLow)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">18.1</span>,<span class="fl">21.9</span>,<span class="dv">0</span>,<span class="fl">3.8</span>)</span>
<span id="cb68-90"><a href="#cb68-90" aria-hidden="true" tabindex="-1"></a>confmat_rast_DuerLow_sf<span class="ot">&lt;-</span><span class="fu">as.polygons</span>(confmat_rast_DuerLow,<span class="at">aggregate=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb68-91"><a href="#cb68-91" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb68-92"><a href="#cb68-92" aria-hidden="true" tabindex="-1"></a>confmat_rast_DuerLow_centroid<span class="ot">&lt;-</span><span class="fu">st_centroid</span>(confmat_rast_DuerLow_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_DuerLow)[<span class="fu">values</span>(confmat_rast_DuerLow) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_DuerLow)[<span class="fu">values</span>(confmat_rast_DuerLow) <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_matrix_DuerLow &lt;-</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot()+</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_spatraster(data = (confmat_rast_DuerLow),</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                   show.legend = F,</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.rm = TRUE</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                   )+</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_Bede("mixed", </span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                   discrete = F,</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.value = "white",</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                   trans = "sqrt",</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                   labels = c("5","25", "50", "75", "100"),</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                   breaks = c(0.05,0.25,0.50,0.75,0.9999))+</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(fill = "Proportion \n of pixels (%)")+</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Sediment","Chlorophyceae","Magnoliopsida","Rhodophyceae","Phaeophyceae"),</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0),</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                      position = "top",</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Phaeophyceae","Rhodophyceae","Magnoliopsida","Chlorophyceae","Sediment"),</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0.1),</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     data = data.frame(</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="co">#       x = c(0,10,0,10,0,10,0,10,0,10,0,10,0,0,2,2,4,4,6,6,8,8,10,10),</span></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="co">#       y = c(0,0,2,2,4,4,6,6,8,8,10,10,0,10,0,10,0,10,0,10,0,10,0,10),</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a><span class="co">#       group = c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12)</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       ),</span></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     aes(x,y,group= group),</span></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     linewidth = 1</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     )+</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_void()+</span></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Duer Low")+</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.margin = unit(c(0,30,0,30), "pt"))</span></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a><span class="do">####### Horse_rooster #######</span></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>df_Horse_rooster<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"Horse_rooster"</span>)</span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a>validation_metrics_Horse_rooster<span class="ot">&lt;-</span><span class="fu">confusionMatrix</span>(df_Horse_rooster<span class="sc">$</span>Pred_Class,df_Horse_rooster<span class="sc">$</span>Truth)</span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a>conf_mat_Horse_rooster<span class="ot">&lt;-</span>validation_metrics_Horse_rooster[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a>conf_mat_Horse_rooster[<span class="dv">6</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a>conf_mat_Horse_rooster[,<span class="dv">6</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a>conf_mat_Horse_rooster[<span class="dv">2</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a>conf_mat_Horse_rooster[,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(conf_mat_Horse_rooster))){</span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true" tabindex="-1"></a>    df_sum<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">row =</span> <span class="cn">NA</span>,</span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_Horse_rooster[i,],<span class="at">na.rm =</span> T)</span>
<span id="cb70-63"><a href="#cb70-63" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_Horse_rooster[,i],<span class="at">na.rm =</span> T)</span>
<span id="cb70-64"><a href="#cb70-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-65"><a href="#cb70-65" aria-hidden="true" tabindex="-1"></a>conf_mat_std_Horse_rooster<span class="ot">&lt;-</span>conf_mat_Horse_rooster</span>
<span id="cb70-66"><a href="#cb70-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-67"><a href="#cb70-67" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_mat_std_Horse_rooster)){</span>
<span id="cb70-68"><a href="#cb70-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(conf_mat_std_Horse_rooster)){</span>
<span id="cb70-69"><a href="#cb70-69" aria-hidden="true" tabindex="-1"></a>    conf_mat_std_Horse_rooster[row,col]<span class="ot">&lt;-</span>conf_mat_std_Horse_rooster[row,col]<span class="sc">/</span>((df_sum<span class="sc">$</span>row[row] <span class="sc">+</span> df_sum<span class="sc">$</span>col[col])<span class="sc">-</span>conf_mat_std_Horse_rooster[row,col])</span>
<span id="cb70-70"><a href="#cb70-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-71"><a href="#cb70-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-72"><a href="#cb70-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-73"><a href="#cb70-73" aria-hidden="true" tabindex="-1"></a>confmat_rast_Horse_rooster<span class="ot">&lt;-</span>conf_mat_std_Horse_rooster <span class="sc">%&gt;%</span> </span>
<span id="cb70-74"><a href="#cb70-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb70-75"><a href="#cb70-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb70-76"><a href="#cb70-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb70-77"><a href="#cb70-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-78"><a href="#cb70-78" aria-hidden="true" tabindex="-1"></a>confmat_rast_Horse_rooster<span class="ot">&lt;-</span><span class="fu">subst</span>(confmat_rast_Horse_rooster, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb70-79"><a href="#cb70-79" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(confmat_rast_Horse_rooster)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb70-80"><a href="#cb70-80" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(confmat_rast_Horse_rooster)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">14.1</span>,<span class="fl">17.9</span>,<span class="fl">4.2</span>,<span class="fl">7.8</span>)</span>
<span id="cb70-81"><a href="#cb70-81" aria-hidden="true" tabindex="-1"></a>confmat_rast_Horse_rooster_sf<span class="ot">&lt;-</span><span class="fu">as.polygons</span>(confmat_rast_Horse_rooster,<span class="at">aggregate=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb70-82"><a href="#cb70-82" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb70-83"><a href="#cb70-83" aria-hidden="true" tabindex="-1"></a>confmat_rast_Horse_rooster_centroid<span class="ot">&lt;-</span><span class="fu">st_centroid</span>(confmat_rast_Horse_rooster_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_Horse_rooster)[<span class="fu">values</span>(confmat_rast_Horse_rooster) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_Horse_rooster)[<span class="fu">values</span>(confmat_rast_Horse_rooster) <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_matrix_Horse_rooster &lt;-</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot()+</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_spatraster(data = (confmat_rast_Horse_rooster),</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                   show.legend = F,</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.rm = TRUE</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                   )+</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_Bede("mixed",</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                   discrete = F,</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.value = "white",</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                   trans = "sqrt",</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                   labels = c("5","25", "50", "75", "100"),</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="co">#                   breaks = c(0.05,0.25,0.50,0.75,0.9999))+</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(fill = "Proportion \n of pixels (%)")+</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Sediment","Chlorophyceae","Magnoliopsida","Rhodophyceae","Phaeophyceae"),</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0),</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                      position = "top",</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Phaeophyceae","Rhodophyceae","Magnoliopsida","Chlorophyceae","Sediment"),</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0.1),</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(</span></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     data = data.frame(</span></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="co">#       x = c(0,10,0,10,0,10,0,10,0,10,0,10,0,0,2,2,4,4,6,6,8,8,10,10),</span></span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a><span class="co">#       y = c(0,0,2,2,4,4,6,6,8,8,10,10,0,10,0,10,0,10,0,10,0,10,0,10),</span></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       group = c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12)</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a><span class="co">#       ),</span></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     aes(x,y,group= group),</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     linewidth = 1</span></span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a><span class="co">#     )+</span></span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_void()+</span></span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Mataducos")+</span></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.margin = unit(c(0,30,0,30), "pt"))</span></span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a><span class="do">####### Handfisher_1 #######</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>df_Handfisher_1<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"Handfisher_1"</span>)</span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>validation_metrics_Handfisher_1<span class="ot">&lt;-</span><span class="fu">confusionMatrix</span>(df_Handfisher_1<span class="sc">$</span>Pred_Class,df_Handfisher_1<span class="sc">$</span>Truth)</span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>conf_mat_Handfisher_1<span class="ot">&lt;-</span>validation_metrics_Handfisher_1[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a>conf_mat_Handfisher_1[<span class="dv">5</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a>conf_mat_Handfisher_1[<span class="dv">6</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a>conf_mat_Handfisher_1[<span class="dv">2</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a>conf_mat_Handfisher_1[<span class="dv">3</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a>conf_mat_Handfisher_1[,<span class="dv">5</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a>conf_mat_Handfisher_1[,<span class="dv">6</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>conf_mat_Handfisher_1[,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a>conf_mat_Handfisher_1[,<span class="dv">3</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(conf_mat_Handfisher_1))){</span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a>    df_sum<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">row =</span> <span class="cn">NA</span>,</span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_Handfisher_1[i,],<span class="at">na.rm =</span> T)</span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_Handfisher_1[,i],<span class="at">na.rm =</span> T)</span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a>conf_mat_std_Handfisher_1<span class="ot">&lt;-</span>conf_mat_Handfisher_1</span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_mat_std_Handfisher_1)){</span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(conf_mat_std_Handfisher_1)){</span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a>    conf_mat_std_Handfisher_1[row,col]<span class="ot">&lt;-</span>conf_mat_std_Handfisher_1[row,col]<span class="sc">/</span>((df_sum<span class="sc">$</span>row[row] <span class="sc">+</span> df_sum<span class="sc">$</span>col[col])<span class="sc">-</span>conf_mat_std_Handfisher_1[row,col])</span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-78"><a href="#cb72-78" aria-hidden="true" tabindex="-1"></a>confmat_rast_Handfisher_1<span class="ot">&lt;-</span>conf_mat_std_Handfisher_1 <span class="sc">%&gt;%</span> </span>
<span id="cb72-79"><a href="#cb72-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb72-80"><a href="#cb72-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb72-81"><a href="#cb72-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb72-82"><a href="#cb72-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-83"><a href="#cb72-83" aria-hidden="true" tabindex="-1"></a>confmat_rast_Handfisher_1<span class="ot">&lt;-</span><span class="fu">subst</span>(confmat_rast_Handfisher_1, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb72-84"><a href="#cb72-84" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(confmat_rast_Handfisher_1)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb72-85"><a href="#cb72-85" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(confmat_rast_Handfisher_1)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">22.1</span>,<span class="fl">25.9</span>,<span class="fl">4.2</span>,<span class="fl">7.8</span>)</span>
<span id="cb72-86"><a href="#cb72-86" aria-hidden="true" tabindex="-1"></a>confmat_rast_Handfisher_1_sf<span class="ot">&lt;-</span><span class="fu">as.polygons</span>(confmat_rast_Handfisher_1,<span class="at">aggregate=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb72-87"><a href="#cb72-87" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb72-88"><a href="#cb72-88" aria-hidden="true" tabindex="-1"></a>confmat_rast_Handfisher_1_centroid<span class="ot">&lt;-</span><span class="fu">st_centroid</span>(confmat_rast_Handfisher_1_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_Handfisher_1)[<span class="fu">values</span>(confmat_rast_Handfisher_1) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_Handfisher_1)[<span class="fu">values</span>(confmat_rast_Handfisher_1) <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_matrix_Handfisher_1 &lt;-</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot()+</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_spatraster(data = (confmat_rast_Handfisher_1),</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                   show.legend = F,</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.rm = TRUE</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                   )+</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_Bede("mixed", </span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                   discrete = F,</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.value = "white",</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                   trans = "sqrt",</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                   labels = c("5","25", "50", "75", "100"),</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                   breaks = c(0.05,0.25,0.50,0.75,0.9999))+</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(fill = "Proportion \n of pixels (%)")+</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Sediment","Chlorophyceae","Magnoliopsida","Rhodophyceae","Phaeophyceae"),</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0),</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                      position = "top",</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Phaeophyceae","Rhodophyceae","Magnoliopsida","Chlorophyceae","Sediment"),</span></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0.1),</span></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     data = data.frame(</span></span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a><span class="co">#       x = c(0,10,0,10,0,10,0,10,0,10,0,10,0,0,2,2,4,4,6,6,8,8,10,10),</span></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a><span class="co">#       y = c(0,0,2,2,4,4,6,6,8,8,10,10,0,10,0,10,0,10,0,10,0,10,0,10),</span></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a><span class="co">#       group = c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12)</span></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       ),</span></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     aes(x,y,group= group),</span></span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     linewidth = 1</span></span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     )+</span></span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_void()+</span></span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Barbatre")+</span></span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.margin = unit(c(0,30,0,30), "pt"))</span></span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a><span class="do">####### Boat #######</span></span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a>df_Boat<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"Boat"</span>)</span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a>validation_metrics_Boat<span class="ot">&lt;-</span><span class="fu">confusionMatrix</span>(df_Boat<span class="sc">$</span>Pred_Class,df_Boat<span class="sc">$</span>Truth)</span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-49"><a href="#cb74-49" aria-hidden="true" tabindex="-1"></a>conf_mat_Boat<span class="ot">&lt;-</span>validation_metrics_Boat[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb74-50"><a href="#cb74-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb74-51"><a href="#cb74-51" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-52"><a href="#cb74-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb74-53"><a href="#cb74-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-54"><a href="#cb74-54" aria-hidden="true" tabindex="-1"></a>conf_mat_Boat[<span class="dv">6</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb74-55"><a href="#cb74-55" aria-hidden="true" tabindex="-1"></a>conf_mat_Boat[,<span class="dv">6</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb74-56"><a href="#cb74-56" aria-hidden="true" tabindex="-1"></a>conf_mat_Boat[<span class="dv">2</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb74-57"><a href="#cb74-57" aria-hidden="true" tabindex="-1"></a>conf_mat_Boat[,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb74-58"><a href="#cb74-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-59"><a href="#cb74-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(conf_mat_Boat))){</span>
<span id="cb74-60"><a href="#cb74-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb74-61"><a href="#cb74-61" aria-hidden="true" tabindex="-1"></a>    df_sum<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">row =</span> <span class="cn">NA</span>,</span>
<span id="cb74-62"><a href="#cb74-62" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb74-63"><a href="#cb74-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb74-64"><a href="#cb74-64" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_Boat[i,],<span class="at">na.rm =</span> T)</span>
<span id="cb74-65"><a href="#cb74-65" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_Boat[,i],<span class="at">na.rm =</span> T)</span>
<span id="cb74-66"><a href="#cb74-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-67"><a href="#cb74-67" aria-hidden="true" tabindex="-1"></a>conf_mat_std_Boat<span class="ot">&lt;-</span>conf_mat_Boat</span>
<span id="cb74-68"><a href="#cb74-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-69"><a href="#cb74-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_mat_std_Boat)){</span>
<span id="cb74-70"><a href="#cb74-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(conf_mat_std_Boat)){</span>
<span id="cb74-71"><a href="#cb74-71" aria-hidden="true" tabindex="-1"></a>    conf_mat_std_Boat[row,col]<span class="ot">&lt;-</span>conf_mat_std_Boat[row,col]<span class="sc">/</span>((df_sum<span class="sc">$</span>row[row] <span class="sc">+</span> df_sum<span class="sc">$</span>col[col])<span class="sc">-</span>conf_mat_std_Boat[row,col])</span>
<span id="cb74-72"><a href="#cb74-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb74-73"><a href="#cb74-73" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-74"><a href="#cb74-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-75"><a href="#cb74-75" aria-hidden="true" tabindex="-1"></a>confmat_rast_Boat<span class="ot">&lt;-</span>conf_mat_std_Boat <span class="sc">%&gt;%</span> </span>
<span id="cb74-76"><a href="#cb74-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb74-77"><a href="#cb74-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb74-78"><a href="#cb74-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb74-79"><a href="#cb74-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-80"><a href="#cb74-80" aria-hidden="true" tabindex="-1"></a>confmat_rast_Boat<span class="ot">&lt;-</span><span class="fu">subst</span>(confmat_rast_Boat, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb74-81"><a href="#cb74-81" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(confmat_rast_Boat)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb74-82"><a href="#cb74-82" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(confmat_rast_Boat)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">22.1</span>,<span class="fl">25.9</span>,<span class="fl">8.2</span>,<span class="fl">11.8</span>)</span>
<span id="cb74-83"><a href="#cb74-83" aria-hidden="true" tabindex="-1"></a>confmat_rast_Boat_sf<span class="ot">&lt;-</span><span class="fu">as.polygons</span>(confmat_rast_Boat,<span class="at">aggregate=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb74-84"><a href="#cb74-84" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb74-85"><a href="#cb74-85" aria-hidden="true" tabindex="-1"></a>confmat_rast_Boat_centroid<span class="ot">&lt;-</span><span class="fu">st_centroid</span>(confmat_rast_Boat_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_Boat)[<span class="fu">values</span>(confmat_rast_Boat) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_Boat)[<span class="fu">values</span>(confmat_rast_Boat) <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_matrix_Boat &lt;-</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot()+</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_spatraster(data = (confmat_rast_Boat),</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                   show.legend = F,</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.rm = TRUE</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                   )+</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_Bede("mixed", </span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                   discrete = F,</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.value = "white",</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                   trans = "sqrt",</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                   labels = c("5","25", "50", "75", "100"),</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a><span class="co">#                   breaks = c(0.05,0.25,0.50,0.75,0.9999))+</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(fill = "Proportion \n of pixels (%)")+</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Sediment","Chlorophyceae","Magnoliopsida","Rhodophyceae","Phaeophyceae"),</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0),</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                      position = "top",</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Phaeophyceae","Rhodophyceae","Magnoliopsida","Chlorophyceae","Sediment"),</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0.1),</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     data = data.frame(</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a><span class="co">#       x = c(0,10,0,10,0,10,0,10,0,10,0,10,0,0,2,2,4,4,6,6,8,8,10,10),</span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a><span class="co">#       y = c(0,0,2,2,4,4,6,6,8,8,10,10,0,10,0,10,0,10,0,10,0,10,0,10),</span></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       group = c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12)</span></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a><span class="co">#       ),</span></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     aes(x,y,group= group),</span></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     linewidth = 1</span></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a><span class="co">#     )+</span></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_void()+</span></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Inner Lagoon")+</span></span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.margin = unit(c(0,30,0,30), "pt"))</span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a><span class="do">####### Arz #######</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>df_Arz<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"Arz"</span>)</span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a>validation_metrics_Arz<span class="ot">&lt;-</span><span class="fu">confusionMatrix</span>(df_Arz<span class="sc">$</span>Pred_Class,df_Arz<span class="sc">$</span>Truth)</span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a>conf_mat_Arz<span class="ot">&lt;-</span>validation_metrics_Arz[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true" tabindex="-1"></a>conf_mat_Arz[<span class="dv">3</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true" tabindex="-1"></a>conf_mat_Arz[,<span class="dv">3</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true" tabindex="-1"></a>conf_mat_Arz[<span class="dv">2</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true" tabindex="-1"></a>conf_mat_Arz[,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true" tabindex="-1"></a>conf_mat_Arz[<span class="dv">5</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb76-59"><a href="#cb76-59" aria-hidden="true" tabindex="-1"></a>conf_mat_Arz[,<span class="dv">5</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb76-60"><a href="#cb76-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-61"><a href="#cb76-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(conf_mat_Arz))){</span>
<span id="cb76-62"><a href="#cb76-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb76-63"><a href="#cb76-63" aria-hidden="true" tabindex="-1"></a>    df_sum<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">row =</span> <span class="cn">NA</span>,</span>
<span id="cb76-64"><a href="#cb76-64" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb76-65"><a href="#cb76-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-66"><a href="#cb76-66" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_Arz[i,],<span class="at">na.rm =</span> T)</span>
<span id="cb76-67"><a href="#cb76-67" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_Arz[,i],<span class="at">na.rm =</span> T)</span>
<span id="cb76-68"><a href="#cb76-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-69"><a href="#cb76-69" aria-hidden="true" tabindex="-1"></a>conf_mat_std_Arz<span class="ot">&lt;-</span>conf_mat_Arz</span>
<span id="cb76-70"><a href="#cb76-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-71"><a href="#cb76-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_mat_std_Arz)){</span>
<span id="cb76-72"><a href="#cb76-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(conf_mat_std_Arz)){</span>
<span id="cb76-73"><a href="#cb76-73" aria-hidden="true" tabindex="-1"></a>    conf_mat_std_Arz[row,col]<span class="ot">&lt;-</span>conf_mat_std_Arz[row,col]<span class="sc">/</span>((df_sum<span class="sc">$</span>row[row] <span class="sc">+</span> df_sum<span class="sc">$</span>col[col])<span class="sc">-</span>conf_mat_std_Arz[row,col])</span>
<span id="cb76-74"><a href="#cb76-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-75"><a href="#cb76-75" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-76"><a href="#cb76-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-77"><a href="#cb76-77" aria-hidden="true" tabindex="-1"></a>confmat_rast_Arz<span class="ot">&lt;-</span>conf_mat_std_Arz <span class="sc">%&gt;%</span> </span>
<span id="cb76-78"><a href="#cb76-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-79"><a href="#cb76-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-80"><a href="#cb76-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb76-81"><a href="#cb76-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-82"><a href="#cb76-82" aria-hidden="true" tabindex="-1"></a>confmat_rast_Arz<span class="ot">&lt;-</span><span class="fu">subst</span>(confmat_rast_Arz, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb76-83"><a href="#cb76-83" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(confmat_rast_Arz)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb76-84"><a href="#cb76-84" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(confmat_rast_Arz)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">14.1</span>,<span class="fl">17.9</span>,<span class="dv">0</span>,<span class="fl">3.8</span>)</span>
<span id="cb76-85"><a href="#cb76-85" aria-hidden="true" tabindex="-1"></a>confmat_rast_Arz_sf<span class="ot">&lt;-</span><span class="fu">as.polygons</span>(confmat_rast_Arz,<span class="at">aggregate=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb76-86"><a href="#cb76-86" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb76-87"><a href="#cb76-87" aria-hidden="true" tabindex="-1"></a>confmat_rast_Arz_centroid<span class="ot">&lt;-</span><span class="fu">st_centroid</span>(confmat_rast_Arz_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_Arz)[<span class="fu">values</span>(confmat_rast_Arz) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_Arz)[<span class="fu">values</span>(confmat_rast_Arz) <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_matrix_Arz &lt;-</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot()+</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_spatraster(data = (confmat_rast_Arz),</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                   show.legend = F,</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.rm = TRUE</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                   )+</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_Bede("mixed", </span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                   discrete = F,</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.value = "white",</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                   trans = "sqrt",</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                   labels = c("5","25", "50", "75", "100"),</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a><span class="co">#                   breaks = c(0.05,0.25,0.50,0.75,0.9999))+</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(fill = "Proportion \n of pixels (%)")+</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Sediment","Chlorophyceae","Magnoliopsida","Rhodophyceae","Phaeophyceae"),</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0),</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                      position = "top",</span></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Phaeophyceae","Rhodophyceae","Magnoliopsida","Chlorophyceae","Sediment"),</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0.1),</span></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(</span></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     data = data.frame(</span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a><span class="co">#       x = c(0,10,0,10,0,10,0,10,0,10,0,10,0,0,2,2,4,4,6,6,8,8,10,10),</span></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a><span class="co">#       y = c(0,0,2,2,4,4,6,6,8,8,10,10,0,10,0,10,0,10,0,10,0,10,0,10),</span></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       group = c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12)</span></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a><span class="co">#       ),</span></span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     aes(x,y,group= group),</span></span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     linewidth = 1</span></span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a><span class="co">#     )+</span></span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_void()+</span></span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Arz Island")+</span></span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.margin = unit(c(0,30,0,30), "pt"))</span></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a><span class="do">####### NorthDike #######</span></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a>df_NorthDike<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"NorthDike"</span>)</span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a>validation_metrics_NorthDike<span class="ot">&lt;-</span><span class="fu">confusionMatrix</span>(df_NorthDike<span class="sc">$</span>Pred_Class,df_NorthDike<span class="sc">$</span>Truth)</span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a>conf_mat_NorthDike<span class="ot">&lt;-</span>validation_metrics_NorthDike[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a>conf_mat_NorthDike[<span class="dv">5</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a>conf_mat_NorthDike[,<span class="dv">5</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true" tabindex="-1"></a>conf_mat_NorthDike[<span class="dv">2</span>,]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb78-56"><a href="#cb78-56" aria-hidden="true" tabindex="-1"></a>conf_mat_NorthDike[,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(conf_mat_NorthDike))){</span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb78-60"><a href="#cb78-60" aria-hidden="true" tabindex="-1"></a>    df_sum<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">row =</span> <span class="cn">NA</span>,</span>
<span id="cb78-61"><a href="#cb78-61" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb78-62"><a href="#cb78-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb78-63"><a href="#cb78-63" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_NorthDike[i,],<span class="at">na.rm =</span> T)</span>
<span id="cb78-64"><a href="#cb78-64" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_NorthDike[,i],<span class="at">na.rm =</span> T)</span>
<span id="cb78-65"><a href="#cb78-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-66"><a href="#cb78-66" aria-hidden="true" tabindex="-1"></a>conf_mat_std_NorthDike<span class="ot">&lt;-</span>conf_mat_NorthDike</span>
<span id="cb78-67"><a href="#cb78-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-68"><a href="#cb78-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_mat_std_NorthDike)){</span>
<span id="cb78-69"><a href="#cb78-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(conf_mat_std_NorthDike)){</span>
<span id="cb78-70"><a href="#cb78-70" aria-hidden="true" tabindex="-1"></a>    conf_mat_std_NorthDike[row,col]<span class="ot">&lt;-</span>conf_mat_std_NorthDike[row,col]<span class="sc">/</span>((df_sum<span class="sc">$</span>row[row] <span class="sc">+</span> df_sum<span class="sc">$</span>col[col])<span class="sc">-</span>conf_mat_std_NorthDike[row,col])</span>
<span id="cb78-71"><a href="#cb78-71" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb78-72"><a href="#cb78-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-73"><a href="#cb78-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-74"><a href="#cb78-74" aria-hidden="true" tabindex="-1"></a>confmat_rast_NorthDike<span class="ot">&lt;-</span>conf_mat_std_NorthDike <span class="sc">%&gt;%</span> </span>
<span id="cb78-75"><a href="#cb78-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb78-76"><a href="#cb78-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb78-77"><a href="#cb78-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb78-78"><a href="#cb78-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-79"><a href="#cb78-79" aria-hidden="true" tabindex="-1"></a>confmat_rast_NorthDike<span class="ot">&lt;-</span><span class="fu">subst</span>(confmat_rast_NorthDike, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb78-80"><a href="#cb78-80" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(confmat_rast_NorthDike)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb78-81"><a href="#cb78-81" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(confmat_rast_NorthDike)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">18.1</span>,<span class="fl">21.9</span>,<span class="fl">4.2</span>,<span class="fl">7.8</span>)</span>
<span id="cb78-82"><a href="#cb78-82" aria-hidden="true" tabindex="-1"></a>confmat_rast_NorthDike_sf<span class="ot">&lt;-</span><span class="fu">as.polygons</span>(confmat_rast_NorthDike,<span class="at">aggregate=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb78-83"><a href="#cb78-83" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb78-84"><a href="#cb78-84" aria-hidden="true" tabindex="-1"></a>confmat_rast_NorthDike_centroid<span class="ot">&lt;-</span><span class="fu">st_centroid</span>(confmat_rast_NorthDike_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_NorthDike)[<span class="fu">values</span>(confmat_rast_NorthDike) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_NorthDike)[<span class="fu">values</span>(confmat_rast_NorthDike) <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_matrix_NorthDike &lt;-</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot()+</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_spatraster(data = (confmat_rast_NorthDike),</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                   show.legend = F,</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.rm = TRUE</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                   )+</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_Bede("mixed", </span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                   discrete = F,</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.value = "white",</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                   trans = "sqrt",</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                   labels = c("5","25", "50", "75", "100"),</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                   breaks = c(0.05,0.25,0.50,0.75,0.9999))+</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(fill = "Proportion \n of pixels (%)")+</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Sediment","Chlorophyceae","Magnoliopsida","Rhodophyceae","Phaeophyceae"),</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0),</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                      position = "top",</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Phaeophyceae","Rhodophyceae","Magnoliopsida","Chlorophyceae","Sediment"),</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0.1),</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     data = data.frame(</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="co">#       x = c(0,10,0,10,0,10,0,10,0,10,0,10,0,0,2,2,4,4,6,6,8,8,10,10),</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a><span class="co">#       y = c(0,0,2,2,4,4,6,6,8,8,10,10,0,10,0,10,0,10,0,10,0,10,0,10),</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="co">#       group = c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12)</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       ),</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     aes(x,y,group= group),</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     linewidth = 1</span></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     )+</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_void()+</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("L'Epine")+</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.margin = unit(c(0,30,0,30), "pt"))</span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a><span class="do">####### Kerdrean #######</span></span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>df_Kerdrean<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"Kerdrean"</span>)</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>validation_metrics_Kerdrean<span class="ot">&lt;-</span><span class="fu">confusionMatrix</span>(df_Kerdrean<span class="sc">$</span>Pred_Class,df_Kerdrean<span class="sc">$</span>Truth)</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>conf_mat_Kerdrean<span class="ot">&lt;-</span>validation_metrics_Kerdrean[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>conf_mat_Kerdrean[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>),]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>conf_mat_Kerdrean[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(conf_mat_Kerdrean))){</span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a>    df_sum<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">row =</span> <span class="cn">NA</span>,</span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_Kerdrean[i,],<span class="at">na.rm =</span> T)</span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_Kerdrean[,i],<span class="at">na.rm =</span> T)</span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true" tabindex="-1"></a>conf_mat_std_Kerdrean<span class="ot">&lt;-</span>conf_mat_Kerdrean</span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-65"><a href="#cb80-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_mat_std_Kerdrean)){</span>
<span id="cb80-66"><a href="#cb80-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(conf_mat_std_Kerdrean)){</span>
<span id="cb80-67"><a href="#cb80-67" aria-hidden="true" tabindex="-1"></a>    conf_mat_std_Kerdrean[row,col]<span class="ot">&lt;-</span>conf_mat_std_Kerdrean[row,col]<span class="sc">/</span>((df_sum<span class="sc">$</span>row[row] <span class="sc">+</span> df_sum<span class="sc">$</span>col[col])<span class="sc">-</span>conf_mat_std_Kerdrean[row,col])</span>
<span id="cb80-68"><a href="#cb80-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-69"><a href="#cb80-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-70"><a href="#cb80-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-71"><a href="#cb80-71" aria-hidden="true" tabindex="-1"></a>confmat_rast_Kerdrean<span class="ot">&lt;-</span>conf_mat_std_Kerdrean <span class="sc">%&gt;%</span> </span>
<span id="cb80-72"><a href="#cb80-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb80-73"><a href="#cb80-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb80-74"><a href="#cb80-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb80-75"><a href="#cb80-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-76"><a href="#cb80-76" aria-hidden="true" tabindex="-1"></a>confmat_rast_Kerdrean<span class="ot">&lt;-</span><span class="fu">subst</span>(confmat_rast_Kerdrean, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb80-77"><a href="#cb80-77" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(confmat_rast_Kerdrean)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb80-78"><a href="#cb80-78" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(confmat_rast_Kerdrean)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">22.1</span>,<span class="fl">25.9</span>,<span class="dv">0</span>,<span class="fl">3.8</span>)</span>
<span id="cb80-79"><a href="#cb80-79" aria-hidden="true" tabindex="-1"></a>confmat_rast_Kerdrean_sf<span class="ot">&lt;-</span><span class="fu">as.polygons</span>(confmat_rast_Kerdrean,<span class="at">aggregate=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb80-80"><a href="#cb80-80" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb80-81"><a href="#cb80-81" aria-hidden="true" tabindex="-1"></a>confmat_rast_Kerdrean_centroid<span class="ot">&lt;-</span><span class="fu">st_centroid</span>(confmat_rast_Kerdrean_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_Kerdrean)[<span class="fu">values</span>(confmat_rast_Kerdrean) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_Kerdrean)[<span class="fu">values</span>(confmat_rast_Kerdrean) <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_matrix_Kerdrean &lt;-</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot()+</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_spatraster(data = (confmat_rast_Kerdrean),</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                   show.legend = F,</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.rm = TRUE</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                   )+</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_Bede("mixed", </span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                   discrete = F,</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                   na.value = "white",</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                   trans = "sqrt",</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                   labels = c("5","25", "50", "75", "100"),</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                   breaks = c(0.05,0.25,0.50,0.75,0.9999))+</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(fill = "Proportion \n of pixels (%)")+</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Sediment","Chlorophyceae","Magnoliopsida","Rhodophyceae","Phaeophyceae"),</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0),</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                      position = "top",</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(breaks = seq(1,9, by = 2),</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                      labels = c("Phaeophyceae","Rhodophyceae","Magnoliopsida","Chlorophyceae","Sediment"),</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a><span class="co">#                      expand = c(0, 0.1),</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                      limits = c(0,10))+</span></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_path(</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     data = data.frame(</span></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a><span class="co">#       x = c(0,10,0,10,0,10,0,10,0,10,0,10,0,0,2,2,4,4,6,6,8,8,10,10),</span></span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a><span class="co">#       y = c(0,0,2,2,4,4,6,6,8,8,10,10,0,10,0,10,0,10,0,10,0,10,0,10),</span></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a><span class="co">#       group = c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12)</span></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       ),</span></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     aes(x,y,group= group),</span></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     linewidth = 1</span></span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     )+</span></span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_void()+</span></span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("L'Epine")+</span></span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a><span class="co">#         plot.margin = unit(c(0,30,0,30), "pt"))</span></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a>confmat_rast_Arz_centroid<span class="ot">&lt;-</span>confmat_rast_Arz_centroid <span class="sc">%&gt;%</span> </span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">"Arz"</span>)</span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a>confmat_rast_Boat_centroid<span class="ot">&lt;-</span>confmat_rast_Boat_centroid <span class="sc">%&gt;%</span> </span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">"Boat"</span>)</span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a>confmat_rast_DuerLow_centroid<span class="ot">&lt;-</span>confmat_rast_DuerLow_centroid <span class="sc">%&gt;%</span> </span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">"DuerLow"</span>)</span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a>confmat_rast_GafanhaHigh_centroid<span class="ot">&lt;-</span>confmat_rast_GafanhaHigh_centroid <span class="sc">%&gt;%</span> </span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">"Gaf_High"</span>)</span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a>confmat_rast_GafanhaLow_centroid<span class="ot">&lt;-</span>confmat_rast_GafanhaLow_centroid <span class="sc">%&gt;%</span> </span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">"Gaf_Low"</span>)</span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a>confmat_rast_Handfisher_1_centroid<span class="ot">&lt;-</span>confmat_rast_Handfisher_1_centroid <span class="sc">%&gt;%</span> </span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">"Handfisher"</span>)</span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a>confmat_rast_Horse_rooster_centroid<span class="ot">&lt;-</span>confmat_rast_Horse_rooster_centroid <span class="sc">%&gt;%</span> </span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">"Rooster"</span>)</span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a>confmat_rast_Kerdrean_centroid<span class="ot">&lt;-</span>confmat_rast_Kerdrean_centroid <span class="sc">%&gt;%</span> </span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">"kerdrean"</span>)</span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a>confmat_rast_NorthDike_centroid<span class="ot">&lt;-</span>confmat_rast_NorthDike_centroid <span class="sc">%&gt;%</span> </span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">"Dike"</span>)</span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a>centroid_cells<span class="ot">&lt;-</span><span class="fu">rbind</span>(confmat_rast_Arz_centroid,confmat_rast_Boat_centroid,confmat_rast_DuerLow_centroid,confmat_rast_GafanhaHigh_centroid,confmat_rast_GafanhaLow_centroid,confmat_rast_Handfisher_1_centroid,confmat_rast_Horse_rooster_centroid,confmat_rast_NorthDike_centroid) <span class="sc">%&gt;%</span> </span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(layer <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true" tabindex="-1"></a><span class="do">##### Global #####</span></span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-70"><a href="#cb82-70" aria-hidden="true" tabindex="-1"></a>validation_metrics<span class="ot">&lt;-</span><span class="fu">confusionMatrix</span>(df<span class="sc">$</span>Pred_Class,df<span class="sc">$</span>Truth)</span>
<span id="cb82-71"><a href="#cb82-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-72"><a href="#cb82-72" aria-hidden="true" tabindex="-1"></a>metrics_by_class<span class="ot">&lt;-</span>validation_metrics<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb82-73"><a href="#cb82-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb82-74"><a href="#cb82-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-75"><a href="#cb82-75" aria-hidden="true" tabindex="-1"></a>conf_mat<span class="ot">&lt;-</span>validation_metrics[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb82-76"><a href="#cb82-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-77"><a href="#cb82-77" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-78"><a href="#cb82-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb82-79"><a href="#cb82-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-80"><a href="#cb82-80" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(conf_mat))){</span>
<span id="cb82-81"><a href="#cb82-81" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb82-82"><a href="#cb82-82" aria-hidden="true" tabindex="-1"></a>    df_sum<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">row =</span> <span class="cn">NA</span>,</span>
<span id="cb82-83"><a href="#cb82-83" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb82-84"><a href="#cb82-84" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-85"><a href="#cb82-85" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat[i,])</span>
<span id="cb82-86"><a href="#cb82-86" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat[,i])</span>
<span id="cb82-87"><a href="#cb82-87" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-88"><a href="#cb82-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-89"><a href="#cb82-89" aria-hidden="true" tabindex="-1"></a>conf_mat_std<span class="ot">&lt;-</span>conf_mat</span>
<span id="cb82-90"><a href="#cb82-90" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_mat_std)){</span>
<span id="cb82-91"><a href="#cb82-91" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(conf_mat_std)){</span>
<span id="cb82-92"><a href="#cb82-92" aria-hidden="true" tabindex="-1"></a>    conf_mat_std[row,col]<span class="ot">&lt;-</span>conf_mat_std[row,col]<span class="sc">/</span>((df_sum<span class="sc">$</span>row[row] <span class="sc">+</span> df_sum<span class="sc">$</span>col[col])<span class="sc">-</span>conf_mat_std[row,col])</span>
<span id="cb82-93"><a href="#cb82-93" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-94"><a href="#cb82-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-95"><a href="#cb82-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-96"><a href="#cb82-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-97"><a href="#cb82-97" aria-hidden="true" tabindex="-1"></a>confmat_rast<span class="ot">&lt;-</span>conf_mat_std <span class="sc">%&gt;%</span> </span>
<span id="cb82-98"><a href="#cb82-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb82-99"><a href="#cb82-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb82-100"><a href="#cb82-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb82-101"><a href="#cb82-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-102"><a href="#cb82-102" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(confmat_rast)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb82-103"><a href="#cb82-103" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(confmat_rast)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>)</span>
<span id="cb82-104"><a href="#cb82-104" aria-hidden="true" tabindex="-1"></a><span class="co"># crs(confmat_rast)&lt;-"4326"</span></span>
<span id="cb82-105"><a href="#cb82-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-106"><a href="#cb82-106" aria-hidden="true" tabindex="-1"></a> <span class="fu">values</span>(confmat_rast)[<span class="fu">values</span>(confmat_rast) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb82-107"><a href="#cb82-107" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb82-108"><a href="#cb82-108" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb82-109"><a href="#cb82-109" aria-hidden="true" tabindex="-1"></a>df_summarize<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb82-110"><a href="#cb82-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Flight) <span class="sc">%&gt;%</span> </span>
<span id="cb82-111"><a href="#cb82-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">length</span>(Flight)) <span class="sc">%&gt;%</span> </span>
<span id="cb82-112"><a href="#cb82-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb82-113"><a href="#cb82-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb82-114"><a href="#cb82-114" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="fu">case_when</span>(Flight <span class="sc">==</span> <span class="st">"GafanhaHigh"</span> <span class="sc">~</span> <span class="st">"Gafanha High"</span>,</span>
<span id="cb82-115"><a href="#cb82-115" aria-hidden="true" tabindex="-1"></a>                   Flight <span class="sc">==</span> <span class="st">"GafanhaLow"</span> <span class="sc">~</span> <span class="st">"Gafanha Low"</span>,</span>
<span id="cb82-116"><a href="#cb82-116" aria-hidden="true" tabindex="-1"></a>                   Flight <span class="sc">==</span> <span class="st">"Boat"</span> <span class="sc">~</span> <span class="st">"Marinha Lanzarote"</span>,</span>
<span id="cb82-117"><a href="#cb82-117" aria-hidden="true" tabindex="-1"></a>                   Flight <span class="sc">==</span> <span class="st">"Horse_rooster"</span> <span class="sc">~</span> <span class="st">"Mataducos"</span>,</span>
<span id="cb82-118"><a href="#cb82-118" aria-hidden="true" tabindex="-1"></a>                   Flight <span class="sc">==</span> <span class="st">"NorthDike"</span> <span class="sc">~</span> <span class="st">"L'Epine"</span>,</span>
<span id="cb82-119"><a href="#cb82-119" aria-hidden="true" tabindex="-1"></a>                   Flight <span class="sc">==</span> <span class="st">"Handfisher_1"</span> <span class="sc">~</span> <span class="st">"Barbâtre"</span>,</span>
<span id="cb82-120"><a href="#cb82-120" aria-hidden="true" tabindex="-1"></a>                   Flight <span class="sc">==</span> <span class="st">"Arz"</span> <span class="sc">~</span> <span class="st">"Arz Island"</span>,</span>
<span id="cb82-121"><a href="#cb82-121" aria-hidden="true" tabindex="-1"></a>                   Flight <span class="sc">==</span> <span class="st">"DuerLow"</span> <span class="sc">~</span> <span class="st">"Duer"</span>,</span>
<span id="cb82-122"><a href="#cb82-122" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">TRUE</span> <span class="sc">~</span> Flight)) <span class="sc">%&gt;%</span> </span>
<span id="cb82-123"><a href="#cb82-123" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Flight <span class="sc">!=</span> <span class="st">"Kerdrean"</span>)</span>
<span id="cb82-124"><a href="#cb82-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-125"><a href="#cb82-125" aria-hidden="true" tabindex="-1"></a>df_corrected_accuracy<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb82-126"><a href="#cb82-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>),</span>
<span id="cb82-127"><a href="#cb82-127" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">9</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">1</span>),</span>
<span id="cb82-128"><a href="#cb82-128" aria-hidden="true" tabindex="-1"></a>      <span class="at">lab =</span> <span class="fu">c</span>(metrics_by_class[<span class="dv">1</span>,<span class="dv">11</span>],metrics_by_class[<span class="dv">2</span>,<span class="dv">11</span>], metrics_by_class[<span class="dv">3</span>,<span class="dv">11</span>], metrics_by_class[<span class="dv">4</span>,<span class="dv">11</span>],metrics_by_class[<span class="dv">5</span>,<span class="dv">11</span>],metrics_by_class[<span class="dv">6</span>,<span class="dv">11</span>]))</span>
<span id="cb82-129"><a href="#cb82-129" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb82-130"><a href="#cb82-130" aria-hidden="true" tabindex="-1"></a>df_Sens_Spec<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb82-131"><a href="#cb82-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>, <span class="dv">11</span>, <span class="fl">12.9</span>, <span class="fl">12.9</span>, <span class="fl">12.9</span>, <span class="fl">12.9</span>, <span class="fl">12.9</span>,<span class="fl">12.9</span>),</span>
<span id="cb82-132"><a href="#cb82-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>,<span class="sc">-</span><span class="fl">0.3</span>,<span class="sc">-</span><span class="fl">0.3</span>,<span class="sc">-</span><span class="fl">0.3</span>,<span class="sc">-</span><span class="fl">0.3</span>,<span class="sc">-</span><span class="fl">0.3</span>,<span class="dv">11</span>,<span class="dv">9</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">1</span>),</span>
<span id="cb82-133"><a href="#cb82-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="fu">c</span>(metrics_by_class<span class="sc">$</span>Recall[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)],metrics_by_class<span class="sc">$</span>Precision[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)])</span>
<span id="cb82-134"><a href="#cb82-134" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-135"><a href="#cb82-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-136"><a href="#cb82-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-137"><a href="#cb82-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-138"><a href="#cb82-138" aria-hidden="true" tabindex="-1"></a>df_Label_Sites<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb82-139"><a href="#cb82-139" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">20</span>,<span class="dv">24</span>,<span class="dv">16</span>,<span class="dv">20</span>,<span class="dv">24</span>,<span class="dv">16</span>,<span class="dv">20</span>),</span>
<span id="cb82-140"><a href="#cb82-140" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">12</span>,<span class="dv">12</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">4</span>),</span>
<span id="cb82-141"><a href="#cb82-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"Gafanha High, "</span>, df_summarize <span class="sc">%&gt;%</span> </span>
<span id="cb82-142"><a href="#cb82-142" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"GafanhaHigh"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-143"><a href="#cb82-143" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">pull</span>(prop) <span class="sc">%&gt;%</span> </span>
<span id="cb82-144"><a href="#cb82-144" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">round</span>(<span class="dv">2</span>)),</span>
<span id="cb82-145"><a href="#cb82-145" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"Gafanha Low, "</span>,df_summarize <span class="sc">%&gt;%</span> </span>
<span id="cb82-146"><a href="#cb82-146" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"GafanhaLow"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-147"><a href="#cb82-147" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">pull</span>(prop) <span class="sc">%&gt;%</span> </span>
<span id="cb82-148"><a href="#cb82-148" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">round</span>(<span class="dv">2</span>)),</span>
<span id="cb82-149"><a href="#cb82-149" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"Inner Lagoon, "</span>, df_summarize <span class="sc">%&gt;%</span> </span>
<span id="cb82-150"><a href="#cb82-150" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"Boat"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-151"><a href="#cb82-151" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">pull</span>(prop) <span class="sc">%&gt;%</span> </span>
<span id="cb82-152"><a href="#cb82-152" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">round</span>(<span class="dv">2</span>)),</span>
<span id="cb82-153"><a href="#cb82-153" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"Mataducos, "</span>, df_summarize <span class="sc">%&gt;%</span> </span>
<span id="cb82-154"><a href="#cb82-154" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"Horse_rooster"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-155"><a href="#cb82-155" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">pull</span>(prop) <span class="sc">%&gt;%</span> </span>
<span id="cb82-156"><a href="#cb82-156" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">round</span>(<span class="dv">2</span>)),</span>
<span id="cb82-157"><a href="#cb82-157" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"L'Epine, "</span>, df_summarize <span class="sc">%&gt;%</span> </span>
<span id="cb82-158"><a href="#cb82-158" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"NorthDike"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-159"><a href="#cb82-159" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">pull</span>(prop) <span class="sc">%&gt;%</span> </span>
<span id="cb82-160"><a href="#cb82-160" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">round</span>(<span class="dv">2</span>)),</span>
<span id="cb82-161"><a href="#cb82-161" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"Barbâtre, "</span>, df_summarize <span class="sc">%&gt;%</span> </span>
<span id="cb82-162"><a href="#cb82-162" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"Handfisher_1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-163"><a href="#cb82-163" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">pull</span>(prop) <span class="sc">%&gt;%</span> </span>
<span id="cb82-164"><a href="#cb82-164" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">round</span>(<span class="dv">2</span>)),</span>
<span id="cb82-165"><a href="#cb82-165" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"Arz Island, "</span>, df_summarize <span class="sc">%&gt;%</span> </span>
<span id="cb82-166"><a href="#cb82-166" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"Arz"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-167"><a href="#cb82-167" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">pull</span>(prop) <span class="sc">%&gt;%</span> </span>
<span id="cb82-168"><a href="#cb82-168" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">round</span>(<span class="dv">2</span>)),</span>
<span id="cb82-169"><a href="#cb82-169" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"Duer, "</span>, df_summarize <span class="sc">%&gt;%</span> </span>
<span id="cb82-170"><a href="#cb82-170" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">filter</span>(Flight <span class="sc">==</span> <span class="st">"DuerLow"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-171"><a href="#cb82-171" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">pull</span>(prop) <span class="sc">%&gt;%</span> </span>
<span id="cb82-172"><a href="#cb82-172" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">round</span>(<span class="dv">2</span>)))</span>
<span id="cb82-173"><a href="#cb82-173" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-174"><a href="#cb82-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-175"><a href="#cb82-175" aria-hidden="true" tabindex="-1"></a>x_axis_text<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb82-176"><a href="#cb82-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>),</span>
<span id="cb82-177"><a href="#cb82-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">12.5</span>,<span class="fl">12.5</span>,<span class="fl">12.5</span>,<span class="fl">12.5</span>,<span class="fl">12.5</span>,<span class="fl">12.5</span>),</span>
<span id="cb82-178"><a href="#cb82-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>,<span class="st">"Bacillariophyceae"</span>,<span class="st">"Chlorophyceae"</span>,<span class="st">"Magnoliopsida"</span>,<span class="st">"Rhodophyceae"</span>,<span class="st">"Phaeophyceae"</span>)</span>
<span id="cb82-179"><a href="#cb82-179" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-180"><a href="#cb82-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-181"><a href="#cb82-181" aria-hidden="true" tabindex="-1"></a>y_axis_text<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb82-182"><a href="#cb82-182" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>,<span class="sc">-</span><span class="fl">0.4</span>,<span class="sc">-</span><span class="fl">0.4</span>,<span class="sc">-</span><span class="fl">0.4</span>,<span class="sc">-</span><span class="fl">0.4</span>,<span class="sc">-</span><span class="fl">0.4</span>),</span>
<span id="cb82-183"><a href="#cb82-183" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">9</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">1</span>),</span>
<span id="cb82-184"><a href="#cb82-184" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>,<span class="st">"Bacillariophyceae"</span>,<span class="st">"Chlorophyceae"</span>,<span class="st">"Magnoliopsida"</span>,<span class="st">"Rhodophyceae"</span>,<span class="st">"Phaeophyceae"</span>)</span>
<span id="cb82-185"><a href="#cb82-185" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-186"><a href="#cb82-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-187"><a href="#cb82-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-188"><a href="#cb82-188" aria-hidden="true" tabindex="-1"></a>centroid_cells_df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">st_coordinates</span>(<span class="fu">st_cast</span>(centroid_cells<span class="sc">$</span>geometry,<span class="st">"MULTIPOINT"</span>)),centroid_cells<span class="sc">$</span>site)</span>
<span id="cb82-189"><a href="#cb82-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-190"><a href="#cb82-190" aria-hidden="true" tabindex="-1"></a>centroid_cells_df<span class="sc">$</span>col <span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb82-191"><a href="#cb82-191" aria-hidden="true" tabindex="-1"></a>centroid_cells_df<span class="sc">$</span>row <span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb82-192"><a href="#cb82-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-193"><a href="#cb82-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-194"><a href="#cb82-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-195"><a href="#cb82-195" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(centroid_cells_df<span class="sc">$</span>centroid_cells.site))){</span>
<span id="cb82-196"><a href="#cb82-196" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-197"><a href="#cb82-197" aria-hidden="true" tabindex="-1"></a>  df_temp<span class="ot">&lt;-</span>centroid_cells_df <span class="sc">%&gt;%</span> </span>
<span id="cb82-198"><a href="#cb82-198" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(centroid_cells_df<span class="sc">$</span>centroid_cells.site <span class="sc">==</span> <span class="fu">unique</span>(centroid_cells_df<span class="sc">$</span>centroid_cells.site)[i])</span>
<span id="cb82-199"><a href="#cb82-199" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-200"><a href="#cb82-200" aria-hidden="true" tabindex="-1"></a>  <span class="do">#### Column </span></span>
<span id="cb82-201"><a href="#cb82-201" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-202"><a href="#cb82-202" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.character</span>(df_temp<span class="sc">$</span>X)))){</span>
<span id="cb82-203"><a href="#cb82-203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb82-204"><a href="#cb82-204" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(X <span class="sc">==</span> <span class="fu">unique</span>(<span class="fu">as.character</span>(df_temp<span class="sc">$</span>X))[ii])) <span class="sc">==</span> <span class="dv">6</span>){</span>
<span id="cb82-205"><a href="#cb82-205" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb82-206"><a href="#cb82-206" aria-hidden="true" tabindex="-1"></a>      centroid_cells_df<span class="ot">&lt;-</span>centroid_cells_df <span class="sc">%&gt;%</span> </span>
<span id="cb82-207"><a href="#cb82-207" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">col =</span> <span class="fu">case_when</span>(centroid_cells.site <span class="sc">==</span> <span class="fu">unique</span>(centroid_cells_df<span class="sc">$</span>centroid_cells.site)[i] <span class="sc">~</span></span>
<span id="cb82-208"><a href="#cb82-208" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">case_when</span>(<span class="fu">as.character</span>(X) <span class="sc">==</span> <span class="fu">unique</span>(<span class="fu">as.character</span>(df_temp<span class="sc">$</span>X))[ii] <span class="sc">~</span> </span>
<span id="cb82-209"><a href="#cb82-209" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">paste0</span>(<span class="st">"col"</span>,ii),</span>
<span id="cb82-210"><a href="#cb82-210" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> col),</span>
<span id="cb82-211"><a href="#cb82-211" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> col))</span>
<span id="cb82-212"><a href="#cb82-212" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-213"><a href="#cb82-213" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-214"><a href="#cb82-214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-215"><a href="#cb82-215" aria-hidden="true" tabindex="-1"></a>  <span class="do">#### ROW</span></span>
<span id="cb82-216"><a href="#cb82-216" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( iii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">as.character</span>(df_temp<span class="sc">$</span>Y)))){</span>
<span id="cb82-217"><a href="#cb82-217" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb82-218"><a href="#cb82-218" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(Y <span class="sc">==</span> <span class="fu">unique</span>(<span class="fu">as.character</span>(df_temp<span class="sc">$</span>Y))[iii])) <span class="sc">==</span> <span class="dv">6</span>){</span>
<span id="cb82-219"><a href="#cb82-219" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb82-220"><a href="#cb82-220" aria-hidden="true" tabindex="-1"></a>      centroid_cells_df<span class="ot">&lt;-</span>centroid_cells_df <span class="sc">%&gt;%</span> </span>
<span id="cb82-221"><a href="#cb82-221" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">case_when</span>(centroid_cells.site <span class="sc">==</span> <span class="fu">unique</span>(centroid_cells_df<span class="sc">$</span>centroid_cells.site)[i] <span class="sc">~</span></span>
<span id="cb82-222"><a href="#cb82-222" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">case_when</span>(<span class="fu">as.character</span>(Y) <span class="sc">==</span> <span class="fu">unique</span>(<span class="fu">as.character</span>(df_temp<span class="sc">$</span>Y))[iii] <span class="sc">~</span> </span>
<span id="cb82-223"><a href="#cb82-223" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">paste0</span>(<span class="st">"row"</span>,iii),</span>
<span id="cb82-224"><a href="#cb82-224" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> row),</span>
<span id="cb82-225"><a href="#cb82-225" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> row))</span>
<span id="cb82-226"><a href="#cb82-226" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-227"><a href="#cb82-227" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-228"><a href="#cb82-228" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-229"><a href="#cb82-229" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-230"><a href="#cb82-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-231"><a href="#cb82-231" aria-hidden="true" tabindex="-1"></a><span class="co"># other_table_path&lt;-data.frame(</span></span>
<span id="cb82-232"><a href="#cb82-232" aria-hidden="true" tabindex="-1"></a><span class="co">#   x = c(1,25,1,25,1,25,1,25,</span></span>
<span id="cb82-233"><a href="#cb82-233" aria-hidden="true" tabindex="-1"></a><span class="co">#         1,1,5,5,9,9,13,13,17,17,21,21,25,25</span></span>
<span id="cb82-234"><a href="#cb82-234" aria-hidden="true" tabindex="-1"></a><span class="co">#         ),</span></span>
<span id="cb82-235"><a href="#cb82-235" aria-hidden="true" tabindex="-1"></a><span class="co">#   y= c(-2,-2,-3,-3,-4,-4,-5,-5,</span></span>
<span id="cb82-236"><a href="#cb82-236" aria-hidden="true" tabindex="-1"></a><span class="co">#        -2,-5,-2,-5,-2,-5,-2,-5,-2,-5,-2,-5,-2,-5</span></span>
<span id="cb82-237"><a href="#cb82-237" aria-hidden="true" tabindex="-1"></a><span class="co">#        ),</span></span>
<span id="cb82-238"><a href="#cb82-238" aria-hidden="true" tabindex="-1"></a><span class="co">#   group=c(1,1,9,9,10,10,11,11,</span></span>
<span id="cb82-239"><a href="#cb82-239" aria-hidden="true" tabindex="-1"></a><span class="co">#           2,2,3,3,4,4,5,5,6,6,7,7,8,8</span></span>
<span id="cb82-240"><a href="#cb82-240" aria-hidden="true" tabindex="-1"></a><span class="co">#           )</span></span>
<span id="cb82-241"><a href="#cb82-241" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb82-242"><a href="#cb82-242" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb82-243"><a href="#cb82-243" aria-hidden="true" tabindex="-1"></a><span class="co"># other_table_title &lt;- data.frame(</span></span>
<span id="cb82-244"><a href="#cb82-244" aria-hidden="true" tabindex="-1"></a><span class="co">#   x = c(-1,3,7,11,15,19,23),</span></span>
<span id="cb82-245"><a href="#cb82-245" aria-hidden="true" tabindex="-1"></a><span class="co">#   y = c(-1.5,-1.5,-1.5,-1.5,-1.5,-1.5,-1.5),</span></span>
<span id="cb82-246"><a href="#cb82-246" aria-hidden="true" tabindex="-1"></a><span class="co">#   label = c("Metrics","Sediment","Bacillariophyceae","Chlorophyceae","Magnoliopsida","Rhodophyceae","Phaeophyceae"),</span></span>
<span id="cb82-247"><a href="#cb82-247" aria-hidden="true" tabindex="-1"></a><span class="co">#   group = c(1,2,3,4,5,6,7)</span></span>
<span id="cb82-248"><a href="#cb82-248" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb82-249"><a href="#cb82-249" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb82-250"><a href="#cb82-250" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy_by_class&lt;-validation_metrics$byClass %&gt;% </span></span>
<span id="cb82-251"><a href="#cb82-251" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.data.frame()</span></span>
<span id="cb82-252"><a href="#cb82-252" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb82-253"><a href="#cb82-253" aria-hidden="true" tabindex="-1"></a><span class="co"># other_table_values &lt;- data.frame(</span></span>
<span id="cb82-254"><a href="#cb82-254" aria-hidden="true" tabindex="-1"></a><span class="co">#   x = c(3,7,11,15,19,23,</span></span>
<span id="cb82-255"><a href="#cb82-255" aria-hidden="true" tabindex="-1"></a><span class="co">#         3,7,11,15,19,23,</span></span>
<span id="cb82-256"><a href="#cb82-256" aria-hidden="true" tabindex="-1"></a><span class="co">#         3,7,11,15,19,23),</span></span>
<span id="cb82-257"><a href="#cb82-257" aria-hidden="true" tabindex="-1"></a><span class="co">#   y = c(-2.5,-2.5,-2.5,-2.5,-2.5,-2.5,</span></span>
<span id="cb82-258"><a href="#cb82-258" aria-hidden="true" tabindex="-1"></a><span class="co">#         -3.5,-3.5,-3.5,-3.5,-3.5,-3.5,</span></span>
<span id="cb82-259"><a href="#cb82-259" aria-hidden="true" tabindex="-1"></a><span class="co">#         -4.5,-4.5,-4.5,-4.5,-4.5,-4.5),</span></span>
<span id="cb82-260"><a href="#cb82-260" aria-hidden="true" tabindex="-1"></a><span class="co">#   label = round(c(accuracy_by_class$Sensitivity[c(1:6)],</span></span>
<span id="cb82-261"><a href="#cb82-261" aria-hidden="true" tabindex="-1"></a><span class="co">#             accuracy_by_class$Specificity[c(1:6)],</span></span>
<span id="cb82-262"><a href="#cb82-262" aria-hidden="true" tabindex="-1"></a><span class="co">#             accuracy_by_class$`Balanced Accuracy`[c(1:6)]),2)</span></span>
<span id="cb82-263"><a href="#cb82-263" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb82-264"><a href="#cb82-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-265"><a href="#cb82-265" aria-hidden="true" tabindex="-1"></a>other_table_path<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb82-266"><a href="#cb82-266" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">26</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">26</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">26</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">26</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">26</span>,</span>
<span id="cb82-267"><a href="#cb82-267" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="dv">3</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">3.857</span>,<span class="fl">3.857</span>,<span class="fl">7.714</span>,<span class="fl">7.714</span>,<span class="fl">11.571</span>,<span class="fl">11.571</span>,<span class="fl">15.429</span>,<span class="fl">15.429</span>,<span class="fl">19.286</span>,<span class="fl">19.286</span>,<span class="fl">23.142</span>,<span class="fl">23.142</span>,<span class="dv">26</span>,<span class="dv">26</span></span>
<span id="cb82-268"><a href="#cb82-268" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb82-269"><a href="#cb82-269" aria-hidden="true" tabindex="-1"></a>  <span class="at">y=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb82-270"><a href="#cb82-270" aria-hidden="true" tabindex="-1"></a>       <span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">5</span></span>
<span id="cb82-271"><a href="#cb82-271" aria-hidden="true" tabindex="-1"></a>       ),</span>
<span id="cb82-272"><a href="#cb82-272" aria-hidden="true" tabindex="-1"></a>  <span class="at">group=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">14</span>,</span>
<span id="cb82-273"><a href="#cb82-273" aria-hidden="true" tabindex="-1"></a>          <span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span></span>
<span id="cb82-274"><a href="#cb82-274" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb82-275"><a href="#cb82-275" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-276"><a href="#cb82-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-277"><a href="#cb82-277" aria-hidden="true" tabindex="-1"></a>other_table_title <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb82-278"><a href="#cb82-278" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.529</span>,<span class="fl">1.929</span>,<span class="fl">5.786</span>,<span class="fl">9.643</span>,<span class="fl">13.5</span>,<span class="fl">17.359</span>,<span class="fl">21.215</span>,<span class="fl">24.571</span>),</span>
<span id="cb82-279"><a href="#cb82-279" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="sc">-</span><span class="fl">1.5</span>,<span class="sc">-</span><span class="fl">1.5</span>,<span class="sc">-</span><span class="fl">1.5</span>,<span class="sc">-</span><span class="fl">1.5</span>,<span class="sc">-</span><span class="fl">1.5</span>,<span class="sc">-</span><span class="fl">1.5</span>,<span class="sc">-</span><span class="fl">1.5</span>),</span>
<span id="cb82-280"><a href="#cb82-280" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Metrics"</span>,<span class="st">"Sediment"</span>,<span class="st">"Bacillariophyceae"</span>,<span class="st">"Chlorophyceae"</span>,<span class="st">"Magnoliopsida"</span>,<span class="st">"Rhodophyceae"</span>,<span class="st">"Phaeophyceae"</span>, <span class="st">"Overall"</span>)</span>
<span id="cb82-281"><a href="#cb82-281" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-282"><a href="#cb82-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-283"><a href="#cb82-283" aria-hidden="true" tabindex="-1"></a>other_table_y_axis<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb82-284"><a href="#cb82-284" aria-hidden="true" tabindex="-1"></a>  <span class="at">x=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>,<span class="sc">-</span><span class="fl">0.4</span>,<span class="sc">-</span><span class="fl">0.4</span>),</span>
<span id="cb82-285"><a href="#cb82-285" aria-hidden="true" tabindex="-1"></a>  <span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>,<span class="sc">-</span><span class="fl">3.5</span>,<span class="sc">-</span><span class="fl">4.5</span>),</span>
<span id="cb82-286"><a href="#cb82-286" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Sensitivity"</span>,<span class="st">"Specificity"</span>, <span class="st">"Accuracy"</span>)</span>
<span id="cb82-287"><a href="#cb82-287" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-288"><a href="#cb82-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-289"><a href="#cb82-289" aria-hidden="true" tabindex="-1"></a>accuracy_by_class<span class="ot">&lt;-</span>validation_metrics<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb82-290"><a href="#cb82-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb82-291"><a href="#cb82-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-292"><a href="#cb82-292" aria-hidden="true" tabindex="-1"></a>other_table_values <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb82-293"><a href="#cb82-293" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.929</span>,<span class="fl">5.786</span>,<span class="fl">9.643</span>,<span class="fl">13.5</span>,<span class="fl">17.359</span>,<span class="fl">21.215</span>,<span class="fl">24.571</span>,</span>
<span id="cb82-294"><a href="#cb82-294" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.929</span>,<span class="fl">5.786</span>,<span class="fl">9.643</span>,<span class="fl">13.5</span>,<span class="fl">17.359</span>,<span class="fl">21.215</span>,<span class="fl">24.571</span>,</span>
<span id="cb82-295"><a href="#cb82-295" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.929</span>,<span class="fl">5.786</span>,<span class="fl">9.643</span>,<span class="fl">13.5</span>,<span class="fl">17.359</span>,<span class="fl">21.215</span>),</span>
<span id="cb82-296"><a href="#cb82-296" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>,<span class="sc">-</span><span class="fl">2.5</span>,<span class="sc">-</span><span class="fl">2.5</span>,<span class="sc">-</span><span class="fl">2.5</span>,<span class="sc">-</span><span class="fl">2.5</span>,<span class="sc">-</span><span class="fl">2.5</span>,<span class="sc">-</span><span class="fl">2.5</span>,</span>
<span id="cb82-297"><a href="#cb82-297" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">3.5</span>,<span class="sc">-</span><span class="fl">3.5</span>,<span class="sc">-</span><span class="fl">3.5</span>,<span class="sc">-</span><span class="fl">3.5</span>,<span class="sc">-</span><span class="fl">3.5</span>,<span class="sc">-</span><span class="fl">3.5</span>,<span class="sc">-</span><span class="fl">3.5</span>,</span>
<span id="cb82-298"><a href="#cb82-298" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">4.5</span>,<span class="sc">-</span><span class="fl">4.5</span>,<span class="sc">-</span><span class="fl">4.5</span>,<span class="sc">-</span><span class="fl">4.5</span>,<span class="sc">-</span><span class="fl">4.5</span>,<span class="sc">-</span><span class="fl">4.5</span>),</span>
<span id="cb82-299"><a href="#cb82-299" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">round</span>(<span class="fu">c</span>(accuracy_by_class<span class="sc">$</span>Sensitivity[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)],<span class="fu">mean</span>(accuracy_by_class<span class="sc">$</span>Sensitivity),</span>
<span id="cb82-300"><a href="#cb82-300" aria-hidden="true" tabindex="-1"></a>            accuracy_by_class<span class="sc">$</span>Specificity[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)],<span class="fu">mean</span>(accuracy_by_class<span class="sc">$</span>Specificity),</span>
<span id="cb82-301"><a href="#cb82-301" aria-hidden="true" tabindex="-1"></a>            accuracy_by_class<span class="sc">$</span><span class="st">`</span><span class="at">Balanced Accuracy</span><span class="st">`</span>[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)]),<span class="dv">2</span>)</span>
<span id="cb82-302"><a href="#cb82-302" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-303"><a href="#cb82-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-304"><a href="#cb82-304" aria-hidden="true" tabindex="-1"></a>global_accuracy_coord<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fl">24.571</span>,</span>
<span id="cb82-305"><a href="#cb82-305" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">y =</span> <span class="sc">-</span><span class="fl">4.5</span>,</span>
<span id="cb82-306"><a href="#cb82-306" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">label =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(validation_metrics<span class="sc">$</span>overall[<span class="dv">1</span>]),<span class="dv">2</span>))  </span>
<span id="cb82-307"><a href="#cb82-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-308"><a href="#cb82-308" aria-hidden="true" tabindex="-1"></a>centroid_cells_df_rows<span class="ot">&lt;-</span>centroid_cells_df <span class="sc">%&gt;%</span> </span>
<span id="cb82-309"><a href="#cb82-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(row)) <span class="sc">%&gt;%</span> </span>
<span id="cb82-310"><a href="#cb82-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Row =</span> <span class="fu">paste0</span>(centroid_cells.site,<span class="st">"_"</span>,row))</span>
<span id="cb82-311"><a href="#cb82-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-312"><a href="#cb82-312" aria-hidden="true" tabindex="-1"></a>centroid_cells_df_cols<span class="ot">&lt;-</span>centroid_cells_df <span class="sc">%&gt;%</span> </span>
<span id="cb82-313"><a href="#cb82-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(col)) <span class="sc">%&gt;%</span> </span>
<span id="cb82-314"><a href="#cb82-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cols =</span> <span class="fu">paste0</span>(centroid_cells.site,<span class="st">"_"</span>,col))</span>
<span id="cb82-315"><a href="#cb82-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-316"><a href="#cb82-316" aria-hidden="true" tabindex="-1"></a>plot_matrix_global <span class="ot">&lt;-</span></span>
<span id="cb82-317"><a href="#cb82-317" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb82-318"><a href="#cb82-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> (confmat_rast),</span>
<span id="cb82-319"><a href="#cb82-319" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># show.legend = F,</span></span>
<span id="cb82-320"><a href="#cb82-320" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb82-321"><a href="#cb82-321" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">+</span></span>
<span id="cb82-322"><a href="#cb82-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> confmat_rast_GafanhaLow,</span>
<span id="cb82-323"><a href="#cb82-323" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb82-324"><a href="#cb82-324" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">+</span></span>
<span id="cb82-325"><a href="#cb82-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> confmat_rast_GafanhaLow_sf,</span>
<span id="cb82-326"><a href="#cb82-326" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb82-327"><a href="#cb82-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> confmat_rast_GafanhaHigh,</span>
<span id="cb82-328"><a href="#cb82-328" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb82-329"><a href="#cb82-329" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">+</span></span>
<span id="cb82-330"><a href="#cb82-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> confmat_rast_GafanhaHigh_sf,</span>
<span id="cb82-331"><a href="#cb82-331" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb82-332"><a href="#cb82-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> confmat_rast_Boat,</span>
<span id="cb82-333"><a href="#cb82-333" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb82-334"><a href="#cb82-334" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">+</span></span>
<span id="cb82-335"><a href="#cb82-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> confmat_rast_Boat_sf,</span>
<span id="cb82-336"><a href="#cb82-336" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb82-337"><a href="#cb82-337" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_spatraster</span>(<span class="at">data =</span> confmat_rast_Horse_rooster,</span>
<span id="cb82-338"><a href="#cb82-338" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb82-339"><a href="#cb82-339" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">+</span></span>
<span id="cb82-340"><a href="#cb82-340" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> confmat_rast_Horse_rooster_sf,</span>
<span id="cb82-341"><a href="#cb82-341" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb82-342"><a href="#cb82-342" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_spatraster</span>(<span class="at">data =</span> confmat_rast_NorthDike,</span>
<span id="cb82-343"><a href="#cb82-343" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb82-344"><a href="#cb82-344" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">+</span></span>
<span id="cb82-345"><a href="#cb82-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> confmat_rast_NorthDike_sf,</span>
<span id="cb82-346"><a href="#cb82-346" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb82-347"><a href="#cb82-347" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_spatraster</span>(<span class="at">data =</span> confmat_rast_Handfisher_1,</span>
<span id="cb82-348"><a href="#cb82-348" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb82-349"><a href="#cb82-349" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">+</span></span>
<span id="cb82-350"><a href="#cb82-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> confmat_rast_Handfisher_1_sf,</span>
<span id="cb82-351"><a href="#cb82-351" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb82-352"><a href="#cb82-352" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_spatraster</span>(<span class="at">data =</span> confmat_rast_Arz,</span>
<span id="cb82-353"><a href="#cb82-353" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb82-354"><a href="#cb82-354" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">+</span></span>
<span id="cb82-355"><a href="#cb82-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> confmat_rast_Arz_sf,</span>
<span id="cb82-356"><a href="#cb82-356" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb82-357"><a href="#cb82-357" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_spatraster</span>(<span class="at">data =</span> confmat_rast_DuerLow,</span>
<span id="cb82-358"><a href="#cb82-358" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb82-359"><a href="#cb82-359" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">+</span></span>
<span id="cb82-360"><a href="#cb82-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> confmat_rast_DuerLow_sf,</span>
<span id="cb82-361"><a href="#cb82-361" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb82-362"><a href="#cb82-362" aria-hidden="true" tabindex="-1"></a>    <span class="co"># geom_spatraster(data = confmat_rast_Kerdrean,</span></span>
<span id="cb82-363"><a href="#cb82-363" aria-hidden="true" tabindex="-1"></a>    <span class="co">#               na.rm = TRUE</span></span>
<span id="cb82-364"><a href="#cb82-364" aria-hidden="true" tabindex="-1"></a>    <span class="co">#               )+</span></span>
<span id="cb82-365"><a href="#cb82-365" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_sf(data = confmat_rast_Kerdrean_sf,</span></span>
<span id="cb82-366"><a href="#cb82-366" aria-hidden="true" tabindex="-1"></a>  <span class="co">#         fill = "transparent")+</span></span>
<span id="cb82-367"><a href="#cb82-367" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_sf(data = centroid_cells,</span></span>
<span id="cb82-368"><a href="#cb82-368" aria-hidden="true" tabindex="-1"></a>  <span class="co">#         fill = "transparent")+</span></span>
<span id="cb82-369"><a href="#cb82-369" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-370"><a href="#cb82-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> centroid_cells_df_rows, </span>
<span id="cb82-371"><a href="#cb82-371" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">group =</span> Row),</span>
<span id="cb82-372"><a href="#cb82-372" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">2</span>,</span>
<span id="cb82-373"><a href="#cb82-373" aria-hidden="true" tabindex="-1"></a>            <span class="at">linejoin =</span> <span class="st">"round"</span>,</span>
<span id="cb82-374"><a href="#cb82-374" aria-hidden="true" tabindex="-1"></a>            <span class="at">lineend =</span> <span class="st">"round"</span>,</span>
<span id="cb82-375"><a href="#cb82-375" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> <span class="st">"grey"</span>)<span class="sc">+</span></span>
<span id="cb82-376"><a href="#cb82-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> centroid_cells_df_cols, </span>
<span id="cb82-377"><a href="#cb82-377" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">group =</span> cols),</span>
<span id="cb82-378"><a href="#cb82-378" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">2</span>,</span>
<span id="cb82-379"><a href="#cb82-379" aria-hidden="true" tabindex="-1"></a>            <span class="at">linejoin =</span> <span class="st">"round"</span>,</span>
<span id="cb82-380"><a href="#cb82-380" aria-hidden="true" tabindex="-1"></a>            <span class="at">lineend =</span> <span class="st">"round"</span>,</span>
<span id="cb82-381"><a href="#cb82-381" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> <span class="st">"grey"</span>)<span class="sc">+</span></span>
<span id="cb82-382"><a href="#cb82-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb82-383"><a href="#cb82-383" aria-hidden="true" tabindex="-1"></a>    <span class="co"># colours = c("black","firebrick4","goldenrod","yellow","chartreuse3"),</span></span>
<span id="cb82-384"><a href="#cb82-384" aria-hidden="true" tabindex="-1"></a>    <span class="co"># colours = c("khaki1","goldenrod","firebrick3","chartreuse4"),</span></span>
<span id="cb82-385"><a href="#cb82-385" aria-hidden="true" tabindex="-1"></a>    <span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"khaki1"</span>,<span class="st">"firebrick4"</span>,<span class="st">"firebrick4"</span>,<span class="st">"firebrick4"</span>,<span class="st">"#3e0b0b"</span>),</span>
<span id="cb82-386"><a href="#cb82-386" aria-hidden="true" tabindex="-1"></a>    <span class="co"># colours = c("#7d0000","#00b300","#00b300","#00b300","#007d00"),</span></span>
<span id="cb82-387"><a href="#cb82-387" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"white"</span>, </span>
<span id="cb82-388"><a href="#cb82-388" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> <span class="st">"sqrt"</span>,</span>
<span id="cb82-389"><a href="#cb82-389" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0.05"</span>,<span class="st">"0.25"</span>, <span class="st">"0.50"</span>, <span class="st">"0.75"</span>, <span class="st">"1"</span>),</span>
<span id="cb82-390"><a href="#cb82-390" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="fl">0.75</span>,<span class="fl">0.9999</span>))<span class="sc">+</span></span>
<span id="cb82-391"><a href="#cb82-391" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_Bede("mixed", </span></span>
<span id="cb82-392"><a href="#cb82-392" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 discrete = F,</span></span>
<span id="cb82-393"><a href="#cb82-393" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 reverse = TRUE,</span></span>
<span id="cb82-394"><a href="#cb82-394" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 na.value = "white",</span></span>
<span id="cb82-395"><a href="#cb82-395" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 trans = "sqrt",</span></span>
<span id="cb82-396"><a href="#cb82-396" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 labels = c("5","25", "50", "75", "100"),</span></span>
<span id="cb82-397"><a href="#cb82-397" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 breaks = c(0.05,0.25,0.50,0.75,0.9999))+</span></span>
<span id="cb82-398"><a href="#cb82-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Proportion </span><span class="sc">\n</span><span class="st"> of pixels"</span>)<span class="sc">+</span></span>
<span id="cb82-399"><a href="#cb82-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">11</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb82-400"><a href="#cb82-400" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>,<span class="st">"Bacillariophyceae"</span>,<span class="st">"Chlorophyceae"</span>,<span class="st">"Magnoliopsida"</span>,<span class="st">"Rhodophyceae"</span>,<span class="st">"Phaeophyceae"</span>),</span>
<span id="cb82-401"><a href="#cb82-401" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb82-402"><a href="#cb82-402" aria-hidden="true" tabindex="-1"></a>                     <span class="at">position =</span> <span class="st">"top"</span>,</span>
<span id="cb82-403"><a href="#cb82-403" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">29</span>))<span class="sc">+</span></span>
<span id="cb82-404"><a href="#cb82-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">11</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb82-405"><a href="#cb82-405" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Phaeophyceae"</span>,<span class="st">"Rhodophyceae"</span>,<span class="st">"Magnoliopsida"</span>,<span class="st">"Chlorophyceae"</span>,<span class="st">"Bacillariophyceae"</span>,<span class="st">"Sediment"</span>),</span>
<span id="cb82-406"><a href="#cb82-406" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>),</span>
<span id="cb82-407"><a href="#cb82-407" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="fl">17.5</span>))<span class="sc">+</span></span>
<span id="cb82-408"><a href="#cb82-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">26</span>,<span class="dv">26</span>,<span class="sc">-</span><span class="dv">3</span>),</span>
<span id="cb82-409"><a href="#cb82-409" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">5</span>)),</span>
<span id="cb82-410"><a href="#cb82-410" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb82-411"><a href="#cb82-411" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb82-412"><a href="#cb82-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">23.142</span>,<span class="dv">26</span>,<span class="dv">26</span>,<span class="fl">23.142</span>),</span>
<span id="cb82-413"><a href="#cb82-413" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">4</span>)),</span>
<span id="cb82-414"><a href="#cb82-414" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"lightgrey"</span>,</span>
<span id="cb82-415"><a href="#cb82-415" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb82-416"><a href="#cb82-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(</span>
<span id="cb82-417"><a href="#cb82-417" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data.frame</span>(</span>
<span id="cb82-418"><a href="#cb82-418" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">12</span>,<span class="dv">12</span>),</span>
<span id="cb82-419"><a href="#cb82-419" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">12</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">12</span>),</span>
<span id="cb82-420"><a href="#cb82-420" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">14</span>)</span>
<span id="cb82-421"><a href="#cb82-421" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb82-422"><a href="#cb82-422" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(x,y,<span class="at">group=</span> group),</span>
<span id="cb82-423"><a href="#cb82-423" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb82-424"><a href="#cb82-424" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb82-425"><a href="#cb82-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> other_table_path,</span>
<span id="cb82-426"><a href="#cb82-426" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb82-427"><a href="#cb82-427" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> y,</span>
<span id="cb82-428"><a href="#cb82-428" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> group),</span>
<span id="cb82-429"><a href="#cb82-429" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb82-430"><a href="#cb82-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb82-431"><a href="#cb82-431" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_corrected_accuracy,</span>
<span id="cb82-432"><a href="#cb82-432" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(lab,<span class="dv">3</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="st">"%"</span>)),</span>
<span id="cb82-433"><a href="#cb82-433" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#ffffff99"</span>,</span>
<span id="cb82-434"><a href="#cb82-434" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">9</span></span>
<span id="cb82-435"><a href="#cb82-435" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb82-436"><a href="#cb82-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb82-437"><a href="#cb82-437" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_Sens_Spec,</span>
<span id="cb82-438"><a href="#cb82-438" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(lab,<span class="dv">4</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="st">"%"</span>)),</span>
<span id="cb82-439"><a href="#cb82-439" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill = "#ffffff99",</span></span>
<span id="cb82-440"><a href="#cb82-440" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">8</span></span>
<span id="cb82-441"><a href="#cb82-441" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb82-442"><a href="#cb82-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb82-443"><a href="#cb82-443" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> other_table_title,</span>
<span id="cb82-444"><a href="#cb82-444" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label),</span>
<span id="cb82-445"><a href="#cb82-445" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill = "#ffffff99",</span></span>
<span id="cb82-446"><a href="#cb82-446" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">8</span></span>
<span id="cb82-447"><a href="#cb82-447" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb82-448"><a href="#cb82-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb82-449"><a href="#cb82-449" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> other_table_y_axis,</span>
<span id="cb82-450"><a href="#cb82-450" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label),</span>
<span id="cb82-451"><a href="#cb82-451" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">8</span>,</span>
<span id="cb82-452"><a href="#cb82-452" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb82-453"><a href="#cb82-453" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">8</span></span>
<span id="cb82-454"><a href="#cb82-454" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb82-455"><a href="#cb82-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb82-456"><a href="#cb82-456" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> other_table_values,</span>
<span id="cb82-457"><a href="#cb82-457" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label),</span>
<span id="cb82-458"><a href="#cb82-458" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill = "#ffffff99",</span></span>
<span id="cb82-459"><a href="#cb82-459" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">8</span></span>
<span id="cb82-460"><a href="#cb82-460" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb82-461"><a href="#cb82-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb82-462"><a href="#cb82-462" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> global_accuracy_coord,</span>
<span id="cb82-463"><a href="#cb82-463" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label),</span>
<span id="cb82-464"><a href="#cb82-464" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill = "#ffffff99",</span></span>
<span id="cb82-465"><a href="#cb82-465" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb82-466"><a href="#cb82-466" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"firebrick4"</span></span>
<span id="cb82-467"><a href="#cb82-467" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-468"><a href="#cb82-468" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb82-469"><a href="#cb82-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb82-470"><a href="#cb82-470" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_Label_Sites,</span>
<span id="cb82-471"><a href="#cb82-471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> lab),</span>
<span id="cb82-472"><a href="#cb82-472" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#ffffff99"</span>,</span>
<span id="cb82-473"><a href="#cb82-473" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">6.8</span></span>
<span id="cb82-474"><a href="#cb82-474" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb82-475"><a href="#cb82-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb82-476"><a href="#cb82-476" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> x_axis_text,</span>
<span id="cb82-477"><a href="#cb82-477" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> lab),</span>
<span id="cb82-478"><a href="#cb82-478" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill = "#ffffff99",</span></span>
<span id="cb82-479"><a href="#cb82-479" aria-hidden="true" tabindex="-1"></a>    <span class="co"># vjust = 1,</span></span>
<span id="cb82-480"><a href="#cb82-480" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb82-481"><a href="#cb82-481" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">9</span>,</span>
<span id="cb82-482"><a href="#cb82-482" aria-hidden="true" tabindex="-1"></a>    <span class="at">angle =</span> <span class="dv">40</span></span>
<span id="cb82-483"><a href="#cb82-483" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb82-484"><a href="#cb82-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb82-485"><a href="#cb82-485" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> y_axis_text,</span>
<span id="cb82-486"><a href="#cb82-486" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> lab),</span>
<span id="cb82-487"><a href="#cb82-487" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill = "#ffffff99",</span></span>
<span id="cb82-488"><a href="#cb82-488" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb82-489"><a href="#cb82-489" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">9</span>,</span>
<span id="cb82-490"><a href="#cb82-490" aria-hidden="true" tabindex="-1"></a>    <span class="co"># angle = 20</span></span>
<span id="cb82-491"><a href="#cb82-491" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb82-492"><a href="#cb82-492" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-493"><a href="#cb82-493" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb82-494"><a href="#cb82-494" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   aes(x = 13.8, y = 12.72, label = "Producer's Accuracy"),</span></span>
<span id="cb82-495"><a href="#cb82-495" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   # fill = "#ffffff99",</span></span>
<span id="cb82-496"><a href="#cb82-496" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   size = 9,</span></span>
<span id="cb82-497"><a href="#cb82-497" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   angle = 20</span></span>
<span id="cb82-498"><a href="#cb82-498" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   )+</span></span>
<span id="cb82-499"><a href="#cb82-499" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb82-500"><a href="#cb82-500" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   aes(x = 0, y = 0, label = "User's Accuracy"),</span></span>
<span id="cb82-501"><a href="#cb82-501" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   # fill = "#ffffff99",</span></span>
<span id="cb82-502"><a href="#cb82-502" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   size = 9</span></span>
<span id="cb82-503"><a href="#cb82-503" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   )+</span></span>
<span id="cb82-504"><a href="#cb82-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"References"</span>)<span class="sc">+</span></span>
<span id="cb82-505"><a href="#cb82-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Prediction"</span>)<span class="sc">+</span></span>
<span id="cb82-506"><a href="#cb82-506" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ggplot2::annotation_custom(ggplotGrob(small_validation_matrices), xmin = 12, ymin = 0)+</span></span>
<span id="cb82-507"><a href="#cb82-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb82-508"><a href="#cb82-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb82-509"><a href="#cb82-509" aria-hidden="true" tabindex="-1"></a>  <span class="co"># axis.title.x = element_text(size = 35),</span></span>
<span id="cb82-510"><a href="#cb82-510" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.y = element_text(size = 35),</span></span>
<span id="cb82-511"><a href="#cb82-511" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb82-512"><a href="#cb82-512" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb82-513"><a href="#cb82-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-514"><a href="#cb82-514" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.text.x = element_text(size = 30),</span></span>
<span id="cb82-515"><a href="#cb82-515" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb82-516"><a href="#cb82-516" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.text.y = element_text(size = 25),</span></span>
<span id="cb82-517"><a href="#cb82-517" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb82-518"><a href="#cb82-518" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-519"><a href="#cb82-519" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb82-520"><a href="#cb82-520" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb82-521"><a href="#cb82-521" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb82-522"><a href="#cb82-522" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line=</span><span class="fu">element_blank</span>(),</span>
<span id="cb82-523"><a href="#cb82-523" aria-hidden="true" tabindex="-1"></a>        <span class="co"># legend.position = "top",</span></span>
<span id="cb82-524"><a href="#cb82-524" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.73</span>, <span class="fl">0.8</span>),</span>
<span id="cb82-525"><a href="#cb82-525" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction=</span><span class="st">"horizontal"</span>,</span>
<span id="cb82-526"><a href="#cb82-526" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"cm"</span>),</span>
<span id="cb82-527"><a href="#cb82-527" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb82-528"><a href="#cb82-528" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">vjust =</span> <span class="dv">2</span>),</span>
<span id="cb82-529"><a href="#cb82-529" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title.align =</span> <span class="fl">0.5</span>,</span>
<span id="cb82-530"><a href="#cb82-530" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="st">"center"</span>)<span class="sc">+</span></span>
<span id="cb82-531"><a href="#cb82-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">7</span>, <span class="at">y =</span> <span class="dv">16</span>, <span class="at">label =</span> <span class="st">"Truth"</span>), <span class="at">size =</span> <span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb82-532"><a href="#cb82-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">y =</span> <span class="dv">6</span>, <span class="at">label =</span> <span class="st">"Prediction"</span>), <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Duplicated aesthetics after name standardisation: size</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_matrix_global</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="do">############ Metrics of each sites ###################</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>Arz_metrics_ByClass<span class="ot">&lt;-</span>validation_metrics_Arz<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">rownames</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gsub</span>(<span class="st">"Class: "</span>,<span class="st">""</span>,.),</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Arz Island"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Class,Site),<span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>Arz_metrics_overall<span class="ot">&lt;-</span>validation_metrics_Arz<span class="sc">$</span>overall <span class="sc">%&gt;%</span> </span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"All"</span>,</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Arz Island"</span>,</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">metric =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(Class,Site,metric,value)</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>Arz_metrics<span class="ot">&lt;-</span><span class="fu">rbind</span>(Arz_metrics_ByClass,Arz_metrics_overall)</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>Boat_metrics_ByClass<span class="ot">&lt;-</span>validation_metrics_Boat<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">rownames</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gsub</span>(<span class="st">"Class: "</span>,<span class="st">""</span>,.),</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Marinha Lanzarote"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Class,Site),<span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>Boat_metrics_overall<span class="ot">&lt;-</span>validation_metrics_Boat<span class="sc">$</span>overall <span class="sc">%&gt;%</span> </span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"All"</span>,</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Marinha Lanzarote"</span>,</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">metric =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(Class,Site,metric,value)</span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>Boat_metrics<span class="ot">&lt;-</span><span class="fu">rbind</span>(Boat_metrics_ByClass,Boat_metrics_overall)</span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>DuerLow_metrics_ByClass<span class="ot">&lt;-</span>validation_metrics_DuerLow<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">rownames</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gsub</span>(<span class="st">"Class: "</span>,<span class="st">""</span>,.),</span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Duer"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Class,Site),<span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>DuerLow_metrics_overall<span class="ot">&lt;-</span>validation_metrics_DuerLow<span class="sc">$</span>overall <span class="sc">%&gt;%</span> </span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"All"</span>,</span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Duer"</span>,</span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">metric =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(Class,Site,metric,value)</span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a>DuerLow_metrics<span class="ot">&lt;-</span><span class="fu">rbind</span>(DuerLow_metrics_ByClass,DuerLow_metrics_overall)</span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a>GafanhaHigh_metrics_ByClass<span class="ot">&lt;-</span>validation_metrics_GafanhaHigh<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">rownames</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gsub</span>(<span class="st">"Class: "</span>,<span class="st">""</span>,.),</span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Gafanha High"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-60"><a href="#cb84-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Class,Site),<span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb84-61"><a href="#cb84-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-62"><a href="#cb84-62" aria-hidden="true" tabindex="-1"></a>GafanhaHigh_metrics_overall<span class="ot">&lt;-</span>validation_metrics_GafanhaHigh<span class="sc">$</span>overall <span class="sc">%&gt;%</span> </span>
<span id="cb84-63"><a href="#cb84-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-64"><a href="#cb84-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-65"><a href="#cb84-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"All"</span>,</span>
<span id="cb84-66"><a href="#cb84-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Gafanha High"</span>,</span>
<span id="cb84-67"><a href="#cb84-67" aria-hidden="true" tabindex="-1"></a>         <span class="at">metric =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-68"><a href="#cb84-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(Class,Site,metric,value)</span>
<span id="cb84-69"><a href="#cb84-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-70"><a href="#cb84-70" aria-hidden="true" tabindex="-1"></a>GafanhaHigh_metrics<span class="ot">&lt;-</span><span class="fu">rbind</span>(GafanhaHigh_metrics_ByClass,GafanhaHigh_metrics_overall)</span>
<span id="cb84-71"><a href="#cb84-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-72"><a href="#cb84-72" aria-hidden="true" tabindex="-1"></a>GafanhaLow_metrics_ByClass<span class="ot">&lt;-</span>validation_metrics_GafanhaLow<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb84-73"><a href="#cb84-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-74"><a href="#cb84-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">rownames</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb84-75"><a href="#cb84-75" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gsub</span>(<span class="st">"Class: "</span>,<span class="st">""</span>,.),</span>
<span id="cb84-76"><a href="#cb84-76" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Gafanha Low"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-77"><a href="#cb84-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Class,Site),<span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb84-78"><a href="#cb84-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-79"><a href="#cb84-79" aria-hidden="true" tabindex="-1"></a>GafanhaLow_metrics_overall<span class="ot">&lt;-</span>validation_metrics_GafanhaLow<span class="sc">$</span>overall <span class="sc">%&gt;%</span> </span>
<span id="cb84-80"><a href="#cb84-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-81"><a href="#cb84-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-82"><a href="#cb84-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"All"</span>,</span>
<span id="cb84-83"><a href="#cb84-83" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Gafanha Low"</span>,</span>
<span id="cb84-84"><a href="#cb84-84" aria-hidden="true" tabindex="-1"></a>         <span class="at">metric =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-85"><a href="#cb84-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(Class,Site,metric,value)</span>
<span id="cb84-86"><a href="#cb84-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-87"><a href="#cb84-87" aria-hidden="true" tabindex="-1"></a>GafanhaLow_metrics<span class="ot">&lt;-</span><span class="fu">rbind</span>(GafanhaLow_metrics_ByClass,GafanhaLow_metrics_overall)</span>
<span id="cb84-88"><a href="#cb84-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-89"><a href="#cb84-89" aria-hidden="true" tabindex="-1"></a>Handfisher_1_metrics_ByClass<span class="ot">&lt;-</span>validation_metrics_Handfisher_1<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb84-90"><a href="#cb84-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-91"><a href="#cb84-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">rownames</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb84-92"><a href="#cb84-92" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gsub</span>(<span class="st">"Class: "</span>,<span class="st">""</span>,.),</span>
<span id="cb84-93"><a href="#cb84-93" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Barbâtre"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-94"><a href="#cb84-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Class,Site),<span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb84-95"><a href="#cb84-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-96"><a href="#cb84-96" aria-hidden="true" tabindex="-1"></a>Handfisher_1_metrics_overall<span class="ot">&lt;-</span>validation_metrics_Handfisher_1<span class="sc">$</span>overall <span class="sc">%&gt;%</span> </span>
<span id="cb84-97"><a href="#cb84-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-98"><a href="#cb84-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-99"><a href="#cb84-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"All"</span>,</span>
<span id="cb84-100"><a href="#cb84-100" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Barbâtre"</span>,</span>
<span id="cb84-101"><a href="#cb84-101" aria-hidden="true" tabindex="-1"></a>         <span class="at">metric =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-102"><a href="#cb84-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(Class,Site,metric,value)</span>
<span id="cb84-103"><a href="#cb84-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-104"><a href="#cb84-104" aria-hidden="true" tabindex="-1"></a>Handfisher_1_metrics<span class="ot">&lt;-</span><span class="fu">rbind</span>(Handfisher_1_metrics_ByClass,Handfisher_1_metrics_overall)</span>
<span id="cb84-105"><a href="#cb84-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-106"><a href="#cb84-106" aria-hidden="true" tabindex="-1"></a>Horse_rooster_metrics_ByClass<span class="ot">&lt;-</span>validation_metrics_Horse_rooster<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb84-107"><a href="#cb84-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-108"><a href="#cb84-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">rownames</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb84-109"><a href="#cb84-109" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gsub</span>(<span class="st">"Class: "</span>,<span class="st">""</span>,.),</span>
<span id="cb84-110"><a href="#cb84-110" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Mataducos"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-111"><a href="#cb84-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Class,Site),<span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb84-112"><a href="#cb84-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-113"><a href="#cb84-113" aria-hidden="true" tabindex="-1"></a>Horse_rooster_metrics_overall<span class="ot">&lt;-</span>validation_metrics_Horse_rooster<span class="sc">$</span>overall <span class="sc">%&gt;%</span> </span>
<span id="cb84-114"><a href="#cb84-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-115"><a href="#cb84-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-116"><a href="#cb84-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"All"</span>,</span>
<span id="cb84-117"><a href="#cb84-117" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Mataducos"</span>,</span>
<span id="cb84-118"><a href="#cb84-118" aria-hidden="true" tabindex="-1"></a>         <span class="at">metric =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-119"><a href="#cb84-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(Class,Site,metric,value)</span>
<span id="cb84-120"><a href="#cb84-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-121"><a href="#cb84-121" aria-hidden="true" tabindex="-1"></a>Horse_rooster_metrics<span class="ot">&lt;-</span><span class="fu">rbind</span>(Horse_rooster_metrics_ByClass,Horse_rooster_metrics_overall)</span>
<span id="cb84-122"><a href="#cb84-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-123"><a href="#cb84-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-124"><a href="#cb84-124" aria-hidden="true" tabindex="-1"></a>Kerdrean_metrics_ByClass<span class="ot">&lt;-</span>validation_metrics_Kerdrean<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb84-125"><a href="#cb84-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-126"><a href="#cb84-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">rownames</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb84-127"><a href="#cb84-127" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gsub</span>(<span class="st">"Class: "</span>,<span class="st">""</span>,.),</span>
<span id="cb84-128"><a href="#cb84-128" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Kerdrean"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-129"><a href="#cb84-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Class,Site),<span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb84-130"><a href="#cb84-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-131"><a href="#cb84-131" aria-hidden="true" tabindex="-1"></a>Kerdrean_metrics_overall<span class="ot">&lt;-</span>validation_metrics_Kerdrean<span class="sc">$</span>overall <span class="sc">%&gt;%</span> </span>
<span id="cb84-132"><a href="#cb84-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-133"><a href="#cb84-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-134"><a href="#cb84-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"All"</span>,</span>
<span id="cb84-135"><a href="#cb84-135" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"Kerdrean"</span>,</span>
<span id="cb84-136"><a href="#cb84-136" aria-hidden="true" tabindex="-1"></a>         <span class="at">metric =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-137"><a href="#cb84-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(Class,Site,metric,value)</span>
<span id="cb84-138"><a href="#cb84-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-139"><a href="#cb84-139" aria-hidden="true" tabindex="-1"></a>Kerdrean_metrics<span class="ot">&lt;-</span><span class="fu">rbind</span>(Kerdrean_metrics_ByClass,Kerdrean_metrics_overall)</span>
<span id="cb84-140"><a href="#cb84-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-141"><a href="#cb84-141" aria-hidden="true" tabindex="-1"></a>NorthDike_metrics_ByClass<span class="ot">&lt;-</span>validation_metrics_NorthDike<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb84-142"><a href="#cb84-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-143"><a href="#cb84-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">rownames</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb84-144"><a href="#cb84-144" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gsub</span>(<span class="st">"Class: "</span>,<span class="st">""</span>,.),</span>
<span id="cb84-145"><a href="#cb84-145" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"L'Epine"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-146"><a href="#cb84-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Class,Site),<span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb84-147"><a href="#cb84-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-148"><a href="#cb84-148" aria-hidden="true" tabindex="-1"></a>NorthDike_metrics_overall<span class="ot">&lt;-</span>validation_metrics_NorthDike<span class="sc">$</span>overall <span class="sc">%&gt;%</span> </span>
<span id="cb84-149"><a href="#cb84-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-150"><a href="#cb84-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-151"><a href="#cb84-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="st">"All"</span>,</span>
<span id="cb84-152"><a href="#cb84-152" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> <span class="st">"L'Epine"</span>,</span>
<span id="cb84-153"><a href="#cb84-153" aria-hidden="true" tabindex="-1"></a>         <span class="at">metric =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-154"><a href="#cb84-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(Class,Site,metric,value)</span>
<span id="cb84-155"><a href="#cb84-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-156"><a href="#cb84-156" aria-hidden="true" tabindex="-1"></a>NorthDike_metrics<span class="ot">&lt;-</span><span class="fu">rbind</span>(NorthDike_metrics_ByClass,NorthDike_metrics_overall)</span>
<span id="cb84-157"><a href="#cb84-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-158"><a href="#cb84-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-159"><a href="#cb84-159" aria-hidden="true" tabindex="-1"></a>BySite_Metrics<span class="ot">&lt;-</span><span class="fu">rbind</span>(NorthDike_metrics,Kerdrean_metrics,Horse_rooster_metrics,Handfisher_1_metrics,GafanhaLow_metrics,GafanhaHigh_metrics,DuerLow_metrics,Boat_metrics,Arz_metrics)</span>
<span id="cb84-160"><a href="#cb84-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-161"><a href="#cb84-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-162"><a href="#cb84-162" aria-hidden="true" tabindex="-1"></a>Overall_metrics_ByClass<span class="ot">&lt;-</span>validation_metrics<span class="sc">$</span>byClass <span class="sc">%&gt;%</span> </span>
<span id="cb84-163"><a href="#cb84-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-164"><a href="#cb84-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">rownames</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb84-165"><a href="#cb84-165" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gsub</span>(<span class="st">"Class: "</span>,<span class="st">""</span>,.)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-166"><a href="#cb84-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Class),<span class="at">names_to =</span> <span class="st">"metric"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb84-167"><a href="#cb84-167" aria-hidden="true" tabindex="-1"></a><span class="do">################</span></span>
<span id="cb84-168"><a href="#cb84-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-169"><a href="#cb84-169" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/High_res/Validation/ConfusionMatrixGlobal.png"</span>,plot_matrix_global , <span class="at">width =</span> <span class="dv">1920</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">1032</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb84-170"><a href="#cb84-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-171"><a href="#cb84-171" aria-hidden="true" tabindex="-1"></a><span class="do">######### Focus on green macrophytes</span></span>
<span id="cb84-172"><a href="#cb84-172" aria-hidden="true" tabindex="-1"></a>df_green<span class="ot">&lt;-</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb84-173"><a href="#cb84-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Pred_Class <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Magnoliopsida"</span>, <span class="st">"Chlorophyceae"</span>),</span>
<span id="cb84-174"><a href="#cb84-174" aria-hidden="true" tabindex="-1"></a>         Truth <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Magnoliopsida"</span>, <span class="st">"Chlorophyceae"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-175"><a href="#cb84-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pred_Class =</span> <span class="fu">as.factor</span>(<span class="fu">as.character</span>(Pred_Class)),</span>
<span id="cb84-176"><a href="#cb84-176" aria-hidden="true" tabindex="-1"></a>         <span class="at">Truth =</span> <span class="fu">as.factor</span>(<span class="fu">as.character</span>(Truth)))</span>
<span id="cb84-177"><a href="#cb84-177" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb84-178"><a href="#cb84-178" aria-hidden="true" tabindex="-1"></a>validation_metrics_green<span class="ot">&lt;-</span><span class="fu">confusionMatrix</span>(df_green<span class="sc">$</span>Pred_Class,df_green<span class="sc">$</span>Truth)</span>
<span id="cb84-179"><a href="#cb84-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-180"><a href="#cb84-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-181"><a href="#cb84-181" aria-hidden="true" tabindex="-1"></a>conf_mat_green<span class="ot">&lt;-</span>validation_metrics_green[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb84-182"><a href="#cb84-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb84-183"><a href="#cb84-183" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-184"><a href="#cb84-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb84-185"><a href="#cb84-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-186"><a href="#cb84-186" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(conf_mat_green))){</span>
<span id="cb84-187"><a href="#cb84-187" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb84-188"><a href="#cb84-188" aria-hidden="true" tabindex="-1"></a>    df_sum<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">row =</span> <span class="cn">NA</span>,</span>
<span id="cb84-189"><a href="#cb84-189" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb84-190"><a href="#cb84-190" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-191"><a href="#cb84-191" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_green[i,],<span class="at">na.rm =</span> T)</span>
<span id="cb84-192"><a href="#cb84-192" aria-hidden="true" tabindex="-1"></a>  df_sum[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(conf_mat_green[,i],<span class="at">na.rm =</span> T)</span>
<span id="cb84-193"><a href="#cb84-193" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-194"><a href="#cb84-194" aria-hidden="true" tabindex="-1"></a>conf_mat_std_green<span class="ot">&lt;-</span>conf_mat_green</span>
<span id="cb84-195"><a href="#cb84-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-196"><a href="#cb84-196" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(conf_mat_std_green)){</span>
<span id="cb84-197"><a href="#cb84-197" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(conf_mat_std_green)){</span>
<span id="cb84-198"><a href="#cb84-198" aria-hidden="true" tabindex="-1"></a>    conf_mat_std_green[row,col]<span class="ot">&lt;-</span>conf_mat_std_green[row,col]<span class="sc">/</span>((df_sum<span class="sc">$</span>row[row] <span class="sc">+</span> df_sum<span class="sc">$</span>col[col])<span class="sc">-</span>conf_mat_std_green[row,col])</span>
<span id="cb84-199"><a href="#cb84-199" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-200"><a href="#cb84-200" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-201"><a href="#cb84-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-202"><a href="#cb84-202" aria-hidden="true" tabindex="-1"></a>confmat_rast_green<span class="ot">&lt;-</span>conf_mat_std_green <span class="sc">%&gt;%</span> </span>
<span id="cb84-203"><a href="#cb84-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-204"><a href="#cb84-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-205"><a href="#cb84-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb84-206"><a href="#cb84-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-207"><a href="#cb84-207" aria-hidden="true" tabindex="-1"></a>confmat_rast_green<span class="ot">&lt;-</span><span class="fu">subst</span>(confmat_rast_green, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb84-208"><a href="#cb84-208" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(confmat_rast_green)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb84-209"><a href="#cb84-209" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(confmat_rast_green)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb84-210"><a href="#cb84-210" aria-hidden="true" tabindex="-1"></a>confmat_rast_green_sf<span class="ot">&lt;-</span><span class="fu">as.polygons</span>(confmat_rast_green,<span class="at">aggregate=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb84-211"><a href="#cb84-211" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb84-212"><a href="#cb84-212" aria-hidden="true" tabindex="-1"></a>confmat_rast_green_centroid<span class="ot">&lt;-</span><span class="fu">st_centroid</span>(confmat_rast_green_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_green)[<span class="fu">values</span>(confmat_rast_green) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(confmat_rast_green)[<span class="fu">values</span>(confmat_rast_green) <span class="sc">==</span> <span class="sc">-</span><span class="dv">99</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>labels_green<span class="ot">&lt;-</span>validation_metrics_green[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">label =</span> <span class="st">"V1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">1.5</span>,<span class="fl">1.5</span>),</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">1.5</span>,<span class="fl">0.5</span>,<span class="fl">1.5</span>,<span class="fl">0.5</span>))</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>plot_green<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_spatraster</span>(<span class="at">data =</span> confmat_rast_green,</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">+</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> confmat_rast_green_sf,</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># colours = c("black","firebrick4","goldenrod","yellow","chartreuse3"),</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># colours = c("khaki1","goldenrod","firebrick3","chartreuse4"),</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"khaki1"</span>,<span class="st">"firebrick4"</span>,<span class="st">"firebrick4"</span>,<span class="st">"firebrick4"</span>,<span class="st">"#3e0b0b"</span>),</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># colours = c("#7d0000","#00b300","#00b300","#00b300","#007d00"),</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"white"</span>, </span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> <span class="st">"sqrt"</span>,</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0.05"</span>,<span class="st">"0.25"</span>, <span class="st">"0.50"</span>, <span class="st">"1"</span>),</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.50</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_Bede("mixed", </span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 discrete = F,</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 reverse = TRUE,</span></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 na.value = "white",</span></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 trans = "sqrt",</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 labels = c("5","25", "50", "75", "100"),</span></span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                 breaks = c(0.05,0.25,0.50,0.75,0.9999))+</span></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Proportion </span><span class="sc">\n</span><span class="st"> of pixels"</span>)<span class="sc">+</span></span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>,<span class="fl">1.5</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Chlorophyceae"</span>,<span class="st">"Magnoliopsida"</span>),</span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">position =</span> <span class="st">"top"</span>,</span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>,<span class="fl">1.5</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Magnoliopsida"</span>,<span class="st">"Chlorophyceae"</span>),</span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> labels_green,<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label), <span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"References"</span>)<span class="sc">+</span></span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Prediction"</span>)<span class="sc">+</span></span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ggplot2::annotation_custom(ggplotGrob(small_validation_matrices), xmin = 12, ymin = 0)+</span></span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>( </span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line=</span><span class="fu">element_blank</span>(),</span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">angle =</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb86-55"><a href="#cb86-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-56"><a href="#cb86-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># legend.position = "top",</span></span>
<span id="cb86-57"><a href="#cb86-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># legend.position = c(0.73, 0.9),</span></span>
<span id="cb86-58"><a href="#cb86-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># legend.direction="horizontal",</span></span>
<span id="cb86-59"><a href="#cb86-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># legend.key.width = unit(2,"cm"),</span></span>
<span id="cb86-60"><a href="#cb86-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb86-61"><a href="#cb86-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">vjust =</span> <span class="dv">2</span>),</span>
<span id="cb86-62"><a href="#cb86-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title.align =</span> <span class="fl">0.5</span>,</span>
<span id="cb86-63"><a href="#cb86-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="st">"center"</span>)</span>
<span id="cb86-64"><a href="#cb86-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-65"><a href="#cb86-65" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"./Figures/High_res/Validation/ConfusionMatrixGreen.png"</span>, plot_green, <span class="at">width =</span> <span class="dv">671</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">479</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<p>The workflow of this study revolves around two distinct flight heights (12 and 120 m, <a href="#fig-workflow" class="quarto-xref">Figure&nbsp;3</a>) where ensuring consistency between reflectances at both heights is crucial. This comparison was conducted at sites where low and high altitude flights overlapped. The low altitude flights were resampled to the same spatial resolution and grid as the high flights using a median resampling method. Reflectance values were then extracted, and a scatterplot was generated and the Root Mean Square Error (RMSE) was computed to compare the difference bewteen the raw and standardised reflectance.</p>
<p>The classification model was applied to all flights at both 12 and 120 m of altitude. <em>In situ</em> information on georeferenced class type and percent cover, acquired over homogeneous vegetation patches at the same time as drone flights was used to assess the model accuracy. These images were used to construct a validation dataset indicating the presence or absence of each class. Additionally to the quadrat-based validation dataset, polygons of each class were photo interpreted in order to increase the number of pixels of the validation dataset. A total of 536,000 pixels were used to validate the Neural Network classifier. The sites with the lowest and highest number of validation data were Gafanha Low (17316 pixels) and Marinha Lanzarote (159713 pixels), respectively. A confusion matrix, along with precision metrics such as global accuracy, sensitivity, specificity, F1 score, and Kappa coefficient, were generated for each site. All validation matrices were then aggregated to create an overall matrix .</p>
</section>
</section>
<section id="variable-importance" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="variable-importance"><span class="header-section-number">2.5</span> Variable Importance</h2>
<p>Variable Importance Plots (VIP) serve as a method to identify which predictors are important for predicting a specific class. Out of the 21 predictors utilized in this study, Variable Importance was computed only for the raw and standardized values of the 10 spectral bands captured by the MicaSense camera. This is achieved by repeatedly predicting the same dataset while randomly shuffling one predictor at a time. The benchmark score obtained after each iteration is then compared to the benchmark score obtained without shuffling any variables. The greater the difference between these two benchmark values, the more important the variable is for the model <span class="citation" data-cites="WEI2015399">(<a href="#ref-WEI2015399" role="doc-biblioref">Wei et al., 2015</a>)</span>.</p>
</section>
<section id="influence-of-the-spatial-resolution-on-classification" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="influence-of-the-spatial-resolution-on-classification"><span class="header-section-number">2.6</span> Influence of the spatial resolution on classification</h2>
<p>To evaluate the influence of spatial resolution on the model’s output, we resampled the drone orthomosaics from their native resolution (8 cm for the high altitude flights) using the “average” method from the Terra package in R. DISCOV was then applied to these resampled rasters, and the results were compared to the original model predictions. For each resolution and vegetation class, we calculated the predicted area loss, where a score of 0 indicates no area loss during spatial resampling, and a score of 100 indicates complete loss of the vegetation class.</p>
<p>We used a Generalized Linear Model (GLM) with a Beta distribution to examine the relationship between pixel resolution, vegetation class, and their interaction on the loss of vegetation. The loss of vegetation was modelled as function of the interaction between pixel resolution and vegetation class (Bacillariophyceae, Phaeophyceae, Magnoliopsida, Chlorophyceae and Rhodophyceae). Sample vs fitted residuals and quartile-quartile graphics were assessed visually, to ensure assumption of the models used were met</p>
</section>
<section id="impact-of-mixed-vegetation-cover-on-the-prediction" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="impact-of-mixed-vegetation-cover-on-the-prediction"><span class="header-section-number">2.7</span> Impact of mixed vegetation cover on the prediction</h2>
<p>The key aspect of the workflow adopted in the present study is the mapping at two different altitudes (12 and 120 m), resulting in two distinct resolutions for the same area (8 and 80 mm; respectively). The high-resolution flight was used to estimate the sub-pixel composition for each pixel of the lower-resolution flight. Consequently, within each pixel of the high-altitude flights, the contribution of each vegetation class (% cover) was obtained, and a kernel density plot was generated. This plot provided a visual representation of the model’s behavior in mixed vegetation scenarios. It helps to understand the minimum vegetation cover of a given class within a pixel necessary for the model to confidently predict that class.</p>
</section>
</section>
<section id="results" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Results</h1>
<section id="reflectance-comparison-between-the-two-different-altitudes" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="reflectance-comparison-between-the-two-different-altitudes"><span class="header-section-number">3.1</span> Reflectance comparison between the two different altitudes</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [27]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># high_alt&lt;- "Data/image/micasense/Gafanha_high_multi.tif" %&gt;% </span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   rast()</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # low_alt&lt;- "Data/image/micasense/Gafanha_Low_Multi_rsp.tif" %&gt;% </span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co"># #   rast() </span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co"># low_alt&lt;- "Data/image/micasense/Gafanha_low_multi.tif" %&gt;% </span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   rast() %&gt;% </span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   resample(high_alt, method = "med")</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="co"># low_alt_pred&lt;- "Data/image/prediction/NewPreds/Gafanha_Low_Pred_rsp.tif" %&gt;% </span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   rast() </span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="co"># mask&lt;-"Data/shp/Mask_Alt_Compare_All.shp" %&gt;% </span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   vect()</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a><span class="co"># high_alt_masked&lt;-crop(high_alt,mask)</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a><span class="co"># high_alt_masked&lt;-mask(high_alt_masked,mask)</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="co"># low_alt_masked&lt;-crop(low_alt,mask)</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a><span class="co"># low_alt_masked&lt;-mask(low_alt_masked,mask)</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a><span class="co"># low_alt_pred_masked&lt;-crop(low_alt_pred,mask)</span></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a><span class="co"># low_alt_pred_masked&lt;-mask(low_alt_pred_masked,mask)</span></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a><span class="co"># stk&lt;-rast(list(c(high_alt_masked,low_alt_masked,low_alt_pred_masked)))%&gt;% </span></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   as.data.frame()</span></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a><span class="co"># names(stk)&lt;-c("B1_high","B2_high","B3_high","B4_high","B5_high","B6_high","B7_high","B8_high","B9_high","B10_high",</span></span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a><span class="co">#               "B1_low","B2_low","B3_low","B4_low","B5_low","B6_low","B7_low","B8_low","B9_low","B10_low",</span></span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a><span class="co">#               "pred")</span></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a><span class="co"># stk_long&lt;-stk %&gt;% </span></span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(px_ID = c(1:nrow(stk))) %&gt;% </span></span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(-c(px_ID,pred),values_to = "Value",names_to = "Bands") %&gt;% </span></span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(alt = case_when(str_detect(Bands, "low") ~ "Low",</span></span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a><span class="co">#                          str_detect(Bands, "high") ~ "High",</span></span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a><span class="co">#                          TRUE ~ "NA"),</span></span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a><span class="co">#          Bands = gsub("_high","",Bands),</span></span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a><span class="co">#          Bands = gsub("_low","",Bands))</span></span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a><span class="co"># stk_summarized&lt;-stk_long %&gt;% </span></span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   # group_by(px_ID,alt) %&gt;% </span></span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   # reframe(Value = mean(Value),</span></span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   #         pred = unique(pred)) %&gt;% </span></span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = "alt", values_from = "Value")</span></span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a><span class="co"># df&lt;-stk_summarized %&gt;% </span></span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() %&gt;% </span></span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Bands) %&gt;% </span></span>
<span id="cb87-54"><a href="#cb87-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(Low&lt;10000,</span></span>
<span id="cb87-55"><a href="#cb87-55" aria-hidden="true" tabindex="-1"></a><span class="co">#          High &lt; 10000,</span></span>
<span id="cb87-56"><a href="#cb87-56" aria-hidden="true" tabindex="-1"></a><span class="co">#          Low &lt; quantile(Low,probs = 0.99),</span></span>
<span id="cb87-57"><a href="#cb87-57" aria-hidden="true" tabindex="-1"></a><span class="co">#          High &lt; quantile(High,probs = 0.99),</span></span>
<span id="cb87-58"><a href="#cb87-58" aria-hidden="true" tabindex="-1"></a><span class="co">#          Low &gt; quantile(Low,probs = 0.01),</span></span>
<span id="cb87-59"><a href="#cb87-59" aria-hidden="true" tabindex="-1"></a><span class="co">#          High &gt; quantile(High,probs = 0.01),</span></span>
<span id="cb87-60"><a href="#cb87-60" aria-hidden="true" tabindex="-1"></a><span class="co">#          !pred %in% c(7,9,3,10)) %&gt;%</span></span>
<span id="cb87-61"><a href="#cb87-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb87-62"><a href="#cb87-62" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb87-63"><a href="#cb87-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-64"><a href="#cb87-64" aria-hidden="true" tabindex="-1"></a>RAW <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Data/CompareReflectance/Compare_ref_raw.csv"</span>)<span class="sc">%&gt;%</span>  </span>
<span id="cb87-65"><a href="#cb87-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Low =</span> Low <span class="sc">/</span><span class="dv">10000</span>,</span>
<span id="cb87-66"><a href="#cb87-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">High =</span> High<span class="sc">/</span><span class="dv">10000</span>)</span>
<span id="cb87-67"><a href="#cb87-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-68"><a href="#cb87-68" aria-hidden="true" tabindex="-1"></a>RMSE_raw <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((RAW<span class="sc">$</span>Low <span class="sc">-</span> RAW<span class="sc">$</span>High)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb87-69"><a href="#cb87-69" aria-hidden="true" tabindex="-1"></a>lm_raw <span class="ot">&lt;-</span> <span class="fu">lm</span>(RAW<span class="sc">$</span>High <span class="sc">~</span> RAW<span class="sc">$</span>Low)</span>
<span id="cb87-70"><a href="#cb87-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-71"><a href="#cb87-71" aria-hidden="true" tabindex="-1"></a>STD <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Data/CompareReflectance/Compare_ref_std.csv"</span>)</span>
<span id="cb87-72"><a href="#cb87-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-73"><a href="#cb87-73" aria-hidden="true" tabindex="-1"></a>RMSE_STD <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((STD<span class="sc">$</span>Low <span class="sc">-</span> STD<span class="sc">$</span>High)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb87-74"><a href="#cb87-74" aria-hidden="true" tabindex="-1"></a>lm_STD <span class="ot">&lt;-</span> <span class="fu">lm</span>(STD<span class="sc">$</span>High <span class="sc">~</span> STD<span class="sc">$</span>Low)</span>
<span id="cb87-75"><a href="#cb87-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-76"><a href="#cb87-76" aria-hidden="true" tabindex="-1"></a>plot_RAW <span class="ot">&lt;-</span> RAW <span class="sc">%&gt;%</span>  </span>
<span id="cb87-77"><a href="#cb87-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Low, <span class="at">y=</span>High))<span class="sc">+</span></span>
<span id="cb87-78"><a href="#cb87-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(aes(color = as.factor(pred)))</span></span>
<span id="cb87-79"><a href="#cb87-79" aria-hidden="true" tabindex="-1"></a>  ggpointdensity<span class="sc">::</span><span class="fu">geom_pointdensity</span>(<span class="at">adjust =</span> .<span class="dv">03</span>)<span class="sc">+</span></span>
<span id="cb87-80"><a href="#cb87-80" aria-hidden="true" tabindex="-1"></a>  viridis<span class="sc">::</span><span class="fu">scale_color_viridis</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">6000</span>),</span>
<span id="cb87-81"><a href="#cb87-81" aria-hidden="true" tabindex="-1"></a>                               <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2000</span>,<span class="dv">4000</span>,<span class="dv">6000</span>),</span>
<span id="cb87-82"><a href="#cb87-82" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"2000"</span>,<span class="st">"4000"</span>,<span class="st">"6000"</span>))<span class="sc">+</span></span>
<span id="cb87-83"><a href="#cb87-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "loess")+</span></span>
<span id="cb87-84"><a href="#cb87-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span> )<span class="sc">+</span></span>
<span id="cb87-85"><a href="#cb87-85" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm", color = "red", linetype = "dashed",linewidth = 1)+</span></span>
<span id="cb87-86"><a href="#cb87-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb87-87"><a href="#cb87-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.6</span>))<span class="sc">+</span></span>
<span id="cb87-88"><a href="#cb87-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.6</span>))<span class="sc">+</span></span>
<span id="cb87-89"><a href="#cb87-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Reflectance of the 120m flight"</span>)<span class="sc">+</span></span>
<span id="cb87-90"><a href="#cb87-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Reflectance of the 12m flight"</span>)<span class="sc">+</span></span>
<span id="cb87-91"><a href="#cb87-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Pixel density"</span>)<span class="sc">+</span></span>
<span id="cb87-92"><a href="#cb87-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb87-93"><a href="#cb87-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb87-94"><a href="#cb87-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">3</span>,<span class="st">"line"</span>))</span>
<span id="cb87-95"><a href="#cb87-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-96"><a href="#cb87-96" aria-hidden="true" tabindex="-1"></a>plot_STD <span class="ot">&lt;-</span> STD <span class="sc">%&gt;%</span>  </span>
<span id="cb87-97"><a href="#cb87-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Low, <span class="at">y=</span>High))<span class="sc">+</span></span>
<span id="cb87-98"><a href="#cb87-98" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(aes(color = as.factor(pred)))</span></span>
<span id="cb87-99"><a href="#cb87-99" aria-hidden="true" tabindex="-1"></a>  ggpointdensity<span class="sc">::</span><span class="fu">geom_pointdensity</span>(<span class="at">adjust =</span> .<span class="dv">03</span>)<span class="sc">+</span></span>
<span id="cb87-100"><a href="#cb87-100" aria-hidden="true" tabindex="-1"></a>  viridis<span class="sc">::</span><span class="fu">scale_color_viridis</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2000</span>),</span>
<span id="cb87-101"><a href="#cb87-101" aria-hidden="true" tabindex="-1"></a>                               <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1000</span>,<span class="dv">2000</span>),</span>
<span id="cb87-102"><a href="#cb87-102" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"1000"</span>,<span class="st">"2000"</span>))<span class="sc">+</span></span>
<span id="cb87-103"><a href="#cb87-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_color_gradient(na.value = 1)+</span></span>
<span id="cb87-104"><a href="#cb87-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "loess")+</span></span>
<span id="cb87-105"><a href="#cb87-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span> )<span class="sc">+</span></span>
<span id="cb87-106"><a href="#cb87-106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm", color = "red", linetype = "dashed",linewidth = 1)+</span></span>
<span id="cb87-107"><a href="#cb87-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb87-108"><a href="#cb87-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">0.05</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb87-109"><a href="#cb87-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="fl">0.05</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb87-110"><a href="#cb87-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Standardised reflectance of the 120m flight"</span>)<span class="sc">+</span></span>
<span id="cb87-111"><a href="#cb87-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Standardised reflectance of the 12m flight"</span>)<span class="sc">+</span></span>
<span id="cb87-112"><a href="#cb87-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Pixel density"</span>)<span class="sc">+</span></span>
<span id="cb87-113"><a href="#cb87-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb87-114"><a href="#cb87-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb87-115"><a href="#cb87-115" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">3</span>,<span class="st">"line"</span>))</span>
<span id="cb87-116"><a href="#cb87-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-117"><a href="#cb87-117" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"./Figures/High_res/Compare_reflectance.png"</span>,plot_RAW, <span class="at">width=</span> <span class="dv">472</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height=</span><span class="dv">402</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb87-118"><a href="#cb87-118" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"./Figures/High_res/Compare_reflectance_std.png"</span>,plot_STD, <span class="at">width=</span> <span class="dv">472</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height=</span><span class="dv">402</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [28]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>RAW <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> <span class="fu">rast</span>(<span class="st">"./Figures/High_res/Compare_reflectance.png"</span>))<span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">300</span>,<span class="at">y=</span> <span class="dv">1200</span>, <span class="at">label =</span> <span class="st">"A"</span>) ,<span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>),</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major=</span><span class="fu">element_blank</span>(), </span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(), </span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"pt"</span>))</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>STD <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> <span class="fu">rast</span>(<span class="st">"./Figures/High_res/Compare_reflectance_std.png"</span>))<span class="sc">+</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()<span class="sc">+</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">300</span>,<span class="at">y=</span> <span class="dv">1200</span>, <span class="at">label =</span> <span class="st">"B"</span>) ,<span class="at">size =</span> <span class="dv">10</span>)<span class="sc">+</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"pt"</span>),</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major=</span><span class="fu">element_blank</span>(), </span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(), </span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"pt"</span>))</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> RAW<span class="sc">+</span>STD</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"./Figures/High_res/Compare_reflectance_both.png"</span>,plot,<span class="at">width=</span> <span class="dv">1920</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height=</span><span class="dv">1129</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<p>In this study, drone flights were conducted at two different altitudes (12 and 120 m) to construct the neural network model. At the sites where the flights at both altitudes overlapped, reflectance was compared. Overall there was a good agreement between the two altitudes (RMSE : 0.027 ; <a href="#fig-CompareRef" class="quarto-xref">Figure&nbsp;4</a>).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [29]:</pre></div><div id="cell-fig-CompareRef" class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"./Figures/High_res/Compare_reflectance_both.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-CompareRef" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-CompareRef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="./Figures/High_res/Compare_reflectance_both.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;4: Comparison of reflectance retrieved from both low-altitude and high-altitude flights over a common area. The black dashed line represents a 1 to 1 relationship. Left (A) plots raw data and right (B) plots standardized data (Equation&nbsp;1)."><img src="./Figures/High_res/Compare_reflectance_both.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-CompareRef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Comparison of reflectance retrieved from both low-altitude and high-altitude flights over a common area. The black dashed line represents a 1 to 1 relationship. Left (A) plots raw data and right (B) plots standardized data (<a href="#eq-std" class="quarto-xref">Equation&nbsp;1</a>).
</figcaption>
</figure>
</div>
</div>
</div></div>
<p>There was a slight underestimation for raw reflectance values in the high-altitude flight, particularly for higher reflectance values (<a href="#fig-CompareRef" class="quarto-xref">Figure&nbsp;4</a> A). Since both flights were conducted over vegetated areas, the highest reflectance values correspond to the infrared part of the spectrum. This difference was not present when the reflectance has been standardized (<a href="#eq-std" class="quarto-xref">Equation&nbsp;1</a> ; <a href="#fig-CompareRef" class="quarto-xref">Figure&nbsp;4</a> B).</p>
</section>
<section id="classification" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="classification"><span class="header-section-number">3.2</span> Classification</h2>
<p>Each drone flight was used to produce a prediction map, as well as a probability map that indicates the model derived probability of the selected class for every pixel. The low-altitude flight conducted in Gafanha, Portugal, represented the site with the highest complexity (<a href="#fig-GafLow" class="quarto-xref">Figure&nbsp;5</a>). Among the five vegetation classes on which the model was trained, four were present on this site, with green and red macroalgae mixed with a seagrass meadow. There was also diatoms forming biofilms on bare sediment surface. Although the seagrass was solely composed of a single specie, <em>Nanozostera noltei</em>, various colors of this specie could be observed from dark green (corresponding to healthy leaves) to brown (when leaves are senescent or have an altered pigment composition). Regardless of the variation of color, the class Magnoliopsida was accurately predicted by the model (F1 score of 0.96 at that site).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [30]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>imglist<span class="ot">&lt;-</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">path =</span> <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">".tif"</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">folder =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Data"</span>) <span class="sc">~</span> <span class="st">"Input"</span>,</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Output"</span>),</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">alt =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"high"</span>) <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"low"</span>),</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">site =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Gafanha"</span>) <span class="sc">~</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Duer"</span>),</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"pred"</span>) <span class="sc">~</span> <span class="st">"Pred"</span>,</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"NDVI"</span>) <span class="sc">~</span> <span class="st">"NDVI"</span>,</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"ortho"</span>),</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">resampled =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"resampled"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">new =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"no_Xantho"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"colored"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">correction =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"corrected_per_bands"</span>) <span class="sc">~</span> <span class="st">"Bands"</span>,</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"corrected.tif"</span>) <span class="sc">~</span> <span class="st">"lm_all"</span>,</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(alt <span class="sc">!=</span> <span class="st">"NA"</span>,</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">str_detect</span>(path,<span class="st">".aux.xml"</span>))</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>shp_roi<span class="ot">&lt;-</span><span class="st">"Data/reflectance_calibration_low_&amp;_high_flights/"</span> <span class="sc">%&gt;%</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">".shp"</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">case_when</span>(name <span class="sc">==</span> <span class="st">"Microphytobenthos"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>                        name <span class="sc">==</span> <span class="st">"ZOS"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>                        name <span class="sc">==</span> <span class="st">"BL"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>                        name <span class="sc">==</span> <span class="st">"SED"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>                        name <span class="sc">==</span> <span class="st">"GRE"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>                        name <span class="sc">==</span> <span class="st">"RED"</span> <span class="sc">~</span> <span class="dv">6</span>,</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>                        name <span class="sc">==</span> <span class="st">"Xanthophyceae"</span> <span class="sc">~</span> <span class="dv">7</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">"Spatial"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vect</span>()</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>zoom_extent<span class="ot">&lt;-</span><span class="st">"Data/shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>,<span class="at">recursive =</span> T,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"zoom_extent_map_Gafanha_comparison"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a>background_GafHigh<span class="ot">&lt;-</span><span class="st">"Data/shp/Aveiro"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">"background_Gafanha_high"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a><span class="do">###### Preview ###########</span></span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a>filelist<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="st">"Data/shp/"</span>, <span class="at">pattern =</span> <span class="st">".shp"</span>, <span class="at">recursive =</span> T,<span class="at">full.names =</span> T)</span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a>mask_aveiro <span class="ot">&lt;-</span> filelist[<span class="fu">str_detect</span>(filelist,<span class="st">"mask_land_intertidal_Aveiro"</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb90-58"><a href="#cb90-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-59"><a href="#cb90-59" aria-hidden="true" tabindex="-1"></a>Flight_aveiro<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb90-60"><a href="#cb90-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name=</span><span class="fu">c</span>(</span>
<span id="cb90-61"><a href="#cb90-61" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gafanha"</span></span>
<span id="cb90-62"><a href="#cb90-62" aria-hidden="true" tabindex="-1"></a>  ) ,</span>
<span id="cb90-63"><a href="#cb90-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(<span class="st">"12m and 120m Flights"</span>),</span>
<span id="cb90-64"><a href="#cb90-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">Long=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.742485</span>) ,</span>
<span id="cb90-65"><a href="#cb90-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lat=</span><span class="fu">c</span>(<span class="fl">40.597599</span>) </span>
<span id="cb90-66"><a href="#cb90-66" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb90-67"><a href="#cb90-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Long"</span>,<span class="st">"Lat"</span>) )  <span class="sc">%&gt;%</span> </span>
<span id="cb90-68"><a href="#cb90-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">"EPSG:4326"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb90-69"><a href="#cb90-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">crs</span>(mask_aveiro))  <span class="sc">%&gt;%</span> </span>
<span id="cb90-70"><a href="#cb90-70" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lon =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">1</span>],</span>
<span id="cb90-71"><a href="#cb90-71" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb90-72"><a href="#cb90-72" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb90-73"><a href="#cb90-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-74"><a href="#cb90-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-75"><a href="#cb90-75" aria-hidden="true" tabindex="-1"></a>p1_background<span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Data/shp/Aveiro/Background_p1_aveiro.shp"</span>)</span>
<span id="cb90-76"><a href="#cb90-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-77"><a href="#cb90-77" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb90-78"><a href="#cb90-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>),</span>
<span id="cb90-79"><a href="#cb90-79" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#BDBDBD"</span>))<span class="sc">+</span></span>
<span id="cb90-80"><a href="#cb90-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> p1_background, <span class="at">fill =</span> <span class="st">"white"</span>,<span class="at">show.legend =</span> F, <span class="at">linewidth=</span><span class="fl">0.05</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,<span class="at">colour=</span><span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb90-81"><a href="#cb90-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mask_aveiro, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),<span class="at">show.legend =</span> F, <span class="at">linewidth=</span><span class="fl">0.05</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,<span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb90-82"><a href="#cb90-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-83"><a href="#cb90-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">519749</span>,<span class="dv">535233</span>) ,</span>
<span id="cb90-84"><a href="#cb90-84" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">4493310</span>,<span class="dv">4508794</span>) )<span class="sc">+</span></span>
<span id="cb90-85"><a href="#cb90-85" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>Flight_aveiro,</span>
<span id="cb90-86"><a href="#cb90-86" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x=</span>lon,</span>
<span id="cb90-87"><a href="#cb90-87" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>lat,</span>
<span id="cb90-88"><a href="#cb90-88" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> Name,</span>
<span id="cb90-89"><a href="#cb90-89" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> Name),</span>
<span id="cb90-90"><a href="#cb90-90" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># description=Description),</span></span>
<span id="cb90-91"><a href="#cb90-91" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size=</span><span class="fl">0.3</span>,</span>
<span id="cb90-92"><a href="#cb90-92" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb90-93"><a href="#cb90-93" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb90-94"><a href="#cb90-94" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend=</span>F,</span>
<span id="cb90-95"><a href="#cb90-95" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fontsize =</span> <span class="dv">18</span>,</span>
<span id="cb90-96"><a href="#cb90-96" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb90-97"><a href="#cb90-97" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.size =</span> <span class="dv">2</span>,</span>
<span id="cb90-98"><a href="#cb90-98" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb90-99"><a href="#cb90-99" aria-hidden="true" tabindex="-1"></a>  <span class="at">expand =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb90-100"><a href="#cb90-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">radius =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb90-101"><a href="#cb90-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.fill =</span> <span class="st">"grey90"</span>,</span>
<span id="cb90-102"><a href="#cb90-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"mm"</span>)) <span class="sc">+</span></span>
<span id="cb90-103"><a href="#cb90-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># theme_void()+</span></span>
<span id="cb90-104"><a href="#cb90-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb90-105"><a href="#cb90-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Longitude"</span>,</span>
<span id="cb90-106"><a href="#cb90-106" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Latitude"</span>)<span class="sc">+</span></span>
<span id="cb90-107"><a href="#cb90-107" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_label(aes(x = 521000, y = 4507794, label = "C"), size = 20)+</span></span>
<span id="cb90-108"><a href="#cb90-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">8.75</span>, <span class="sc">-</span><span class="fl">8.6</span>, <span class="at">by =</span> <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb90-109"><a href="#cb90-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>), <span class="st">"cm"</span>) ,</span>
<span id="cb90-110"><a href="#cb90-110" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb90-111"><a href="#cb90-111" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-112"><a href="#cb90-112" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb90-113"><a href="#cb90-113" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb90-114"><a href="#cb90-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb90-115"><a href="#cb90-115" aria-hidden="true" tabindex="-1"></a><span class="do">######### RGB #########</span></span>
<span id="cb90-116"><a href="#cb90-116" aria-hidden="true" tabindex="-1"></a> Gafanha_low_ortho<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb90-117"><a href="#cb90-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb90-118"><a href="#cb90-118" aria-hidden="true" tabindex="-1"></a>         alt <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb90-119"><a href="#cb90-119" aria-hidden="true" tabindex="-1"></a>         type <span class="sc">==</span> <span class="st">"ortho"</span>,</span>
<span id="cb90-120"><a href="#cb90-120" aria-hidden="true" tabindex="-1"></a>         resampled <span class="sc">==</span> <span class="st">"TRUE"</span>,</span>
<span id="cb90-121"><a href="#cb90-121" aria-hidden="true" tabindex="-1"></a>         col <span class="sc">==</span> <span class="st">"TRUE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-122"><a href="#cb90-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb90-123"><a href="#cb90-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>() </span>
<span id="cb90-124"><a href="#cb90-124" aria-hidden="true" tabindex="-1"></a> <span class="fu">names</span>(Gafanha_low_ortho)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"B1"</span>, <span class="st">"B3"</span>, <span class="st">"B5"</span>,<span class="st">"alpha"</span>)</span>
<span id="cb90-125"><a href="#cb90-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-126"><a href="#cb90-126" aria-hidden="true" tabindex="-1"></a> <span class="fu">values</span>(Gafanha_low_ortho)[<span class="fu">values</span>(Gafanha_low_ortho<span class="sc">$</span>alpha) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb90-127"><a href="#cb90-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-128"><a href="#cb90-128" aria-hidden="true" tabindex="-1"></a> Gafanha_low_ortho_zoomed<span class="ot">&lt;-</span>Gafanha_low_ortho <span class="sc">%&gt;%</span> </span>
<span id="cb90-129"><a href="#cb90-129" aria-hidden="true" tabindex="-1"></a>   <span class="fu">crop</span>(zoom_extent)</span>
<span id="cb90-130"><a href="#cb90-130" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb90-131"><a href="#cb90-131" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb90-132"><a href="#cb90-132" aria-hidden="true" tabindex="-1"></a> map_extent_full<span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="fu">as.polygons</span>(<span class="fu">ext</span>(Gafanha_low_ortho)))</span>
<span id="cb90-133"><a href="#cb90-133" aria-hidden="true" tabindex="-1"></a> sf<span class="sc">::</span><span class="fu">st_crs</span>(map_extent_full)<span class="ot">&lt;-</span><span class="fu">st_crs</span>(Gafanha_low_ortho)</span>
<span id="cb90-134"><a href="#cb90-134" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb90-135"><a href="#cb90-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-136"><a href="#cb90-136" aria-hidden="true" tabindex="-1"></a>  map_extent_zommed<span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="fu">as.polygons</span>(<span class="fu">ext</span>(Gafanha_low_ortho_zoomed)))</span>
<span id="cb90-137"><a href="#cb90-137" aria-hidden="true" tabindex="-1"></a> sf<span class="sc">::</span><span class="fu">st_crs</span>(map_extent_zommed)<span class="ot">&lt;-</span><span class="fu">st_crs</span>(Gafanha_low_ortho_zoomed)</span>
<span id="cb90-138"><a href="#cb90-138" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb90-139"><a href="#cb90-139" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb90-140"><a href="#cb90-140" aria-hidden="true" tabindex="-1"></a> rgb_Gafanha_low_zoomed<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb90-141"><a href="#cb90-141" aria-hidden="true" tabindex="-1"></a>   tidyterra<span class="sc">::</span><span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> Gafanha_low_ortho_zoomed, </span>
<span id="cb90-142"><a href="#cb90-142" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">r =</span> <span class="dv">3</span>,</span>
<span id="cb90-143"><a href="#cb90-143" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">g =</span> <span class="dv">2</span>,</span>
<span id="cb90-144"><a href="#cb90-144" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">b =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb90-145"><a href="#cb90-145" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb90-146"><a href="#cb90-146" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_extent, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"black"</span>,<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb90-147"><a href="#cb90-147" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)<span class="sc">+</span></span>
<span id="cb90-148"><a href="#cb90-148" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_void</span>()</span>
<span id="cb90-149"><a href="#cb90-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-150"><a href="#cb90-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-151"><a href="#cb90-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-152"><a href="#cb90-152" aria-hidden="true" tabindex="-1"></a> scale_labels<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.74368</span>, <span class="sc">-</span><span class="fl">8.743565</span>,<span class="sc">-</span><span class="fl">8.74342</span>),</span>
<span id="cb90-153"><a href="#cb90-153" aria-hidden="true" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">40.59792</span>,<span class="dv">3</span>)),</span>
<span id="cb90-154"><a href="#cb90-154" aria-hidden="true" tabindex="-1"></a>                          <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"10"</span>,<span class="st">"20 m"</span>))</span>
<span id="cb90-155"><a href="#cb90-155" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb90-156"><a href="#cb90-156" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb90-157"><a href="#cb90-157" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb90-158"><a href="#cb90-158" aria-hidden="true" tabindex="-1"></a>  rgb_Gafanha_low<span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb90-159"><a href="#cb90-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>, </span>
<span id="cb90-160"><a href="#cb90-160" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>, <span class="st">"water"</span>),</span>
<span id="cb90-161"><a href="#cb90-161" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#CFCFCF"</span>,<span class="st">"#42c9bc"</span>))<span class="sc">+</span></span>
<span id="cb90-162"><a href="#cb90-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_GafHigh,</span>
<span id="cb90-163"><a href="#cb90-163" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb90-164"><a href="#cb90-164" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F,</span>
<span id="cb90-165"><a href="#cb90-165" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb90-166"><a href="#cb90-166" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.4</span>,</span>
<span id="cb90-167"><a href="#cb90-167" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb90-168"><a href="#cb90-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_GafHigh,</span>
<span id="cb90-169"><a href="#cb90-169" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),</span>
<span id="cb90-170"><a href="#cb90-170" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F, </span>
<span id="cb90-171"><a href="#cb90-171" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb90-172"><a href="#cb90-172" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.4</span>,</span>
<span id="cb90-173"><a href="#cb90-173" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb90-174"><a href="#cb90-174" aria-hidden="true" tabindex="-1"></a>   tidyterra<span class="sc">::</span><span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> Gafanha_low_ortho,</span>
<span id="cb90-175"><a href="#cb90-175" aria-hidden="true" tabindex="-1"></a>         <span class="at">r =</span> <span class="dv">1</span>,</span>
<span id="cb90-176"><a href="#cb90-176" aria-hidden="true" tabindex="-1"></a>         <span class="at">g =</span> <span class="dv">2</span>,</span>
<span id="cb90-177"><a href="#cb90-177" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> <span class="dv">3</span>,</span>
<span id="cb90-178"><a href="#cb90-178" aria-hidden="true" tabindex="-1"></a>         <span class="at">maxcell =</span> <span class="dv">4010533</span></span>
<span id="cb90-179"><a href="#cb90-179" aria-hidden="true" tabindex="-1"></a>         )<span class="sc">+</span></span>
<span id="cb90-180"><a href="#cb90-180" aria-hidden="true" tabindex="-1"></a>    ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"tl"</span>,</span>
<span id="cb90-181"><a href="#cb90-181" aria-hidden="true" tabindex="-1"></a>                                <span class="at">text_cex=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb90-182"><a href="#cb90-182" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(p1),</span>
<span id="cb90-183"><a href="#cb90-183" aria-hidden="true" tabindex="-1"></a>                        <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.7430</span>,</span>
<span id="cb90-184"><a href="#cb90-184" aria-hidden="true" tabindex="-1"></a>                        <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">8.742702</span>,</span>
<span id="cb90-185"><a href="#cb90-185" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ymin =</span> <span class="fl">40.5970515</span>, </span>
<span id="cb90-186"><a href="#cb90-186" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ymax =</span> <span class="fl">40.5974</span>) <span class="sc">+</span></span>
<span id="cb90-187"><a href="#cb90-187" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb90-188"><a href="#cb90-188" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_extent, </span>
<span id="cb90-189"><a href="#cb90-189" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"transparent"</span>,</span>
<span id="cb90-190"><a href="#cb90-190" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb90-191"><a href="#cb90-191" aria-hidden="true" tabindex="-1"></a>           <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb90-192"><a href="#cb90-192" aria-hidden="true" tabindex="-1"></a>           <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb90-193"><a href="#cb90-193" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)<span class="sc">+</span></span>
<span id="cb90-194"><a href="#cb90-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(rgb_Gafanha_low_zoomed),</span>
<span id="cb90-195"><a href="#cb90-195" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.7430</span>,</span>
<span id="cb90-196"><a href="#cb90-196" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmax=</span><span class="sc">-</span><span class="fl">8.7427</span>,</span>
<span id="cb90-197"><a href="#cb90-197" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">40.5977</span>) <span class="sc">+</span></span>
<span id="cb90-198"><a href="#cb90-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(x,y,<span class="at">group=</span>grp),</span>
<span id="cb90-199"><a href="#cb90-199" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.7432439</span>,<span class="sc">-</span><span class="fl">8.743</span>,<span class="sc">-</span><span class="fl">8.7432439</span>,<span class="sc">-</span><span class="fl">8.743</span>),</span>
<span id="cb90-200"><a href="#cb90-200" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y=</span><span class="fu">c</span>(<span class="fl">40.5976275</span>,<span class="fl">40.5979</span>,<span class="fl">40.5975373</span>,<span class="fl">40.59771</span>),</span>
<span id="cb90-201"><a href="#cb90-201" aria-hidden="true" tabindex="-1"></a>                              <span class="at">grp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb90-202"><a href="#cb90-202" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb90-203"><a href="#cb90-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-204"><a href="#cb90-204" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb90-205"><a href="#cb90-205" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">angle =</span> <span class="dv">20</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb90-206"><a href="#cb90-206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.7437</span>, <span class="sc">-</span><span class="fl">8.74275</span>), <span class="at">breaks =</span> <span class="sc">-</span><span class="fl">8.743</span>)<span class="sc">+</span></span>
<span id="cb90-207"><a href="#cb90-207" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">40.59715</span>, <span class="fl">40.5979</span>), <span class="at">breaks =</span> <span class="fl">40.5975</span>)</span>
<span id="cb90-208"><a href="#cb90-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-209"><a href="#cb90-209" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb90-210"><a href="#cb90-210" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb90-211"><a href="#cb90-211" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-212"><a href="#cb90-212" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-213"><a href="#cb90-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-214"><a href="#cb90-214" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/Gaf_Low_RGB.png"</span>,rgb_Gafanha_low , <span class="at">width =</span> <span class="dv">1920</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">1129</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb90-215"><a href="#cb90-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-216"><a href="#cb90-216" aria-hidden="true" tabindex="-1"></a>zoom_extent<span class="ot">&lt;-</span><span class="st">"Data/shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb90-217"><a href="#cb90-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>,<span class="at">recursive =</span> T,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb90-218"><a href="#cb90-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb90-219"><a href="#cb90-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-220"><a href="#cb90-220" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"zoom_extent_map_Gafanha_comparison"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb90-221"><a href="#cb90-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb90-222"><a href="#cb90-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb90-223"><a href="#cb90-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-224"><a href="#cb90-224" aria-hidden="true" tabindex="-1"></a><span class="do">####### Zoomed map ########</span></span>
<span id="cb90-225"><a href="#cb90-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-226"><a href="#cb90-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-227"><a href="#cb90-227" aria-hidden="true" tabindex="-1"></a>Gafanha_low_pred_zoomed<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb90-228"><a href="#cb90-228" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb90-229"><a href="#cb90-229" aria-hidden="true" tabindex="-1"></a>       alt <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb90-230"><a href="#cb90-230" aria-hidden="true" tabindex="-1"></a>       type <span class="sc">==</span> <span class="st">"Pred"</span>,</span>
<span id="cb90-231"><a href="#cb90-231" aria-hidden="true" tabindex="-1"></a>       resampled <span class="sc">==</span> <span class="st">"FALSE"</span>,</span>
<span id="cb90-232"><a href="#cb90-232" aria-hidden="true" tabindex="-1"></a>       folder <span class="sc">==</span> <span class="st">"Input"</span>,</span>
<span id="cb90-233"><a href="#cb90-233" aria-hidden="true" tabindex="-1"></a>       new <span class="sc">==</span> <span class="st">"TRUE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-234"><a href="#cb90-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb90-235"><a href="#cb90-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb90-236"><a href="#cb90-236" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Gafanha_low_pred_zoomed)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb90-237"><a href="#cb90-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-238"><a href="#cb90-238" aria-hidden="true" tabindex="-1"></a>Gafanha_low_pred_zoomed<span class="ot">&lt;-</span>Gafanha_low_pred_zoomed <span class="sc">%&gt;%</span> </span>
<span id="cb90-239"><a href="#cb90-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zoom_extent)</span>
<span id="cb90-240"><a href="#cb90-240" aria-hidden="true" tabindex="-1"></a>Gafanha_low_pred_zoomed<span class="ot">&lt;-</span><span class="fu">as.factor</span>(Gafanha_low_pred_zoomed)</span>
<span id="cb90-241"><a href="#cb90-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-242"><a href="#cb90-242" aria-hidden="true" tabindex="-1"></a>Gafanha_low_pred_map_zoomed<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb90-243"><a href="#cb90-243" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> Gafanha_low_pred_zoomed, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer))<span class="sc">+</span></span>
<span id="cb90-244"><a href="#cb90-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_extent, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"black"</span>,<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb90-245"><a href="#cb90-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)<span class="sc">+</span></span>
<span id="cb90-246"><a href="#cb90-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#70543e"</span>, <span class="st">"#b3ff1a"</span>,<span class="st">"#70543e"</span>, <span class="st">"#DAA520"</span>, <span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>, <span class="cn">NA</span>, <span class="st">"#42c9bc"</span>), <span class="at">na.value =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb90-247"><a href="#cb90-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb90-248"><a href="#cb90-248" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_equal()+</span></span>
<span id="cb90-249"><a href="#cb90-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-250"><a href="#cb90-250" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-251"><a href="#cb90-251" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb90-252"><a href="#cb90-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb90-253"><a href="#cb90-253" aria-hidden="true" tabindex="-1"></a> <span class="co"># Gafanha_low_pred_map_zoomed</span></span>
<span id="cb90-254"><a href="#cb90-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-255"><a href="#cb90-255" aria-hidden="true" tabindex="-1"></a><span class="do">####  Overall map</span></span>
<span id="cb90-256"><a href="#cb90-256" aria-hidden="true" tabindex="-1"></a>Gafanha_low_pred<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb90-257"><a href="#cb90-257" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb90-258"><a href="#cb90-258" aria-hidden="true" tabindex="-1"></a>       alt <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb90-259"><a href="#cb90-259" aria-hidden="true" tabindex="-1"></a>       type <span class="sc">==</span> <span class="st">"Pred"</span>,</span>
<span id="cb90-260"><a href="#cb90-260" aria-hidden="true" tabindex="-1"></a>       <span class="co"># resampled == "TRUE",</span></span>
<span id="cb90-261"><a href="#cb90-261" aria-hidden="true" tabindex="-1"></a>       new <span class="sc">==</span> <span class="st">"TRUE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-262"><a href="#cb90-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb90-263"><a href="#cb90-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb90-264"><a href="#cb90-264" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Gafanha_low_pred)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb90-265"><a href="#cb90-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-266"><a href="#cb90-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-267"><a href="#cb90-267" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(Gafanha_low_pred)[<span class="fu">values</span>(Gafanha_low_pred) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb90-268"><a href="#cb90-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-269"><a href="#cb90-269" aria-hidden="true" tabindex="-1"></a>Gafanha_low_pred<span class="ot">&lt;-</span>Gafanha_low_pred <span class="sc">%&gt;%</span> </span>
<span id="cb90-270"><a href="#cb90-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb90-271"><a href="#cb90-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-272"><a href="#cb90-272" aria-hidden="true" tabindex="-1"></a><span class="do">####### Pred ######</span></span>
<span id="cb90-273"><a href="#cb90-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-274"><a href="#cb90-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-275"><a href="#cb90-275" aria-hidden="true" tabindex="-1"></a>Gafanha_low_pred_map <span class="ot">&lt;-</span></span>
<span id="cb90-276"><a href="#cb90-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb90-277"><a href="#cb90-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>, </span>
<span id="cb90-278"><a href="#cb90-278" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>, <span class="st">"water"</span>),</span>
<span id="cb90-279"><a href="#cb90-279" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#CFCFCF"</span>,<span class="st">"#42c9bc"</span>))<span class="sc">+</span></span>
<span id="cb90-280"><a href="#cb90-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_GafHigh,</span>
<span id="cb90-281"><a href="#cb90-281" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),</span>
<span id="cb90-282"><a href="#cb90-282" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F, </span>
<span id="cb90-283"><a href="#cb90-283" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb90-284"><a href="#cb90-284" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.4</span>,</span>
<span id="cb90-285"><a href="#cb90-285" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb90-286"><a href="#cb90-286" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_sf(data = background_GafHigh,</span></span>
<span id="cb90-287"><a href="#cb90-287" aria-hidden="true" tabindex="-1"></a>  <span class="co">#         fill = "white",</span></span>
<span id="cb90-288"><a href="#cb90-288" aria-hidden="true" tabindex="-1"></a>  <span class="co">#         show.legend = F, </span></span>
<span id="cb90-289"><a href="#cb90-289" aria-hidden="true" tabindex="-1"></a>  <span class="co">#         linewidth=0.05,</span></span>
<span id="cb90-290"><a href="#cb90-290" aria-hidden="true" tabindex="-1"></a>  <span class="co">#         alpha=1,</span></span>
<span id="cb90-291"><a href="#cb90-291" aria-hidden="true" tabindex="-1"></a>  <span class="co">#         colour="white")+</span></span>
<span id="cb90-292"><a href="#cb90-292" aria-hidden="true" tabindex="-1"></a>   ggnewscale<span class="sc">::</span><span class="fu">new_scale</span>(<span class="st">"fill"</span>)<span class="sc">+</span></span>
<span id="cb90-293"><a href="#cb90-293" aria-hidden="true" tabindex="-1"></a>    tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> Gafanha_low_pred, </span>
<span id="cb90-294"><a href="#cb90-294" aria-hidden="true" tabindex="-1"></a>                               <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer),</span>
<span id="cb90-295"><a href="#cb90-295" aria-hidden="true" tabindex="-1"></a>                               <span class="at">maxcell =</span> <span class="dv">500832</span><span class="sc">*</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb90-296"><a href="#cb90-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_extent, </span>
<span id="cb90-297"><a href="#cb90-297" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>, </span>
<span id="cb90-298"><a href="#cb90-298" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb90-299"><a href="#cb90-299" aria-hidden="true" tabindex="-1"></a>          <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb90-300"><a href="#cb90-300" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb90-301"><a href="#cb90-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)<span class="sc">+</span></span>
<span id="cb90-302"><a href="#cb90-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(Gafanha_low_pred_map_zoomed), </span>
<span id="cb90-303"><a href="#cb90-303" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.7430</span>,</span>
<span id="cb90-304"><a href="#cb90-304" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmax=</span><span class="sc">-</span><span class="fl">8.7427</span>, </span>
<span id="cb90-305"><a href="#cb90-305" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">40.5977</span>) <span class="sc">+</span></span>
<span id="cb90-306"><a href="#cb90-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(x,y,<span class="at">group=</span>grp),</span>
<span id="cb90-307"><a href="#cb90-307" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.7432439</span>,<span class="sc">-</span><span class="fl">8.743</span>,<span class="sc">-</span><span class="fl">8.7432439</span>,<span class="sc">-</span><span class="fl">8.743</span>),</span>
<span id="cb90-308"><a href="#cb90-308" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y=</span><span class="fu">c</span>(<span class="fl">40.5976275</span>,<span class="fl">40.5979</span>,<span class="fl">40.5975373</span>,<span class="fl">40.59771</span>),</span>
<span id="cb90-309"><a href="#cb90-309" aria-hidden="true" tabindex="-1"></a>                              <span class="at">grp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb90-310"><a href="#cb90-310" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb90-311"><a href="#cb90-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>),</span>
<span id="cb90-312"><a href="#cb90-312" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span><span class="fu">c</span>(<span class="st">"#70543e"</span>, <span class="st">"#b3ff1a"</span>, <span class="st">"#DAA520"</span>, <span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>, <span class="st">"#42c9bc"</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>),</span>
<span id="cb90-313"><a href="#cb90-313" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb90-314"><a href="#cb90-314" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb90-315"><a href="#cb90-315" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>,</span>
<span id="cb90-316"><a href="#cb90-316" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb90-317"><a href="#cb90-317" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb90-318"><a href="#cb90-318" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb90-319"><a href="#cb90-319" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb90-320"><a href="#cb90-320" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb90-321"><a href="#cb90-321" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Water"</span>))<span class="sc">+</span></span>
<span id="cb90-322"><a href="#cb90-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb90-323"><a href="#cb90-323" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_equal()+</span></span>
<span id="cb90-324"><a href="#cb90-324" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">angle =</span> <span class="dv">20</span>,<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb90-325"><a href="#cb90-325" aria-hidden="true" tabindex="-1"></a>         <span class="co"># axis.text.y = element_text(size = 20),</span></span>
<span id="cb90-326"><a href="#cb90-326" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-327"><a href="#cb90-327" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-328"><a href="#cb90-328" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-329"><a href="#cb90-329" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.98</span>,<span class="fl">0.3</span>),</span>
<span id="cb90-330"><a href="#cb90-330" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb90-331"><a href="#cb90-331" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">"cm"</span>))<span class="sc">+</span></span>
<span id="cb90-332"><a href="#cb90-332" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.7437</span>, <span class="sc">-</span><span class="fl">8.74275</span>), <span class="at">breaks =</span> <span class="sc">-</span><span class="fl">8.743</span>)<span class="sc">+</span></span>
<span id="cb90-333"><a href="#cb90-333" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">40.59715</span>, <span class="fl">40.5979</span>), <span class="at">breaks =</span> <span class="fl">40.5975</span>)</span>
<span id="cb90-334"><a href="#cb90-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-335"><a href="#cb90-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-336"><a href="#cb90-336" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/Gaf_Low_Pred.png"</span>,Gafanha_low_pred_map , <span class="at">width =</span> <span class="dv">1920</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">1129</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb90-337"><a href="#cb90-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-338"><a href="#cb90-338" aria-hidden="true" tabindex="-1"></a><span class="do">################# PLOT AND SAVING ###########</span></span>
<span id="cb90-339"><a href="#cb90-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-340"><a href="#cb90-340" aria-hidden="true" tabindex="-1"></a>plot_Gaf_Low<span class="ot">&lt;-</span>rgb_Gafanha_low<span class="sc">+</span></span>
<span id="cb90-341"><a href="#cb90-341" aria-hidden="true" tabindex="-1"></a>  Gafanha_low_pred_map</span>
<span id="cb90-342"><a href="#cb90-342" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb90-343"><a href="#cb90-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-344"><a href="#cb90-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-345"><a href="#cb90-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-346"><a href="#cb90-346" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/Maps Pred/FigX-Gaf_Low_Pred.png"</span>,plot_Gaf_Low , <span class="at">width =</span> <span class="dv">1920</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">1009</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [31]:</pre></div><div id="cell-fig-GafLow" class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"./Figures/Low_res/Maps Pred/FigX-Gaf_Low_Pred.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GafLow" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-GafLow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="./Figures/Low_res/Maps%20Pred/FigX-Gaf_Low_Pred.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure&nbsp;5: RGB orthomosaic (Left) and Prediction (Right) of the low altitude flight of Gafanha, Portugal. The total extent of this flight was 3000 m² with a resolution of 8 mm per pixel. Background colors indicate intertidal area (Light Green) and land area (Light Grey). The zoom covers an area equivalent to a 10-meter Sentinel-2 pixel size."><img src="./Figures/Low_res/Maps%20Pred/FigX-Gaf_Low_Pred.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-GafLow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: RGB orthomosaic (Left) and Prediction (Right) of the low altitude flight of Gafanha, Portugal. The total extent of this flight was 3000 m² with a resolution of 8 mm per pixel. Background colors indicate intertidal area (Light Green) and land area (Light Grey). The zoom covers an area equivalent to a 10-meter Sentinel-2 pixel size.
</figcaption>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [32]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>imglist<span class="ot">&lt;-</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="st">"Data"</span>,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">path =</span> <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">".tif"</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">folder =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Data"</span>) <span class="sc">~</span> <span class="st">"Input"</span>,</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Output"</span>),</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">alt =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"high"</span>) <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">str_detect</span>(path, <span class="st">"High"</span>) <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"low"</span>),</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">site =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Gafanha"</span>) <span class="sc">~</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path,<span class="st">"AveiroHigh"</span>)<span class="sc">~</span><span class="st">"Gafanha"</span>,</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Duer"</span>),</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"pred"</span>) <span class="sc">~</span> <span class="st">"Pred"</span>,</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"NDVI"</span>) <span class="sc">~</span> <span class="st">"NDVI"</span>,</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"ortho"</span>),</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">resampled =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"resampled"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">new =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"no_Xantho"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">str_detect</span>(path, <span class="st">"NewPreds"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"colored"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">correction =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"corrected_per_bands"</span>) <span class="sc">~</span> <span class="st">"Bands"</span>,</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"corrected.tif"</span>) <span class="sc">~</span> <span class="st">"lm_all"</span>,</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(alt <span class="sc">!=</span> <span class="st">"NA"</span>,</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">str_detect</span>(path,<span class="st">".aux.xml"</span>))</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a><span class="do">########## ZOOM #############</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>zoom_extent<span class="ot">&lt;-</span><span class="st">"Data/shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>,<span class="at">recursive =</span> T,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"zoom"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a>mask_low<span class="ot">&lt;-</span><span class="st">"Data/shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>,<span class="at">recursive =</span> T,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"mask_Gafanha_low"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a>Gafanha_low_ortho_zoomed<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a>         alt <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a>         type <span class="sc">==</span> <span class="st">"ortho"</span>,</span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a>         resampled <span class="sc">==</span> <span class="st">"TRUE"</span>,</span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a>         col <span class="sc">==</span> <span class="st">"TRUE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zoom_extent)</span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Gafanha_low_ortho_zoomed)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"B1"</span>, <span class="st">"B3"</span>, <span class="st">"B5"</span>,<span class="st">"alpha"</span>)</span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a> Gafanha_low_pred_zoomed<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a>         alt <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a>         type <span class="sc">==</span> <span class="st">"Pred"</span>,</span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a>         <span class="co"># resampled == "TRUE",</span></span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a>         new <span class="sc">==</span> <span class="st">"TRUE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zoom_extent) <span class="sc">%&gt;%</span> </span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(mask_low, <span class="at">inverse =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.factor</span>()</span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Gafanha_low_pred_zoomed)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a>zoomed_low_map<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> Gafanha_low_ortho_zoomed,</span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">r =</span> <span class="dv">1</span>,</span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">g =</span> <span class="dv">2</span>,</span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">b =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> Gafanha_low_pred_zoomed, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer), <span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>),</span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span><span class="fu">c</span>(<span class="st">"#70543e"</span>, <span class="st">"#b3ff1a"</span>, <span class="st">"#DAA520"</span>, <span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>, <span class="st">"#42c9bc"</span>,<span class="cn">NA</span>,<span class="cn">NA</span>), </span>
<span id="cb92-81"><a href="#cb92-81" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb92-82"><a href="#cb92-82" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">""</span>, </span>
<span id="cb92-83"><a href="#cb92-83" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>, </span>
<span id="cb92-84"><a href="#cb92-84" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Chlorophyceae"</span>, </span>
<span id="cb92-85"><a href="#cb92-85" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb92-86"><a href="#cb92-86" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb92-87"><a href="#cb92-87" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb92-88"><a href="#cb92-88" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb92-89"><a href="#cb92-89" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Water"</span>))<span class="sc">+</span></span>
<span id="cb92-90"><a href="#cb92-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_extent, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"black"</span>,<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb92-91"><a href="#cb92-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb92-92"><a href="#cb92-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb92-93"><a href="#cb92-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-94"><a href="#cb92-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-95"><a href="#cb92-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-96"><a href="#cb92-96" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb92-97"><a href="#cb92-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-98"><a href="#cb92-98" aria-hidden="true" tabindex="-1"></a> Gafanha_low_ortho<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb92-99"><a href="#cb92-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb92-100"><a href="#cb92-100" aria-hidden="true" tabindex="-1"></a>         alt <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb92-101"><a href="#cb92-101" aria-hidden="true" tabindex="-1"></a>         type <span class="sc">==</span> <span class="st">"ortho"</span>,</span>
<span id="cb92-102"><a href="#cb92-102" aria-hidden="true" tabindex="-1"></a>         resampled <span class="sc">==</span> <span class="st">"TRUE"</span>,</span>
<span id="cb92-103"><a href="#cb92-103" aria-hidden="true" tabindex="-1"></a>         col <span class="sc">==</span> <span class="st">"TRUE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-104"><a href="#cb92-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb92-105"><a href="#cb92-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>() </span>
<span id="cb92-106"><a href="#cb92-106" aria-hidden="true" tabindex="-1"></a> <span class="fu">names</span>(Gafanha_low_ortho)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"B1"</span>, <span class="st">"B3"</span>, <span class="st">"B5"</span>,<span class="st">"alpha"</span>)</span>
<span id="cb92-107"><a href="#cb92-107" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(Gafanha_low_ortho)[<span class="fu">values</span>(Gafanha_low_ortho<span class="sc">$</span>alpha) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb92-108"><a href="#cb92-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-109"><a href="#cb92-109" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb92-110"><a href="#cb92-110" aria-hidden="true" tabindex="-1"></a> Gafanha_low_pred<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb92-111"><a href="#cb92-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb92-112"><a href="#cb92-112" aria-hidden="true" tabindex="-1"></a>         alt <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb92-113"><a href="#cb92-113" aria-hidden="true" tabindex="-1"></a>         type <span class="sc">==</span> <span class="st">"Pred"</span>,</span>
<span id="cb92-114"><a href="#cb92-114" aria-hidden="true" tabindex="-1"></a>         <span class="co"># resampled == "TRUE",</span></span>
<span id="cb92-115"><a href="#cb92-115" aria-hidden="true" tabindex="-1"></a>         new <span class="sc">==</span> <span class="st">"TRUE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-116"><a href="#cb92-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb92-117"><a href="#cb92-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb92-118"><a href="#cb92-118" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Gafanha_low_pred)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb92-119"><a href="#cb92-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-120"><a href="#cb92-120" aria-hidden="true" tabindex="-1"></a>Gafanha_low_pred_masked<span class="ot">&lt;-</span>Gafanha_low_pred <span class="sc">%&gt;%</span> </span>
<span id="cb92-121"><a href="#cb92-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># crop(mask_low) %&gt;% </span></span>
<span id="cb92-122"><a href="#cb92-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(mask_low, <span class="at">inverse =</span> T)</span>
<span id="cb92-123"><a href="#cb92-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-124"><a href="#cb92-124" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(Gafanha_low_pred_masked)[<span class="fu">values</span>(Gafanha_low_pred_masked) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb92-125"><a href="#cb92-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-126"><a href="#cb92-126" aria-hidden="true" tabindex="-1"></a>Gafanha_low_pred_masked<span class="ot">&lt;-</span>Gafanha_low_pred_masked <span class="sc">%&gt;%</span> </span>
<span id="cb92-127"><a href="#cb92-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb92-128"><a href="#cb92-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-129"><a href="#cb92-129" aria-hidden="true" tabindex="-1"></a>rgb_Gafanha_low <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb92-130"><a href="#cb92-130" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> Gafanha_low_ortho,</span>
<span id="cb92-131"><a href="#cb92-131" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">r =</span> <span class="dv">1</span>,</span>
<span id="cb92-132"><a href="#cb92-132" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">g =</span> <span class="dv">2</span>,</span>
<span id="cb92-133"><a href="#cb92-133" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">b =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb92-134"><a href="#cb92-134" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> Gafanha_low_pred_masked, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer))<span class="sc">+</span></span>
<span id="cb92-135"><a href="#cb92-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>),</span>
<span id="cb92-136"><a href="#cb92-136" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span><span class="fu">c</span>(<span class="st">"#70543e"</span>, <span class="st">"#b3ff1a"</span>, <span class="st">"#DAA520"</span>, <span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>, <span class="st">"#42c9bc"</span>,<span class="cn">NA</span>,<span class="cn">NA</span>), </span>
<span id="cb92-137"><a href="#cb92-137" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb92-138"><a href="#cb92-138" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">""</span>, </span>
<span id="cb92-139"><a href="#cb92-139" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>, </span>
<span id="cb92-140"><a href="#cb92-140" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Chlorophyceae"</span>, </span>
<span id="cb92-141"><a href="#cb92-141" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb92-142"><a href="#cb92-142" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb92-143"><a href="#cb92-143" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb92-144"><a href="#cb92-144" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb92-145"><a href="#cb92-145" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Water"</span>))<span class="sc">+</span></span>
<span id="cb92-146"><a href="#cb92-146" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"bl"</span>,<span class="at">text_cex=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb92-147"><a href="#cb92-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_extent, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"black"</span>,<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb92-148"><a href="#cb92-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-149"><a href="#cb92-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">8.7434247325</span>, <span class="at">y=</span><span class="fl">40.5977530006</span>, <span class="at">xend =</span> <span class="sc">-</span><span class="fl">8.7430558162</span>, <span class="at">yend =</span> <span class="fl">40.5972152706</span>), <span class="at">linetype =</span><span class="st">"dashed"</span> ,<span class="at">linewidth=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb92-150"><a href="#cb92-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(zoomed_low_map), <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.743725</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">8.7434057328</span>, <span class="at">ymin =</span> <span class="fl">40.5977200450</span>, <span class="at">ymax =</span> <span class="fl">40.59798</span>) <span class="sc">+</span></span>
<span id="cb92-151"><a href="#cb92-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(x,y,<span class="at">group=</span>grp),</span>
<span id="cb92-152"><a href="#cb92-152" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.74336194</span>,<span class="sc">-</span><span class="fl">8.74371</span>,<span class="sc">-</span><span class="fl">8.743243794</span>,<span class="sc">-</span><span class="fl">8.7434057328</span>), <span class="at">y=</span><span class="fu">c</span>(<span class="fl">40.59762751</span>,<span class="fl">40.5977400850</span>,<span class="fl">40.59762725</span>,<span class="fl">40.5977200450</span>),<span class="at">grp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb92-153"><a href="#cb92-153" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb92-154"><a href="#cb92-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb92-155"><a href="#cb92-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)<span class="sc">+</span></span>
<span id="cb92-156"><a href="#cb92-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb92-157"><a href="#cb92-157" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb92-158"><a href="#cb92-158" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">angle =</span> <span class="dv">20</span>,<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb92-159"><a href="#cb92-159" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.3</span>))<span class="sc">+</span></span>
<span id="cb92-160"><a href="#cb92-160" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ggtitle("a ")+</span></span>
<span id="cb92-161"><a href="#cb92-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="fl">8.7437</span>, <span class="sc">-</span><span class="fl">8.7430</span>, <span class="fl">0.0002</span>))</span>
<span id="cb92-162"><a href="#cb92-162" aria-hidden="true" tabindex="-1"></a>rgb_Gafanha_low</span>
<span id="cb92-163"><a href="#cb92-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-164"><a href="#cb92-164" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/Gaf_Low_RGB_Pred_V2.png"</span>,rgb_Gafanha_low , <span class="at">width =</span> <span class="dv">890</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">1120</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<p>The high-altitude flight over Gafanha covered a total area of ~1 km² (<a href="#fig-GafHigh" class="quarto-xref">Figure&nbsp;6</a>). A channel contouring a small island was masked in the prediction map. Most of vegetation area was classified as seagrass by the model, including patches with discolored leaves. Only a few pixels were classified as green algae (F1 score of 0.55). Patches of Rhodophyceae were correctly classified (F1 score of 0.85). In the northern part of the site and near the land eadges, patches of the schorre angiosperm <em>Sporobolus maritimus</em> (syn. <em>Spartina maritima)</em> were misclassified, either as seagrass or as brown algae (F1 score of 0.77 and 0.71, respectively).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [33]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>imglist<span class="ot">&lt;-</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">path =</span> <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">".tif"</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">folder =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Data"</span>) <span class="sc">~</span> <span class="st">"Input"</span>,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Output"</span>),</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">alt =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"high"</span>) <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">str_detect</span>(path, <span class="st">"High"</span>) <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"low"</span>),</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">site =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Gafanha"</span>) <span class="sc">~</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"AveiroHigh"</span>) <span class="sc">~</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Duer"</span>),</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"pred"</span>) <span class="sc">~</span> <span class="st">"Pred"</span>,</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"Preds"</span>) <span class="sc">~</span> <span class="st">"Pred"</span>,</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"NDVI"</span>) <span class="sc">~</span> <span class="st">"NDVI"</span>,</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"ortho"</span>),</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">resampled =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"resampled"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">new =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"no_Xantho"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">str_detect</span>(path, <span class="st">"NewPreds"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"colored"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">correction =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"corrected_per_bands"</span>) <span class="sc">~</span> <span class="st">"Bands"</span>,</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"corrected.tif"</span>) <span class="sc">~</span> <span class="st">"lm_all"</span>,</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(alt <span class="sc">!=</span> <span class="st">"NA"</span>,</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">str_detect</span>(path,<span class="st">".aux.xml"</span>))</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a><span class="do">#### Preview ####</span></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>filelist<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="st">"Data/shp/"</span>, <span class="at">pattern =</span> <span class="st">".shp"</span>, <span class="at">recursive =</span> T,<span class="at">full.names =</span> T)</span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>mask_aveiro <span class="ot">&lt;-</span> filelist[<span class="fu">str_detect</span>(filelist,<span class="st">"mask_land_intertidal_Aveiro"</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>Flight_aveiro<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name=</span><span class="fu">c</span>(</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gafanha"</span></span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>  ) ,</span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(<span class="st">"12m and 120m Flights"</span>),</span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">Long=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.742485</span>) ,</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lat=</span><span class="fu">c</span>(<span class="fl">40.597599</span>) </span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Long"</span>,<span class="st">"Lat"</span>) )  <span class="sc">%&gt;%</span> </span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">"EPSG:4326"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">crs</span>(mask_aveiro))  <span class="sc">%&gt;%</span> </span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lon =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">1</span>],</span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a>p1_background<span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Data/shp/Aveiro/Background_p1_aveiro.shp"</span>)</span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb93-52"><a href="#cb93-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>),</span>
<span id="cb93-53"><a href="#cb93-53" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#BDBDBD"</span>))<span class="sc">+</span></span>
<span id="cb93-54"><a href="#cb93-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> p1_background, <span class="at">fill =</span> <span class="st">"white"</span>,<span class="at">show.legend =</span> F, <span class="at">linewidth=</span><span class="fl">0.05</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,<span class="at">colour=</span><span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb93-55"><a href="#cb93-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mask_aveiro, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),<span class="at">show.legend =</span> F, <span class="at">linewidth=</span><span class="fl">0.05</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,<span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb93-56"><a href="#cb93-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">519749</span>,<span class="dv">535233</span>) ,</span>
<span id="cb93-57"><a href="#cb93-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">4493310</span>,<span class="dv">4508794</span>) )<span class="sc">+</span></span>
<span id="cb93-58"><a href="#cb93-58" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>Flight_aveiro,</span>
<span id="cb93-59"><a href="#cb93-59" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x=</span>lon,</span>
<span id="cb93-60"><a href="#cb93-60" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>lat,</span>
<span id="cb93-61"><a href="#cb93-61" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> Name,</span>
<span id="cb93-62"><a href="#cb93-62" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> Name),</span>
<span id="cb93-63"><a href="#cb93-63" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># description=Description),</span></span>
<span id="cb93-64"><a href="#cb93-64" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size=</span><span class="fl">0.3</span>,</span>
<span id="cb93-65"><a href="#cb93-65" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb93-66"><a href="#cb93-66" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb93-67"><a href="#cb93-67" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend=</span>F,</span>
<span id="cb93-68"><a href="#cb93-68" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fontsize =</span> <span class="dv">20</span>,</span>
<span id="cb93-69"><a href="#cb93-69" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb93-70"><a href="#cb93-70" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.size =</span> <span class="dv">2</span>,</span>
<span id="cb93-71"><a href="#cb93-71" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb93-72"><a href="#cb93-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">expand =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb93-73"><a href="#cb93-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">radius =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb93-74"><a href="#cb93-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.fill =</span> <span class="st">"grey90"</span>,</span>
<span id="cb93-75"><a href="#cb93-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"mm"</span>)) <span class="sc">+</span></span>
<span id="cb93-76"><a href="#cb93-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># theme_void()+</span></span>
<span id="cb93-77"><a href="#cb93-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb93-78"><a href="#cb93-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Longitude"</span>,</span>
<span id="cb93-79"><a href="#cb93-79" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Latitude"</span>)<span class="sc">+</span></span>
<span id="cb93-80"><a href="#cb93-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_label(aes(x = 521000, y = 4507794, label = "C"), size = 20)+</span></span>
<span id="cb93-81"><a href="#cb93-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">8.75</span>, <span class="sc">-</span><span class="fl">8.6</span>, <span class="at">by =</span> <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb93-82"><a href="#cb93-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>), <span class="st">"cm"</span>) ,</span>
<span id="cb93-83"><a href="#cb93-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb93-84"><a href="#cb93-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb93-85"><a href="#cb93-85" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb93-86"><a href="#cb93-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb93-87"><a href="#cb93-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb93-88"><a href="#cb93-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-89"><a href="#cb93-89" aria-hidden="true" tabindex="-1"></a><span class="do">#####</span></span>
<span id="cb93-90"><a href="#cb93-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-91"><a href="#cb93-91" aria-hidden="true" tabindex="-1"></a>land_mask_GafHigh<span class="ot">&lt;-</span><span class="st">"Data/shp/Aveiro"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb93-92"><a href="#cb93-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb93-93"><a href="#cb93-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb93-94"><a href="#cb93-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-95"><a href="#cb93-95" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">"mask_Gafanha_high1"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-96"><a href="#cb93-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb93-97"><a href="#cb93-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb93-98"><a href="#cb93-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-99"><a href="#cb93-99" aria-hidden="true" tabindex="-1"></a>background_GafHigh<span class="ot">&lt;-</span><span class="st">"Data/shp/Aveiro"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb93-100"><a href="#cb93-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb93-101"><a href="#cb93-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb93-102"><a href="#cb93-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-103"><a href="#cb93-103" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">"background_Gafanha_high"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-104"><a href="#cb93-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb93-105"><a href="#cb93-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb93-106"><a href="#cb93-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-107"><a href="#cb93-107" aria-hidden="true" tabindex="-1"></a>GafHigh_ortho<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb93-108"><a href="#cb93-108" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb93-109"><a href="#cb93-109" aria-hidden="true" tabindex="-1"></a>                type <span class="sc">==</span> <span class="st">"ortho"</span>,</span>
<span id="cb93-110"><a href="#cb93-110" aria-hidden="true" tabindex="-1"></a>                alt<span class="sc">==</span><span class="st">"high"</span>,</span>
<span id="cb93-111"><a href="#cb93-111" aria-hidden="true" tabindex="-1"></a>                col <span class="sc">==</span> <span class="st">"TRUE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-112"><a href="#cb93-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb93-113"><a href="#cb93-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb93-114"><a href="#cb93-114" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(GafHigh_ortho)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"B1"</span>,<span class="st">"B3"</span>, <span class="st">"B5"</span>, <span class="st">"alpha"</span>)</span>
<span id="cb93-115"><a href="#cb93-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-116"><a href="#cb93-116" aria-hidden="true" tabindex="-1"></a><span class="co"># values(GafHigh_ortho)[values(GafHigh_ortho$B1) == 0] = NA</span></span>
<span id="cb93-117"><a href="#cb93-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-118"><a href="#cb93-118" aria-hidden="true" tabindex="-1"></a>GafHigh_ortho_masked<span class="ot">&lt;-</span>GafHigh_ortho <span class="sc">%&gt;%</span> </span>
<span id="cb93-119"><a href="#cb93-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(land_mask_GafHigh, <span class="at">inverse =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb93-120"><a href="#cb93-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(land_mask_GafHigh)</span>
<span id="cb93-121"><a href="#cb93-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-122"><a href="#cb93-122" aria-hidden="true" tabindex="-1"></a>GafHigh_ortho_masked<span class="ot">&lt;-</span><span class="fu">na.omit</span>(GafHigh_ortho_masked, <span class="at">field=</span><span class="cn">NA</span>, <span class="at">geom=</span><span class="cn">FALSE</span>)</span>
<span id="cb93-123"><a href="#cb93-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-124"><a href="#cb93-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-125"><a href="#cb93-125" aria-hidden="true" tabindex="-1"></a><span class="do">###### RGB ########</span></span>
<span id="cb93-126"><a href="#cb93-126" aria-hidden="true" tabindex="-1"></a>zoom_gaf_high_sf<span class="ot">&lt;-</span><span class="st">"Data/shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb93-127"><a href="#cb93-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>,<span class="at">recursive =</span> T,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb93-128"><a href="#cb93-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb93-129"><a href="#cb93-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-130"><a href="#cb93-130" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"zoom_extent_map_Gafanha_High_comparison"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-131"><a href="#cb93-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb93-132"><a href="#cb93-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb93-133"><a href="#cb93-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-134"><a href="#cb93-134" aria-hidden="true" tabindex="-1"></a>Gaflow_extent<span class="ot">&lt;-</span><span class="st">"Data/shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb93-135"><a href="#cb93-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>,<span class="at">recursive =</span> T,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb93-136"><a href="#cb93-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb93-137"><a href="#cb93-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-138"><a href="#cb93-138" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"GafLow_extent.shp"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-139"><a href="#cb93-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb93-140"><a href="#cb93-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb93-141"><a href="#cb93-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-142"><a href="#cb93-142" aria-hidden="true" tabindex="-1"></a>rgb_Gafanha_High_zoomed<span class="ot">&lt;-</span>GafHigh_ortho_masked <span class="sc">%&gt;%</span> </span>
<span id="cb93-143"><a href="#cb93-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zoom_gaf_high_sf)</span>
<span id="cb93-144"><a href="#cb93-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-145"><a href="#cb93-145" aria-hidden="true" tabindex="-1"></a>rgb_Gafanha_High_zoomed<span class="ot">&lt;-</span></span>
<span id="cb93-146"><a href="#cb93-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb93-147"><a href="#cb93-147" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> rgb_Gafanha_High_zoomed,</span>
<span id="cb93-148"><a href="#cb93-148" aria-hidden="true" tabindex="-1"></a>         <span class="at">r =</span> <span class="dv">1</span>,</span>
<span id="cb93-149"><a href="#cb93-149" aria-hidden="true" tabindex="-1"></a>         <span class="at">g =</span> <span class="dv">2</span>,</span>
<span id="cb93-150"><a href="#cb93-150" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb93-151"><a href="#cb93-151" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_gaf_high_sf, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"black"</span>,<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb93-152"><a href="#cb93-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb93-153"><a href="#cb93-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-154"><a href="#cb93-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-155"><a href="#cb93-155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-156"><a href="#cb93-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-157"><a href="#cb93-157" aria-hidden="true" tabindex="-1"></a>rgb_Gafanha_High <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb93-158"><a href="#cb93-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>,  </span>
<span id="cb93-159"><a href="#cb93-159" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>, <span class="st">"water"</span>),</span>
<span id="cb93-160"><a href="#cb93-160" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#CFCFCF"</span>,<span class="st">"#42c9bc"</span>))<span class="sc">+</span></span>
<span id="cb93-161"><a href="#cb93-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_GafHigh,</span>
<span id="cb93-162"><a href="#cb93-162" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),</span>
<span id="cb93-163"><a href="#cb93-163" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F, </span>
<span id="cb93-164"><a href="#cb93-164" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb93-165"><a href="#cb93-165" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.93</span>,</span>
<span id="cb93-166"><a href="#cb93-166" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb93-167"><a href="#cb93-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_GafHigh,</span>
<span id="cb93-168"><a href="#cb93-168" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb93-169"><a href="#cb93-169" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F,</span>
<span id="cb93-170"><a href="#cb93-170" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb93-171"><a href="#cb93-171" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.4</span>,</span>
<span id="cb93-172"><a href="#cb93-172" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb93-173"><a href="#cb93-173" aria-hidden="true" tabindex="-1"></a>   tidyterra<span class="sc">::</span><span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> GafHigh_ortho_masked,</span>
<span id="cb93-174"><a href="#cb93-174" aria-hidden="true" tabindex="-1"></a>         <span class="at">r =</span> <span class="dv">1</span>,</span>
<span id="cb93-175"><a href="#cb93-175" aria-hidden="true" tabindex="-1"></a>         <span class="at">g =</span> <span class="dv">2</span>,</span>
<span id="cb93-176"><a href="#cb93-176" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> <span class="dv">3</span>,</span>
<span id="cb93-177"><a href="#cb93-177" aria-hidden="true" tabindex="-1"></a>         <span class="at">maxcell =</span> <span class="dv">5007120</span>)<span class="sc">+</span></span>
<span id="cb93-178"><a href="#cb93-178" aria-hidden="true" tabindex="-1"></a>    ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"bl"</span>,</span>
<span id="cb93-179"><a href="#cb93-179" aria-hidden="true" tabindex="-1"></a>                                <span class="at">text_cex=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb93-180"><a href="#cb93-180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(p1), </span>
<span id="cb93-181"><a href="#cb93-181" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.744</span>, </span>
<span id="cb93-182"><a href="#cb93-182" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">8.7412</span>,</span>
<span id="cb93-183"><a href="#cb93-183" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> <span class="fl">40.5923</span>,</span>
<span id="cb93-184"><a href="#cb93-184" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> <span class="fl">40.595</span>) <span class="sc">+</span></span>
<span id="cb93-185"><a href="#cb93-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_gaf_high_sf,</span>
<span id="cb93-186"><a href="#cb93-186" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"transparent"</span>, </span>
<span id="cb93-187"><a href="#cb93-187" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb93-188"><a href="#cb93-188" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb93-189"><a href="#cb93-189" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb93-190"><a href="#cb93-190" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> Gaflow_extent,</span>
<span id="cb93-191"><a href="#cb93-191" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"transparent"</span>, </span>
<span id="cb93-192"><a href="#cb93-192" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb93-193"><a href="#cb93-193" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb93-194"><a href="#cb93-194" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb93-195"><a href="#cb93-195" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="fu">aes</span>(x,y,<span class="at">group=</span>grp),</span>
<span id="cb93-196"><a href="#cb93-196" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.74363778</span>,<span class="sc">-</span><span class="fl">8.74757</span>,<span class="sc">-</span><span class="fl">8.74351982</span>,<span class="sc">-</span><span class="fl">8.7453</span>), </span>
<span id="cb93-197"><a href="#cb93-197" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y=</span><span class="fu">c</span>(<span class="fl">40.5983781677</span>,<span class="fl">40.5995</span>,<span class="fl">40.598377893</span>,<span class="fl">40.5995</span>),</span>
<span id="cb93-198"><a href="#cb93-198" aria-hidden="true" tabindex="-1"></a>                              <span class="at">grp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb93-199"><a href="#cb93-199" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb93-200"><a href="#cb93-200" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb93-201"><a href="#cb93-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(rgb_Gafanha_High_zoomed),</span>
<span id="cb93-202"><a href="#cb93-202" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.7479</span>, </span>
<span id="cb93-203"><a href="#cb93-203" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">8.7452</span>, </span>
<span id="cb93-204"><a href="#cb93-204" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">40.5979</span>,</span>
<span id="cb93-205"><a href="#cb93-205" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> <span class="fl">40.603</span>) <span class="sc">+</span></span>
<span id="cb93-206"><a href="#cb93-206" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb93-207"><a href="#cb93-207" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)<span class="sc">+</span></span>
<span id="cb93-208"><a href="#cb93-208" aria-hidden="true" tabindex="-1"></a>   <span class="co"># xlim(c(-8.748, -8.741))+</span></span>
<span id="cb93-209"><a href="#cb93-209" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ylim(c(40.593,40.601))+</span></span>
<span id="cb93-210"><a href="#cb93-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb93-211"><a href="#cb93-211" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">angle =</span> <span class="dv">20</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb93-212"><a href="#cb93-212" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb93-213"><a href="#cb93-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.747576</span>, <span class="sc">-</span><span class="fl">8.741465</span>),<span class="at">breaks =</span>  <span class="sc">-</span><span class="fl">8.745</span>)<span class="sc">+</span></span>
<span id="cb93-214"><a href="#cb93-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">40.59297</span>,<span class="fl">40.60109</span>),<span class="at">breaks =</span>  <span class="fl">40.595</span>)</span>
<span id="cb93-215"><a href="#cb93-215" aria-hidden="true" tabindex="-1"></a><span class="co"># rgb_Gafanha_High</span></span>
<span id="cb93-216"><a href="#cb93-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-217"><a href="#cb93-217" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/Gaf_High_RGB.png"</span>,rgb_Gafanha_High , <span class="at">width =</span> <span class="dv">712</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">1120</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb93-218"><a href="#cb93-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-219"><a href="#cb93-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-220"><a href="#cb93-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-221"><a href="#cb93-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-222"><a href="#cb93-222" aria-hidden="true" tabindex="-1"></a><span class="do">######### Pred #######</span></span>
<span id="cb93-223"><a href="#cb93-223" aria-hidden="true" tabindex="-1"></a>Gafanha_high_pred<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb93-224"><a href="#cb93-224" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(site <span class="sc">==</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb93-225"><a href="#cb93-225" aria-hidden="true" tabindex="-1"></a>       alt <span class="sc">==</span> <span class="st">"high"</span>,</span>
<span id="cb93-226"><a href="#cb93-226" aria-hidden="true" tabindex="-1"></a>       type <span class="sc">==</span> <span class="st">"Pred"</span>,</span>
<span id="cb93-227"><a href="#cb93-227" aria-hidden="true" tabindex="-1"></a>       new <span class="sc">==</span> <span class="st">"TRUE"</span>,</span>
<span id="cb93-228"><a href="#cb93-228" aria-hidden="true" tabindex="-1"></a>       <span class="sc">!</span><span class="fu">str_detect</span>(path, <span class="st">"Probs"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-229"><a href="#cb93-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb93-230"><a href="#cb93-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb93-231"><a href="#cb93-231" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Gafanha_high_pred)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb93-232"><a href="#cb93-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-233"><a href="#cb93-233" aria-hidden="true" tabindex="-1"></a>GafHigh_pred_masked<span class="ot">&lt;-</span>Gafanha_high_pred <span class="sc">%&gt;%</span> </span>
<span id="cb93-234"><a href="#cb93-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(land_mask_GafHigh, <span class="at">inverse =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb93-235"><a href="#cb93-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(land_mask_GafHigh)</span>
<span id="cb93-236"><a href="#cb93-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-237"><a href="#cb93-237" aria-hidden="true" tabindex="-1"></a>GafHigh_pred_masked<span class="ot">&lt;-</span><span class="fu">na.omit</span>(GafHigh_pred_masked, <span class="at">field=</span><span class="cn">NA</span>, <span class="at">geom=</span><span class="cn">FALSE</span>) </span>
<span id="cb93-238"><a href="#cb93-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-239"><a href="#cb93-239" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(GafHigh_pred_masked)[<span class="fu">values</span>(GafHigh_pred_masked) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb93-240"><a href="#cb93-240" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(GafHigh_pred_masked)[<span class="fu">values</span>(GafHigh_pred_masked) <span class="sc">==</span> <span class="dv">3</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb93-241"><a href="#cb93-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-242"><a href="#cb93-242" aria-hidden="true" tabindex="-1"></a>GafHigh_pred_masked<span class="ot">&lt;-</span>GafHigh_pred_masked <span class="sc">%&gt;%</span> </span>
<span id="cb93-243"><a href="#cb93-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb93-244"><a href="#cb93-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-245"><a href="#cb93-245" aria-hidden="true" tabindex="-1"></a>Gafanha_High_zoomed_pred<span class="ot">&lt;-</span>GafHigh_pred_masked <span class="sc">%&gt;%</span> </span>
<span id="cb93-246"><a href="#cb93-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zoom_gaf_high_sf)</span>
<span id="cb93-247"><a href="#cb93-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-248"><a href="#cb93-248" aria-hidden="true" tabindex="-1"></a>Gafanha_High_zoomed_pred<span class="ot">&lt;-</span></span>
<span id="cb93-249"><a href="#cb93-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb93-250"><a href="#cb93-250" aria-hidden="true" tabindex="-1"></a>   tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> Gafanha_High_zoomed_pred, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer),</span>
<span id="cb93-251"><a href="#cb93-251" aria-hidden="true" tabindex="-1"></a>                            <span class="at">show.legend =</span> F,</span>
<span id="cb93-252"><a href="#cb93-252" aria-hidden="true" tabindex="-1"></a>                             <span class="at">maxcell =</span> <span class="dv">5007120</span>)<span class="sc">+</span></span>
<span id="cb93-253"><a href="#cb93-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>),</span>
<span id="cb93-254"><a href="#cb93-254" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span><span class="fu">c</span>(<span class="st">"#70543e"</span>, <span class="st">"#b3ff1a"</span>, <span class="st">"#DAA520"</span>, <span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>, <span class="st">"#42c9bc"</span>,<span class="cn">NA</span>,<span class="cn">NA</span>),</span>
<span id="cb93-255"><a href="#cb93-255" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb93-256"><a href="#cb93-256" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb93-257"><a href="#cb93-257" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>,</span>
<span id="cb93-258"><a href="#cb93-258" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb93-259"><a href="#cb93-259" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb93-260"><a href="#cb93-260" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb93-261"><a href="#cb93-261" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb93-262"><a href="#cb93-262" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb93-263"><a href="#cb93-263" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Water"</span>))<span class="sc">+</span></span>
<span id="cb93-264"><a href="#cb93-264" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_gaf_high_sf, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="st">"black"</span>,<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb93-265"><a href="#cb93-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb93-266"><a href="#cb93-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-267"><a href="#cb93-267" aria-hidden="true" tabindex="-1"></a>Gafanha_high_pred_map<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb93-268"><a href="#cb93-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_GafHigh, </span>
<span id="cb93-269"><a href="#cb93-269" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),</span>
<span id="cb93-270"><a href="#cb93-270" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F,</span>
<span id="cb93-271"><a href="#cb93-271" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb93-272"><a href="#cb93-272" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.93</span>,</span>
<span id="cb93-273"><a href="#cb93-273" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb93-274"><a href="#cb93-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_GafHigh,</span>
<span id="cb93-275"><a href="#cb93-275" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb93-276"><a href="#cb93-276" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F,</span>
<span id="cb93-277"><a href="#cb93-277" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb93-278"><a href="#cb93-278" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.4</span>,</span>
<span id="cb93-279"><a href="#cb93-279" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb93-280"><a href="#cb93-280" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="st">""</span>, </span>
<span id="cb93-281"><a href="#cb93-281" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>, <span class="st">"water"</span>),</span>
<span id="cb93-282"><a href="#cb93-282" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#CFCFCF"</span>,<span class="st">"#42c9bc"</span>))<span class="sc">+</span></span>
<span id="cb93-283"><a href="#cb93-283" aria-hidden="true" tabindex="-1"></a>  ggnewscale<span class="sc">::</span><span class="fu">new_scale</span>(<span class="st">"fill"</span>)<span class="sc">+</span></span>
<span id="cb93-284"><a href="#cb93-284" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> GafHigh_pred_masked, </span>
<span id="cb93-285"><a href="#cb93-285" aria-hidden="true" tabindex="-1"></a>                             <span class="co"># show.legend = F,</span></span>
<span id="cb93-286"><a href="#cb93-286" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer),</span>
<span id="cb93-287"><a href="#cb93-287" aria-hidden="true" tabindex="-1"></a>                             <span class="at">maxcell =</span> <span class="dv">5010420</span>)<span class="sc">+</span></span>
<span id="cb93-288"><a href="#cb93-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>),</span>
<span id="cb93-289"><a href="#cb93-289" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span><span class="fu">c</span>(<span class="st">"#70543e"</span>, <span class="st">"#b3ff1a"</span>, <span class="st">"#DAA520"</span>, <span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>, <span class="st">"#42c9bc"</span>,<span class="cn">NA</span>,<span class="cn">NA</span>),</span>
<span id="cb93-290"><a href="#cb93-290" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb93-291"><a href="#cb93-291" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb93-292"><a href="#cb93-292" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>,</span>
<span id="cb93-293"><a href="#cb93-293" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb93-294"><a href="#cb93-294" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb93-295"><a href="#cb93-295" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb93-296"><a href="#cb93-296" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb93-297"><a href="#cb93-297" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb93-298"><a href="#cb93-298" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Water"</span>))<span class="sc">+</span></span>
<span id="cb93-299"><a href="#cb93-299" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_gaf_high_sf, </span>
<span id="cb93-300"><a href="#cb93-300" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"transparent"</span>, </span>
<span id="cb93-301"><a href="#cb93-301" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb93-302"><a href="#cb93-302" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb93-303"><a href="#cb93-303" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb93-304"><a href="#cb93-304" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> Gaflow_extent,</span>
<span id="cb93-305"><a href="#cb93-305" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"transparent"</span>, </span>
<span id="cb93-306"><a href="#cb93-306" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb93-307"><a href="#cb93-307" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb93-308"><a href="#cb93-308" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb93-309"><a href="#cb93-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(x,y,<span class="at">group=</span>grp),</span>
<span id="cb93-310"><a href="#cb93-310" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.74363778</span>,<span class="sc">-</span><span class="fl">8.74757</span>,<span class="sc">-</span><span class="fl">8.74351982</span>,<span class="sc">-</span><span class="fl">8.7453</span>), </span>
<span id="cb93-311"><a href="#cb93-311" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y=</span><span class="fu">c</span>(<span class="fl">40.5983781677</span>,<span class="fl">40.5995</span>,<span class="fl">40.598377893</span>,<span class="fl">40.5995</span>),</span>
<span id="cb93-312"><a href="#cb93-312" aria-hidden="true" tabindex="-1"></a>                              <span class="at">grp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb93-313"><a href="#cb93-313" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb93-314"><a href="#cb93-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(Gafanha_High_zoomed_pred), </span>
<span id="cb93-315"><a href="#cb93-315" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.7479</span>, </span>
<span id="cb93-316"><a href="#cb93-316" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">8.7452</span>, </span>
<span id="cb93-317"><a href="#cb93-317" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">40.5979</span>,</span>
<span id="cb93-318"><a href="#cb93-318" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> <span class="fl">40.603</span>) <span class="sc">+</span></span>
<span id="cb93-319"><a href="#cb93-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)<span class="sc">+</span></span>
<span id="cb93-320"><a href="#cb93-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb93-321"><a href="#cb93-321" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">angle =</span> <span class="dv">20</span>,<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb93-322"><a href="#cb93-322" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb93-323"><a href="#cb93-323" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.text.y = element_text(size = 20),</span></span>
<span id="cb93-324"><a href="#cb93-324" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb93-325"><a href="#cb93-325" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb93-326"><a href="#cb93-326" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.96</span>,<span class="fl">0.23</span>),</span>
<span id="cb93-327"><a href="#cb93-327" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">23</span>),</span>
<span id="cb93-328"><a href="#cb93-328" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">1.2</span>,<span class="st">"cm"</span>))<span class="sc">+</span></span>
<span id="cb93-329"><a href="#cb93-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.747576</span>, <span class="sc">-</span><span class="fl">8.741465</span>),<span class="at">breaks =</span>  <span class="sc">-</span><span class="fl">8.745</span>)<span class="sc">+</span></span>
<span id="cb93-330"><a href="#cb93-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">40.59297</span>,<span class="fl">40.60109</span>),<span class="at">breaks =</span>  <span class="fl">40.595</span>)</span>
<span id="cb93-331"><a href="#cb93-331" aria-hidden="true" tabindex="-1"></a><span class="co"># Gafanha_high_pred_map</span></span>
<span id="cb93-332"><a href="#cb93-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-333"><a href="#cb93-333" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/Gaf_High_Pred.png"</span>,Gafanha_high_pred_map , <span class="at">width =</span> <span class="dv">712</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">1120</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb93-334"><a href="#cb93-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-335"><a href="#cb93-335" aria-hidden="true" tabindex="-1"></a><span class="do">################# PLOT AND SAVING ###########</span></span>
<span id="cb93-336"><a href="#cb93-336" aria-hidden="true" tabindex="-1"></a>plot_GafHigh<span class="ot">&lt;-</span>rgb_Gafanha_High<span class="sc">+</span></span>
<span id="cb93-337"><a href="#cb93-337" aria-hidden="true" tabindex="-1"></a>  Gafanha_high_pred_map</span>
<span id="cb93-338"><a href="#cb93-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-339"><a href="#cb93-339" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/Maps Pred/FigX-Gaf_High_Pred.png"</span>,plot_GafHigh , <span class="at">width =</span> <span class="dv">2105</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">1363</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb93-340"><a href="#cb93-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-341"><a href="#cb93-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-342"><a href="#cb93-342" aria-hidden="true" tabindex="-1"></a><span class="do">#########</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [34]:</pre></div><div id="cell-fig-GafHigh" class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"./Figures/Low_res/Maps Pred/FigX-Gaf_High_Pred1.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-GafHigh" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-GafHigh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="./Figures/Low_res/Maps%20Pred/FigX-Gaf_High_Pred1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure&nbsp;6: RGB orthomosaic (Left) and Prediction (Right) of the high altitude flight of Gafanha, Portugal. The total extent of this flight was about 1 km² with a resolution of 80 mm per pixel. Background colors indicate intertidal area (Light Green), land area (Light Grey) and water (Light Blue). The yellow outline shows the extent of the low altitude flight of Gafanha presented in Figure&nbsp;5. The zoom covers an area equivalent to a 10-meter Sentinel-2 pixel size."><img src="./Figures/Low_res/Maps%20Pred/FigX-Gaf_High_Pred1.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-GafHigh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: RGB orthomosaic (Left) and Prediction (Right) of the high altitude flight of Gafanha, Portugal. The total extent of this flight was about 1 km² with a resolution of 80 mm per pixel. Background colors indicate intertidal area (Light Green), land area (Light Grey) and water (Light Blue). The yellow outline shows the extent of the low altitude flight of Gafanha presented in <a href="#fig-GafLow" class="quarto-xref">Figure&nbsp;5</a>. The zoom covers an area equivalent to a 10-meter Sentinel-2 pixel size.
</figcaption>
</figure>
</div>
</div>
</div></div>
<p>Among the high altitude flights, the one acquired over the inner part of Ria de Aveiro coastal lagoon covered the largest area with approximately 1.5 km² (<a href="#fig-Boat" class="quarto-xref">Figure&nbsp;7</a>). Teh vegetation present at the site was dominated by seagrass and red macroalgae. The classification provided consistent results, with a patchy seagrass meadow mixed with red macroalgae on the eastern part of the site. As shown in the zoom (<a href="#fig-Boat" class="quarto-xref">Figure&nbsp;7</a>), the edges of the meadow were mixed with green macroalgae (<em>Ulva sp.</em>), which the model agreed with (F1 score of 0.89 for green algae, 0.97 for seagrass and 0.98 for red algae).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [35]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>imglist<span class="ot">&lt;-</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">path =</span> <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">".tif"</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">folder =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Data"</span>) <span class="sc">~</span> <span class="st">"Input"</span>,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Output"</span>),</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">alt =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"high"</span>) <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">str_detect</span>(path, <span class="st">"High"</span>) <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"low"</span>),</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">site =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Gafanha"</span>) <span class="sc">~</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"AveiroHigh"</span>) <span class="sc">~</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Duer"</span>),</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"pred"</span>) <span class="sc">~</span> <span class="st">"Pred"</span>,</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"Preds"</span>) <span class="sc">~</span> <span class="st">"Pred"</span>,</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"NDVI"</span>) <span class="sc">~</span> <span class="st">"NDVI"</span>,</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"ortho"</span>),</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">resampled =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"resampled"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">new =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"no_Xantho"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">str_detect</span>(path, <span class="st">"NewPreds"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"colored"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">correction =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"corrected_per_bands"</span>) <span class="sc">~</span> <span class="st">"Bands"</span>,</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"corrected.tif"</span>) <span class="sc">~</span> <span class="st">"lm_all"</span>,</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(alt <span class="sc">!=</span> <span class="st">"NA"</span>,</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">str_detect</span>(path,<span class="st">".aux.xml"</span>))</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a><span class="do">########### PREVIEW #############</span></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>filelist<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="st">"Data/shp/"</span>, <span class="at">pattern =</span> <span class="st">".shp"</span>, <span class="at">recursive =</span> T,<span class="at">full.names =</span> T)</span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>mask_aveiro <span class="ot">&lt;-</span> filelist[<span class="fu">str_detect</span>(filelist,<span class="st">"mask_land_intertidal_Aveiro"</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>Flight_aveiro<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name=</span><span class="fu">c</span>(</span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Marinha Lanzarote"</span></span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a>  ) ,</span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(</span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"120m Flight"</span>),</span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">Long=</span><span class="fu">c</span>( </span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fl">8.690677</span>) ,</span>
<span id="cb95-40"><a href="#cb95-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lat=</span><span class="fu">c</span>(</span>
<span id="cb95-41"><a href="#cb95-41" aria-hidden="true" tabindex="-1"></a>        <span class="fl">40.665120</span>) </span>
<span id="cb95-42"><a href="#cb95-42" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb95-43"><a href="#cb95-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Long"</span>,<span class="st">"Lat"</span>) )  <span class="sc">%&gt;%</span> </span>
<span id="cb95-44"><a href="#cb95-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">"EPSG:4326"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb95-45"><a href="#cb95-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">crs</span>(mask_aveiro))  <span class="sc">%&gt;%</span> </span>
<span id="cb95-46"><a href="#cb95-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lon =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">1</span>],</span>
<span id="cb95-47"><a href="#cb95-47" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb95-48"><a href="#cb95-48" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb95-49"><a href="#cb95-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-50"><a href="#cb95-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-51"><a href="#cb95-51" aria-hidden="true" tabindex="-1"></a>p1_background<span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Data/shp/Aveiro/Background_p1_aveiro.shp"</span>)</span>
<span id="cb95-52"><a href="#cb95-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-53"><a href="#cb95-53" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb95-54"><a href="#cb95-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>),</span>
<span id="cb95-55"><a href="#cb95-55" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#BDBDBD"</span>))<span class="sc">+</span></span>
<span id="cb95-56"><a href="#cb95-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> p1_background, <span class="at">fill =</span> <span class="st">"white"</span>,<span class="at">show.legend =</span> F, <span class="at">linewidth=</span><span class="fl">0.05</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,<span class="at">colour=</span><span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb95-57"><a href="#cb95-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mask_aveiro, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),<span class="at">linewidth=</span><span class="fl">0.05</span>,<span class="at">alpha=</span><span class="fl">0.93</span>,<span class="at">show.legend =</span> F,<span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb95-58"><a href="#cb95-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">519749</span>,<span class="dv">535233</span>) ,</span>
<span id="cb95-59"><a href="#cb95-59" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">4493310</span>,<span class="dv">4508794</span>) )<span class="sc">+</span></span>
<span id="cb95-60"><a href="#cb95-60" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>Flight_aveiro,</span>
<span id="cb95-61"><a href="#cb95-61" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x=</span>lon,</span>
<span id="cb95-62"><a href="#cb95-62" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>lat,</span>
<span id="cb95-63"><a href="#cb95-63" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> Name,</span>
<span id="cb95-64"><a href="#cb95-64" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> Name),</span>
<span id="cb95-65"><a href="#cb95-65" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># description=Description),</span></span>
<span id="cb95-66"><a href="#cb95-66" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size=</span><span class="fl">0.3</span>,</span>
<span id="cb95-67"><a href="#cb95-67" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb95-68"><a href="#cb95-68" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb95-69"><a href="#cb95-69" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend=</span>F,</span>
<span id="cb95-70"><a href="#cb95-70" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fontsize =</span> <span class="dv">10</span>,</span>
<span id="cb95-71"><a href="#cb95-71" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb95-72"><a href="#cb95-72" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.size =</span> <span class="dv">2</span>,</span>
<span id="cb95-73"><a href="#cb95-73" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb95-74"><a href="#cb95-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">expand =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb95-75"><a href="#cb95-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">radius =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb95-76"><a href="#cb95-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.fill =</span> <span class="st">"grey90"</span>,</span>
<span id="cb95-77"><a href="#cb95-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"mm"</span>)) <span class="sc">+</span></span>
<span id="cb95-78"><a href="#cb95-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># theme_void()+</span></span>
<span id="cb95-79"><a href="#cb95-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb95-80"><a href="#cb95-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Longitude"</span>,</span>
<span id="cb95-81"><a href="#cb95-81" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Latitude"</span>)<span class="sc">+</span></span>
<span id="cb95-82"><a href="#cb95-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_label(aes(x = 521000, y = 4507794, label = "C"), size = 20)+</span></span>
<span id="cb95-83"><a href="#cb95-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">8.75</span>, <span class="sc">-</span><span class="fl">8.6</span>, <span class="at">by =</span> <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb95-84"><a href="#cb95-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>), <span class="st">"cm"</span>) ,</span>
<span id="cb95-85"><a href="#cb95-85" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb95-86"><a href="#cb95-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb95-87"><a href="#cb95-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb95-88"><a href="#cb95-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb95-89"><a href="#cb95-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb95-90"><a href="#cb95-90" aria-hidden="true" tabindex="-1"></a><span class="do">##### ZOOM and masking #####</span></span>
<span id="cb95-91"><a href="#cb95-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-92"><a href="#cb95-92" aria-hidden="true" tabindex="-1"></a>Boat_rgb<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb95-93"><a href="#cb95-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"Boat_high_RGB_merged.tif"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-94"><a href="#cb95-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb95-95"><a href="#cb95-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb95-96"><a href="#cb95-96" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Boat_rgb)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"B1"</span>,<span class="st">"B3"</span>,<span class="st">"B5"</span>)</span>
<span id="cb95-97"><a href="#cb95-97" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(Boat_rgb)[<span class="fu">values</span>(Boat_rgb) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb95-98"><a href="#cb95-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-99"><a href="#cb95-99" aria-hidden="true" tabindex="-1"></a>mask_boat<span class="ot">&lt;-</span><span class="st">"Data/shp/Aveiro"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb95-100"><a href="#cb95-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb95-101"><a href="#cb95-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb95-102"><a href="#cb95-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-103"><a href="#cb95-103" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">"boat"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-104"><a href="#cb95-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb95-105"><a href="#cb95-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb95-106"><a href="#cb95-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-107"><a href="#cb95-107" aria-hidden="true" tabindex="-1"></a>background_Boat<span class="ot">&lt;-</span><span class="st">"Data/shp/Aveiro"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb95-108"><a href="#cb95-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb95-109"><a href="#cb95-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb95-110"><a href="#cb95-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-111"><a href="#cb95-111" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">"background_Boat"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-112"><a href="#cb95-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb95-113"><a href="#cb95-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb95-114"><a href="#cb95-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-115"><a href="#cb95-115" aria-hidden="true" tabindex="-1"></a>zoom_boat_high_sf<span class="ot">&lt;-</span><span class="st">"Data/shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb95-116"><a href="#cb95-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>,<span class="at">recursive =</span> T,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb95-117"><a href="#cb95-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb95-118"><a href="#cb95-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-119"><a href="#cb95-119" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"zoom_extent_map_Boat_comparison"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-120"><a href="#cb95-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb95-121"><a href="#cb95-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb95-122"><a href="#cb95-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-123"><a href="#cb95-123" aria-hidden="true" tabindex="-1"></a>zoom_boat_high_sf_2<span class="ot">&lt;-</span><span class="st">"Data/shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb95-124"><a href="#cb95-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>,<span class="at">recursive =</span> T,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb95-125"><a href="#cb95-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb95-126"><a href="#cb95-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-127"><a href="#cb95-127" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"zoom_extent_map_Boat_2_comparison"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-128"><a href="#cb95-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb95-129"><a href="#cb95-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb95-130"><a href="#cb95-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-131"><a href="#cb95-131" aria-hidden="true" tabindex="-1"></a>rgb_Boat_zoomed<span class="ot">&lt;-</span>Boat_rgb <span class="sc">%&gt;%</span> </span>
<span id="cb95-132"><a href="#cb95-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zoom_boat_high_sf)</span>
<span id="cb95-133"><a href="#cb95-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-134"><a href="#cb95-134" aria-hidden="true" tabindex="-1"></a>rgb_Boat_zoomed_2<span class="ot">&lt;-</span>Boat_rgb <span class="sc">%&gt;%</span> </span>
<span id="cb95-135"><a href="#cb95-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zoom_boat_high_sf_2)</span>
<span id="cb95-136"><a href="#cb95-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-137"><a href="#cb95-137" aria-hidden="true" tabindex="-1"></a>Boat_rgb_mask<span class="ot">&lt;-</span>Boat_rgb <span class="sc">%&gt;%</span> </span>
<span id="cb95-138"><a href="#cb95-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(mask_boat, <span class="at">inverse =</span> T)</span>
<span id="cb95-139"><a href="#cb95-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-140"><a href="#cb95-140" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb95-141"><a href="#cb95-141" aria-hidden="true" tabindex="-1"></a>rgb_Boat_zoomed_map<span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb95-142"><a href="#cb95-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> rgb_Boat_zoomed,</span>
<span id="cb95-143"><a href="#cb95-143" aria-hidden="true" tabindex="-1"></a>                      <span class="at">r =</span> <span class="dv">3</span>,</span>
<span id="cb95-144"><a href="#cb95-144" aria-hidden="true" tabindex="-1"></a>                      <span class="at">g =</span> <span class="dv">2</span>,</span>
<span id="cb95-145"><a href="#cb95-145" aria-hidden="true" tabindex="-1"></a>                      <span class="at">b =</span> <span class="dv">1</span>,</span>
<span id="cb95-146"><a href="#cb95-146" aria-hidden="true" tabindex="-1"></a>                      <span class="at">max_col_value =</span> <span class="dv">4000</span>)<span class="sc">+</span></span>
<span id="cb95-147"><a href="#cb95-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_boat_high_sf, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>,<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-148"><a href="#cb95-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-149"><a href="#cb95-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb95-150"><a href="#cb95-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-151"><a href="#cb95-151" aria-hidden="true" tabindex="-1"></a>rgb_Boat_zoomed_map_2</span>
<span id="cb95-152"><a href="#cb95-152" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb95-153"><a href="#cb95-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> rgb_Boat_zoomed_2,</span>
<span id="cb95-154"><a href="#cb95-154" aria-hidden="true" tabindex="-1"></a>                      <span class="at">r =</span> <span class="dv">3</span>,</span>
<span id="cb95-155"><a href="#cb95-155" aria-hidden="true" tabindex="-1"></a>                      <span class="at">g =</span> <span class="dv">2</span>,</span>
<span id="cb95-156"><a href="#cb95-156" aria-hidden="true" tabindex="-1"></a>                      <span class="at">b =</span> <span class="dv">1</span>,</span>
<span id="cb95-157"><a href="#cb95-157" aria-hidden="true" tabindex="-1"></a>                      <span class="at">interpolate =</span> F,</span>
<span id="cb95-158"><a href="#cb95-158" aria-hidden="true" tabindex="-1"></a>                      <span class="at">max_col_value =</span> <span class="dv">4000</span>)<span class="sc">+</span></span>
<span id="cb95-159"><a href="#cb95-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_boat_high_sf_2, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>,<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-160"><a href="#cb95-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-161"><a href="#cb95-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb95-162"><a href="#cb95-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-163"><a href="#cb95-163" aria-hidden="true" tabindex="-1"></a><span class="do">####### RGB ############</span></span>
<span id="cb95-164"><a href="#cb95-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-165"><a href="#cb95-165" aria-hidden="true" tabindex="-1"></a>RGB_Boat_map<span class="ot">&lt;-</span></span>
<span id="cb95-166"><a href="#cb95-166" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb95-167"><a href="#cb95-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>,  </span>
<span id="cb95-168"><a href="#cb95-168" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>, <span class="st">"water"</span>),</span>
<span id="cb95-169"><a href="#cb95-169" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#CFCFCF"</span>,<span class="st">"#42c9bc"</span>))<span class="sc">+</span></span>
<span id="cb95-170"><a href="#cb95-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_Boat,</span>
<span id="cb95-171"><a href="#cb95-171" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),</span>
<span id="cb95-172"><a href="#cb95-172" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F, </span>
<span id="cb95-173"><a href="#cb95-173" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb95-174"><a href="#cb95-174" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.93</span>,</span>
<span id="cb95-175"><a href="#cb95-175" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb95-176"><a href="#cb95-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_Boat,</span>
<span id="cb95-177"><a href="#cb95-177" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb95-178"><a href="#cb95-178" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F, </span>
<span id="cb95-179"><a href="#cb95-179" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb95-180"><a href="#cb95-180" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.4</span>,</span>
<span id="cb95-181"><a href="#cb95-181" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb95-182"><a href="#cb95-182" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> Boat_rgb_mask,</span>
<span id="cb95-183"><a href="#cb95-183" aria-hidden="true" tabindex="-1"></a>                      <span class="at">r =</span> <span class="dv">3</span>,</span>
<span id="cb95-184"><a href="#cb95-184" aria-hidden="true" tabindex="-1"></a>                      <span class="at">g =</span> <span class="dv">2</span>,</span>
<span id="cb95-185"><a href="#cb95-185" aria-hidden="true" tabindex="-1"></a>                      <span class="at">b =</span> <span class="dv">1</span>,</span>
<span id="cb95-186"><a href="#cb95-186" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># maxcell = 5000,</span></span>
<span id="cb95-187"><a href="#cb95-187" aria-hidden="true" tabindex="-1"></a>                      <span class="at">maxcell =</span> <span class="dv">500832</span><span class="sc">*</span><span class="dv">8</span>,</span>
<span id="cb95-188"><a href="#cb95-188" aria-hidden="true" tabindex="-1"></a>                      <span class="at">max_col_value =</span> <span class="dv">5000</span>)<span class="sc">+</span></span>
<span id="cb95-189"><a href="#cb95-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_boat_high_sf,</span>
<span id="cb95-190"><a href="#cb95-190" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>,</span>
<span id="cb95-191"><a href="#cb95-191" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="st">"black"</span>, </span>
<span id="cb95-192"><a href="#cb95-192" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-193"><a href="#cb95-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_boat_high_sf_2,</span>
<span id="cb95-194"><a href="#cb95-194" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>,</span>
<span id="cb95-195"><a href="#cb95-195" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="st">"black"</span>, </span>
<span id="cb95-196"><a href="#cb95-196" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-197"><a href="#cb95-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(rgb_Boat_zoomed_map),</span>
<span id="cb95-198"><a href="#cb95-198" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.6975</span>,</span>
<span id="cb95-199"><a href="#cb95-199" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">8.69</span>,</span>
<span id="cb95-200"><a href="#cb95-200" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">40.6666</span>,</span>
<span id="cb95-201"><a href="#cb95-201" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> <span class="fl">40.6711</span>) <span class="sc">+</span></span>
<span id="cb95-202"><a href="#cb95-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(rgb_Boat_zoomed_map_2),</span>
<span id="cb95-203"><a href="#cb95-203" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.6975+0.007</span>,</span>
<span id="cb95-204"><a href="#cb95-204" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">8.69+0.007</span>,</span>
<span id="cb95-205"><a href="#cb95-205" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">40.6666</span>,</span>
<span id="cb95-206"><a href="#cb95-206" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> <span class="fl">40.6711</span>) <span class="sc">+</span></span>
<span id="cb95-207"><a href="#cb95-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(p1),</span>
<span id="cb95-208"><a href="#cb95-208" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.6795</span>,</span>
<span id="cb95-209"><a href="#cb95-209" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">8.6736</span>,</span>
<span id="cb95-210"><a href="#cb95-210" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">40.6585</span>,</span>
<span id="cb95-211"><a href="#cb95-211" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> <span class="fl">40.6625</span>) <span class="sc">+</span></span>
<span id="cb95-212"><a href="#cb95-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(x,y,<span class="at">group=</span>grp),</span>
<span id="cb95-213"><a href="#cb95-213" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.69452127</span>,<span class="sc">-</span><span class="fl">8.6965</span>,<span class="sc">-</span><span class="fl">8.69440039</span>,<span class="sc">-</span><span class="fl">8.69105</span>), </span>
<span id="cb95-214"><a href="#cb95-214" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y=</span><span class="fu">c</span>(<span class="fl">40.66244282</span>,<span class="fl">40.66673</span>,<span class="fl">40.66244282</span>,<span class="fl">40.66673</span>),</span>
<span id="cb95-215"><a href="#cb95-215" aria-hidden="true" tabindex="-1"></a>                              <span class="at">grp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb95-216"><a href="#cb95-216" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb95-217"><a href="#cb95-217" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-218"><a href="#cb95-218" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="fu">aes</span>(x,y,<span class="at">group=</span>grp),</span>
<span id="cb95-219"><a href="#cb95-219" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.6819877</span>,<span class="sc">-</span><span class="fl">8.69645+0.007</span>,<span class="sc">-</span><span class="fl">8.6818696</span>,<span class="sc">-</span><span class="fl">8.6911+0.007</span>), </span>
<span id="cb95-220"><a href="#cb95-220" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y=</span><span class="fu">c</span>(<span class="fl">40.6652874</span>,<span class="fl">40.66675</span>,<span class="fl">40.6652874</span>,<span class="fl">40.66673</span>),</span>
<span id="cb95-221"><a href="#cb95-221" aria-hidden="true" tabindex="-1"></a>                              <span class="at">grp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb95-222"><a href="#cb95-222" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb95-223"><a href="#cb95-223" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-224"><a href="#cb95-224" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"bl"</span>,</span>
<span id="cb95-225"><a href="#cb95-225" aria-hidden="true" tabindex="-1"></a>                              <span class="at">text_cex=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb95-226"><a href="#cb95-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.6965</span>,<span class="sc">-</span><span class="fl">8.675</span>),</span>
<span id="cb95-227"><a href="#cb95-227" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span>  <span class="sc">-</span><span class="fl">8.685</span>)<span class="sc">+</span></span>
<span id="cb95-228"><a href="#cb95-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">40.659</span>,<span class="fl">40.6704</span>),</span>
<span id="cb95-229"><a href="#cb95-229" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span>  <span class="fl">40.664</span>)<span class="sc">+</span></span>
<span id="cb95-230"><a href="#cb95-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb95-231"><a href="#cb95-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb95-232"><a href="#cb95-232" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.text.x = element_text(size = 20, angle = 20 , hjust = 1),</span></span>
<span id="cb95-233"><a href="#cb95-233" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb95-234"><a href="#cb95-234" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb95-235"><a href="#cb95-235" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb95-236"><a href="#cb95-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-237"><a href="#cb95-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-238"><a href="#cb95-238" aria-hidden="true" tabindex="-1"></a><span class="do">####### Pred ######## </span></span>
<span id="cb95-239"><a href="#cb95-239" aria-hidden="true" tabindex="-1"></a>Boat1_pred<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb95-240"><a href="#cb95-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"AveiroBoat1_highPrediction_nnNewStanRawMetrics_Preds_NoXantho_7.tif"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-241"><a href="#cb95-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb95-242"><a href="#cb95-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb95-243"><a href="#cb95-243" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Boat1_pred)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb95-244"><a href="#cb95-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-245"><a href="#cb95-245" aria-hidden="true" tabindex="-1"></a>Boat2_pred<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb95-246"><a href="#cb95-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"AveiroBoat2_highPrediction_nnNewStanRawMetrics_Preds_NoXantho_7.tif"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-247"><a href="#cb95-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb95-248"><a href="#cb95-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb95-249"><a href="#cb95-249" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Boat2_pred)<span class="ot">&lt;-</span><span class="st">"layer"</span></span>
<span id="cb95-250"><a href="#cb95-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-251"><a href="#cb95-251" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(Boat1_pred)[<span class="fu">values</span>(Boat1_pred) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb95-252"><a href="#cb95-252" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(Boat2_pred)[<span class="fu">values</span>(Boat2_pred) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb95-253"><a href="#cb95-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-254"><a href="#cb95-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-255"><a href="#cb95-255" aria-hidden="true" tabindex="-1"></a>B1_overextent<span class="ot">&lt;-</span><span class="fu">ext</span>(Boat1_pred)</span>
<span id="cb95-256"><a href="#cb95-256" aria-hidden="true" tabindex="-1"></a>B1_overextent[<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="fu">ext</span>(Boat2_pred)[<span class="dv">2</span>]</span>
<span id="cb95-257"><a href="#cb95-257" aria-hidden="true" tabindex="-1"></a>B1_overextent[<span class="dv">4</span>]<span class="ot">&lt;-</span><span class="fu">ext</span>(Boat2_pred)[<span class="dv">4</span>]</span>
<span id="cb95-258"><a href="#cb95-258" aria-hidden="true" tabindex="-1"></a>B1_overextent <span class="ot">&lt;-</span> <span class="fu">rast</span>(B1_overextent)</span>
<span id="cb95-259"><a href="#cb95-259" aria-hidden="true" tabindex="-1"></a><span class="fu">res</span>(B1_overextent)<span class="ot">&lt;-</span><span class="fu">res</span>(Boat1_pred)</span>
<span id="cb95-260"><a href="#cb95-260" aria-hidden="true" tabindex="-1"></a><span class="co"># terra::writeRaster(B1$B1,"B1.tif")</span></span>
<span id="cb95-261"><a href="#cb95-261" aria-hidden="true" tabindex="-1"></a><span class="co"># terra::writeRaster(B2$B2,"B2.tif")</span></span>
<span id="cb95-262"><a href="#cb95-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-263"><a href="#cb95-263" aria-hidden="true" tabindex="-1"></a>B2_resampled <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(Boat2_pred,B1_overextent, <span class="at">method =</span> <span class="st">"near"</span>,<span class="at">threads =</span> T)</span>
<span id="cb95-264"><a href="#cb95-264" aria-hidden="true" tabindex="-1"></a><span class="co"># terra::writeRaster(B2_resampled$B1,"B2_resampled.tif", overwrite = T)</span></span>
<span id="cb95-265"><a href="#cb95-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-266"><a href="#cb95-266" aria-hidden="true" tabindex="-1"></a>Boat_pred<span class="ot">&lt;-</span><span class="fu">merge</span>(Boat1_pred,B2_resampled)</span>
<span id="cb95-267"><a href="#cb95-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-268"><a href="#cb95-268" aria-hidden="true" tabindex="-1"></a>Boat_pred_aggregate<span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">aggregate</span>(Boat_pred,<span class="at">fact =</span> <span class="dv">6</span>, <span class="at">fun =</span><span class="st">"modal"</span>) </span>
<span id="cb95-269"><a href="#cb95-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-270"><a href="#cb95-270" aria-hidden="true" tabindex="-1"></a>masked_pred<span class="ot">&lt;-</span>Boat_pred_aggregate <span class="sc">%&gt;%</span> </span>
<span id="cb95-271"><a href="#cb95-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(mask_boat,<span class="at">inverse=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb95-272"><a href="#cb95-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb95-273"><a href="#cb95-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-274"><a href="#cb95-274" aria-hidden="true" tabindex="-1"></a>Boat_pred_zoom<span class="ot">&lt;-</span>Boat1_pred <span class="sc">%&gt;%</span> </span>
<span id="cb95-275"><a href="#cb95-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zoom_boat_high_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb95-276"><a href="#cb95-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb95-277"><a href="#cb95-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-278"><a href="#cb95-278" aria-hidden="true" tabindex="-1"></a>Boat_pred_zoom_2<span class="ot">&lt;-</span>Boat2_pred <span class="sc">%&gt;%</span> </span>
<span id="cb95-279"><a href="#cb95-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zoom_boat_high_sf_2) <span class="sc">%&gt;%</span> </span>
<span id="cb95-280"><a href="#cb95-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb95-281"><a href="#cb95-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-282"><a href="#cb95-282" aria-hidden="true" tabindex="-1"></a>Boat_Pred_zoomed_map<span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb95-283"><a href="#cb95-283" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> Boat_pred_zoom, </span>
<span id="cb95-284"><a href="#cb95-284" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer), </span>
<span id="cb95-285"><a href="#cb95-285" aria-hidden="true" tabindex="-1"></a>                             <span class="at">show.legend =</span> F,</span>
<span id="cb95-286"><a href="#cb95-286" aria-hidden="true" tabindex="-1"></a>                             <span class="at">maxcell =</span> <span class="dv">5010420</span>)<span class="sc">+</span></span>
<span id="cb95-287"><a href="#cb95-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#70543e"</span>,<span class="st">"#b3ff1a"</span>,<span class="st">"#389318"</span>,<span class="st">"#873e23"</span>),</span>
<span id="cb95-288"><a href="#cb95-288" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb95-289"><a href="#cb95-289" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb95-290"><a href="#cb95-290" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>,</span>
<span id="cb95-291"><a href="#cb95-291" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Chlorphyceae"</span>,</span>
<span id="cb95-292"><a href="#cb95-292" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Magnoliopsida"</span>))<span class="sc">+</span></span>
<span id="cb95-293"><a href="#cb95-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_boat_high_sf, </span>
<span id="cb95-294"><a href="#cb95-294" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>, </span>
<span id="cb95-295"><a href="#cb95-295" aria-hidden="true" tabindex="-1"></a>          <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb95-296"><a href="#cb95-296" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="st">"black"</span>, </span>
<span id="cb95-297"><a href="#cb95-297" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-298"><a href="#cb95-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb95-299"><a href="#cb95-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-300"><a href="#cb95-300" aria-hidden="true" tabindex="-1"></a>Boat_Pred_zoomed_map_2<span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb95-301"><a href="#cb95-301" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> Boat_pred_zoom_2, </span>
<span id="cb95-302"><a href="#cb95-302" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer), </span>
<span id="cb95-303"><a href="#cb95-303" aria-hidden="true" tabindex="-1"></a>                             <span class="at">show.legend =</span> F,</span>
<span id="cb95-304"><a href="#cb95-304" aria-hidden="true" tabindex="-1"></a>                             <span class="at">maxcell =</span> <span class="dv">5010420</span>)<span class="sc">+</span></span>
<span id="cb95-305"><a href="#cb95-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#70543e"</span>,<span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>),</span>
<span id="cb95-306"><a href="#cb95-306" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb95-307"><a href="#cb95-307" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb95-308"><a href="#cb95-308" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>,</span>
<span id="cb95-309"><a href="#cb95-309" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb95-310"><a href="#cb95-310" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb95-311"><a href="#cb95-311" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Rhodophyceae"</span>))<span class="sc">+</span></span>
<span id="cb95-312"><a href="#cb95-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_boat_high_sf_2, </span>
<span id="cb95-313"><a href="#cb95-313" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>, </span>
<span id="cb95-314"><a href="#cb95-314" aria-hidden="true" tabindex="-1"></a>          <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb95-315"><a href="#cb95-315" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="st">"black"</span>, </span>
<span id="cb95-316"><a href="#cb95-316" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-317"><a href="#cb95-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb95-318"><a href="#cb95-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-319"><a href="#cb95-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-320"><a href="#cb95-320" aria-hidden="true" tabindex="-1"></a>Boat_pred_map<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb95-321"><a href="#cb95-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_Boat, </span>
<span id="cb95-322"><a href="#cb95-322" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),</span>
<span id="cb95-323"><a href="#cb95-323" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F, </span>
<span id="cb95-324"><a href="#cb95-324" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb95-325"><a href="#cb95-325" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.93</span>,</span>
<span id="cb95-326"><a href="#cb95-326" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb95-327"><a href="#cb95-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_Boat,</span>
<span id="cb95-328"><a href="#cb95-328" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb95-329"><a href="#cb95-329" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F, </span>
<span id="cb95-330"><a href="#cb95-330" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb95-331"><a href="#cb95-331" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.4</span>,</span>
<span id="cb95-332"><a href="#cb95-332" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb95-333"><a href="#cb95-333" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="st">""</span>, </span>
<span id="cb95-334"><a href="#cb95-334" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>, <span class="st">"water"</span>),</span>
<span id="cb95-335"><a href="#cb95-335" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#CFCFCF"</span>,<span class="st">"#42c9bc"</span>))<span class="sc">+</span></span>
<span id="cb95-336"><a href="#cb95-336" aria-hidden="true" tabindex="-1"></a>  ggnewscale<span class="sc">::</span><span class="fu">new_scale</span>(<span class="st">"fill"</span>)<span class="sc">+</span></span>
<span id="cb95-337"><a href="#cb95-337" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> masked_pred, </span>
<span id="cb95-338"><a href="#cb95-338" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer),</span>
<span id="cb95-339"><a href="#cb95-339" aria-hidden="true" tabindex="-1"></a>                             <span class="co"># show.legend = F,</span></span>
<span id="cb95-340"><a href="#cb95-340" aria-hidden="true" tabindex="-1"></a>                             <span class="at">maxcell =</span> <span class="dv">5010420</span>,</span>
<span id="cb95-341"><a href="#cb95-341" aria-hidden="true" tabindex="-1"></a>                             )<span class="sc">+</span></span>
<span id="cb95-342"><a href="#cb95-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>),</span>
<span id="cb95-343"><a href="#cb95-343" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span><span class="fu">c</span>(<span class="st">"#70543e"</span>, <span class="st">"#b3ff1a"</span>, <span class="st">"#DAA520"</span>, <span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>, <span class="st">"#42c9bc"</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>),</span>
<span id="cb95-344"><a href="#cb95-344" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb95-345"><a href="#cb95-345" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb95-346"><a href="#cb95-346" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>,</span>
<span id="cb95-347"><a href="#cb95-347" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb95-348"><a href="#cb95-348" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb95-349"><a href="#cb95-349" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb95-350"><a href="#cb95-350" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb95-351"><a href="#cb95-351" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb95-352"><a href="#cb95-352" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Water"</span>))<span class="sc">+</span></span>
<span id="cb95-353"><a href="#cb95-353" aria-hidden="true" tabindex="-1"></a>  ggnewscale<span class="sc">::</span><span class="fu">new_scale</span>(<span class="st">"fill"</span>)<span class="sc">+</span></span>
<span id="cb95-354"><a href="#cb95-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_boat_high_sf, </span>
<span id="cb95-355"><a href="#cb95-355" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"transparent"</span>, </span>
<span id="cb95-356"><a href="#cb95-356" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb95-357"><a href="#cb95-357" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb95-358"><a href="#cb95-358" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-359"><a href="#cb95-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_boat_high_sf_2, </span>
<span id="cb95-360"><a href="#cb95-360" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">"transparent"</span>, </span>
<span id="cb95-361"><a href="#cb95-361" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb95-362"><a href="#cb95-362" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb95-363"><a href="#cb95-363" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-364"><a href="#cb95-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(x,y,<span class="at">group=</span>grp),</span>
<span id="cb95-365"><a href="#cb95-365" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.69452127</span>,<span class="sc">-</span><span class="fl">8.6965</span>,<span class="sc">-</span><span class="fl">8.69440039</span>,<span class="sc">-</span><span class="fl">8.69105</span>), </span>
<span id="cb95-366"><a href="#cb95-366" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y=</span><span class="fu">c</span>(<span class="fl">40.66244282</span>,<span class="fl">40.66673</span>,<span class="fl">40.66244282</span>,<span class="fl">40.66673</span>),</span>
<span id="cb95-367"><a href="#cb95-367" aria-hidden="true" tabindex="-1"></a>                              <span class="at">grp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb95-368"><a href="#cb95-368" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb95-369"><a href="#cb95-369" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-370"><a href="#cb95-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(x,y,<span class="at">group=</span>grp),</span>
<span id="cb95-371"><a href="#cb95-371" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.6819877</span>,<span class="sc">-</span><span class="fl">8.69645+0.007</span>,<span class="sc">-</span><span class="fl">8.6818696</span>,<span class="sc">-</span><span class="fl">8.6911+0.007</span>), </span>
<span id="cb95-372"><a href="#cb95-372" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y=</span><span class="fu">c</span>(<span class="fl">40.6652874</span>,<span class="fl">40.66675</span>,<span class="fl">40.6652874</span>,<span class="fl">40.66673</span>),</span>
<span id="cb95-373"><a href="#cb95-373" aria-hidden="true" tabindex="-1"></a>                              <span class="at">grp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb95-374"><a href="#cb95-374" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb95-375"><a href="#cb95-375" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb95-376"><a href="#cb95-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(Boat_Pred_zoomed_map),</span>
<span id="cb95-377"><a href="#cb95-377" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.6975</span>,</span>
<span id="cb95-378"><a href="#cb95-378" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">8.69</span>,</span>
<span id="cb95-379"><a href="#cb95-379" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">40.6666</span>,</span>
<span id="cb95-380"><a href="#cb95-380" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> <span class="fl">40.6711</span>) <span class="sc">+</span></span>
<span id="cb95-381"><a href="#cb95-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(Boat_Pred_zoomed_map_2),</span>
<span id="cb95-382"><a href="#cb95-382" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">8.6975+0.007</span>,</span>
<span id="cb95-383"><a href="#cb95-383" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">8.69+0.007</span>,</span>
<span id="cb95-384"><a href="#cb95-384" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">40.6666</span>,</span>
<span id="cb95-385"><a href="#cb95-385" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> <span class="fl">40.6711</span>) <span class="sc">+</span></span>
<span id="cb95-386"><a href="#cb95-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)<span class="sc">+</span></span>
<span id="cb95-387"><a href="#cb95-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb95-388"><a href="#cb95-388" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb95-389"><a href="#cb95-389" aria-hidden="true" tabindex="-1"></a>     <span class="co"># axis.text.x = element_text(size = 20, angle = 20,hjust = 1),</span></span>
<span id="cb95-390"><a href="#cb95-390" aria-hidden="true" tabindex="-1"></a>     <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb95-391"><a href="#cb95-391" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb95-392"><a href="#cb95-392" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb95-393"><a href="#cb95-393" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb95-394"><a href="#cb95-394" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.98</span>,<span class="fl">0.38</span>),</span>
<span id="cb95-395"><a href="#cb95-395" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb95-396"><a href="#cb95-396" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>,<span class="st">"cm"</span>))<span class="sc">+</span></span>
<span id="cb95-397"><a href="#cb95-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">8.6965</span>,<span class="sc">-</span><span class="fl">8.675</span>),</span>
<span id="cb95-398"><a href="#cb95-398" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span>  <span class="sc">-</span><span class="fl">8.685</span>)<span class="sc">+</span></span>
<span id="cb95-399"><a href="#cb95-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">40.659</span>,<span class="fl">40.6704</span>),</span>
<span id="cb95-400"><a href="#cb95-400" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span>  <span class="fl">40.664</span>)</span>
<span id="cb95-401"><a href="#cb95-401" aria-hidden="true" tabindex="-1"></a><span class="do">################# PLOT AND SAVING ###########</span></span>
<span id="cb95-402"><a href="#cb95-402" aria-hidden="true" tabindex="-1"></a>plot_Boat<span class="ot">&lt;-</span>RGB_Boat_map<span class="sc">/</span></span>
<span id="cb95-403"><a href="#cb95-403" aria-hidden="true" tabindex="-1"></a>  Boat_pred_map</span>
<span id="cb95-404"><a href="#cb95-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-405"><a href="#cb95-405" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/Maps Pred/FigX-Boat_Pred.png"</span>,plot_Boat , <span class="at">width =</span> <span class="dv">1000</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">1120</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [36]:</pre></div><div id="cell-fig-Boat" class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"./Figures/Low_res/Maps Pred/FigX-Boat_Pred.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Boat" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Boat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="./Figures/Low_res/Maps%20Pred/FigX-Boat_Pred.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure&nbsp;7: RGB orthomosaic (Top) and Prediction (Bottom) of the flight made in the inner part of Ria de Aveiro Lagoon, Portugal. The total extent of this flight was about 1.5 km² with a resolution of 80 mm per pixel. Background colors indicate intertidal area (Light Green), land area (Light Grey) and water (Light Blue). The zoom inserts cover an area equivalent to the size of a 10-meter Sentinel-2 pixel."><img src="./Figures/Low_res/Maps%20Pred/FigX-Boat_Pred.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Boat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: RGB orthomosaic (Top) and Prediction (Bottom) of the flight made in the inner part of Ria de Aveiro Lagoon, Portugal. The total extent of this flight was about 1.5 km² with a resolution of 80 mm per pixel. Background colors indicate intertidal area (Light Green), land area (Light Grey) and water (Light Blue). The zoom inserts cover an area equivalent to the size of a 10-meter Sentinel-2 pixel.
</figcaption>
</figure>
</div>
</div>
</div></div>
<p>The flight over L’Epine in Noirmoutier Island, France (<a href="#fig-Dike" class="quarto-xref">Figure&nbsp;8</a> A) was conducted near a dike, which crossed the northern part of the site from West to East. Alongside this dike, Fucale brown macroalgae (<em>Fucus spp.</em>, <em>Ascophyllum nodosum</em>) were attached to sparse rocks, and stranded green algae (<em>Ulva spp.</em>) could be observed, which was correctly reproduced by the prediction (<a href="#fig-Dike" class="quarto-xref">Figure&nbsp;8</a> B). This site was characterized by a high mixture between green macroalgae and seagrass but these two classes were correctly discriminated by the classifier (F1 score of 0.97 and 0.98 respectively).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [37]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>imglist<span class="ot">&lt;-</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">path =</span> <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">".tif"</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">folder =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Data"</span>) <span class="sc">~</span> <span class="st">"Input"</span>,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Output"</span>),</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">alt =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"high"</span>) <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">str_detect</span>(path, <span class="st">"High"</span>) <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"low"</span>),</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">site =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Gafanha"</span>) <span class="sc">~</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"AveiroHigh"</span>) <span class="sc">~</span> <span class="st">"Gafanha"</span>,</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Duer"</span>),</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"pred"</span>) <span class="sc">~</span> <span class="st">"Pred"</span>,</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"Preds"</span>) <span class="sc">~</span> <span class="st">"Pred"</span>,</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"NDVI"</span>) <span class="sc">~</span> <span class="st">"NDVI"</span>,</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"ortho"</span>),</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">resampled =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"resampled"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">new =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"no_Xantho"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">str_detect</span>(path, <span class="st">"NewPreds"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"colored"</span>) <span class="sc">~</span> <span class="st">"TRUE"</span>,</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"FALSE"</span>),</span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">correction =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"corrected_per_bands"</span>) <span class="sc">~</span> <span class="st">"Bands"</span>,</span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(path, <span class="st">"corrected.tif"</span>) <span class="sc">~</span> <span class="st">"lm_all"</span>,</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(alt <span class="sc">!=</span> <span class="st">"NA"</span>,</span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">str_detect</span>(path,<span class="st">".aux.xml"</span>))</span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a><span class="do">##### Preview #####</span></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>filelist<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="st">"Data/shp/"</span>, <span class="at">pattern =</span> <span class="st">".shp"</span>, <span class="at">recursive =</span> T,<span class="at">full.names =</span> T)</span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>mask_BB <span class="ot">&lt;-</span> filelist[<span class="fu">str_detect</span>(filelist,<span class="st">"mask_land_intertidal_BB"</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>Flight_BB<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">Name=</span><span class="fu">c</span>(</span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L'Epine"</span></span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a>  ) ,</span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">Description =</span> <span class="fu">c</span>(</span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"120m Flight"</span>),</span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">Long=</span><span class="fu">c</span>(</span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fl">2.228239</span>) ,</span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lat=</span><span class="fu">c</span>( </span>
<span id="cb97-43"><a href="#cb97-43" aria-hidden="true" tabindex="-1"></a>        <span class="fl">46.989515</span>) </span>
<span id="cb97-44"><a href="#cb97-44" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb97-45"><a href="#cb97-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"Long"</span>,<span class="st">"Lat"</span>) )  <span class="sc">%&gt;%</span> </span>
<span id="cb97-46"><a href="#cb97-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">"EPSG:4326"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb97-47"><a href="#cb97-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">crs</span>(mask_BB))  <span class="sc">%&gt;%</span> </span>
<span id="cb97-48"><a href="#cb97-48" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lon =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">1</span>],</span>
<span id="cb97-49"><a href="#cb97-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) [,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb97-50"><a href="#cb97-50" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb97-51"><a href="#cb97-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-52"><a href="#cb97-52" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb97-53"><a href="#cb97-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land mask"</span>),</span>
<span id="cb97-54"><a href="#cb97-54" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#BDBDBD"</span>))<span class="sc">+</span></span>
<span id="cb97-55"><a href="#cb97-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mask_BB, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type), <span class="at">linewidth=</span><span class="fl">0.05</span>,<span class="at">alpha=</span><span class="fl">0.93</span>, <span class="at">show.legend =</span> F,<span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb97-56"><a href="#cb97-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">550609</span>,<span class="dv">579539</span>) ,</span>
<span id="cb97-57"><a href="#cb97-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">5189447</span>,<span class="dv">5218377</span>) )<span class="sc">+</span></span>
<span id="cb97-58"><a href="#cb97-58" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data=</span>Flight_BB,</span>
<span id="cb97-59"><a href="#cb97-59" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x=</span>lon,</span>
<span id="cb97-60"><a href="#cb97-60" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y=</span>lat,</span>
<span id="cb97-61"><a href="#cb97-61" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> Name,</span>
<span id="cb97-62"><a href="#cb97-62" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> Name),</span>
<span id="cb97-63"><a href="#cb97-63" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># description=Description),</span></span>
<span id="cb97-64"><a href="#cb97-64" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size=</span><span class="fl">0.3</span>,</span>
<span id="cb97-65"><a href="#cb97-65" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"goldenrod"</span>,</span>
<span id="cb97-66"><a href="#cb97-66" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.colour =</span> <span class="st">"goldenrod4"</span>,</span>
<span id="cb97-67"><a href="#cb97-67" aria-hidden="true" tabindex="-1"></a>                 <span class="at">show.legend=</span>F,</span>
<span id="cb97-68"><a href="#cb97-68" aria-hidden="true" tabindex="-1"></a>                 <span class="at">con.size =</span> <span class="dv">2</span>,</span>
<span id="cb97-69"><a href="#cb97-69" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.fontsize =</span> <span class="dv">10</span>,</span>
<span id="cb97-70"><a href="#cb97-70" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb97-71"><a href="#cb97-71" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span><span class="fl">0.8</span>,</span>
<span id="cb97-72"><a href="#cb97-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">expand =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) , </span>
<span id="cb97-73"><a href="#cb97-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">radius =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"mm"</span>) ,</span>
<span id="cb97-74"><a href="#cb97-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.fill =</span> <span class="st">"grey90"</span>,</span>
<span id="cb97-75"><a href="#cb97-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">label.buffer =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"mm"</span>)) <span class="sc">+</span></span>
<span id="cb97-76"><a href="#cb97-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># theme_Bede_Map()+</span></span>
<span id="cb97-77"><a href="#cb97-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Longitude"</span>,</span>
<span id="cb97-78"><a href="#cb97-78" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Latitude"</span>)<span class="sc">+</span></span>
<span id="cb97-79"><a href="#cb97-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_label(aes(x = 553460, y = 5216442, label = "B"), size = 20)+</span></span>
<span id="cb97-80"><a href="#cb97-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>), <span class="st">"cm"</span>) ,</span>
<span id="cb97-81"><a href="#cb97-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.95</span>,<span class="fl">0.2</span>),</span>
<span id="cb97-82"><a href="#cb97-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span>  <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb97-83"><a href="#cb97-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb97-84"><a href="#cb97-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb97-85"><a href="#cb97-85" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>, </span>
<span id="cb97-86"><a href="#cb97-86" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb97-87"><a href="#cb97-87" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">linetype=</span><span class="st">"solid"</span>, </span>
<span id="cb97-88"><a href="#cb97-88" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">colour =</span><span class="st">"black"</span>),</span>
<span id="cb97-89"><a href="#cb97-89" aria-hidden="true" tabindex="-1"></a>        <span class="co"># panel.background = element_rect(fill = "#FFFFFF90"),</span></span>
<span id="cb97-90"><a href="#cb97-90" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb97-91"><a href="#cb97-91" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb97-92"><a href="#cb97-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb97-93"><a href="#cb97-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb97-94"><a href="#cb97-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb97-95"><a href="#cb97-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-96"><a href="#cb97-96" aria-hidden="true" tabindex="-1"></a><span class="do">##### RGB ######</span></span>
<span id="cb97-97"><a href="#cb97-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-98"><a href="#cb97-98" aria-hidden="true" tabindex="-1"></a>Dike_rgb<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb97-99"><a href="#cb97-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"NorthDike_high_multi_4326_colored.tif"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-100"><a href="#cb97-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb97-101"><a href="#cb97-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb97-102"><a href="#cb97-102" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Dike_rgb)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"B1"</span>,<span class="st">"B3"</span>,<span class="st">"B5"</span>,<span class="st">"alpha"</span>)</span>
<span id="cb97-103"><a href="#cb97-103" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(Dike_rgb)[<span class="fu">values</span>(Dike_rgb<span class="sc">$</span>alpha) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb97-104"><a href="#cb97-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-105"><a href="#cb97-105" aria-hidden="true" tabindex="-1"></a>mask_Dike<span class="ot">&lt;-</span><span class="st">"Data/shp/Bourgneuf"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb97-106"><a href="#cb97-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb97-107"><a href="#cb97-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb97-108"><a href="#cb97-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb97-109"><a href="#cb97-109" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">"mask_NorthDike"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-110"><a href="#cb97-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb97-111"><a href="#cb97-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb97-112"><a href="#cb97-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-113"><a href="#cb97-113" aria-hidden="true" tabindex="-1"></a>background_Dike<span class="ot">&lt;-</span><span class="st">"Data/shp/Bourgneuf"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb97-114"><a href="#cb97-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb97-115"><a href="#cb97-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb97-116"><a href="#cb97-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb97-117"><a href="#cb97-117" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">"background"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-118"><a href="#cb97-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb97-119"><a href="#cb97-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb97-120"><a href="#cb97-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-121"><a href="#cb97-121" aria-hidden="true" tabindex="-1"></a>zoom_Dike_high_sf<span class="ot">&lt;-</span><span class="st">"Data/shp"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb97-122"><a href="#cb97-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="st">".shp"</span>,<span class="at">recursive =</span> T,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb97-123"><a href="#cb97-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb97-124"><a href="#cb97-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb97-125"><a href="#cb97-125" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"zoom_extent_map_Dike_comparison"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-126"><a href="#cb97-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb97-127"><a href="#cb97-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>()</span>
<span id="cb97-128"><a href="#cb97-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-129"><a href="#cb97-129" aria-hidden="true" tabindex="-1"></a>Dike_rgb_masked<span class="ot">&lt;-</span>Dike_rgb <span class="sc">%&gt;%</span> </span>
<span id="cb97-130"><a href="#cb97-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(mask_Dike) <span class="sc">%&gt;%</span></span>
<span id="cb97-131"><a href="#cb97-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(mask_Dike)</span>
<span id="cb97-132"><a href="#cb97-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-133"><a href="#cb97-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-134"><a href="#cb97-134" aria-hidden="true" tabindex="-1"></a>zoom_rgb_dike<span class="ot">&lt;-</span>Dike_rgb_masked <span class="sc">%&gt;%</span> </span>
<span id="cb97-135"><a href="#cb97-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zoom_Dike_high_sf)</span>
<span id="cb97-136"><a href="#cb97-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-137"><a href="#cb97-137" aria-hidden="true" tabindex="-1"></a>zoom_rgb_dike_map<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb97-138"><a href="#cb97-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> zoom_rgb_dike,</span>
<span id="cb97-139"><a href="#cb97-139" aria-hidden="true" tabindex="-1"></a>                      <span class="at">r =</span> <span class="dv">3</span>,</span>
<span id="cb97-140"><a href="#cb97-140" aria-hidden="true" tabindex="-1"></a>                      <span class="at">g =</span> <span class="dv">2</span>,</span>
<span id="cb97-141"><a href="#cb97-141" aria-hidden="true" tabindex="-1"></a>                      <span class="at">b =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb97-142"><a href="#cb97-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_Dike_high_sf, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>,<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb97-143"><a href="#cb97-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">32630</span>)<span class="sc">+</span></span>
<span id="cb97-144"><a href="#cb97-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb97-145"><a href="#cb97-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-146"><a href="#cb97-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-147"><a href="#cb97-147" aria-hidden="true" tabindex="-1"></a>RGB_Dike_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb97-148"><a href="#cb97-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">""</span>,  </span>
<span id="cb97-149"><a href="#cb97-149" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>, <span class="st">"water"</span>),</span>
<span id="cb97-150"><a href="#cb97-150" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#CFCFCF"</span>,<span class="st">"#42c9bc"</span>))<span class="sc">+</span></span>
<span id="cb97-151"><a href="#cb97-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_Dike,</span>
<span id="cb97-152"><a href="#cb97-152" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),</span>
<span id="cb97-153"><a href="#cb97-153" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F, </span>
<span id="cb97-154"><a href="#cb97-154" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb97-155"><a href="#cb97-155" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.93</span>,</span>
<span id="cb97-156"><a href="#cb97-156" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb97-157"><a href="#cb97-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_Dike,</span>
<span id="cb97-158"><a href="#cb97-158" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb97-159"><a href="#cb97-159" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F, </span>
<span id="cb97-160"><a href="#cb97-160" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb97-161"><a href="#cb97-161" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.4</span>,</span>
<span id="cb97-162"><a href="#cb97-162" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"transparent"</span>)<span class="sc">+</span></span>
<span id="cb97-163"><a href="#cb97-163" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> Dike_rgb_masked,</span>
<span id="cb97-164"><a href="#cb97-164" aria-hidden="true" tabindex="-1"></a>                      <span class="at">r =</span> <span class="dv">3</span>,</span>
<span id="cb97-165"><a href="#cb97-165" aria-hidden="true" tabindex="-1"></a>                      <span class="at">g =</span> <span class="dv">2</span>,</span>
<span id="cb97-166"><a href="#cb97-166" aria-hidden="true" tabindex="-1"></a>                      <span class="at">b =</span> <span class="dv">1</span>,</span>
<span id="cb97-167"><a href="#cb97-167" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># maxcell = 500,</span></span>
<span id="cb97-168"><a href="#cb97-168" aria-hidden="true" tabindex="-1"></a>                      <span class="at">maxcell =</span> <span class="dv">500832</span><span class="sc">*</span><span class="dv">8</span></span>
<span id="cb97-169"><a href="#cb97-169" aria-hidden="true" tabindex="-1"></a>                      )<span class="sc">+</span></span>
<span id="cb97-170"><a href="#cb97-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_Dike_high_sf, </span>
<span id="cb97-171"><a href="#cb97-171" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>, </span>
<span id="cb97-172"><a href="#cb97-172" aria-hidden="true" tabindex="-1"></a>          <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb97-173"><a href="#cb97-173" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="st">"black"</span>, </span>
<span id="cb97-174"><a href="#cb97-174" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb97-175"><a href="#cb97-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(zoom_rgb_dike_map), </span>
<span id="cb97-176"><a href="#cb97-176" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">2.226</span>, </span>
<span id="cb97-177"><a href="#cb97-177" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">46.9888</span>,</span>
<span id="cb97-178"><a href="#cb97-178" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> <span class="fl">46.9893</span>) <span class="sc">+</span></span>
<span id="cb97-179"><a href="#cb97-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(p1),</span>
<span id="cb97-180"><a href="#cb97-180" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">2.226</span>,</span>
<span id="cb97-181"><a href="#cb97-181" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">46.9875</span>) <span class="sc">+</span></span>
<span id="cb97-182"><a href="#cb97-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(x,y,<span class="at">group=</span>grp),</span>
<span id="cb97-183"><a href="#cb97-183" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.226834</span>,<span class="sc">-</span><span class="fl">2.225905</span>,<span class="sc">-</span><span class="fl">2.226834</span>,<span class="sc">-</span><span class="fl">2.225905</span>),</span>
<span id="cb97-184"><a href="#cb97-184" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y=</span><span class="fu">c</span>(<span class="fl">46.9886439</span>,<span class="fl">46.9892105</span>,<span class="fl">46.9885538</span>,<span class="fl">46.988805</span>),</span>
<span id="cb97-185"><a href="#cb97-185" aria-hidden="true" tabindex="-1"></a>                              <span class="at">grp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb97-186"><a href="#cb97-186" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb97-187"><a href="#cb97-187" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"tl"</span>,<span class="at">text_cex=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb97-188"><a href="#cb97-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.2293</span>,<span class="sc">-</span><span class="fl">2.2253</span>),</span>
<span id="cb97-189"><a href="#cb97-189" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span>  <span class="sc">-</span><span class="fl">2.228</span>)<span class="sc">+</span></span>
<span id="cb97-190"><a href="#cb97-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">46.9882</span>,<span class="fl">46.98935</span>),</span>
<span id="cb97-191"><a href="#cb97-191" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span>  <span class="fl">46.9890</span>)<span class="sc">+</span></span>
<span id="cb97-192"><a href="#cb97-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb97-193"><a href="#cb97-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb97-194"><a href="#cb97-194" aria-hidden="true" tabindex="-1"></a>    <span class="co"># axis.text.x =element_text(size = 20, angle = 20, hjust = 1),</span></span>
<span id="cb97-195"><a href="#cb97-195" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span><span class="fu">element_blank</span>(),</span>
<span id="cb97-196"><a href="#cb97-196" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb97-197"><a href="#cb97-197" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb97-198"><a href="#cb97-198" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb97-199"><a href="#cb97-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-200"><a href="#cb97-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-201"><a href="#cb97-201" aria-hidden="true" tabindex="-1"></a><span class="do">##### Pred ######</span></span>
<span id="cb97-202"><a href="#cb97-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-203"><a href="#cb97-203" aria-hidden="true" tabindex="-1"></a>Dike_Pred<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span> </span>
<span id="cb97-204"><a href="#cb97-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(path,<span class="st">"Noirmoutier_highPrediction_nnNewStanRawMetrics_Preds_NoXantho_7_4326.tif"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-205"><a href="#cb97-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb97-206"><a href="#cb97-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb97-207"><a href="#cb97-207" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Dike_Pred)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"layer"</span>)</span>
<span id="cb97-208"><a href="#cb97-208" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(Dike_Pred)[<span class="fu">values</span>(Dike_Pred) <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb97-209"><a href="#cb97-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-210"><a href="#cb97-210" aria-hidden="true" tabindex="-1"></a>Dike_Pred_masked<span class="ot">&lt;-</span>Dike_Pred <span class="sc">%&gt;%</span> </span>
<span id="cb97-211"><a href="#cb97-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(mask_Dike) <span class="sc">%&gt;%</span> </span>
<span id="cb97-212"><a href="#cb97-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(mask_Dike) <span class="sc">%&gt;%</span> </span>
<span id="cb97-213"><a href="#cb97-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.factor</span>()</span>
<span id="cb97-214"><a href="#cb97-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-215"><a href="#cb97-215" aria-hidden="true" tabindex="-1"></a>zoom_Pred_dike<span class="ot">&lt;-</span>Dike_Pred_masked <span class="sc">%&gt;%</span> </span>
<span id="cb97-216"><a href="#cb97-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(zoom_Dike_high_sf)</span>
<span id="cb97-217"><a href="#cb97-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-218"><a href="#cb97-218" aria-hidden="true" tabindex="-1"></a>zoom_Pred_dike_map<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb97-219"><a href="#cb97-219" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> zoom_Pred_dike, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer), <span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb97-220"><a href="#cb97-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#70543e"</span>,<span class="st">"#b3ff1a"</span>,<span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#42c9bc"</span>),</span>
<span id="cb97-221"><a href="#cb97-221" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb97-222"><a href="#cb97-222" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb97-223"><a href="#cb97-223" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>,</span>
<span id="cb97-224"><a href="#cb97-224" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Chlorphyceae"</span>,</span>
<span id="cb97-225"><a href="#cb97-225" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb97-226"><a href="#cb97-226" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb97-227"><a href="#cb97-227" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Water"</span>))<span class="sc">+</span></span>
<span id="cb97-228"><a href="#cb97-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_Dike_high_sf, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>,<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb97-229"><a href="#cb97-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb97-230"><a href="#cb97-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-231"><a href="#cb97-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-232"><a href="#cb97-232" aria-hidden="true" tabindex="-1"></a>Dike_pred_map<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb97-233"><a href="#cb97-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_Dike, </span>
<span id="cb97-234"><a href="#cb97-234" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Type),</span>
<span id="cb97-235"><a href="#cb97-235" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F, </span>
<span id="cb97-236"><a href="#cb97-236" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb97-237"><a href="#cb97-237" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.93</span>,</span>
<span id="cb97-238"><a href="#cb97-238" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"grey30"</span>)<span class="sc">+</span></span>
<span id="cb97-239"><a href="#cb97-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> background_Dike,</span>
<span id="cb97-240"><a href="#cb97-240" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb97-241"><a href="#cb97-241" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> F, </span>
<span id="cb97-242"><a href="#cb97-242" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth=</span><span class="fl">0.05</span>,</span>
<span id="cb97-243"><a href="#cb97-243" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="fl">0.4</span>,</span>
<span id="cb97-244"><a href="#cb97-244" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb97-245"><a href="#cb97-245" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="st">""</span>,  </span>
<span id="cb97-246"><a href="#cb97-246" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Intertidal area"</span>, <span class="st">"Land area"</span>, <span class="st">"water"</span>),</span>
<span id="cb97-247"><a href="#cb97-247" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#7DC27D"</span>, <span class="st">"#CFCFCF"</span>,<span class="st">"#42c9bc"</span>))<span class="sc">+</span></span>
<span id="cb97-248"><a href="#cb97-248" aria-hidden="true" tabindex="-1"></a>  ggnewscale<span class="sc">::</span><span class="fu">new_scale</span>(<span class="st">"fill"</span>)<span class="sc">+</span></span>
<span id="cb97-249"><a href="#cb97-249" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> Dike_Pred_masked, </span>
<span id="cb97-250"><a href="#cb97-250" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer),</span>
<span id="cb97-251"><a href="#cb97-251" aria-hidden="true" tabindex="-1"></a>                             <span class="at">maxcell =</span> <span class="dv">5010420</span>,</span>
<span id="cb97-252"><a href="#cb97-252" aria-hidden="true" tabindex="-1"></a>                             )<span class="sc">+</span></span>
<span id="cb97-253"><a href="#cb97-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>),</span>
<span id="cb97-254"><a href="#cb97-254" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span><span class="fu">c</span>(<span class="st">"#70543e"</span>, <span class="st">"#b3ff1a"</span>, <span class="st">"#DAA520"</span>, <span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>, <span class="st">"#42c9bc"</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>),</span>
<span id="cb97-255"><a href="#cb97-255" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb97-256"><a href="#cb97-256" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb97-257"><a href="#cb97-257" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Sediment"</span>,</span>
<span id="cb97-258"><a href="#cb97-258" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb97-259"><a href="#cb97-259" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb97-260"><a href="#cb97-260" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb97-261"><a href="#cb97-261" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb97-262"><a href="#cb97-262" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb97-263"><a href="#cb97-263" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Water"</span>))<span class="sc">+</span></span>
<span id="cb97-264"><a href="#cb97-264" aria-hidden="true" tabindex="-1"></a>  ggnewscale<span class="sc">::</span><span class="fu">new_scale</span>(<span class="st">"fill"</span>)<span class="sc">+</span></span>
<span id="cb97-265"><a href="#cb97-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> zoom_Dike_high_sf, </span>
<span id="cb97-266"><a href="#cb97-266" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"transparent"</span>, </span>
<span id="cb97-267"><a href="#cb97-267" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb97-268"><a href="#cb97-268" aria-hidden="true" tabindex="-1"></a>          <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb97-269"><a href="#cb97-269" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb97-270"><a href="#cb97-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(zoom_Pred_dike_map), </span>
<span id="cb97-271"><a href="#cb97-271" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">2.226</span>, </span>
<span id="cb97-272"><a href="#cb97-272" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="fl">46.9888</span>,</span>
<span id="cb97-273"><a href="#cb97-273" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> <span class="fl">46.9893</span>) <span class="sc">+</span></span>
<span id="cb97-274"><a href="#cb97-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(x,y,<span class="at">group=</span>grp),</span>
<span id="cb97-275"><a href="#cb97-275" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.226834</span>,<span class="sc">-</span><span class="fl">2.225905</span>,<span class="sc">-</span><span class="fl">2.226834</span>,<span class="sc">-</span><span class="fl">2.225905</span>),</span>
<span id="cb97-276"><a href="#cb97-276" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y=</span><span class="fu">c</span>(<span class="fl">46.9886439</span>,<span class="fl">46.9892105</span>,<span class="fl">46.9885538</span>,<span class="fl">46.988805</span>),</span>
<span id="cb97-277"><a href="#cb97-277" aria-hidden="true" tabindex="-1"></a>                              <span class="at">grp=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb97-278"><a href="#cb97-278" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb97-279"><a href="#cb97-279" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotation_custom(ggplotGrob(Boat_Pred_zoomed_map), xmin = -8.697, xmax = -8.692, ymin = 40.667,ymax = 40.6705) +</span></span>
<span id="cb97-280"><a href="#cb97-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)<span class="sc">+</span></span>
<span id="cb97-281"><a href="#cb97-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb97-282"><a href="#cb97-282" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">angle =</span> <span class="dv">20</span>,<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb97-283"><a href="#cb97-283" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb97-284"><a href="#cb97-284" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb97-285"><a href="#cb97-285" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb97-286"><a href="#cb97-286" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.50</span>),</span>
<span id="cb97-287"><a href="#cb97-287" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb97-288"><a href="#cb97-288" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>,<span class="st">"cm"</span>))<span class="sc">+</span></span>
<span id="cb97-289"><a href="#cb97-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.2293</span>,<span class="sc">-</span><span class="fl">2.2253</span>),</span>
<span id="cb97-290"><a href="#cb97-290" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span>  <span class="sc">-</span><span class="fl">2.228</span>)<span class="sc">+</span></span>
<span id="cb97-291"><a href="#cb97-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">46.9882</span>,<span class="fl">46.98935</span>),</span>
<span id="cb97-292"><a href="#cb97-292" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span>  <span class="fl">46.9890</span>)</span>
<span id="cb97-293"><a href="#cb97-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-294"><a href="#cb97-294" aria-hidden="true" tabindex="-1"></a><span class="do">################# PLOT AND SAVING ###########</span></span>
<span id="cb97-295"><a href="#cb97-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-296"><a href="#cb97-296" aria-hidden="true" tabindex="-1"></a>plot_Dike<span class="ot">&lt;-</span>RGB_Dike_map<span class="sc">/</span></span>
<span id="cb97-297"><a href="#cb97-297" aria-hidden="true" tabindex="-1"></a>  Dike_pred_map</span>
<span id="cb97-298"><a href="#cb97-298" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-299"><a href="#cb97-299" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/Maps Pred/FigX-Dike_Pred.png"</span>,plot_Dike , <span class="at">width =</span> <span class="dv">1200</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">900</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [38]:</pre></div><div id="cell-fig-Dike" class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"./Figures/Low_res/Maps Pred/FigX-Dike_Pred.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Dike" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Dike-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="./Figures/Low_res/Maps%20Pred/FigX-Dike_Pred.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure&nbsp;8: RGB orthomosaic (Top) and Prediction (Bottom) of L’Epine, France. The total extent of this flight was about 28 000 m² with a resolution of 80 mm per pixel. Background colors indicate intertidal area (Light Green) and land area (Light Grey). The zoom covers an area equivalent to a 10-meter Sentinel-2 pixel size."><img src="./Figures/Low_res/Maps%20Pred/FigX-Dike_Pred.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Dike-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: RGB orthomosaic (Top) and Prediction (Bottom) of L’Epine, France. The total extent of this flight was about 28 000 m² with a resolution of 80 mm per pixel. Background colors indicate intertidal area (Light Green) and land area (Light Grey). The zoom covers an area equivalent to a 10-meter Sentinel-2 pixel size.
</figcaption>
</figure>
</div>
</div>
</div></div>
</section>
<section id="validation-of-the-model" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="validation-of-the-model"><span class="header-section-number">3.3</span> Validation of the model</h2>
<p>With all drone flights combined, the model global accuracy was 94.26% with a Kappa coefficient of 0.92 (<a href="#fig-Validation" class="quarto-xref">Figure&nbsp;9</a>).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [39]:</pre></div><div id="cell-fig-Validation" class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"./Figures/Low_res/Validation/ConfusionMatrixGlobal.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Validation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Validation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="./Figures/Low_res/Validation/ConfusionMatrixGlobal.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="Figure&nbsp;9: A global confusion matrix on the left is derived from validation data across each flight, while a mosaic of confusion matrices from individual flights is presented on the right. The labels inside the matrices indicate the balanced accuracy for each class. The labels at the bottom of the global matrix indicate the User’s accuracy for each class, and those on the right indicate the Producer’s Accuracy. The values adjacent to the names of each site represent the proportion of total pixels from that site contributing to the overall matrix. Grey lines within the mosaic indicate the absence of validation data for the class at that site. The table at the bottom summarizes the Sensitivity, Specificity, and Accuracy for each class and for the overall model."><img src="./Figures/Low_res/Validation/ConfusionMatrixGlobal.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Validation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: A global confusion matrix on the left is derived from validation data across each flight, while a mosaic of confusion matrices from individual flights is presented on the right. The labels inside the matrices indicate the balanced accuracy for each class. The labels at the bottom of the global matrix indicate the User’s accuracy for each class, and those on the right indicate the Producer’s Accuracy. The values adjacent to the names of each site represent the proportion of total pixels from that site contributing to the overall matrix. Grey lines within the mosaic indicate the absence of validation data for the class at that site. The table at the bottom summarizes the Sensitivity, Specificity, and Accuracy for each class and for the overall model.
</figcaption>
</figure>
</div>
</div>
</div></div>
<p>The lowest performing site was Gafanha High (global accuracy of 75.45%) whereas Mataducos was the site with the most accurate prediction (global accuracy of 98.05%). Overall, the classes Phaeophyceae, Magnoliopsida, Sediment and Rhodophyceae were correctly classified with a balanced accuracy of 1, 0.96, 0.96 and 0.91 respectively. Bacillariophyceae was the least accurate class (accuracy of 0.72 ) mainly due to confusion with Magnoliopsida and Sediment.</p>
</section>
<section id="variable-importance-1" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="variable-importance-1"><span class="header-section-number">3.4</span> Variable importance</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [40]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="do">################# SPECTRA ########### </span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>SP1<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"Output/Spectra_VIP.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"Min/Max Standardised Spectra"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">!=</span> <span class="st">"Bare Sediment"</span>,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"Sun Glint"</span>,</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"A - MagnoliopsidaL"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> <span class="st">"STD"</span>)</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>SP2<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"Output/Spectra_VIP2.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"Raw Spectra"</span>,</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean =</span> mean <span class="sc">/</span> <span class="dv">10000</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">!=</span> <span class="st">"Bare Sediment"</span>,</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"Sun Glint"</span>,</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">!=</span> <span class="st">"A - MagnoliopsidaL"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">reframe</span>(Class,Wavelength, mean, type) <span class="sc">%&gt;%</span> </span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">value =</span> <span class="st">"mean"</span>)</span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>SP<span class="ot">&lt;-</span>SP1 <span class="sc">%&gt;%</span> </span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(SP2)</span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a>SP_plot<span class="ot">&lt;-</span><span class="fu">ggplot</span>(SP, <span class="fu">aes</span>( <span class="at">x =</span> Wavelength, <span class="at">y =</span> value, <span class="at">color =</span> Class))<span class="sc">+</span></span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> type, <span class="at">scale =</span> <span class="st">"free"</span>,<span class="at">ncol =</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#389318"</span>, <span class="st">"#873e23"</span>, <span class="st">"#b3002d"</span>, <span class="st">"#b3ff1a"</span>, <span class="st">"#DAA520"</span>))<span class="sc">+</span></span>
<span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Reflectance"</span>)<span class="sc">+</span></span>
<span id="cb100-35"><a href="#cb100-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Wavelength (nm)"</span>)<span class="sc">+</span></span>
<span id="cb100-36"><a href="#cb100-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb100-37"><a href="#cb100-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb100-38"><a href="#cb100-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb100-39"><a href="#cb100-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb100-40"><a href="#cb100-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb100-41"><a href="#cb100-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">25</span>),</span>
<span id="cb100-42"><a href="#cb100-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.7</span>),</span>
<span id="cb100-43"><a href="#cb100-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>, <span class="at">alpha=</span><span class="dv">0</span>), <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb100-44"><a href="#cb100-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb100-45"><a href="#cb100-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb100-46"><a href="#cb100-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">"cm"</span>),</span>
<span id="cb100-47"><a href="#cb100-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text.align =</span> <span class="dv">0</span>,</span>
<span id="cb100-48"><a href="#cb100-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb100-49"><a href="#cb100-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb100-50"><a href="#cb100-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color=</span><span class="st">"black"</span>))</span>
<span id="cb100-51"><a href="#cb100-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-52"><a href="#cb100-52" aria-hidden="true" tabindex="-1"></a><span class="do">############## VIP ##############</span></span>
<span id="cb100-53"><a href="#cb100-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-54"><a href="#cb100-54" aria-hidden="true" tabindex="-1"></a>filelist<span class="ot">&lt;-</span><span class="st">"Data"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb100-55"><a href="#cb100-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">"NN_VIP_byClass_NoXanth.csv"</span>, <span class="at">recursive =</span> T,<span class="at">full.names =</span> T)</span>
<span id="cb100-56"><a href="#cb100-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-57"><a href="#cb100-57" aria-hidden="true" tabindex="-1"></a>VIP<span class="ot">&lt;-</span>filelist[<span class="fu">which</span>(<span class="fu">str_detect</span>(filelist,<span class="st">"VIP"</span>))] <span class="sc">%&gt;%</span> </span>
<span id="cb100-58"><a href="#cb100-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb100-59"><a href="#cb100-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Magnoliopsida =</span> (Magnoliosida <span class="sc">+</span> Low_SPC)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-60"><a href="#cb100-60" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Magnoliosida ,Low_SPC))</span>
<span id="cb100-61"><a href="#cb100-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-62"><a href="#cb100-62" aria-hidden="true" tabindex="-1"></a>VIP1<span class="ot">&lt;-</span>VIP <span class="sc">%&gt;%</span></span>
<span id="cb100-63"><a href="#cb100-63" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Water,</span>
<span id="cb100-64"><a href="#cb100-64" aria-hidden="true" tabindex="-1"></a>                   SunGlint,</span>
<span id="cb100-65"><a href="#cb100-65" aria-hidden="true" tabindex="-1"></a>                   Deep_Sediment,</span>
<span id="cb100-66"><a href="#cb100-66" aria-hidden="true" tabindex="-1"></a>                   Bare_Sediment)) <span class="sc">%&gt;%</span></span>
<span id="cb100-67"><a href="#cb100-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::filter(!str_detect(X,"NDVI")) %&gt;% </span></span>
<span id="cb100-68"><a href="#cb100-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">isSTD =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(X,<span class="st">"Stan"</span>) <span class="sc">~</span> <span class="st">"Standardised"</span>, </span>
<span id="cb100-69"><a href="#cb100-69" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"RAW"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb100-70"><a href="#cb100-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(X,isSTD), <span class="at">names_to =</span> <span class="st">"Class"</span>,<span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-71"><a href="#cb100-71" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(X <span class="sc">!=</span> <span class="st">"NDVI"</span>,</span>
<span id="cb100-72"><a href="#cb100-72" aria-hidden="true" tabindex="-1"></a>                X <span class="sc">!=</span> <span class="st">"NDVI_Stan"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-73"><a href="#cb100-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Class) <span class="sc">%&gt;%</span></span>
<span id="cb100-74"><a href="#cb100-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">STD =</span> (value<span class="sc">-</span><span class="fu">min</span>(value))<span class="sc">/</span>(<span class="fu">max</span>(value)<span class="sc">-</span><span class="fu">min</span>(value))) <span class="sc">%&gt;%</span> </span>
<span id="cb100-75"><a href="#cb100-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb100-76"><a href="#cb100-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">case_when</span>(Class <span class="sc">==</span> <span class="st">"Magnoliosida"</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb100-77"><a href="#cb100-77" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"Low_SPC"</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb100-78"><a href="#cb100-78" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"Clorophyta"</span> <span class="sc">~</span> <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb100-79"><a href="#cb100-79" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"Rhodphyta"</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb100-80"><a href="#cb100-80" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"MPB"</span> <span class="sc">~</span> <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb100-81"><a href="#cb100-81" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"Phaeophyta"</span> <span class="sc">~</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb100-82"><a href="#cb100-82" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> Class),</span>
<span id="cb100-83"><a href="#cb100-83" aria-hidden="true" tabindex="-1"></a>         <span class="at">Variable =</span> <span class="fu">str_replace_all</span>(<span class="fu">str_replace_all</span>(<span class="fu">str_replace_all</span>(X,<span class="st">"Reflectance"</span>,<span class="st">""</span>),<span class="st">"Stan"</span>,<span class="st">""</span>),<span class="st">"_"</span>,<span class="st">""</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb100-84"><a href="#cb100-84" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">!=</span> <span class="st">"Total"</span>) </span>
<span id="cb100-85"><a href="#cb100-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-86"><a href="#cb100-86" aria-hidden="true" tabindex="-1"></a>VIP_summarised<span class="ot">&lt;-</span>VIP1 <span class="sc">%&gt;%</span> </span>
<span id="cb100-87"><a href="#cb100-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable, Class) <span class="sc">%&gt;%</span> </span>
<span id="cb100-88"><a href="#cb100-88" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">sumVIP =</span> <span class="fu">sum</span>(STD)) <span class="sc">%&gt;%</span> </span>
<span id="cb100-89"><a href="#cb100-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb100-90"><a href="#cb100-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Class) <span class="sc">%&gt;%</span> </span>
<span id="cb100-91"><a href="#cb100-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">STD =</span> (sumVIP<span class="sc">-</span><span class="fu">min</span>(sumVIP))<span class="sc">/</span>(<span class="fu">max</span>(sumVIP)<span class="sc">-</span><span class="fu">min</span>(sumVIP)))</span>
<span id="cb100-92"><a href="#cb100-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-93"><a href="#cb100-93" aria-hidden="true" tabindex="-1"></a>VIP_subPLOT<span class="ot">&lt;-</span>VIP_summarised <span class="sc">%&gt;%</span> </span>
<span id="cb100-94"><a href="#cb100-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Variable, <span class="at">y =</span> STD, <span class="at">fill =</span> Class)) <span class="sc">+</span></span>
<span id="cb100-95"><a href="#cb100-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>,<span class="at">position =</span>  <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb100-96"><a href="#cb100-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>()<span class="sc">+</span></span>
<span id="cb100-97"><a href="#cb100-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb100-98"><a href="#cb100-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Class)<span class="sc">+</span></span>
<span id="cb100-99"><a href="#cb100-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Class"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Bacillariophyceae"</span>,<span class="st">"Chlorophyceae"</span>, <span class="st">"Magnoliopsida"</span>, <span class="st">"Phaeophyceae"</span>,<span class="st">"Rhodophyceae"</span>),</span>
<span id="cb100-100"><a href="#cb100-100" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#DAA520"</span>,<span class="st">"#b3ff1a"</span>, <span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>))<span class="sc">+</span></span>
<span id="cb100-101"><a href="#cb100-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb100-102"><a href="#cb100-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">"dotted"</span>,<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"grey9"</span>,<span class="st">"grey9"</span>,<span class="st">"grey9"</span>,<span class="st">"grey9"</span>,<span class="cn">NA</span>)))<span class="sc">+</span></span>
<span id="cb100-103"><a href="#cb100-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Importance"</span>)<span class="sc">+</span></span>
<span id="cb100-104"><a href="#cb100-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>,</span>
<span id="cb100-105"><a href="#cb100-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb100-106"><a href="#cb100-106" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb100-107"><a href="#cb100-107" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb100-108"><a href="#cb100-108" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span><span class="fu">element_blank</span>(),</span>
<span id="cb100-109"><a href="#cb100-109" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span><span class="fu">element_blank</span>(),</span>
<span id="cb100-110"><a href="#cb100-110" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb100-111"><a href="#cb100-111" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">'cm'</span>),</span>
<span id="cb100-112"><a href="#cb100-112" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb100-113"><a href="#cb100-113" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb100-114"><a href="#cb100-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>))</span>
<span id="cb100-115"><a href="#cb100-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-116"><a href="#cb100-116" aria-hidden="true" tabindex="-1"></a>VIP_PLOT<span class="ot">&lt;-</span>VIP_subPLOT<span class="sc">+</span></span>
<span id="cb100-117"><a href="#cb100-117" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_text(aes(label = "Standardised Reflectance Spectra"), color = "black", size = 8)+</span></span>
<span id="cb100-118"><a href="#cb100-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inset_element</span>(SP_plot,<span class="at">left =</span> <span class="fl">0.6341</span>, <span class="at">top =</span> <span class="fl">0.47</span>, <span class="at">bottom =</span> <span class="sc">-</span><span class="fl">0.01</span>, <span class="at">right =</span> <span class="fl">0.90</span>,  <span class="at">align_to =</span> <span class="st">"full"</span>)</span>
<span id="cb100-119"><a href="#cb100-119" aria-hidden="true" tabindex="-1"></a>VIP_PLOT</span>
<span id="cb100-120"><a href="#cb100-120" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/VIP/Fig_VIP.png"</span>, VIP_PLOT, <span class="at">width =</span> <span class="dv">1920</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">1129</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb100-121"><a href="#cb100-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-122"><a href="#cb100-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-123"><a href="#cb100-123" aria-hidden="true" tabindex="-1"></a><span class="do">################# VIP NDVI ######################</span></span>
<span id="cb100-124"><a href="#cb100-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-125"><a href="#cb100-125" aria-hidden="true" tabindex="-1"></a>VIP_NDVI<span class="ot">&lt;-</span></span>
<span id="cb100-126"><a href="#cb100-126" aria-hidden="true" tabindex="-1"></a>  VIP <span class="sc">%&gt;%</span></span>
<span id="cb100-127"><a href="#cb100-127" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Water,</span>
<span id="cb100-128"><a href="#cb100-128" aria-hidden="true" tabindex="-1"></a>                   SunGlint,</span>
<span id="cb100-129"><a href="#cb100-129" aria-hidden="true" tabindex="-1"></a>                   Deep_Sediment,</span>
<span id="cb100-130"><a href="#cb100-130" aria-hidden="true" tabindex="-1"></a>                   Bare_Sediment)) <span class="sc">%&gt;%</span></span>
<span id="cb100-131"><a href="#cb100-131" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::filter(!str_detect(X,"NDVI")) %&gt;% </span></span>
<span id="cb100-132"><a href="#cb100-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">isSTD =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(X,<span class="st">"Stan"</span>) <span class="sc">~</span> <span class="st">"Standardised"</span>, </span>
<span id="cb100-133"><a href="#cb100-133" aria-hidden="true" tabindex="-1"></a>                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"RAW"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb100-134"><a href="#cb100-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(X,isSTD), <span class="at">names_to =</span> <span class="st">"Class"</span>,<span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-135"><a href="#cb100-135" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(X <span class="sc">==</span> <span class="st">"NDVI"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-136"><a href="#cb100-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Class) <span class="sc">%&gt;%</span></span>
<span id="cb100-137"><a href="#cb100-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">STD =</span> (value<span class="sc">-</span><span class="fu">min</span>(value))<span class="sc">/</span>(<span class="fu">max</span>(value)<span class="sc">-</span><span class="fu">min</span>(value))) <span class="sc">%&gt;%</span> </span>
<span id="cb100-138"><a href="#cb100-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb100-139"><a href="#cb100-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">case_when</span>(Class <span class="sc">==</span> <span class="st">"Magnoliosida"</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb100-140"><a href="#cb100-140" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"Low_SPC"</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb100-141"><a href="#cb100-141" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"Clorophyta"</span> <span class="sc">~</span> <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb100-142"><a href="#cb100-142" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"Rhodphyta"</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb100-143"><a href="#cb100-143" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"MPB"</span> <span class="sc">~</span> <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb100-144"><a href="#cb100-144" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"Phaeophyta"</span> <span class="sc">~</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb100-145"><a href="#cb100-145" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> Class),</span>
<span id="cb100-146"><a href="#cb100-146" aria-hidden="true" tabindex="-1"></a>         <span class="at">Variable =</span> <span class="fu">str_replace_all</span>(<span class="fu">str_replace_all</span>(<span class="fu">str_replace_all</span>(X,<span class="st">"Reflectance"</span>,<span class="st">""</span>),<span class="st">"Stan"</span>,<span class="st">""</span>),<span class="st">"_"</span>,<span class="st">""</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb100-147"><a href="#cb100-147" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">!=</span> <span class="st">"Total"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-148"><a href="#cb100-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Class) <span class="sc">%&gt;%</span> </span>
<span id="cb100-149"><a href="#cb100-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum =</span> <span class="fu">sum</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb100-150"><a href="#cb100-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">STD =</span> (sum<span class="sc">-</span><span class="fu">min</span>(sum))<span class="sc">/</span>(<span class="fu">max</span>(sum)<span class="sc">-</span><span class="fu">min</span>(sum))) <span class="sc">%&gt;%</span> </span>
<span id="cb100-151"><a href="#cb100-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Class, <span class="at">y =</span> STD, <span class="at">fill =</span> Class)) <span class="sc">+</span></span>
<span id="cb100-152"><a href="#cb100-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>,<span class="at">position =</span>  <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb100-153"><a href="#cb100-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_polar()+</span></span>
<span id="cb100-154"><a href="#cb100-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb100-155"><a href="#cb100-155" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~Class)+</span></span>
<span id="cb100-156"><a href="#cb100-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Class"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Bacillariophyceae"</span>,<span class="st">"Chlorophyceae"</span>, <span class="st">"Magnoliopsida"</span>, <span class="st">"Phaeophyceae"</span>,<span class="st">"Rhodophyceae"</span>),</span>
<span id="cb100-157"><a href="#cb100-157" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#DAA520"</span>,<span class="st">"#b3ff1a"</span>, <span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>))<span class="sc">+</span>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb100-158"><a href="#cb100-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">"dotted"</span>,<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"grey9"</span>,<span class="st">"grey9"</span>,<span class="st">"grey9"</span>,<span class="st">"grey9"</span>,<span class="cn">NA</span>)))<span class="sc">+</span></span>
<span id="cb100-159"><a href="#cb100-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Importance"</span>)<span class="sc">+</span></span>
<span id="cb100-160"><a href="#cb100-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>,</span>
<span id="cb100-161"><a href="#cb100-161" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb100-162"><a href="#cb100-162" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb100-163"><a href="#cb100-163" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb100-164"><a href="#cb100-164" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span><span class="fu">element_blank</span>(),</span>
<span id="cb100-165"><a href="#cb100-165" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span><span class="fu">element_blank</span>(),</span>
<span id="cb100-166"><a href="#cb100-166" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb100-167"><a href="#cb100-167" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">'cm'</span>),</span>
<span id="cb100-168"><a href="#cb100-168" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb100-169"><a href="#cb100-169" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb100-170"><a href="#cb100-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<p>The computation of the variable importance made it possible to identify which bands were the most useful for class prediction (<a href="#fig-VIP" class="quarto-xref">Figure&nbsp;10</a>).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [41]:</pre></div><div id="cell-fig-VIP" class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figures/Low_res/VIP/Fig_VIP.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-VIP" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-VIP-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figures/Low_res/VIP/Fig_VIP.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" title="Figure&nbsp;10: Variable Importance of the Neural Network Classifier for each taxonomic class. The longer the slice, the more important the variable for prediction of each class. The right plot shows the drone raw and standardised reflectance spectra of each class. Each slice represents the Variable Importance (VI) of both raw and standardised reflectance combined."><img src="Figures/Low_res/VIP/Fig_VIP.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-VIP-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Variable Importance of the Neural Network Classifier for each taxonomic class. The longer the slice, the more important the variable for prediction of each class. The right plot shows the drone raw and standardised reflectance spectra of each class. Each slice represents the Variable Importance (VI) of both raw and standardised reflectance combined.
</figcaption>
</figure>
</div>
</div>
</div></div>
<p>The spectral bands at 444, 717 and 842 nm of the Micasense camera did not provide important information to discriminate any of the vegetation classes. The band at 531 nm was the most important predictor by far for the classifier to accurately predict Chlorophyceae. In fact, at this wavelength, the Chlorophyceae spectra showed the highest reflectance among all vegetation classes (<a href="#fig-vegetation" class="quarto-xref">Figure&nbsp;2</a> F). The bands at 531 and 740 nm were the most important predictors for Phaeophyceae, corresponding to the lowest reflectance among all classes. Bands at 475 and 560 nm were the most important predictors for Bacillariophyceae and Rhodophyceae, respectively. Four predictors, ranging from the green (560 nm) to the RedEdge (705 nm) bands were important to accurately predict Magnoliopsida.</p>
</section>
<section id="effect-of-spatial-resolution-on-the-classification" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="effect-of-spatial-resolution-on-the-classification"><span class="header-section-number">3.5</span> Effect of spatial resolution on the classification</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [42]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>img_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"Data/BiCOME_Flights"</span>, <span class="at">pattern =</span> <span class="st">".tif"</span>, <span class="at">recursive =</span> T, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">".*/"</span>,<span class="st">""</span>,path),</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">sites =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Boat1"</span>) <span class="sc">~</span> <span class="st">"Boat1"</span>,</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"Boat2"</span>) <span class="sc">~</span> <span class="st">"Boat2"</span>,</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"GafanhaHigh"</span>) <span class="sc">~</span> <span class="st">"GafanhaHigh"</span>,</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"GafanhaLow"</span>) <span class="sc">~</span> <span class="st">"GafanhaLow"</span>,</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"Horse_rooster"</span>) <span class="sc">~</span> <span class="st">"Horse_rooster"</span>,</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"Gois"</span>) <span class="sc">~</span> <span class="st">"Gois"</span>,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"Handfisher_1"</span>) <span class="sc">~</span> <span class="st">"Handfisher_1"</span>,</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"Handfisher_2"</span>) <span class="sc">~</span> <span class="st">"Handfisher_2"</span>,</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"NorthDike"</span>) <span class="sc">~</span> <span class="st">"NorthDike"</span>,</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"Arz"</span>) <span class="sc">~</span> <span class="st">"Arz"</span>,</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"DuerHigh"</span>) <span class="sc">~</span> <span class="st">"DuerHigh"</span>,</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"DuerLow"</span>) <span class="sc">~</span> <span class="st">"DuerLow"</span>,</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"Kerdrean"</span>) <span class="sc">~</span> <span class="st">"Kerdrean"</span>,</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"Locmariaquer"</span>) <span class="sc">~</span> <span class="st">"Locmariaquer"</span>),</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">"Preds"</span>) <span class="sc">~</span> <span class="st">"Pred"</span>,</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(name, <span class="st">"Probs"</span>) <span class="sc">~</span> <span class="st">"Prob"</span>,</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> <span class="st">"Ortho"</span>),</span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">filter =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path,<span class="st">"Majority_filter_21by21"</span>)<span class="sc">~</span> <span class="st">"21"</span>,</span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">str_detect</span>(path,<span class="st">"Majority_filter_7by7"</span>)<span class="sc">~</span> <span class="st">"7"</span>,</span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">str_detect</span>(path,<span class="st">"Majority_filter"</span>)<span class="sc">~</span> <span class="st">"3"</span>,</span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">str_detect</span>(path,<span class="st">"RAW"</span>)<span class="sc">~</span> <span class="st">"RAW"</span>,</span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>                            T <span class="sc">~</span> <span class="st">"NA"</span>),</span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">UTM_zone =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"Aveiro"</span>) <span class="sc">~</span> <span class="dv">32629</span>,</span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">32630</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(path, <span class="st">".tif.aux.xml"</span>),</span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">str_detect</span>(path, <span class="st">".tif.enp"</span>),</span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a>                type <span class="sc">==</span> <span class="st">"Ortho"</span>)</span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a>res_to_resample <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">25</span>,<span class="dv">30</span>,<span class="dv">35</span>,<span class="dv">40</span>,<span class="dv">45</span>,<span class="dv">50</span>,<span class="dv">55</span>,<span class="dv">60</span>,<span class="dv">65</span>,<span class="dv">70</span>,<span class="dv">75</span>,<span class="dv">80</span>,<span class="dv">85</span>,<span class="dv">90</span>,<span class="dv">95</span>,<span class="dv">100</span>,<span class="dv">200</span>,<span class="dv">300</span>,<span class="dv">400</span>,<span class="dv">500</span>,<span class="dv">600</span>,<span class="dv">700</span>,<span class="dv">800</span>,<span class="dv">900</span>,<span class="dv">1000</span>,<span class="dv">1500</span>,<span class="dv">2000</span>,<span class="dv">2500</span>,<span class="dv">3000</span>)</span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a>res_to_resample <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2000</span>)</span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pb2 &lt;- progress_bar$new(</span></span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># format = "  Processing [:bar] :percent in :elapsed",</span></span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># total = length(res_to_resample),    # Total number of iterations</span></span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># width = 60    # Width of the progress bar</span></span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-43"><a href="#cb102-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(img_list)){</span>
<span id="cb102-44"><a href="#cb102-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># pb2$tick()</span></span>
<span id="cb102-45"><a href="#cb102-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-46"><a href="#cb102-46" aria-hidden="true" tabindex="-1"></a>  img <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(img_list<span class="sc">$</span>path[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb102-47"><a href="#cb102-47" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(<span class="fu">paste0</span>(<span class="st">"EPSG:"</span>, img_list<span class="sc">$</span>UTM_zone[i]), <span class="at">thread =</span> T)</span>
<span id="cb102-48"><a href="#cb102-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-49"><a href="#cb102-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-50"><a href="#cb102-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_to_resample)){</span>
<span id="cb102-51"><a href="#cb102-51" aria-hidden="true" tabindex="-1"></a>    new_res <span class="ot">&lt;-</span> res_to_resample[ii]<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb102-52"><a href="#cb102-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-53"><a href="#cb102-53" aria-hidden="true" tabindex="-1"></a>    r_template <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">ext</span>(img), <span class="at">resolution =</span> new_res, <span class="at">crs =</span> <span class="fu">crs</span>(img))</span>
<span id="cb102-54"><a href="#cb102-54" aria-hidden="true" tabindex="-1"></a>    r_resampled <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(img, r_template, <span class="at">method=</span><span class="st">"bilinear"</span>, <span class="at">threads =</span> T)<span class="sc">%&gt;%</span> </span>
<span id="cb102-55"><a href="#cb102-55" aria-hidden="true" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">project</span>(<span class="st">"EPSG:4326"</span>, <span class="at">thread =</span> T)</span>
<span id="cb102-56"><a href="#cb102-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-57"><a href="#cb102-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb102-58"><a href="#cb102-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(<span class="st">"Data/Resampling/"</span>,res_to_resample[ii],<span class="st">"cm"</span>))){</span>
<span id="cb102-59"><a href="#cb102-59" aria-hidden="true" tabindex="-1"></a>       <span class="fu">dir.create</span>(<span class="fu">paste0</span>(<span class="st">"Data/Resampling/"</span>,res_to_resample[ii],<span class="st">"cm"</span>), <span class="at">recursive =</span> T) </span>
<span id="cb102-60"><a href="#cb102-60" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb102-61"><a href="#cb102-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb102-62"><a href="#cb102-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeRaster</span>(r_resampled, <span class="fu">paste0</span>(<span class="st">"Data/Resampling/"</span>,res_to_resample[ii],<span class="st">"cm/"</span>,<span class="fu">gsub</span>(<span class="st">".tif"</span>,<span class="fu">paste0</span>(<span class="st">"_"</span>,res_to_resample[ii],<span class="st">"cm.tif"</span>),img_list<span class="sc">$</span>name[i])),<span class="at">overwrite =</span> T)</span>
<span id="cb102-63"><a href="#cb102-63" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb102-64"><a href="#cb102-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-65"><a href="#cb102-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-66"><a href="#cb102-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-67"><a href="#cb102-67" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"D:/Git_repo/DISCOV-MicaSense/Data/img"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb102-68"><a href="#cb102-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb102-69"><a href="#cb102-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb102-70"><a href="#cb102-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">".*/"</span>,<span class="st">""</span>,path) <span class="sc">%&gt;%</span> <span class="fu">gsub</span>(<span class="st">".tif"</span>,<span class="st">""</span>,.)) <span class="sc">%&gt;%</span> </span>
<span id="cb102-71"><a href="#cb102-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::filter(str_detect("Arz_29092022_Fl2_12m*", name))</span></span>
<span id="cb102-72"><a href="#cb102-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb102-73"><a href="#cb102-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_c</span>(<span class="at">collapse =</span> <span class="st">"</span><span class="sc">\"</span><span class="st">, </span><span class="sc">\"</span><span class="st">"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-74"><a href="#cb102-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_c</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, ., <span class="st">"</span><span class="sc">\"</span><span class="st">"</span>)</span>
<span id="cb102-75"><a href="#cb102-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-76"><a href="#cb102-76" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(a)</span>
<span id="cb102-77"><a href="#cb102-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-78"><a href="#cb102-78" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(a, </span>
<span id="cb102-79"><a href="#cb102-79" aria-hidden="true" tabindex="-1"></a>  <span class="st">"test.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [43]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>list_pred <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"Data/Predictions/Resampled"</span>,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">".*/"</span>,<span class="st">""</span>,path),</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">"_prob.tif"</span>) <span class="sc">~</span> <span class="st">"Prob"</span>,</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> <span class="st">"Pred"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Pred"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span><span class="fu">sub</span>(<span class="st">".*_(</span><span class="sc">\\</span><span class="st">d+)cm_.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, name) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">ortho_name  =</span> <span class="fu">sub</span>(<span class="st">"_(</span><span class="sc">\\</span><span class="st">d+)cm_.*"</span>, <span class="st">""</span>, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ortho_name,res) <span class="sc">%&gt;%</span> </span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(ortho_name, <span class="st">"Aveiro_1506_Highest"</span>) <span class="sc">~</span> <span class="st">"Aveiro"</span>,</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Aveiro_boat_1706_flight_1"</span>) <span class="sc">~</span> <span class="st">"Boat1"</span>,</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Aveiro_boat_1706_flight_2"</span>) <span class="sc">~</span> <span class="st">"Boat2"</span>,</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"NoirmoutierNorthDikeSite"</span>) <span class="sc">~</span> <span class="st">"NorthDike"</span>,</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Duer_15072022_120m"</span>) <span class="sc">~</span> <span class="st">"Duer"</span>,</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"handfisher_Ortho"</span>) <span class="sc">~</span> <span class="st">"handfisher_Ortho"</span>,</span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Horse_rooster"</span>) <span class="sc">~</span> <span class="st">"Horse_rooster"</span>,</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"fl1_120m_handfisher_old"</span>) <span class="sc">~</span> <span class="st">"fl1_120m_handfisher_old"</span>,</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"fl2_120m_handfisher_old"</span>) <span class="sc">~</span> <span class="st">"fl2_120m_handfisher_old"</span>,</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>site <span class="sc">==</span> <span class="st">"handfisher_Ortho"</span>,</span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>site <span class="sc">==</span> <span class="st">"Duer"</span>)</span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>scales <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">res =</span> <span class="fu">unique</span>(list_pred<span class="sc">$</span>res)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">case_when</span>(res <span class="sc">&lt;</span> <span class="dv">100</span> <span class="sc">~</span>  <span class="fu">paste0</span>(res, <span class="st">"cm"</span>),</span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>                           T <span class="sc">~</span> <span class="fu">paste0</span>(res <span class="sc">/</span> <span class="dv">100</span>, <span class="st">"m"</span>)))</span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>extremes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">res =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">3000</span>),</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"10cm"</span>, <span class="st">"30m"</span>)</span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-33"><a href="#cb103-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-34"><a href="#cb103-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span><span class="fu">nrow</span>(scales)){</span>
<span id="cb103-35"><a href="#cb103-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-36"><a href="#cb103-36" aria-hidden="true" tabindex="-1"></a> point_of_interest <span class="ot">&lt;-</span> scales[i,]</span>
<span id="cb103-37"><a href="#cb103-37" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb103-38"><a href="#cb103-38" aria-hidden="true" tabindex="-1"></a> a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb103-39"><a href="#cb103-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb103-40"><a href="#cb103-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Draw the axis as a line</span></span>
<span id="cb103-41"><a href="#cb103-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">10</span>, <span class="at">xend =</span> <span class="dv">3000</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">0</span>), <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb103-42"><a href="#cb103-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-43"><a href="#cb103-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the points at the extremities with labels</span></span>
<span id="cb103-44"><a href="#cb103-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> extremes, <span class="fu">aes</span>(<span class="at">x =</span> res, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> label), <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb103-45"><a href="#cb103-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-46"><a href="#cb103-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the point of interest with a label</span></span>
<span id="cb103-47"><a href="#cb103-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> point_of_interest, <span class="fu">aes</span>(<span class="at">x =</span> res, <span class="at">y =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb103-48"><a href="#cb103-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> point_of_interest, <span class="fu">aes</span>(<span class="at">x =</span> res, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> label), <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb103-49"><a href="#cb103-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-50"><a href="#cb103-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Scale the x-axis from 10 to 3000 cm</span></span>
<span id="cb103-51"><a href="#cb103-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_x_continuous(limits = c(10, 3000), breaks = c(10, 100, 500, 1000, 1500, 2000, 2500, 3000)) +</span></span>
<span id="cb103-52"><a href="#cb103-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-53"><a href="#cb103-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Customize the theme to remove y-axis</span></span>
<span id="cb103-54"><a href="#cb103-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># theme_minimal() +</span></span>
<span id="cb103-55"><a href="#cb103-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb103-56"><a href="#cb103-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb103-57"><a href="#cb103-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb103-58"><a href="#cb103-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb103-59"><a href="#cb103-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb103-60"><a href="#cb103-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb103-61"><a href="#cb103-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb103-62"><a href="#cb103-62" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb103-63"><a href="#cb103-63" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb103-64"><a href="#cb103-64" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">"output/plot/scales/"</span>,point_of_interest<span class="sc">$</span>res,<span class="st">".png"</span>),a, <span class="at">bg =</span> <span class="st">"white"</span>,<span class="at">width =</span> <span class="dv">1904</span><span class="sc">*</span><span class="dv">2</span>, <span class="at">height =</span> <span class="dv">132</span><span class="sc">*</span><span class="dv">2</span>, <span class="at">unit =</span> <span class="st">"px"</span> )</span>
<span id="cb103-65"><a href="#cb103-65" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb103-66"><a href="#cb103-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-67"><a href="#cb103-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-68"><a href="#cb103-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-69"><a href="#cb103-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(list_pred)){</span>
<span id="cb103-70"><a href="#cb103-70" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb103-71"><a href="#cb103-71" aria-hidden="true" tabindex="-1"></a>    img <span class="ot">&lt;-</span> list_pred<span class="sc">$</span>path[i] <span class="sc">%&gt;%</span> </span>
<span id="cb103-72"><a href="#cb103-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rast</span>() </span>
<span id="cb103-73"><a href="#cb103-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(img) <span class="ot">&lt;-</span> <span class="st">"layer"</span></span>
<span id="cb103-74"><a href="#cb103-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-75"><a href="#cb103-75" aria-hidden="true" tabindex="-1"></a>    img <span class="ot">&lt;-</span> img <span class="sc">%&gt;%</span> </span>
<span id="cb103-76"><a href="#cb103-76" aria-hidden="true" tabindex="-1"></a>       dplyr<span class="sc">::</span><span class="fu">filter</span>(layer <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb103-77"><a href="#cb103-77" aria-hidden="true" tabindex="-1"></a>                     layer <span class="sc">&lt;=</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-78"><a href="#cb103-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">layer =</span> <span class="fu">as.factor</span>(layer))</span>
<span id="cb103-79"><a href="#cb103-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ifel(img$layer == 0 | img$layer &gt; 8, NA, img$layer)</span></span>
<span id="cb103-80"><a href="#cb103-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-81"><a href="#cb103-81" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span>(list_pred<span class="sc">$</span>site[i] <span class="sc">==</span> <span class="st">"Aveiro"</span>){</span>
<span id="cb103-82"><a href="#cb103-82" aria-hidden="true" tabindex="-1"></a>       mask <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Data/shp/Aveiro/background_Gafanha_high.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-83"><a href="#cb103-83" aria-hidden="true" tabindex="-1"></a>         dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">!=</span> <span class="st">"Land"</span>)</span>
<span id="cb103-84"><a href="#cb103-84" aria-hidden="true" tabindex="-1"></a>     }<span class="cf">else</span>{</span>
<span id="cb103-85"><a href="#cb103-85" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span>(list_pred<span class="sc">$</span>site[i]  <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Boat1"</span>,<span class="st">"Boat2"</span>)){</span>
<span id="cb103-86"><a href="#cb103-86" aria-hidden="true" tabindex="-1"></a>         mask <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Data/shp/Aveiro/background_Boat.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-87"><a href="#cb103-87" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">!=</span> <span class="st">"Land"</span>)</span>
<span id="cb103-88"><a href="#cb103-88" aria-hidden="true" tabindex="-1"></a>       }<span class="cf">else</span>{</span>
<span id="cb103-89"><a href="#cb103-89" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span>(list_pred<span class="sc">$</span>site[i] <span class="sc">==</span> <span class="st">"NorthDike"</span>){</span>
<span id="cb103-90"><a href="#cb103-90" aria-hidden="true" tabindex="-1"></a>           mask <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Data/shp/Bourgneuf/background_Dike.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-91"><a href="#cb103-91" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">!=</span> <span class="st">"Land"</span>)</span>
<span id="cb103-92"><a href="#cb103-92" aria-hidden="true" tabindex="-1"></a>         }<span class="cf">else</span>{</span>
<span id="cb103-93"><a href="#cb103-93" aria-hidden="true" tabindex="-1"></a>           <span class="cf">if</span>(list_pred<span class="sc">$</span>site[i] <span class="sc">==</span> <span class="st">"Horse_rooster"</span>){</span>
<span id="cb103-94"><a href="#cb103-94" aria-hidden="true" tabindex="-1"></a>             mask <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Data/shp/Aveiro/background_Horse_rooster.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-95"><a href="#cb103-95" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">!=</span> <span class="st">"Land"</span>)</span>
<span id="cb103-96"><a href="#cb103-96" aria-hidden="true" tabindex="-1"></a>           }<span class="cf">else</span>{</span>
<span id="cb103-97"><a href="#cb103-97" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(list_pred<span class="sc">$</span>site[i]  <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"fl1_120m_handfisher_old"</span>,<span class="st">"fl2_120m_handfisher_old"</span>)){</span>
<span id="cb103-98"><a href="#cb103-98" aria-hidden="true" tabindex="-1"></a>              mask <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Data/shp/Bourgneuf/background_fisherman.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-99"><a href="#cb103-99" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(Type <span class="sc">!=</span> <span class="st">"Land"</span>)</span>
<span id="cb103-100"><a href="#cb103-100" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb103-101"><a href="#cb103-101" aria-hidden="true" tabindex="-1"></a>           }</span>
<span id="cb103-102"><a href="#cb103-102" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb103-103"><a href="#cb103-103" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb103-104"><a href="#cb103-104" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb103-105"><a href="#cb103-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-106"><a href="#cb103-106" aria-hidden="true" tabindex="-1"></a>    low_res <span class="ot">&lt;-</span>  list_pred <span class="sc">%&gt;%</span> </span>
<span id="cb103-107"><a href="#cb103-107" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(site <span class="sc">==</span> list_pred<span class="sc">$</span>site[i],</span>
<span id="cb103-108"><a href="#cb103-108" aria-hidden="true" tabindex="-1"></a>                    res <span class="sc">==</span> <span class="fu">max</span>(res)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-109"><a href="#cb103-109" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb103-110"><a href="#cb103-110" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rast</span>()</span>
<span id="cb103-111"><a href="#cb103-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-112"><a href="#cb103-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(low_res) <span class="ot">&lt;-</span> <span class="st">"layer"</span></span>
<span id="cb103-113"><a href="#cb103-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-114"><a href="#cb103-114" aria-hidden="true" tabindex="-1"></a>    low_res <span class="ot">&lt;-</span> low_res <span class="sc">%&gt;%</span> </span>
<span id="cb103-115"><a href="#cb103-115" aria-hidden="true" tabindex="-1"></a>       dplyr<span class="sc">::</span><span class="fu">filter</span>(layer <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb103-116"><a href="#cb103-116" aria-hidden="true" tabindex="-1"></a>                     layer <span class="sc">&lt;=</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-117"><a href="#cb103-117" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">layer =</span> <span class="fu">as.factor</span>(layer))</span>
<span id="cb103-118"><a href="#cb103-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-119"><a href="#cb103-119" aria-hidden="true" tabindex="-1"></a>     img <span class="ot">&lt;-</span> <span class="fu">mask</span>(img,mask)</span>
<span id="cb103-120"><a href="#cb103-120" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb103-121"><a href="#cb103-121" aria-hidden="true" tabindex="-1"></a>     df_layer <span class="ot">&lt;-</span> img <span class="sc">%&gt;%</span> </span>
<span id="cb103-122"><a href="#cb103-122" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb103-123"><a href="#cb103-123" aria-hidden="true" tabindex="-1"></a>      <span class="co"># mutate(layer = as.numeric(layer)) %&gt;%</span></span>
<span id="cb103-124"><a href="#cb103-124" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(layer),</span>
<span id="cb103-125"><a href="#cb103-125" aria-hidden="true" tabindex="-1"></a>             layer <span class="sc">!=</span> <span class="dv">0</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb103-126"><a href="#cb103-126" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(layer) <span class="sc">%&gt;%</span></span>
<span id="cb103-127"><a href="#cb103-127" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb103-128"><a href="#cb103-128" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">percentage =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb103-129"><a href="#cb103-129" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="fu">paste0</span>(layer, <span class="st">" ("</span>, <span class="fu">round</span>(percentage, <span class="dv">1</span>), <span class="st">"%)"</span>))    </span>
<span id="cb103-130"><a href="#cb103-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-131"><a href="#cb103-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-132"><a href="#cb103-132" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb103-133"><a href="#cb103-133" aria-hidden="true" tabindex="-1"></a>      <span class="at">layer =</span> <span class="fu">as.character</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)),</span>
<span id="cb103-134"><a href="#cb103-134" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"#DAA520"</span>,<span class="st">"#b3ff1a"</span>,<span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>)</span>
<span id="cb103-135"><a href="#cb103-135" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb103-136"><a href="#cb103-136" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-137"><a href="#cb103-137" aria-hidden="true" tabindex="-1"></a>    layer_counts <span class="ot">&lt;-</span> df_layer <span class="sc">%&gt;%</span> </span>
<span id="cb103-138"><a href="#cb103-138" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">layer =</span> <span class="fu">as.character</span>(layer)) <span class="sc">%&gt;%</span></span>
<span id="cb103-139"><a href="#cb103-139" aria-hidden="true" tabindex="-1"></a>      <span class="co"># dplyr::filter(layer %in% c("3","4") ) %&gt;% </span></span>
<span id="cb103-140"><a href="#cb103-140" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(layer,count) <span class="sc">%&gt;%</span> </span>
<span id="cb103-141"><a href="#cb103-141" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(layer <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span>,<span class="st">"4"</span>,<span class="st">"5"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-142"><a href="#cb103-142" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(colors, <span class="at">by =</span> <span class="st">"layer"</span>)</span>
<span id="cb103-143"><a href="#cb103-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-144"><a href="#cb103-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">png</span>(<span class="st">"pie_chart.png"</span>, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">800</span>, <span class="at">bg =</span> <span class="st">"transparent"</span>)</span>
<span id="cb103-145"><a href="#cb103-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-146"><a href="#cb103-146" aria-hidden="true" tabindex="-1"></a>    plotrix<span class="sc">::</span><span class="fu">pie3D</span>(layer_counts<span class="sc">$</span>count,</span>
<span id="cb103-147"><a href="#cb103-147" aria-hidden="true" tabindex="-1"></a>      <span class="co"># labels = layer_counts$layer,</span></span>
<span id="cb103-148"><a href="#cb103-148" aria-hidden="true" tabindex="-1"></a>      <span class="at">explode =</span> <span class="fl">0.1</span>, <span class="co"># Adds space between the slices</span></span>
<span id="cb103-149"><a href="#cb103-149" aria-hidden="true" tabindex="-1"></a>      <span class="co"># main = "3D Pie Chart of Layer",</span></span>
<span id="cb103-150"><a href="#cb103-150" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> layer_counts<span class="sc">$</span>color,</span>
<span id="cb103-151"><a href="#cb103-151" aria-hidden="true" tabindex="-1"></a>      <span class="at">radius =</span> <span class="fl">0.5</span>,</span>
<span id="cb103-152"><a href="#cb103-152" aria-hidden="true" tabindex="-1"></a>      <span class="at">theta =</span> <span class="dv">2</span>)</span>
<span id="cb103-153"><a href="#cb103-153" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb103-154"><a href="#cb103-154" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb103-155"><a href="#cb103-155" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-156"><a href="#cb103-156" aria-hidden="true" tabindex="-1"></a>    img_grob <span class="ot">&lt;-</span> grid<span class="sc">::</span><span class="fu">rasterGrob</span>(png<span class="sc">::</span><span class="fu">readPNG</span>(<span class="st">"pie_chart.png"</span>), </span>
<span id="cb103-157"><a href="#cb103-157" aria-hidden="true" tabindex="-1"></a>                             <span class="at">interpolate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-158"><a href="#cb103-158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-159"><a href="#cb103-159" aria-hidden="true" tabindex="-1"></a>    scale_grob <span class="ot">&lt;-</span> grid<span class="sc">::</span><span class="fu">rasterGrob</span>(png<span class="sc">::</span><span class="fu">readPNG</span>(<span class="fu">paste0</span>(<span class="st">"Output/plot/scales/"</span>,list_pred<span class="sc">$</span>res[i],<span class="st">".png"</span>)), </span>
<span id="cb103-160"><a href="#cb103-160" aria-hidden="true" tabindex="-1"></a>                             <span class="at">interpolate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-161"><a href="#cb103-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-162"><a href="#cb103-162" aria-hidden="true" tabindex="-1"></a>   plot <span class="ot">&lt;-</span>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb103-163"><a href="#cb103-163" aria-hidden="true" tabindex="-1"></a>        tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> img, </span>
<span id="cb103-164"><a href="#cb103-164" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer),</span>
<span id="cb103-165"><a href="#cb103-165" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">maxcell =</span> <span class="dv">500832</span><span class="sc">*</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb103-166"><a href="#cb103-166" aria-hidden="true" tabindex="-1"></a>     tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data =</span> low_res, </span>
<span id="cb103-167"><a href="#cb103-167" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer), </span>
<span id="cb103-168"><a href="#cb103-168" aria-hidden="true" tabindex="-1"></a>                                <span class="at">alpha =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb103-169"><a href="#cb103-169" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb103-170"><a href="#cb103-170" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="dv">4326</span>)<span class="sc">+</span></span>
<span id="cb103-171"><a href="#cb103-171" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>),</span>
<span id="cb103-172"><a href="#cb103-172" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="st">"#DAA520"</span>, <span class="st">"#b3ff1a"</span>,<span class="st">"#389318"</span>,<span class="st">"#873e23"</span>,<span class="st">"#b3002d"</span>,<span class="st">"#797a79"</span>,<span class="st">"white"</span>,<span class="st">"#42c9bc"</span>),</span>
<span id="cb103-173"><a href="#cb103-173" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb103-174"><a href="#cb103-174" aria-hidden="true" tabindex="-1"></a>                        <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb103-175"><a href="#cb103-175" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb103-176"><a href="#cb103-176" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb103-177"><a href="#cb103-177" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb103-178"><a href="#cb103-178" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb103-179"><a href="#cb103-179" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb103-180"><a href="#cb103-180" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Sediment"</span>,</span>
<span id="cb103-181"><a href="#cb103-181" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Sunglint"</span>,</span>
<span id="cb103-182"><a href="#cb103-182" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Water"</span>))<span class="sc">+</span></span>
<span id="cb103-183"><a href="#cb103-183" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_Bede_Map</span>()<span class="sc">+</span></span>
<span id="cb103-184"><a href="#cb103-184" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">angle =</span> <span class="dv">20</span>,<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb103-185"><a href="#cb103-185" aria-hidden="true" tabindex="-1"></a>           <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb103-186"><a href="#cb103-186" aria-hidden="true" tabindex="-1"></a>           <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb103-187"><a href="#cb103-187" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb103-188"><a href="#cb103-188" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb103-189"><a href="#cb103-189" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">"cm"</span>))</span>
<span id="cb103-190"><a href="#cb103-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-191"><a href="#cb103-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-192"><a href="#cb103-192" aria-hidden="true" tabindex="-1"></a>   plot_limits <span class="ot">&lt;-</span> <span class="fu">ggplot_build</span>(plot)<span class="sc">$</span>layout<span class="sc">$</span>panel_params[[<span class="dv">1</span>]]</span>
<span id="cb103-193"><a href="#cb103-193" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-194"><a href="#cb103-194" aria-hidden="true" tabindex="-1"></a>    x_range <span class="ot">&lt;-</span> plot_limits<span class="sc">$</span>x_range</span>
<span id="cb103-195"><a href="#cb103-195" aria-hidden="true" tabindex="-1"></a>    y_range <span class="ot">&lt;-</span> plot_limits<span class="sc">$</span>y_range</span>
<span id="cb103-196"><a href="#cb103-196" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-197"><a href="#cb103-197" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(list_pred<span class="sc">$</span>site[i] <span class="sc">==</span> <span class="st">"Aveiro"</span>){</span>
<span id="cb103-198"><a href="#cb103-198" aria-hidden="true" tabindex="-1"></a>      x_position_1 <span class="ot">&lt;-</span> x_range[<span class="dv">2</span>] <span class="sc">-</span> (x_range[<span class="dv">2</span>] <span class="sc">-</span> x_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.4</span></span>
<span id="cb103-199"><a href="#cb103-199" aria-hidden="true" tabindex="-1"></a>      y_position_1 <span class="ot">&lt;-</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> (y_range[<span class="dv">2</span>] <span class="sc">-</span> y_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.4</span></span>
<span id="cb103-200"><a href="#cb103-200" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb103-201"><a href="#cb103-201" aria-hidden="true" tabindex="-1"></a>      x_position_2 <span class="ot">&lt;-</span> x_range[<span class="dv">2</span>] <span class="sc">-</span> (x_range[<span class="dv">2</span>] <span class="sc">-</span> x_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb103-202"><a href="#cb103-202" aria-hidden="true" tabindex="-1"></a>      y_position_2 <span class="ot">&lt;-</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> (y_range[<span class="dv">2</span>] <span class="sc">-</span> y_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb103-203"><a href="#cb103-203" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb103-204"><a href="#cb103-204" aria-hidden="true" tabindex="-1"></a>      plot <span class="ot">&lt;-</span> plot <span class="sc">+</span> <span class="fu">annotation_custom</span>(</span>
<span id="cb103-205"><a href="#cb103-205" aria-hidden="true" tabindex="-1"></a>          <span class="at">grob =</span> img_grob,<span class="at">xmin =</span> x_position_1,<span class="at">xmax =</span> x_range[<span class="dv">2</span>], <span class="at">ymin =</span> y_range[<span class="dv">1</span>], <span class="at">ymax =</span> y_position_1)<span class="sc">+</span></span>
<span id="cb103-206"><a href="#cb103-206" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.91</span>,<span class="fl">0.6</span>))<span class="sc">+</span></span>
<span id="cb103-207"><a href="#cb103-207" aria-hidden="true" tabindex="-1"></a>         <span class="fu">annotation_custom</span>(</span>
<span id="cb103-208"><a href="#cb103-208" aria-hidden="true" tabindex="-1"></a>          <span class="at">grob =</span> scale_grob,<span class="at">xmin =</span> x_position_2,<span class="at">xmax =</span> x_range[<span class="dv">2</span>], <span class="at">ymin =</span> y_range[<span class="dv">1</span>], <span class="at">ymax =</span> y_position_2)<span class="sc">+</span></span>
<span id="cb103-209"><a href="#cb103-209" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.91</span>,<span class="fl">0.6</span>))</span>
<span id="cb103-210"><a href="#cb103-210" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb103-211"><a href="#cb103-211" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb103-212"><a href="#cb103-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-213"><a href="#cb103-213" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(list_pred<span class="sc">$</span>site[i] <span class="sc">==</span> <span class="st">"Boat1"</span>){</span>
<span id="cb103-214"><a href="#cb103-214" aria-hidden="true" tabindex="-1"></a>      x_position_1 <span class="ot">&lt;-</span> x_range[<span class="dv">2</span>] <span class="sc">-</span> (x_range[<span class="dv">2</span>] <span class="sc">-</span> x_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">1.15</span></span>
<span id="cb103-215"><a href="#cb103-215" aria-hidden="true" tabindex="-1"></a>      x_position_12 <span class="ot">&lt;-</span> x_range[<span class="dv">2</span>] <span class="sc">-</span> (x_range[<span class="dv">2</span>] <span class="sc">-</span> x_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.7</span></span>
<span id="cb103-216"><a href="#cb103-216" aria-hidden="true" tabindex="-1"></a>      y_position_1 <span class="ot">&lt;-</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> (y_range[<span class="dv">2</span>] <span class="sc">-</span> y_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.4</span></span>
<span id="cb103-217"><a href="#cb103-217" aria-hidden="true" tabindex="-1"></a>      y_position_12 <span class="ot">&lt;-</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> (y_range[<span class="dv">2</span>] <span class="sc">-</span> y_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.8</span></span>
<span id="cb103-218"><a href="#cb103-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-219"><a href="#cb103-219" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb103-220"><a href="#cb103-220" aria-hidden="true" tabindex="-1"></a>      x_position_2 <span class="ot">&lt;-</span> x_range[<span class="dv">2</span>] <span class="sc">-</span> (x_range[<span class="dv">2</span>] <span class="sc">-</span> x_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb103-221"><a href="#cb103-221" aria-hidden="true" tabindex="-1"></a>      y_position_2 <span class="ot">&lt;-</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> (y_range[<span class="dv">2</span>] <span class="sc">-</span> y_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb103-222"><a href="#cb103-222" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb103-223"><a href="#cb103-223" aria-hidden="true" tabindex="-1"></a>      plot <span class="ot">&lt;-</span> plot <span class="sc">+</span> </span>
<span id="cb103-224"><a href="#cb103-224" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotation_custom</span>(<span class="at">grob =</span> img_grob,</span>
<span id="cb103-225"><a href="#cb103-225" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xmin =</span> x_position_1,</span>
<span id="cb103-226"><a href="#cb103-226" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xmax =</span> x_position_12,</span>
<span id="cb103-227"><a href="#cb103-227" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymin =</span> y_position_1, </span>
<span id="cb103-228"><a href="#cb103-228" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymax =</span> y_position_12)<span class="sc">+</span></span>
<span id="cb103-229"><a href="#cb103-229" aria-hidden="true" tabindex="-1"></a>         <span class="fu">annotation_custom</span>(<span class="at">grob =</span> scale_grob,</span>
<span id="cb103-230"><a href="#cb103-230" aria-hidden="true" tabindex="-1"></a>                           <span class="at">xmin =</span> x_position_2,</span>
<span id="cb103-231"><a href="#cb103-231" aria-hidden="true" tabindex="-1"></a>                           <span class="at">xmax =</span> x_range[<span class="dv">2</span>],</span>
<span id="cb103-232"><a href="#cb103-232" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ymin =</span> y_range[<span class="dv">1</span>],</span>
<span id="cb103-233"><a href="#cb103-233" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ymax =</span> y_position_2)<span class="sc">+</span></span>
<span id="cb103-234"><a href="#cb103-234" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.18</span>,<span class="dv">1</span>))</span>
<span id="cb103-235"><a href="#cb103-235" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb103-236"><a href="#cb103-236" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb103-237"><a href="#cb103-237" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-238"><a href="#cb103-238" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(list_pred<span class="sc">$</span>site[i] <span class="sc">==</span> <span class="st">"Boat2"</span>){</span>
<span id="cb103-239"><a href="#cb103-239" aria-hidden="true" tabindex="-1"></a>      x_position_1 <span class="ot">&lt;-</span> x_range[<span class="dv">2</span>] <span class="sc">-</span> (x_range[<span class="dv">2</span>] <span class="sc">-</span> x_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.9</span></span>
<span id="cb103-240"><a href="#cb103-240" aria-hidden="true" tabindex="-1"></a>      x_position_12 <span class="ot">&lt;-</span> x_range[<span class="dv">2</span>] <span class="sc">-</span> (x_range[<span class="dv">2</span>] <span class="sc">-</span> x_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.6</span></span>
<span id="cb103-241"><a href="#cb103-241" aria-hidden="true" tabindex="-1"></a>      y_position_1 <span class="ot">&lt;-</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> (y_range[<span class="dv">2</span>] <span class="sc">-</span> y_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.6</span></span>
<span id="cb103-242"><a href="#cb103-242" aria-hidden="true" tabindex="-1"></a>      y_position_12 <span class="ot">&lt;-</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> (y_range[<span class="dv">2</span>] <span class="sc">-</span> y_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb103-243"><a href="#cb103-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-244"><a href="#cb103-244" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb103-245"><a href="#cb103-245" aria-hidden="true" tabindex="-1"></a>      x_position_2 <span class="ot">&lt;-</span> x_range[<span class="dv">2</span>] <span class="sc">-</span> (x_range[<span class="dv">2</span>] <span class="sc">-</span> x_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb103-246"><a href="#cb103-246" aria-hidden="true" tabindex="-1"></a>      y_position_2 <span class="ot">&lt;-</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> (y_range[<span class="dv">2</span>] <span class="sc">-</span> y_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb103-247"><a href="#cb103-247" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb103-248"><a href="#cb103-248" aria-hidden="true" tabindex="-1"></a>      plot <span class="ot">&lt;-</span> plot <span class="sc">+</span> </span>
<span id="cb103-249"><a href="#cb103-249" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotation_custom</span>(<span class="at">grob =</span> img_grob,</span>
<span id="cb103-250"><a href="#cb103-250" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xmin =</span> x_position_1,</span>
<span id="cb103-251"><a href="#cb103-251" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xmax =</span> x_position_12,</span>
<span id="cb103-252"><a href="#cb103-252" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymin =</span> y_position_1,</span>
<span id="cb103-253"><a href="#cb103-253" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymax =</span> y_position_12)<span class="sc">+</span></span>
<span id="cb103-254"><a href="#cb103-254" aria-hidden="true" tabindex="-1"></a>         <span class="fu">annotation_custom</span>(<span class="at">grob =</span> scale_grob,</span>
<span id="cb103-255"><a href="#cb103-255" aria-hidden="true" tabindex="-1"></a>                           <span class="at">xmin =</span> x_position_2,</span>
<span id="cb103-256"><a href="#cb103-256" aria-hidden="true" tabindex="-1"></a>                           <span class="at">xmax =</span> x_range[<span class="dv">2</span>],</span>
<span id="cb103-257"><a href="#cb103-257" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ymin =</span> y_range[<span class="dv">1</span>],</span>
<span id="cb103-258"><a href="#cb103-258" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ymax =</span> y_position_2)<span class="sc">+</span></span>
<span id="cb103-259"><a href="#cb103-259" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.18</span>,<span class="dv">1</span>))</span>
<span id="cb103-260"><a href="#cb103-260" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb103-261"><a href="#cb103-261" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb103-262"><a href="#cb103-262" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(list_pred<span class="sc">$</span>site[i] <span class="sc">==</span> <span class="st">"NorthDike"</span>){</span>
<span id="cb103-263"><a href="#cb103-263" aria-hidden="true" tabindex="-1"></a>      x_position_1 <span class="ot">&lt;-</span> x_range[<span class="dv">2</span>] <span class="sc">-</span> (x_range[<span class="dv">2</span>] <span class="sc">-</span> x_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.9</span></span>
<span id="cb103-264"><a href="#cb103-264" aria-hidden="true" tabindex="-1"></a>      x_position_12 <span class="ot">&lt;-</span> x_range[<span class="dv">2</span>] <span class="sc">-</span> (x_range[<span class="dv">2</span>] <span class="sc">-</span> x_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.6</span></span>
<span id="cb103-265"><a href="#cb103-265" aria-hidden="true" tabindex="-1"></a>      y_position_1 <span class="ot">&lt;-</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> (y_range[<span class="dv">2</span>] <span class="sc">-</span> y_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.6</span></span>
<span id="cb103-266"><a href="#cb103-266" aria-hidden="true" tabindex="-1"></a>      y_position_12 <span class="ot">&lt;-</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> (y_range[<span class="dv">2</span>] <span class="sc">-</span> y_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb103-267"><a href="#cb103-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-268"><a href="#cb103-268" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb103-269"><a href="#cb103-269" aria-hidden="true" tabindex="-1"></a>      x_position_2 <span class="ot">&lt;-</span> x_range[<span class="dv">2</span>] <span class="sc">-</span> (x_range[<span class="dv">2</span>] <span class="sc">-</span> x_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb103-270"><a href="#cb103-270" aria-hidden="true" tabindex="-1"></a>      y_position_2 <span class="ot">&lt;-</span> y_range[<span class="dv">1</span>] <span class="sc">+</span> (y_range[<span class="dv">2</span>] <span class="sc">-</span> y_range[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb103-271"><a href="#cb103-271" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb103-272"><a href="#cb103-272" aria-hidden="true" tabindex="-1"></a>      plot <span class="ot">&lt;-</span> plot <span class="sc">+</span> </span>
<span id="cb103-273"><a href="#cb103-273" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotation_custom</span>(<span class="at">grob =</span> img_grob,</span>
<span id="cb103-274"><a href="#cb103-274" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xmin =</span> x_position_1,</span>
<span id="cb103-275"><a href="#cb103-275" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xmax =</span> x_position_12,</span>
<span id="cb103-276"><a href="#cb103-276" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymin =</span> y_position_1,</span>
<span id="cb103-277"><a href="#cb103-277" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ymax =</span> y_position_12)<span class="sc">+</span></span>
<span id="cb103-278"><a href="#cb103-278" aria-hidden="true" tabindex="-1"></a>         <span class="fu">annotation_custom</span>(<span class="at">grob =</span> scale_grob,</span>
<span id="cb103-279"><a href="#cb103-279" aria-hidden="true" tabindex="-1"></a>                           <span class="at">xmin =</span> x_position_2,</span>
<span id="cb103-280"><a href="#cb103-280" aria-hidden="true" tabindex="-1"></a>                           <span class="at">xmax =</span> x_range[<span class="dv">2</span>],</span>
<span id="cb103-281"><a href="#cb103-281" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ymin =</span> y_range[<span class="dv">1</span>],</span>
<span id="cb103-282"><a href="#cb103-282" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ymax =</span> y_position_2)<span class="sc">+</span></span>
<span id="cb103-283"><a href="#cb103-283" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.18</span>,<span class="dv">1</span>))</span>
<span id="cb103-284"><a href="#cb103-284" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb103-285"><a href="#cb103-285" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb103-286"><a href="#cb103-286" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-287"><a href="#cb103-287" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot</span></span>
<span id="cb103-288"><a href="#cb103-288" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">"Output/Resampling/"</span>,<span class="fu">gsub</span>(<span class="st">".tif"</span>,<span class="st">".png"</span>,list_pred<span class="sc">$</span>name[i])), plot, <span class="at">height =</span> <span class="dv">1125</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">width =</span> <span class="dv">1320</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb103-289"><a href="#cb103-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-290"><a href="#cb103-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-291"><a href="#cb103-291" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [44]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MapRs)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>img_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"Data/Predictions/RAW/"</span>, <span class="at">pattern =</span> <span class="st">".tif"</span>, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">".*/"</span>,<span class="st">""</span>,path),</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name,<span class="st">"Probs"</span>) <span class="sc">~</span> <span class="st">"Probs"</span>,</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Pred"</span>),</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">site =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name,<span class="st">"Boat1"</span>) <span class="sc">~</span> <span class="st">"Boat1"</span>,</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(name,<span class="st">"Boat2"</span>) <span class="sc">~</span> <span class="st">"Boat2"</span>,</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(name,<span class="st">"Gafanha_high"</span>) <span class="sc">~</span> <span class="st">"AveiroHigh"</span>,</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(name,<span class="st">"Duer"</span>) <span class="sc">~</span> <span class="st">"Duer"</span>,</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(name,<span class="st">"Gafanha_Low"</span>) <span class="sc">~</span> <span class="st">"AveiroLow"</span>,</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(name,<span class="st">"NorthDike"</span>) <span class="sc">~</span> <span class="st">"NorthDike"</span>),</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">filtered =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name,<span class="st">"_7"</span>) <span class="sc">~</span> T,</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>                              T <span class="sc">~</span> F),</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">UTM_zone =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"NorthDike"</span>) <span class="sc">~</span> <span class="dv">32630</span>,</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">str_detect</span>(path, <span class="st">"Duer"</span>) <span class="sc">~</span> <span class="dv">32630</span>,</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">32629</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(site <span class="sc">!=</span> <span class="st">"AveiroLow"</span>,</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>                type <span class="sc">==</span> <span class="st">"Pred"</span>,</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>                filtered <span class="sc">==</span> F,</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>                site <span class="sc">==</span> <span class="st">"NorthDike"</span>)</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a><span class="co"># res_to_resample &lt;- c(10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,200,300,400,500,600,700,800,900,1000,1500,2000,2500,3000)</span></span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>res_to_resample <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3000</span>)</span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(img_list)){</span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a>  img <span class="ot">&lt;-</span> img_list <span class="sc">%&gt;%</span> </span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(path <span class="sc">==</span> img_list<span class="sc">$</span>path[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rast</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(<span class="fu">paste0</span>(<span class="st">"EPSG:"</span>, img_list<span class="sc">$</span>UTM_zone[i]), <span class="at">thread =</span> T, <span class="at">method =</span> <span class="st">"near"</span>) </span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-36"><a href="#cb104-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_to_resample)){</span>
<span id="cb104-37"><a href="#cb104-37" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb104-38"><a href="#cb104-38" aria-hidden="true" tabindex="-1"></a>      new_res <span class="ot">&lt;-</span> res_to_resample[ii]<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb104-39"><a href="#cb104-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb104-40"><a href="#cb104-40" aria-hidden="true" tabindex="-1"></a>    r_template <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">ext</span>(img), <span class="at">resolution =</span> new_res, <span class="at">crs =</span> <span class="fu">crs</span>(img))</span>
<span id="cb104-41"><a href="#cb104-41" aria-hidden="true" tabindex="-1"></a>    r_resampled <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(img, r_template, <span class="at">method=</span><span class="st">"mode"</span>, <span class="at">threads =</span> T)<span class="sc">%&gt;%</span> </span>
<span id="cb104-42"><a href="#cb104-42" aria-hidden="true" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">project</span>(<span class="st">"EPSG:4326"</span>, <span class="at">thread =</span> T, <span class="at">method =</span> <span class="st">"near"</span>)</span>
<span id="cb104-43"><a href="#cb104-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb104-44"><a href="#cb104-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb104-45"><a href="#cb104-45" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(<span class="st">"Data/Validation/Prediction_resampling/"</span>,res_to_resample[ii],<span class="st">"cm"</span>))){</span>
<span id="cb104-46"><a href="#cb104-46" aria-hidden="true" tabindex="-1"></a>       <span class="fu">dir.create</span>(<span class="fu">paste0</span>(<span class="st">"Data/Validation/Prediction_resampling/"</span>,res_to_resample[ii],<span class="st">"cm"</span>), <span class="at">recursive =</span> T) </span>
<span id="cb104-47"><a href="#cb104-47" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb104-48"><a href="#cb104-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb104-49"><a href="#cb104-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeRaster</span>(r_resampled, <span class="fu">paste0</span>(<span class="st">"Data/Validation/Prediction_resampling/"</span>,res_to_resample[ii],<span class="st">"cm/"</span>,<span class="fu">gsub</span>(<span class="st">".tif"</span>,<span class="fu">paste0</span>(<span class="st">"_"</span>,res_to_resample[ii],<span class="st">"cm.tif"</span>),img_list<span class="sc">$</span>name[i])),<span class="at">overwrite =</span> T)</span>
<span id="cb104-50"><a href="#cb104-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb104-51"><a href="#cb104-51" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [45]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>df_valid <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"Data/Validation/Prediction_resampling"</span>,<span class="at">pattern =</span> <span class="st">".tif"</span>,<span class="at">recursive =</span> T, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">".*/"</span>,<span class="st">""</span>,path)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::filter(type == "Pred") %&gt;% </span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span><span class="fu">sub</span>(<span class="st">".*_(</span><span class="sc">\\</span><span class="st">d+)cm.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, name) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(name,res) <span class="sc">%&gt;%</span> </span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">"Gafanha_high"</span>) <span class="sc">~</span> <span class="st">"Aveiro"</span>,</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(name, <span class="st">"Boat1"</span>) <span class="sc">~</span> <span class="st">"Boat1"</span>,</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(name, <span class="st">"Boat2"</span>) <span class="sc">~</span> <span class="st">"Boat2"</span>,</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(name, <span class="st">"NorthDike"</span>) <span class="sc">~</span> <span class="st">"NorthDike"</span>,</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(name, <span class="st">"Duer_high"</span>) <span class="sc">~</span> <span class="st">"Duer"</span>,</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(name, <span class="st">"handfisher_Ortho"</span>) <span class="sc">~</span> <span class="st">"handfisher_Ortho"</span>,</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> <span class="cn">NA</span>),</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"validation"</span>)</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>df_resampled <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"Data/Predictions/Resampled"</span>,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">".*/"</span>,<span class="st">""</span>,path),</span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">"_prob.tif"</span>) <span class="sc">~</span> <span class="st">"Prob"</span>,</span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> <span class="st">"Pred"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Pred"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span><span class="fu">sub</span>(<span class="st">".*_(</span><span class="sc">\\</span><span class="st">d+)cm_.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, name) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">ortho_name  =</span> <span class="fu">sub</span>(<span class="st">"_(</span><span class="sc">\\</span><span class="st">d+)cm_.*"</span>, <span class="st">""</span>, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ortho_name,res) <span class="sc">%&gt;%</span> </span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(ortho_name, <span class="st">"Aveiro_1506_Highest"</span>) <span class="sc">~</span> <span class="st">"Aveiro"</span>,</span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Aveiro_boat_1706_flight_1"</span>) <span class="sc">~</span> <span class="st">"Boat1"</span>,</span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Aveiro_boat_1706_flight_2"</span>) <span class="sc">~</span> <span class="st">"Boat2"</span>,</span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"NoirmoutierNorthDikeSite"</span>) <span class="sc">~</span> <span class="st">"NorthDike"</span>,</span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Duer_15072022_120m"</span>) <span class="sc">~</span> <span class="st">"Duer"</span>,</span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"handfisher_Ortho"</span>) <span class="sc">~</span> <span class="st">"handfisher_Ortho"</span>,</span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Horse_rooster"</span>) <span class="sc">~</span> <span class="st">"Horse_rooster"</span>,</span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"fl1_120m_handfisher_old"</span>) <span class="sc">~</span> <span class="st">"fl1_120m_handfisher_old"</span>,</span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"fl2_120m_handfisher_old"</span>) <span class="sc">~</span> <span class="st">"fl2_120m_handfisher_old"</span>,</span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>site <span class="sc">==</span> <span class="st">"handfisher_Ortho"</span>,</span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>site <span class="sc">==</span> <span class="st">"Duer"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>ortho_name)</span>
<span id="cb105-41"><a href="#cb105-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-42"><a href="#cb105-42" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_valid <span class="sc">%&gt;%</span> </span>
<span id="cb105-43"><a href="#cb105-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(df_resampled) <span class="sc">%&gt;%</span> </span>
<span id="cb105-44"><a href="#cb105-44" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(site <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Aveiro"</span>,<span class="st">"Boat1"</span>,<span class="st">"Boat2"</span>,<span class="st">"NorthDike"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-45"><a href="#cb105-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::filter(site == "Aveiro") %&gt;% </span></span>
<span id="cb105-46"><a href="#cb105-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb105-47"><a href="#cb105-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> type, <span class="at">values_from =</span> path)</span>
<span id="cb105-48"><a href="#cb105-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-49"><a href="#cb105-49" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">file.exists</span>(<span class="st">"Data/Resampled_saved_data_total.csv"</span>)){</span>
<span id="cb105-50"><a href="#cb105-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-51"><a href="#cb105-51" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( <span class="st">"Data/Resampled_saved_data_total.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-52"><a href="#cb105-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">true_fct =</span> <span class="fu">as.factor</span>(true))</span>
<span id="cb105-53"><a href="#cb105-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-54"><a href="#cb105-54" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb105-55"><a href="#cb105-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-56"><a href="#cb105-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)){</span>
<span id="cb105-57"><a href="#cb105-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-58"><a href="#cb105-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(i)</span>
<span id="cb105-59"><a href="#cb105-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-60"><a href="#cb105-60" aria-hidden="true" tabindex="-1"></a>    img <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">c</span>(df<span class="sc">$</span>validation[i],df<span class="sc">$</span>Pred[i]))</span>
<span id="cb105-61"><a href="#cb105-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-62"><a href="#cb105-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(img) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"true"</span>,<span class="st">"pred"</span>)</span>
<span id="cb105-63"><a href="#cb105-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-64"><a href="#cb105-64" aria-hidden="true" tabindex="-1"></a>    df_img <span class="ot">&lt;-</span> img <span class="sc">%&gt;%</span>  </span>
<span id="cb105-65"><a href="#cb105-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-66"><a href="#cb105-66" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>true <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb105-67"><a href="#cb105-67" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">!</span>pred <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-68"><a href="#cb105-68" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">res =</span> df<span class="sc">$</span>res[i],</span>
<span id="cb105-69"><a href="#cb105-69" aria-hidden="true" tabindex="-1"></a>                    <span class="at">site =</span> df<span class="sc">$</span>site[i])</span>
<span id="cb105-70"><a href="#cb105-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-71"><a href="#cb105-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb105-72"><a href="#cb105-72" aria-hidden="true" tabindex="-1"></a>      df_compare <span class="ot">&lt;-</span> df_img</span>
<span id="cb105-73"><a href="#cb105-73" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb105-74"><a href="#cb105-74" aria-hidden="true" tabindex="-1"></a>      df_compare <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_compare,df_img)</span>
<span id="cb105-75"><a href="#cb105-75" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb105-76"><a href="#cb105-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-77"><a href="#cb105-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-78"><a href="#cb105-78" aria-hidden="true" tabindex="-1"></a>  validation <span class="ot">=</span> df_compare <span class="sc">%&gt;%</span> </span>
<span id="cb105-79"><a href="#cb105-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">same =</span> <span class="fu">case_when</span>(pred <span class="sc">==</span> true <span class="sc">~</span> T,</span>
<span id="cb105-80"><a href="#cb105-80" aria-hidden="true" tabindex="-1"></a>                            T <span class="sc">~</span> F))</span>
<span id="cb105-81"><a href="#cb105-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-82"><a href="#cb105-82" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">&lt;-</span> validation <span class="sc">%&gt;%</span> </span>
<span id="cb105-83"><a href="#cb105-83" aria-hidden="true" tabindex="-1"></a>  dtplyr<span class="sc">::</span><span class="fu">lazy_dt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-84"><a href="#cb105-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(res,true) <span class="sc">%&gt;%</span> </span>
<span id="cb105-85"><a href="#cb105-85" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">agreed =</span> <span class="fu">sum</span>(same, <span class="at">na.rm =</span> T),</span>
<span id="cb105-86"><a href="#cb105-86" aria-hidden="true" tabindex="-1"></a>          <span class="at">n_obs =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb105-87"><a href="#cb105-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ungroup() %&gt;% </span></span>
<span id="cb105-88"><a href="#cb105-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> agreed<span class="sc">/</span>n_obs,</span>
<span id="cb105-89"><a href="#cb105-89" aria-hidden="true" tabindex="-1"></a>         <span class="at">loss =</span> <span class="dv">1</span><span class="sc">-</span>prop) <span class="sc">%&gt;%</span> </span>
<span id="cb105-90"><a href="#cb105-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-91"><a href="#cb105-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">true_fct =</span> <span class="fu">as.factor</span>(true),</span>
<span id="cb105-92"><a href="#cb105-92" aria-hidden="true" tabindex="-1"></a>         <span class="at">area =</span> (res<span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span>(res<span class="sc">/</span><span class="dv">100</span>)) </span>
<span id="cb105-93"><a href="#cb105-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-94"><a href="#cb105-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(total, <span class="st">"Data/Resampled_saved_data_total.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb105-95"><a href="#cb105-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb105-96"><a href="#cb105-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-97"><a href="#cb105-97" aria-hidden="true" tabindex="-1"></a><span class="co"># validation &lt;- read.csv( "Data/Resampled_saved_data.csv")</span></span>
<span id="cb105-98"><a href="#cb105-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-99"><a href="#cb105-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-100"><a href="#cb105-100" aria-hidden="true" tabindex="-1"></a><span class="co"># reframing &lt;- total %&gt;% </span></span>
<span id="cb105-101"><a href="#cb105-101" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(true_fct) %&gt;% </span></span>
<span id="cb105-102"><a href="#cb105-102" aria-hidden="true" tabindex="-1"></a><span class="co">#   dplyr::filter(res == 10) %&gt;% </span></span>
<span id="cb105-103"><a href="#cb105-103" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() %&gt;% </span></span>
<span id="cb105-104"><a href="#cb105-104" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(diff = max(prop)-prop) %&gt;% </span></span>
<span id="cb105-105"><a href="#cb105-105" aria-hidden="true" tabindex="-1"></a><span class="co">#   dplyr::select(true_fct,diff)</span></span>
<span id="cb105-106"><a href="#cb105-106" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb105-107"><a href="#cb105-107" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb105-108"><a href="#cb105-108" aria-hidden="true" tabindex="-1"></a><span class="co"># total &lt;- total %&gt;% </span></span>
<span id="cb105-109"><a href="#cb105-109" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(reframing, by = "true_fct") %&gt;% </span></span>
<span id="cb105-110"><a href="#cb105-110" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(prop = prop + diff) %&gt;% </span></span>
<span id="cb105-111"><a href="#cb105-111" aria-hidden="true" tabindex="-1"></a><span class="co">#   dplyr::select(-diff)</span></span>
<span id="cb105-112"><a href="#cb105-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-113"><a href="#cb105-113" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span>  total <span class="sc">%&gt;%</span> </span>
<span id="cb105-114"><a href="#cb105-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loss =</span> <span class="dv">1</span><span class="sc">-</span>prop)</span>
<span id="cb105-115"><a href="#cb105-115" aria-hidden="true" tabindex="-1"></a>total <span class="sc">%&gt;%</span> </span>
<span id="cb105-116"><a href="#cb105-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> area, <span class="at">y =</span> loss, <span class="at">group =</span> true, <span class="at">color =</span>true_fct))<span class="sc">+</span></span>
<span id="cb105-117"><a href="#cb105-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb105-118"><a href="#cb105-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede_Map</span>()</span>
<span id="cb105-119"><a href="#cb105-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-120"><a href="#cb105-120" aria-hidden="true" tabindex="-1"></a>glm_res_true <span class="ot">&lt;-</span> <span class="fu">glm</span>(loss <span class="sc">~</span> area<span class="sc">*</span>true_fct , <span class="at">data =</span> total)</span>
<span id="cb105-121"><a href="#cb105-121" aria-hidden="true" tabindex="-1"></a><span class="co"># glm_res_true &lt;- mgcv::gam(prop ~ area * true_fct , data = total, familly = mgcv::betar(link="logit")) </span></span>
<span id="cb105-122"><a href="#cb105-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-123"><a href="#cb105-123" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> total <span class="sc">%&gt;%</span> </span>
<span id="cb105-124"><a href="#cb105-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(res, true) <span class="sc">%&gt;%</span> </span>
<span id="cb105-125"><a href="#cb105-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">mean =</span> <span class="fu">mean</span>(loss))</span>
<span id="cb105-126"><a href="#cb105-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-127"><a href="#cb105-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-128"><a href="#cb105-128" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm_res_true)</span>
<span id="cb105-129"><a href="#cb105-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-130"><a href="#cb105-130" aria-hidden="true" tabindex="-1"></a>Utilities.Package<span class="sc">::</span><span class="fu">Model_Check</span>(glm_res_true)</span>
<span id="cb105-131"><a href="#cb105-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-132"><a href="#cb105-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-133"><a href="#cb105-133" aria-hidden="true" tabindex="-1"></a>NewData<span class="ot">&lt;-</span><span class="fu">expand_grid</span>(<span class="at">area=</span><span class="fu">unique</span>(total<span class="sc">$</span>area),</span>
<span id="cb105-134"><a href="#cb105-134" aria-hidden="true" tabindex="-1"></a>                    <span class="at">true_fct=</span><span class="fu">unique</span>(total<span class="sc">$</span>true_fct))</span>
<span id="cb105-135"><a href="#cb105-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-136"><a href="#cb105-136" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm_res_true, NewData, <span class="at">se.fit =</span> T, <span class="at">type =</span> <span class="st">"link"</span>)</span>
<span id="cb105-137"><a href="#cb105-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-138"><a href="#cb105-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-139"><a href="#cb105-139" aria-hidden="true" tabindex="-1"></a>NewData <span class="ot">&lt;-</span> NewData <span class="sc">%&gt;%</span> </span>
<span id="cb105-140"><a href="#cb105-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> pred<span class="sc">$</span>fit<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb105-141"><a href="#cb105-141" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> pred<span class="sc">$</span>se.fit<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb105-142"><a href="#cb105-142" aria-hidden="true" tabindex="-1"></a>         <span class="at">true_fct=</span>(true_fct),</span>
<span id="cb105-143"><a href="#cb105-143" aria-hidden="true" tabindex="-1"></a>         <span class="at">res =</span> <span class="fu">sqrt</span>(area)<span class="sc">/</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-144"><a href="#cb105-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(true_fct) <span class="sc">%&gt;%</span> </span>
<span id="cb105-145"><a href="#cb105-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span> ((fit<span class="sc">-</span><span class="fu">min</span>(fit))<span class="sc">/</span>(<span class="fu">max</span>(fit)<span class="sc">-</span><span class="fu">min</span>(fit)))<span class="sc">*</span>(<span class="fu">max</span>(fit)<span class="sc">/</span><span class="dv">100</span>),</span>
<span id="cb105-146"><a href="#cb105-146" aria-hidden="true" tabindex="-1"></a>         <span class="at">fitted_se =</span> ((se<span class="sc">-</span><span class="fu">min</span>(se))<span class="sc">/</span>(<span class="fu">max</span>(se)<span class="sc">-</span><span class="fu">min</span>(se)))<span class="sc">*</span>(<span class="fu">max</span>(se)<span class="sc">/</span><span class="dv">100</span>))</span>
<span id="cb105-147"><a href="#cb105-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-148"><a href="#cb105-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-149"><a href="#cb105-149" aria-hidden="true" tabindex="-1"></a>  cols_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#DAA520"</span>,</span>
<span id="cb105-150"><a href="#cb105-150" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"#b3ff1a"</span>,</span>
<span id="cb105-151"><a href="#cb105-151" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"#389318"</span>,</span>
<span id="cb105-152"><a href="#cb105-152" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"#873e23"</span>,</span>
<span id="cb105-153"><a href="#cb105-153" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"#b3002d"</span>,</span>
<span id="cb105-154"><a href="#cb105-154" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"#70543e"</span>,</span>
<span id="cb105-155"><a href="#cb105-155" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"7"</span> <span class="ot">=</span> <span class="st">'grey'</span>,</span>
<span id="cb105-156"><a href="#cb105-156" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"8"</span> <span class="ot">=</span> <span class="st">"#42c9bc"</span>)</span>
<span id="cb105-157"><a href="#cb105-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-158"><a href="#cb105-158" aria-hidden="true" tabindex="-1"></a>(plot <span class="ot">&lt;-</span> NewData <span class="sc">%&gt;%</span> </span>
<span id="cb105-159"><a href="#cb105-159" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(true_fct <span class="sc">!=</span> <span class="dv">1</span>,</span>
<span id="cb105-160"><a href="#cb105-160" aria-hidden="true" tabindex="-1"></a>                true_fct <span class="sc">!=</span> <span class="dv">6</span>,</span>
<span id="cb105-161"><a href="#cb105-161" aria-hidden="true" tabindex="-1"></a>                true_fct <span class="sc">!=</span> <span class="dv">7</span>,</span>
<span id="cb105-162"><a href="#cb105-162" aria-hidden="true" tabindex="-1"></a>                true_fct <span class="sc">!=</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-163"><a href="#cb105-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb105-164"><a href="#cb105-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">sqrt</span>(area)<span class="sc">/</span><span class="dv">100</span>, <span class="at">y =</span> fitted<span class="sc">*</span><span class="dv">100</span>, <span class="at">ymax =</span> (fitted<span class="sc">+</span>fitted_se)<span class="sc">*</span><span class="dv">100</span>, <span class="at">ymin =</span> (fitted<span class="sc">-</span>fitted_se)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb105-165"><a href="#cb105-165" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> true_fct, <span class="at">group =</span> true_fct, <span class="at">fill =</span> true_fct</span>
<span id="cb105-166"><a href="#cb105-166" aria-hidden="true" tabindex="-1"></a>                  ), <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb105-167"><a href="#cb105-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">sqrt</span>(area)<span class="sc">/</span><span class="dv">100</span>, <span class="at">y =</span> fitted<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb105-168"><a href="#cb105-168" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> true_fct, <span class="at">group =</span> true_fct</span>
<span id="cb105-169"><a href="#cb105-169" aria-hidden="true" tabindex="-1"></a>                ))<span class="sc">+</span></span>
<span id="cb105-170"><a href="#cb105-170" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb105-171"><a href="#cb105-171" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> cols_fill,</span>
<span id="cb105-172"><a href="#cb105-172" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Green algae"</span>, <span class="st">"Seagrass"</span>, <span class="st">"Brown algae"</span>, <span class="st">"Red algae"</span>, <span class="st">"Sediment"</span>, <span class="st">"Sunglint"</span>,<span class="st">"Water"</span>)) <span class="sc">+</span></span>
<span id="cb105-173"><a href="#cb105-173" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb105-174"><a href="#cb105-174" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> cols_fill,</span>
<span id="cb105-175"><a href="#cb105-175" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Green algae"</span>, <span class="st">"Seagrass"</span>, <span class="st">"Brown algae"</span>, <span class="st">"Red algae"</span>, <span class="st">"Sediment"</span>, <span class="st">"Sunglint"</span>,<span class="st">"Water"</span>))<span class="sc">+</span></span>
<span id="cb105-176"><a href="#cb105-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb105-177"><a href="#cb105-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Resolution (m)"</span>) <span class="sc">+</span></span>
<span id="cb105-178"><a href="#cb105-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Predicted area loss"</span>)<span class="sc">+</span></span>
<span id="cb105-179"><a href="#cb105-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb105-180"><a href="#cb105-180" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb105-181"><a href="#cb105-181" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb105-182"><a href="#cb105-182" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb105-183"><a href="#cb105-183" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>)</span>
<span id="cb105-184"><a href="#cb105-184" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb105-185"><a href="#cb105-185" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-186"><a href="#cb105-186" aria-hidden="true" tabindex="-1"></a>    <span class="co"># scale_x_log10()</span></span>
<span id="cb105-187"><a href="#cb105-187" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-188"><a href="#cb105-188" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb105-189"><a href="#cb105-189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-190"><a href="#cb105-190" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/High_res/resolution_plot.png"</span>, plot, <span class="at">bg =</span> <span class="st">"white"</span>, <span class="at">height =</span> <span class="dv">803</span><span class="sc">*</span><span class="dv">3</span>, <span class="at">width =</span> <span class="dv">1184</span><span class="sc">*</span><span class="dv">3</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [46]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>df_resampled_img <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"Data/Predictions/Resampled"</span>,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">".*/"</span>,<span class="st">""</span>,path),</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">"_prob.tif"</span>) <span class="sc">~</span> <span class="st">"Prob"</span>,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> <span class="st">"Pred"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Pred"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span><span class="fu">sub</span>(<span class="st">".*_(</span><span class="sc">\\</span><span class="st">d+)cm_.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, name) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">ortho_name  =</span> <span class="fu">sub</span>(<span class="st">"_(</span><span class="sc">\\</span><span class="st">d+)cm_.*"</span>, <span class="st">""</span>, name)) <span class="sc">%&gt;%</span> </span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ortho_name,res) <span class="sc">%&gt;%</span> </span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(ortho_name, <span class="st">"Aveiro_1506_Highest"</span>) <span class="sc">~</span> <span class="st">"Aveiro"</span>,</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Aveiro_boat_1706_flight_1"</span>) <span class="sc">~</span> <span class="st">"Boat1"</span>,</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Aveiro_boat_1706_flight_2"</span>) <span class="sc">~</span> <span class="st">"Boat2"</span>,</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"NoirmoutierNorthDikeSite"</span>) <span class="sc">~</span> <span class="st">"NorthDike"</span>,</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Duer_15072022_120m"</span>) <span class="sc">~</span> <span class="st">"Duer"</span>,</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"handfisher_Ortho"</span>) <span class="sc">~</span> <span class="st">"handfisher_Ortho"</span>,</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"Horse_rooster"</span>) <span class="sc">~</span> <span class="st">"Horse_rooster"</span>,</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"fl1_120m_handfisher_old"</span>) <span class="sc">~</span> <span class="st">"fl1_120m_handfisher_old"</span>,</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">str_detect</span>(ortho_name, <span class="st">"fl2_120m_handfisher_old"</span>) <span class="sc">~</span> <span class="st">"fl2_120m_handfisher_old"</span>,</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>site <span class="sc">==</span> <span class="st">"handfisher_Ortho"</span>,</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span>site <span class="sc">==</span> <span class="st">"Duer"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>ortho_name)</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>native_res <span class="ot">&lt;-</span> df_resampled_img <span class="sc">%&gt;%</span> </span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(res <span class="sc">==</span> <span class="dv">10</span>)</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(native_res)){</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(i)</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>    img <span class="ot">&lt;-</span> <span class="fu">rast</span>(native_res<span class="sc">$</span>path[i])</span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(img) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pred"</span>)</span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>    df_img <span class="ot">&lt;-</span> img <span class="sc">%&gt;%</span>  </span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>pred <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(pred) <span class="sc">%&gt;%</span> </span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reframe</span>(<span class="at">n_obs =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">res =</span> native_res<span class="sc">$</span>res[i],</span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a>                    <span class="at">site =</span> native_res<span class="sc">$</span>site[i],</span>
<span id="cb106-45"><a href="#cb106-45" aria-hidden="true" tabindex="-1"></a>                    <span class="at">px_area =</span> (res<span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span>(res<span class="sc">/</span><span class="dv">100</span>),</span>
<span id="cb106-46"><a href="#cb106-46" aria-hidden="true" tabindex="-1"></a>                    <span class="at">area_vegetation =</span> n_obs<span class="sc">*</span>px_area) <span class="sc">%&gt;%</span> </span>
<span id="cb106-47"><a href="#cb106-47" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(px_area,n_obs)) <span class="sc">%&gt;%</span> </span>
<span id="cb106-48"><a href="#cb106-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">area_RAW  =</span> area_vegetation)</span>
<span id="cb106-49"><a href="#cb106-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-50"><a href="#cb106-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb106-51"><a href="#cb106-51" aria-hidden="true" tabindex="-1"></a>      df_native <span class="ot">&lt;-</span> df_img</span>
<span id="cb106-52"><a href="#cb106-52" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb106-53"><a href="#cb106-53" aria-hidden="true" tabindex="-1"></a>      df_native <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_native,df_img)</span>
<span id="cb106-54"><a href="#cb106-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb106-55"><a href="#cb106-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb106-56"><a href="#cb106-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-57"><a href="#cb106-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_resampled_img)){</span>
<span id="cb106-58"><a href="#cb106-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-59"><a href="#cb106-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(i)</span>
<span id="cb106-60"><a href="#cb106-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-61"><a href="#cb106-61" aria-hidden="true" tabindex="-1"></a>    img <span class="ot">&lt;-</span> <span class="fu">rast</span>(df_resampled_img<span class="sc">$</span>path[i])</span>
<span id="cb106-62"><a href="#cb106-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-63"><a href="#cb106-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(img) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pred"</span>)</span>
<span id="cb106-64"><a href="#cb106-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-65"><a href="#cb106-65" aria-hidden="true" tabindex="-1"></a>    df_img <span class="ot">&lt;-</span> img <span class="sc">%&gt;%</span>  </span>
<span id="cb106-66"><a href="#cb106-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb106-67"><a href="#cb106-67" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>pred <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb106-68"><a href="#cb106-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(pred) <span class="sc">%&gt;%</span> </span>
<span id="cb106-69"><a href="#cb106-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reframe</span>(<span class="at">n_obs =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb106-70"><a href="#cb106-70" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">res =</span> df_resampled_img<span class="sc">$</span>res[i],</span>
<span id="cb106-71"><a href="#cb106-71" aria-hidden="true" tabindex="-1"></a>                    <span class="at">site =</span> df_resampled_img<span class="sc">$</span>site[i],</span>
<span id="cb106-72"><a href="#cb106-72" aria-hidden="true" tabindex="-1"></a>                    <span class="at">px_area =</span> (res<span class="sc">/</span><span class="dv">100</span>)<span class="sc">*</span>(res<span class="sc">/</span><span class="dv">100</span>),</span>
<span id="cb106-73"><a href="#cb106-73" aria-hidden="true" tabindex="-1"></a>                    <span class="at">area_vegetation =</span> n_obs<span class="sc">*</span>px_area) <span class="sc">%&gt;%</span> </span>
<span id="cb106-74"><a href="#cb106-74" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(px_area,n_obs)) <span class="sc">%&gt;%</span> </span>
<span id="cb106-75"><a href="#cb106-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">area_resampled  =</span> area_vegetation)</span>
<span id="cb106-76"><a href="#cb106-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-77"><a href="#cb106-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb106-78"><a href="#cb106-78" aria-hidden="true" tabindex="-1"></a>      df_resampled <span class="ot">&lt;-</span> df_img</span>
<span id="cb106-79"><a href="#cb106-79" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb106-80"><a href="#cb106-80" aria-hidden="true" tabindex="-1"></a>      df_resampled <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_resampled,df_img)</span>
<span id="cb106-81"><a href="#cb106-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb106-82"><a href="#cb106-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb106-83"><a href="#cb106-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-84"><a href="#cb106-84" aria-hidden="true" tabindex="-1"></a><span class="co"># df_compare &lt;- read.csv("Data/Resampled_saved_data.csv")</span></span>
<span id="cb106-85"><a href="#cb106-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-86"><a href="#cb106-86" aria-hidden="true" tabindex="-1"></a>df_area_compare <span class="ot">&lt;-</span> df_resampled <span class="sc">%&gt;%</span> </span>
<span id="cb106-87"><a href="#cb106-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(-res) %&gt;% </span></span>
<span id="cb106-88"><a href="#cb106-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_native <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>res), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"site"</span>,<span class="st">"pred"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb106-89"><a href="#cb106-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loss =</span> <span class="fu">abs</span>((area_resampled<span class="sc">-</span>area_RAW)<span class="sc">/</span>(area_resampled<span class="sc">+</span>area_RAW)),</span>
<span id="cb106-90"><a href="#cb106-90" aria-hidden="true" tabindex="-1"></a>          <span class="at">class_fct =</span> <span class="fu">as.factor</span>(pred),</span>
<span id="cb106-91"><a href="#cb106-91" aria-hidden="true" tabindex="-1"></a>         <span class="at">area =</span> res<span class="sc">*</span>res)</span>
<span id="cb106-92"><a href="#cb106-92" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb106-93"><a href="#cb106-93" aria-hidden="true" tabindex="-1"></a>df_area_compare <span class="sc">%&gt;%</span> </span>
<span id="cb106-94"><a href="#cb106-94" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(class_fct <span class="sc">!=</span> <span class="dv">1</span>,</span>
<span id="cb106-95"><a href="#cb106-95" aria-hidden="true" tabindex="-1"></a>                class_fct <span class="sc">!=</span> <span class="dv">6</span>,</span>
<span id="cb106-96"><a href="#cb106-96" aria-hidden="true" tabindex="-1"></a>                class_fct <span class="sc">!=</span> <span class="dv">7</span>,</span>
<span id="cb106-97"><a href="#cb106-97" aria-hidden="true" tabindex="-1"></a>                class_fct <span class="sc">!=</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb106-98"><a href="#cb106-98" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group_by(area,class_fct) %&gt;% </span></span>
<span id="cb106-99"><a href="#cb106-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reframe(loss = mean(loss)) %&gt;% </span></span>
<span id="cb106-100"><a href="#cb106-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> area, <span class="at">y =</span> loss, <span class="at">colour =</span> class_fct))<span class="sc">+</span></span>
<span id="cb106-101"><a href="#cb106-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb106-102"><a href="#cb106-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>)<span class="sc">+</span></span>
<span id="cb106-103"><a href="#cb106-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb106-104"><a href="#cb106-104" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> cols_fill,</span>
<span id="cb106-105"><a href="#cb106-105" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Green algae"</span>, <span class="st">"Seagrass"</span>, <span class="st">"Brown algae"</span>, <span class="st">"Red algae"</span>, <span class="st">"Sediment"</span>, <span class="st">"Sunglint"</span>,<span class="st">"Water"</span>))</span>
<span id="cb106-106"><a href="#cb106-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-107"><a href="#cb106-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-108"><a href="#cb106-108" aria-hidden="true" tabindex="-1"></a>df_area_compare <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Data/Resampling/Area_loss_df.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb106-109"><a href="#cb106-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">class_fct =</span> <span class="fu">as.factor</span>(class_fct)) <span class="sc">%&gt;%</span> </span>
<span id="cb106-110"><a href="#cb106-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb106-111"><a href="#cb106-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-112"><a href="#cb106-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-113"><a href="#cb106-113" aria-hidden="true" tabindex="-1"></a>glm_res_true <span class="ot">&lt;-</span> <span class="fu">glm</span>(loss <span class="sc">~</span> res<span class="sc">*</span>class_fct , <span class="at">data =</span> df_area_compare, <span class="at">family=</span><span class="fu">quasi</span>(<span class="at">link=</span><span class="st">"logit"</span>, <span class="at">variance=</span><span class="st">"mu(1-mu)"</span>))</span>
<span id="cb106-114"><a href="#cb106-114" aria-hidden="true" tabindex="-1"></a><span class="co"># glm_res_true &lt;- mgcv::gam(prop ~ area * true_fct , data = total, familly = mgcv::betar(link="logit")) </span></span>
<span id="cb106-115"><a href="#cb106-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-116"><a href="#cb106-116" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm_res_true)</span>
<span id="cb106-117"><a href="#cb106-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-118"><a href="#cb106-118" aria-hidden="true" tabindex="-1"></a><span class="co"># glm_res_true$coefficients</span></span>
<span id="cb106-119"><a href="#cb106-119" aria-hidden="true" tabindex="-1"></a><span class="co"># coef(summary(glm_res_true))[,4]</span></span>
<span id="cb106-120"><a href="#cb106-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-121"><a href="#cb106-121" aria-hidden="true" tabindex="-1"></a>Utilities.Package<span class="sc">::</span><span class="fu">Model_Check</span>(glm_res_true)</span>
<span id="cb106-122"><a href="#cb106-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-123"><a href="#cb106-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-124"><a href="#cb106-124" aria-hidden="true" tabindex="-1"></a>NewData<span class="ot">&lt;-</span><span class="fu">expand_grid</span>(<span class="at">area=</span><span class="fu">unique</span>(df_area_compare<span class="sc">$</span>area),</span>
<span id="cb106-125"><a href="#cb106-125" aria-hidden="true" tabindex="-1"></a>                    <span class="at">class_fct=</span><span class="fu">unique</span>(df_area_compare<span class="sc">$</span>class_fct))</span>
<span id="cb106-126"><a href="#cb106-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-127"><a href="#cb106-127" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm_res_true, NewData, <span class="at">se.fit =</span> T, <span class="at">type =</span> <span class="st">"link"</span>)</span>
<span id="cb106-128"><a href="#cb106-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-129"><a href="#cb106-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-130"><a href="#cb106-130" aria-hidden="true" tabindex="-1"></a>NewData <span class="ot">&lt;-</span> NewData <span class="sc">%&gt;%</span> </span>
<span id="cb106-131"><a href="#cb106-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> pred<span class="sc">$</span>fit<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb106-132"><a href="#cb106-132" aria-hidden="true" tabindex="-1"></a>         <span class="at">se =</span> pred<span class="sc">$</span>se.fit<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb106-133"><a href="#cb106-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-134"><a href="#cb106-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-135"><a href="#cb106-135" aria-hidden="true" tabindex="-1"></a>  cols_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#DAA520"</span>,</span>
<span id="cb106-136"><a href="#cb106-136" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"#b3ff1a"</span>,</span>
<span id="cb106-137"><a href="#cb106-137" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"#389318"</span>,</span>
<span id="cb106-138"><a href="#cb106-138" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"#873e23"</span>,</span>
<span id="cb106-139"><a href="#cb106-139" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"#b3002d"</span>,</span>
<span id="cb106-140"><a href="#cb106-140" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"#70543e"</span>,</span>
<span id="cb106-141"><a href="#cb106-141" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"7"</span> <span class="ot">=</span> <span class="st">'grey'</span>,</span>
<span id="cb106-142"><a href="#cb106-142" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"8"</span> <span class="ot">=</span> <span class="st">"#42c9bc"</span>)</span>
<span id="cb106-143"><a href="#cb106-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-144"><a href="#cb106-144" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> NewData <span class="sc">%&gt;%</span> </span>
<span id="cb106-145"><a href="#cb106-145" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(class_fct <span class="sc">!=</span> <span class="dv">1</span>,</span>
<span id="cb106-146"><a href="#cb106-146" aria-hidden="true" tabindex="-1"></a>                class_fct <span class="sc">!=</span> <span class="dv">6</span>,</span>
<span id="cb106-147"><a href="#cb106-147" aria-hidden="true" tabindex="-1"></a>                class_fct <span class="sc">!=</span> <span class="dv">7</span>,</span>
<span id="cb106-148"><a href="#cb106-148" aria-hidden="true" tabindex="-1"></a>                class_fct <span class="sc">!=</span> <span class="dv">8</span>) </span>
<span id="cb106-149"><a href="#cb106-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-150"><a href="#cb106-150" aria-hidden="true" tabindex="-1"></a>(plot <span class="ot">&lt;-</span> NewData <span class="sc">%&gt;%</span> </span>
<span id="cb106-151"><a href="#cb106-151" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(class_fct <span class="sc">!=</span> <span class="dv">1</span>,</span>
<span id="cb106-152"><a href="#cb106-152" aria-hidden="true" tabindex="-1"></a>                class_fct <span class="sc">!=</span> <span class="dv">6</span>,</span>
<span id="cb106-153"><a href="#cb106-153" aria-hidden="true" tabindex="-1"></a>                class_fct <span class="sc">!=</span> <span class="dv">7</span>,</span>
<span id="cb106-154"><a href="#cb106-154" aria-hidden="true" tabindex="-1"></a>                class_fct <span class="sc">!=</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb106-155"><a href="#cb106-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb106-156"><a href="#cb106-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">sqrt</span>(area)<span class="sc">/</span><span class="dv">100</span>, <span class="at">y =</span> fit, <span class="at">ymax =</span> fit<span class="sc">+</span>se, <span class="at">ymin =</span> fit<span class="sc">-</span>se, </span>
<span id="cb106-157"><a href="#cb106-157" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> class_fct, <span class="at">group =</span> class_fct, <span class="at">fill =</span> class_fct</span>
<span id="cb106-158"><a href="#cb106-158" aria-hidden="true" tabindex="-1"></a>                  ), <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb106-159"><a href="#cb106-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">sqrt</span>(area)<span class="sc">/</span><span class="dv">100</span>, <span class="at">y =</span> fit,</span>
<span id="cb106-160"><a href="#cb106-160" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> class_fct, <span class="at">group =</span> class_fct</span>
<span id="cb106-161"><a href="#cb106-161" aria-hidden="true" tabindex="-1"></a>                ))<span class="sc">+</span></span>
<span id="cb106-162"><a href="#cb106-162" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb106-163"><a href="#cb106-163" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> cols_fill,</span>
<span id="cb106-164"><a href="#cb106-164" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Green algae"</span>, <span class="st">"Seagrass"</span>, <span class="st">"Brown algae"</span>, <span class="st">"Red algae"</span>, <span class="st">"Sediment"</span>, <span class="st">"Sunglint"</span>,<span class="st">"Water"</span>)) <span class="sc">+</span></span>
<span id="cb106-165"><a href="#cb106-165" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb106-166"><a href="#cb106-166" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> cols_fill,</span>
<span id="cb106-167"><a href="#cb106-167" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Green algae"</span>, <span class="st">"Seagrass"</span>, <span class="st">"Brown algae"</span>, <span class="st">"Red algae"</span>, <span class="st">"Sediment"</span>, <span class="st">"Sunglint"</span>,<span class="st">"Water"</span>))<span class="sc">+</span></span>
<span id="cb106-168"><a href="#cb106-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb106-169"><a href="#cb106-169" aria-hidden="true" tabindex="-1"></a>    <span class="co"># xlim(0,1)+</span></span>
<span id="cb106-170"><a href="#cb106-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Resolution (m)"</span>) <span class="sc">+</span></span>
<span id="cb106-171"><a href="#cb106-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Predicted area loss"</span>)<span class="sc">+</span></span>
<span id="cb106-172"><a href="#cb106-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb106-173"><a href="#cb106-173" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb106-174"><a href="#cb106-174" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb106-175"><a href="#cb106-175" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb106-176"><a href="#cb106-176" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>)</span>
<span id="cb106-177"><a href="#cb106-177" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb106-178"><a href="#cb106-178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-179"><a href="#cb106-179" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<p>Clear differences were seen in vegetation loss across different resolutions and vegetation classes (@fig-pixel). At a fine resolution of 1m, changes in the retrieved area for each vegetation type are minimal. Green algae shows the highest loss, with 1.2% area lost compared to the native resolution (80 mm). As the resolution coarsens to 10m, vegetation loss becomes more pronounced, with green algae again experiencing the greatest reduction (12% compared to 8cm) and seagrass showing the smallest loss (1.3%). At a resolution of 30m, all green algae have been lost (100% compared to 8cm), while seagrass experiences a relatively small reduction of 11%. Brown algae and red algae show moderate declines, with losses at 30m resolution reaching approximately 37% and 59%, respectively.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [47]:</pre></div><div id="cell-fig-pixelsize" class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figures/High_res/resolution_plot.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pixelsize" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pixelsize-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figures/High_res/resolution_plot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="Figure&nbsp;11: Predicted area loss for different vegetation types (green algae, seagrass, brown algae, red algae) as a function of spatial resolution. Lines represent GLM predictions, and shaded areas indicate standard errors. As resolution decreases, predicted area loss increases for all vegetation types, with green algae showing the highest loss and seagrass the smallest at coarser resolutions."><img src="Figures/High_res/resolution_plot.png" class="img-fluid figure-img" style="width:90.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pixelsize-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Predicted area loss for different vegetation types (green algae, seagrass, brown algae, red algae) as a function of spatial resolution. Lines represent GLM predictions, and shaded areas indicate standard errors. As resolution decreases, predicted area loss increases for all vegetation types, with green algae showing the highest loss and seagrass the smallest at coarser resolutions.
</figcaption>
</figure>
</div>
</div>
</div></div>
</section>
<section id="effect-of-the-percent-cover-on-the-prediction" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="effect-of-the-percent-cover-on-the-prediction"><span class="header-section-number">3.6</span> Effect of the percent cover on the prediction</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [48]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">list.files</span>(<span class="st">"./Output"</span>,<span class="at">pattern =</span> <span class="st">"output_80_filtered_Upscaling.csv"</span>)) <span class="sc">==</span> <span class="dv">0</span> ){</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a> imglist<span class="ot">&lt;-</span><span class="st">"Output/High_Flights_correction/Low_flight_spatial_resampling/"</span> <span class="sc">%&gt;%</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">list.files</span>(<span class="st">".tif"</span>,<span class="at">full.names =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">path =</span> <span class="st">"."</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">size =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path,<span class="st">"_8_7x7.tif"</span>) <span class="sc">~</span> <span class="dv">8</span>,</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path,<span class="st">"16.tif"</span>) <span class="sc">~</span> <span class="dv">16</span>,</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path,<span class="st">"32.tif"</span>) <span class="sc">~</span> <span class="dv">32</span>,</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path,<span class="st">"48.tif"</span>) <span class="sc">~</span> <span class="dv">48</span>,</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path,<span class="st">"64.tif"</span>) <span class="sc">~</span> <span class="dv">64</span>,</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path,<span class="st">"80.tif"</span>) <span class="sc">~</span> <span class="dv">80</span>),</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(path, <span class="st">"ortho"</span>) <span class="sc">~</span> <span class="st">"ortho"</span>,</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">str_detect</span>(path, <span class="st">"pred"</span>) <span class="sc">~</span> <span class="st">"Pred"</span>,</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Prob"</span>))</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>pred_8<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">8</span>,</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>          type <span class="sc">==</span> <span class="st">"Pred"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span></span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>   terra<span class="sc">::</span><span class="fu">rast</span>()</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a> <span class="fu">names</span>(pred_8)<span class="ot">&lt;-</span><span class="st">"Pred_8"</span></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a> pred_80<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">80</span>,</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>          type <span class="sc">==</span> <span class="st">"Pred"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span></span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>   terra<span class="sc">::</span><span class="fu">rast</span>()</span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a> <span class="fu">names</span>(pred_80)<span class="ot">&lt;-</span><span class="st">"Pred_80"</span></span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>prob_80<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span></span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">80</span>,</span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>          type <span class="sc">==</span> <span class="st">"Prob"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span></span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>   terra<span class="sc">::</span><span class="fu">rast</span>()</span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a> <span class="fu">names</span>(prob_80)<span class="ot">&lt;-</span><span class="st">"Prob_80"</span></span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a> model_80<span class="ot">&lt;-</span>imglist <span class="sc">%&gt;%</span></span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">80</span>,</span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>          type <span class="sc">==</span> <span class="st">"Pred"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pull</span>(path) <span class="sc">%&gt;%</span></span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>   terra<span class="sc">::</span><span class="fu">rast</span>()</span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a> <span class="fu">values</span>(model_80)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncell</span>(model_80))</span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a> <span class="fu">names</span>(model_80)<span class="ot">&lt;-</span><span class="st">"ID_80"</span></span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a> model_80_rs_to_8<span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">resample</span>(model_80,pred_8,<span class="at">method =</span> <span class="st">"near"</span>)</span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a> <span class="fu">names</span>(model_80_rs_to_8)<span class="ot">&lt;-</span><span class="st">"ID_80"</span></span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a> df_80_8<span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">list</span>(model_80_rs_to_8,pred_8)) <span class="sc">%&gt;%</span></span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.data.frame</span>(<span class="at">xy=</span>F) <span class="sc">%&gt;%</span></span>
<span id="cb108-52"><a href="#cb108-52" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span>Pred_8 <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb108-53"><a href="#cb108-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-54"><a href="#cb108-54" aria-hidden="true" tabindex="-1"></a> df_80<span class="ot">&lt;-</span>terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">list</span>(model_80,pred_80,prob_80)) <span class="sc">%&gt;%</span></span>
<span id="cb108-55"><a href="#cb108-55" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.data.frame</span>(<span class="at">xy=</span>F) <span class="sc">%&gt;%</span></span>
<span id="cb108-56"><a href="#cb108-56" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span>Pred_80 <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb108-57"><a href="#cb108-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-58"><a href="#cb108-58" aria-hidden="true" tabindex="-1"></a><span class="do">#############</span></span>
<span id="cb108-59"><a href="#cb108-59" aria-hidden="true" tabindex="-1"></a>output_80<span class="ot">&lt;-</span>df_80 <span class="sc">%&gt;%</span> </span>
<span id="cb108-60"><a href="#cb108-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_80_8, <span class="at">by =</span> <span class="st">"ID_80"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-61"><a href="#cb108-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Pred_8)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-62"><a href="#cb108-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class_80 =</span> <span class="fu">case_when</span>(Pred_80 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Bare Sediment"</span>,</span>
<span id="cb108-63"><a href="#cb108-63" aria-hidden="true" tabindex="-1"></a>                              Pred_80 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Green Algae"</span>,</span>
<span id="cb108-64"><a href="#cb108-64" aria-hidden="true" tabindex="-1"></a>                              Pred_80 <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Bare Sediment"</span>,</span>
<span id="cb108-65"><a href="#cb108-65" aria-hidden="true" tabindex="-1"></a>                              Pred_80 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb108-66"><a href="#cb108-66" aria-hidden="true" tabindex="-1"></a>                              Pred_80 <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Microphytobenthos"</span>,</span>
<span id="cb108-67"><a href="#cb108-67" aria-hidden="true" tabindex="-1"></a>                              Pred_80 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb108-68"><a href="#cb108-68" aria-hidden="true" tabindex="-1"></a>                              Pred_80 <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb108-69"><a href="#cb108-69" aria-hidden="true" tabindex="-1"></a>                              Pred_80 <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb108-70"><a href="#cb108-70" aria-hidden="true" tabindex="-1"></a>                              Pred_80 <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Sun Glint"</span>,</span>
<span id="cb108-71"><a href="#cb108-71" aria-hidden="true" tabindex="-1"></a>                              Pred_80 <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Water"</span>,</span>
<span id="cb108-72"><a href="#cb108-72" aria-hidden="true" tabindex="-1"></a>                              Pred_80 <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb108-73"><a href="#cb108-73" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(Pred_80)),</span>
<span id="cb108-74"><a href="#cb108-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">Class_8 =</span> <span class="fu">case_when</span>(Pred_8 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Bare Sediment"</span>,</span>
<span id="cb108-75"><a href="#cb108-75" aria-hidden="true" tabindex="-1"></a>                              Pred_8 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Green Algae"</span>,</span>
<span id="cb108-76"><a href="#cb108-76" aria-hidden="true" tabindex="-1"></a>                              Pred_8 <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Bare Sediment"</span>,</span>
<span id="cb108-77"><a href="#cb108-77" aria-hidden="true" tabindex="-1"></a>                              Pred_8 <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb108-78"><a href="#cb108-78" aria-hidden="true" tabindex="-1"></a>                              Pred_8 <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Microphytobenthos"</span>,</span>
<span id="cb108-79"><a href="#cb108-79" aria-hidden="true" tabindex="-1"></a>                              Pred_8 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb108-80"><a href="#cb108-80" aria-hidden="true" tabindex="-1"></a>                              Pred_8 <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb108-81"><a href="#cb108-81" aria-hidden="true" tabindex="-1"></a>                              Pred_8 <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb108-82"><a href="#cb108-82" aria-hidden="true" tabindex="-1"></a>                              Pred_8 <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Sun Glint"</span>,</span>
<span id="cb108-83"><a href="#cb108-83" aria-hidden="true" tabindex="-1"></a>                              Pred_8 <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Water"</span>,</span>
<span id="cb108-84"><a href="#cb108-84" aria-hidden="true" tabindex="-1"></a>                              Pred_8 <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Xanthophyceae"</span>,</span>
<span id="cb108-85"><a href="#cb108-85" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(Pred_8))</span>
<span id="cb108-86"><a href="#cb108-86" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb108-87"><a href="#cb108-87" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(Class_80 <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb108-88"><a href="#cb108-88" aria-hidden="true" tabindex="-1"></a>                 Class_80 <span class="sc">!=</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb108-89"><a href="#cb108-89" aria-hidden="true" tabindex="-1"></a>                 Class_80 <span class="sc">!=</span> <span class="st">"Sun Glint"</span>,</span>
<span id="cb108-90"><a href="#cb108-90" aria-hidden="true" tabindex="-1"></a>                 Class_8 <span class="sc">!=</span> <span class="st">"Water"</span>,</span>
<span id="cb108-91"><a href="#cb108-91" aria-hidden="true" tabindex="-1"></a>                 Class_8 <span class="sc">!=</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb108-92"><a href="#cb108-92" aria-hidden="true" tabindex="-1"></a>                 Class_8 <span class="sc">!=</span> <span class="st">"Sun Glint"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-93"><a href="#cb108-93" aria-hidden="true" tabindex="-1"></a>           <span class="fu">group_by</span>(ID_80, Prob_80) <span class="sc">%&gt;%</span> </span>
<span id="cb108-94"><a href="#cb108-94" aria-hidden="true" tabindex="-1"></a>           <span class="fu">summarise</span>(<span class="at">prop_Sed =</span> <span class="fu">sum</span>((Pred_8 <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">|</span>(Pred_8 <span class="sc">==</span> <span class="dv">3</span>))<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb108-95"><a href="#cb108-95" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prop_Green =</span> <span class="fu">sum</span>(Pred_8 <span class="sc">==</span> <span class="dv">2</span>)<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb108-96"><a href="#cb108-96" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prop_Magno =</span> <span class="fu">sum</span>((Pred_8 <span class="sc">==</span> <span class="dv">4</span>)<span class="sc">|</span>(Pred_8 <span class="sc">==</span> <span class="dv">6</span>))<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb108-97"><a href="#cb108-97" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prop_MPB =</span> <span class="fu">sum</span>(Pred_8 <span class="sc">==</span> <span class="dv">5</span>)<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb108-98"><a href="#cb108-98" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prop_Rodo =</span> <span class="fu">sum</span>(Pred_8 <span class="sc">==</span> <span class="dv">8</span>)<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb108-99"><a href="#cb108-99" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prop_Xantho =</span> <span class="fu">sum</span>(Pred_8 <span class="sc">==</span> <span class="dv">11</span>)<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb108-100"><a href="#cb108-100" aria-hidden="true" tabindex="-1"></a>                     <span class="at">True =</span> <span class="fu">unique</span>(Class_80)) <span class="sc">%&gt;%</span></span>
<span id="cb108-101"><a href="#cb108-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(ID_80,True,Prob_80), <span class="at">names_to =</span> <span class="st">"Class"</span>, <span class="at">values_to =</span> <span class="st">"Proportion"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-102"><a href="#cb108-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">case_when</span>(Class <span class="sc">==</span> <span class="st">"prop_Sed"</span> <span class="sc">~</span> <span class="st">"Bare Sediment"</span>,</span>
<span id="cb108-103"><a href="#cb108-103" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"prop_Green"</span> <span class="sc">~</span> <span class="st">"Green Algae"</span>,</span>
<span id="cb108-104"><a href="#cb108-104" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"prop_Magno"</span> <span class="sc">~</span> <span class="st">"Magnoliopsida"</span>,</span>
<span id="cb108-105"><a href="#cb108-105" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"prop_MPB"</span> <span class="sc">~</span> <span class="st">"Microphytobenthos"</span>,</span>
<span id="cb108-106"><a href="#cb108-106" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"prop_Pheo"</span> <span class="sc">~</span> <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb108-107"><a href="#cb108-107" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"prop_Rodo"</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb108-108"><a href="#cb108-108" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"prop_Glint"</span> <span class="sc">~</span> <span class="st">"Sun Glint"</span>,</span>
<span id="cb108-109"><a href="#cb108-109" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"prop_Water"</span> <span class="sc">~</span> <span class="st">"Water"</span>,</span>
<span id="cb108-110"><a href="#cb108-110" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"prop_Xantho"</span> <span class="sc">~</span> <span class="st">"Xanthophyceae"</span>),</span>
<span id="cb108-111"><a href="#cb108-111" aria-hidden="true" tabindex="-1"></a>         <span class="at">same =</span> <span class="fu">case_when</span>(True <span class="sc">==</span> Class <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb108-112"><a href="#cb108-112" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-113"><a href="#cb108-113" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>Proportion <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb108-114"><a href="#cb108-114" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb108-115"><a href="#cb108-115" aria-hidden="true" tabindex="-1"></a>  list<span class="ot">&lt;-</span>output_80 <span class="sc">%&gt;%</span> </span>
<span id="cb108-116"><a href="#cb108-116" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Proportion <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb108-117"><a href="#cb108-117" aria-hidden="true" tabindex="-1"></a>                Class <span class="sc">==</span> True) <span class="sc">%&gt;%</span> </span>
<span id="cb108-118"><a href="#cb108-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(ID_80)</span>
<span id="cb108-119"><a href="#cb108-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-120"><a href="#cb108-120" aria-hidden="true" tabindex="-1"></a>output_80_filtered<span class="ot">&lt;-</span>output_80 <span class="sc">%&gt;%</span> </span>
<span id="cb108-121"><a href="#cb108-121" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>ID_80 <span class="sc">%in%</span> list )</span>
<span id="cb108-122"><a href="#cb108-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-123"><a href="#cb108-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-124"><a href="#cb108-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-125"><a href="#cb108-125" aria-hidden="true" tabindex="-1"></a>output_80_filtered_same<span class="ot">&lt;-</span>output_80_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb108-126"><a href="#cb108-126" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(same <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb108-127"><a href="#cb108-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-128"><a href="#cb108-128" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(output_80_filtered, <span class="st">"./Output/output_80_filtered_Upscaling.csv"</span>)</span>
<span id="cb108-129"><a href="#cb108-129" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(output_80_filtered_same, <span class="st">"./Output/output_80_filtered_same_Upscaling.csv"</span>)</span>
<span id="cb108-130"><a href="#cb108-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-131"><a href="#cb108-131" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb108-132"><a href="#cb108-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-133"><a href="#cb108-133" aria-hidden="true" tabindex="-1"></a>  output_80_filtered<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"./Output/output_80_filtered_Upscaling.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-134"><a href="#cb108-134" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Proportion =</span> Proportion <span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-135"><a href="#cb108-135" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb108-136"><a href="#cb108-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb108-137"><a href="#cb108-137" aria-hidden="true" tabindex="-1"></a>  output_80_filtered_same<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"./Output/output_80_filtered_same_Upscaling.csv"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb108-138"><a href="#cb108-138" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Proportion =</span> Proportion <span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-139"><a href="#cb108-139" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb108-140"><a href="#cb108-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb108-141"><a href="#cb108-141" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-142"><a href="#cb108-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-143"><a href="#cb108-143" aria-hidden="true" tabindex="-1"></a><span class="do">################# LM ####################</span></span>
<span id="cb108-144"><a href="#cb108-144" aria-hidden="true" tabindex="-1"></a>lm_sediment<span class="ot">&lt;-</span>output_80_filtered_same <span class="sc">%&gt;%</span></span>
<span id="cb108-145"><a href="#cb108-145" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Bare Sediment"</span>) </span>
<span id="cb108-146"><a href="#cb108-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-147"><a href="#cb108-147" aria-hidden="true" tabindex="-1"></a> lm_sediment<span class="ot">&lt;-</span> <span class="fu">lm</span>(lm_sediment<span class="sc">$</span>Prob_80 <span class="sc">~</span> lm_sediment<span class="sc">$</span>Proportion)</span>
<span id="cb108-148"><a href="#cb108-148" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb108-149"><a href="#cb108-149" aria-hidden="true" tabindex="-1"></a> lm_green<span class="ot">&lt;-</span>output_80_filtered_same <span class="sc">%&gt;%</span></span>
<span id="cb108-150"><a href="#cb108-150" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Green Algae"</span>) </span>
<span id="cb108-151"><a href="#cb108-151" aria-hidden="true" tabindex="-1"></a>  lm_green<span class="ot">&lt;-</span> <span class="fu">lm</span>(lm_green<span class="sc">$</span>Prob_80 <span class="sc">~</span> lm_green<span class="sc">$</span>Proportion)</span>
<span id="cb108-152"><a href="#cb108-152" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb108-153"><a href="#cb108-153" aria-hidden="true" tabindex="-1"></a> lm_magno<span class="ot">&lt;-</span>output_80_filtered_same <span class="sc">%&gt;%</span></span>
<span id="cb108-154"><a href="#cb108-154" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Magnoliopsida"</span>) </span>
<span id="cb108-155"><a href="#cb108-155" aria-hidden="true" tabindex="-1"></a>   lm_magno<span class="ot">&lt;-</span> <span class="fu">lm</span>(lm_magno<span class="sc">$</span>Prob_80 <span class="sc">~</span> lm_magno<span class="sc">$</span>Proportion)</span>
<span id="cb108-156"><a href="#cb108-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-157"><a href="#cb108-157" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb108-158"><a href="#cb108-158" aria-hidden="true" tabindex="-1"></a> lm_MPB<span class="ot">&lt;-</span>output_80_filtered_same <span class="sc">%&gt;%</span></span>
<span id="cb108-159"><a href="#cb108-159" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Microphytobenthos"</span>)</span>
<span id="cb108-160"><a href="#cb108-160" aria-hidden="true" tabindex="-1"></a>    lm_MPB<span class="ot">&lt;-</span> <span class="fu">lm</span>(lm_MPB<span class="sc">$</span>Prob_80 <span class="sc">~</span> lm_MPB<span class="sc">$</span>Proportion)</span>
<span id="cb108-161"><a href="#cb108-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-162"><a href="#cb108-162" aria-hidden="true" tabindex="-1"></a>lm_Rodo<span class="ot">&lt;-</span>output_80_filtered_same <span class="sc">%&gt;%</span></span>
<span id="cb108-163"><a href="#cb108-163" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Rodophyceae"</span>)</span>
<span id="cb108-164"><a href="#cb108-164" aria-hidden="true" tabindex="-1"></a>    lm_Rodo<span class="ot">&lt;-</span> <span class="fu">lm</span>(lm_Rodo<span class="sc">$</span>Prob_80 <span class="sc">~</span> lm_Rodo<span class="sc">$</span>Proportion)</span>
<span id="cb108-165"><a href="#cb108-165" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb108-166"><a href="#cb108-166" aria-hidden="true" tabindex="-1"></a> <span class="do">########### ALPHA ###############</span></span>
<span id="cb108-167"><a href="#cb108-167" aria-hidden="true" tabindex="-1"></a>alpha_sed<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">prop =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,  <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-168"><a href="#cb108-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> lm_sediment<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]<span class="sc">*</span>prop<span class="sc">+</span>lm_sediment<span class="sc">$</span>coefficients[[<span class="dv">1</span>]],</span>
<span id="cb108-169"><a href="#cb108-169" aria-hidden="true" tabindex="-1"></a>         <span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.)),</span>
<span id="cb108-170"><a href="#cb108-170" aria-hidden="true" tabindex="-1"></a>         <span class="at">xmin =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,  <span class="fl">0.01</span>),</span>
<span id="cb108-171"><a href="#cb108-171" aria-hidden="true" tabindex="-1"></a>         <span class="at">xmax =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">1.01</span>,<span class="fl">0.01</span>),</span>
<span id="cb108-172"><a href="#cb108-172" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymin =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(.)),</span>
<span id="cb108-173"><a href="#cb108-173" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymax =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb108-174"><a href="#cb108-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(xmin,xmax),<span class="at">names_to =</span> <span class="st">"name_x"</span>, <span class="at">values_to =</span> <span class="st">"x"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-175"><a href="#cb108-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(ymax,ymin), <span class="at">names_to =</span> <span class="st">"name_y"</span>,<span class="at">values_to =</span> <span class="st">"y"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-176"><a href="#cb108-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="fu">nrow</span>(.)<span class="sc">/</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-177"><a href="#cb108-177" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(name_x,name_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-178"><a href="#cb108-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> <span class="fu">case_when</span>(alpha <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb108-179"><a href="#cb108-179" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> alpha),</span>
<span id="cb108-180"><a href="#cb108-180" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">%&gt;%</span> </span>
<span id="cb108-181"><a href="#cb108-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> (alpha <span class="sc">-</span> <span class="fu">min</span>(alpha))<span class="sc">/</span> (<span class="fu">max</span>(alpha) <span class="sc">-</span> <span class="fu">min</span>(alpha)))</span>
<span id="cb108-182"><a href="#cb108-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-183"><a href="#cb108-183" aria-hidden="true" tabindex="-1"></a>alpha_green<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">prop =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,  <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-184"><a href="#cb108-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> lm_green<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]<span class="sc">*</span>prop<span class="sc">+</span>lm_green<span class="sc">$</span>coefficients[[<span class="dv">1</span>]],</span>
<span id="cb108-185"><a href="#cb108-185" aria-hidden="true" tabindex="-1"></a>         <span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.)),</span>
<span id="cb108-186"><a href="#cb108-186" aria-hidden="true" tabindex="-1"></a>         <span class="at">xmin =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,  <span class="fl">0.01</span>),</span>
<span id="cb108-187"><a href="#cb108-187" aria-hidden="true" tabindex="-1"></a>         <span class="at">xmax =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">1.01</span>,<span class="fl">0.01</span>),</span>
<span id="cb108-188"><a href="#cb108-188" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymin =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(.)),</span>
<span id="cb108-189"><a href="#cb108-189" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymax =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb108-190"><a href="#cb108-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(xmin,xmax),<span class="at">names_to =</span> <span class="st">"name_x"</span>, <span class="at">values_to =</span> <span class="st">"x"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-191"><a href="#cb108-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(ymax,ymin), <span class="at">names_to =</span> <span class="st">"name_y"</span>,<span class="at">values_to =</span> <span class="st">"y"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-192"><a href="#cb108-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="fu">nrow</span>(.)<span class="sc">/</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-193"><a href="#cb108-193" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(name_x,name_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-194"><a href="#cb108-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> <span class="fu">case_when</span>(alpha <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb108-195"><a href="#cb108-195" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> alpha),</span>
<span id="cb108-196"><a href="#cb108-196" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">%&gt;%</span> </span>
<span id="cb108-197"><a href="#cb108-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> (alpha <span class="sc">-</span> <span class="fu">min</span>(alpha))<span class="sc">/</span> (<span class="fu">max</span>(alpha) <span class="sc">-</span> <span class="fu">min</span>(alpha)))</span>
<span id="cb108-198"><a href="#cb108-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-199"><a href="#cb108-199" aria-hidden="true" tabindex="-1"></a>alpha_magno<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">prop =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,  <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-200"><a href="#cb108-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> lm_magno<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]<span class="sc">*</span>prop<span class="sc">+</span>lm_magno<span class="sc">$</span>coefficients[[<span class="dv">1</span>]],</span>
<span id="cb108-201"><a href="#cb108-201" aria-hidden="true" tabindex="-1"></a>         <span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.)),</span>
<span id="cb108-202"><a href="#cb108-202" aria-hidden="true" tabindex="-1"></a>         <span class="at">xmin =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,  <span class="fl">0.01</span>),</span>
<span id="cb108-203"><a href="#cb108-203" aria-hidden="true" tabindex="-1"></a>         <span class="at">xmax =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">1.01</span>,<span class="fl">0.01</span>),</span>
<span id="cb108-204"><a href="#cb108-204" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymin =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(.)),</span>
<span id="cb108-205"><a href="#cb108-205" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymax =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb108-206"><a href="#cb108-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(xmin,xmax),<span class="at">names_to =</span> <span class="st">"name_x"</span>, <span class="at">values_to =</span> <span class="st">"x"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-207"><a href="#cb108-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(ymax,ymin), <span class="at">names_to =</span> <span class="st">"name_y"</span>,<span class="at">values_to =</span> <span class="st">"y"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-208"><a href="#cb108-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="fu">nrow</span>(.)<span class="sc">/</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-209"><a href="#cb108-209" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(name_x,name_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-210"><a href="#cb108-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> <span class="fu">case_when</span>(alpha <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb108-211"><a href="#cb108-211" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> alpha),</span>
<span id="cb108-212"><a href="#cb108-212" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">%&gt;%</span> </span>
<span id="cb108-213"><a href="#cb108-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> (alpha <span class="sc">-</span> <span class="fu">min</span>(alpha))<span class="sc">/</span> (<span class="fu">max</span>(alpha) <span class="sc">-</span> <span class="fu">min</span>(alpha)))</span>
<span id="cb108-214"><a href="#cb108-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-215"><a href="#cb108-215" aria-hidden="true" tabindex="-1"></a>alpha_MPB<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">prop =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,  <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-216"><a href="#cb108-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> lm_MPB<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]<span class="sc">*</span>prop<span class="sc">+</span>lm_MPB<span class="sc">$</span>coefficients[[<span class="dv">1</span>]],</span>
<span id="cb108-217"><a href="#cb108-217" aria-hidden="true" tabindex="-1"></a>         <span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.)),</span>
<span id="cb108-218"><a href="#cb108-218" aria-hidden="true" tabindex="-1"></a>         <span class="at">xmin =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,  <span class="fl">0.01</span>),</span>
<span id="cb108-219"><a href="#cb108-219" aria-hidden="true" tabindex="-1"></a>         <span class="at">xmax =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">1.01</span>,<span class="fl">0.01</span>),</span>
<span id="cb108-220"><a href="#cb108-220" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymin =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(.)),</span>
<span id="cb108-221"><a href="#cb108-221" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymax =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb108-222"><a href="#cb108-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(xmin,xmax),<span class="at">names_to =</span> <span class="st">"name_x"</span>, <span class="at">values_to =</span> <span class="st">"x"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-223"><a href="#cb108-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(ymax,ymin), <span class="at">names_to =</span> <span class="st">"name_y"</span>,<span class="at">values_to =</span> <span class="st">"y"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-224"><a href="#cb108-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="fu">nrow</span>(.)<span class="sc">/</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-225"><a href="#cb108-225" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(name_x,name_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-226"><a href="#cb108-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> <span class="fu">case_when</span>(alpha <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb108-227"><a href="#cb108-227" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> alpha),</span>
<span id="cb108-228"><a href="#cb108-228" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">%&gt;%</span> </span>
<span id="cb108-229"><a href="#cb108-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> (alpha <span class="sc">-</span> <span class="fu">min</span>(alpha))<span class="sc">/</span> (<span class="fu">max</span>(alpha) <span class="sc">-</span> <span class="fu">min</span>(alpha)))</span>
<span id="cb108-230"><a href="#cb108-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-231"><a href="#cb108-231" aria-hidden="true" tabindex="-1"></a>alpha_Rodo<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">prop =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,  <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-232"><a href="#cb108-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> lm_Rodo<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]<span class="sc">*</span>prop<span class="sc">+</span>lm_Rodo<span class="sc">$</span>coefficients[[<span class="dv">1</span>]],</span>
<span id="cb108-233"><a href="#cb108-233" aria-hidden="true" tabindex="-1"></a>         <span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.)),</span>
<span id="cb108-234"><a href="#cb108-234" aria-hidden="true" tabindex="-1"></a>         <span class="at">xmin =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,  <span class="fl">0.01</span>),</span>
<span id="cb108-235"><a href="#cb108-235" aria-hidden="true" tabindex="-1"></a>         <span class="at">xmax =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">1.01</span>,<span class="fl">0.01</span>),</span>
<span id="cb108-236"><a href="#cb108-236" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymin =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">nrow</span>(.)),</span>
<span id="cb108-237"><a href="#cb108-237" aria-hidden="true" tabindex="-1"></a>         <span class="at">ymax =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb108-238"><a href="#cb108-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(xmin,xmax),<span class="at">names_to =</span> <span class="st">"name_x"</span>, <span class="at">values_to =</span> <span class="st">"x"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-239"><a href="#cb108-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(ymax,ymin), <span class="at">names_to =</span> <span class="st">"name_y"</span>,<span class="at">values_to =</span> <span class="st">"y"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-240"><a href="#cb108-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="fu">nrow</span>(.)<span class="sc">/</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-241"><a href="#cb108-241" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(name_x,name_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-242"><a href="#cb108-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> <span class="fu">case_when</span>(alpha <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb108-243"><a href="#cb108-243" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> alpha),</span>
<span id="cb108-244"><a href="#cb108-244" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">%&gt;%</span> </span>
<span id="cb108-245"><a href="#cb108-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha =</span> (alpha <span class="sc">-</span> <span class="fu">min</span>(alpha))<span class="sc">/</span> (<span class="fu">max</span>(alpha) <span class="sc">-</span> <span class="fu">min</span>(alpha)))</span>
<span id="cb108-246"><a href="#cb108-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-247"><a href="#cb108-247" aria-hidden="true" tabindex="-1"></a><span class="co"># alpha_xantho&lt;-data.frame(prop = seq(0,1,  0.01)) %&gt;% </span></span>
<span id="cb108-248"><a href="#cb108-248" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(alpha = lm_xantho$coefficients[[2]]*prop+lm_xantho$coefficients[[1]],</span></span>
<span id="cb108-249"><a href="#cb108-249" aria-hidden="true" tabindex="-1"></a><span class="co">#          ID = c(1:nrow(.)),</span></span>
<span id="cb108-250"><a href="#cb108-250" aria-hidden="true" tabindex="-1"></a><span class="co">#          xmin = seq(0,1,  0.01),</span></span>
<span id="cb108-251"><a href="#cb108-251" aria-hidden="true" tabindex="-1"></a><span class="co">#          xmax = seq(0.01,1.01,0.01),</span></span>
<span id="cb108-252"><a href="#cb108-252" aria-hidden="true" tabindex="-1"></a><span class="co">#          ymin = rep(0,nrow(.)),</span></span>
<span id="cb108-253"><a href="#cb108-253" aria-hidden="true" tabindex="-1"></a><span class="co">#          ymax = rep(1,nrow(.))) %&gt;% </span></span>
<span id="cb108-254"><a href="#cb108-254" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(c(xmin,xmax),names_to = "name_x", values_to = "x") %&gt;% </span></span>
<span id="cb108-255"><a href="#cb108-255" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(c(ymax,ymin), names_to = "name_y",values_to = "y") %&gt;% </span></span>
<span id="cb108-256"><a href="#cb108-256" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(y = rep(c(0,1,1,0),nrow(.)/4)) %&gt;% </span></span>
<span id="cb108-257"><a href="#cb108-257" aria-hidden="true" tabindex="-1"></a><span class="co">#   dplyr::select(-c(name_x,name_y)) %&gt;% </span></span>
<span id="cb108-258"><a href="#cb108-258" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(alpha = case_when(alpha &gt; 1 ~ 1,</span></span>
<span id="cb108-259"><a href="#cb108-259" aria-hidden="true" tabindex="-1"></a><span class="co">#                            TRUE ~ alpha),</span></span>
<span id="cb108-260"><a href="#cb108-260" aria-hidden="true" tabindex="-1"></a><span class="co">#          alpha = 1-alpha) %&gt;% </span></span>
<span id="cb108-261"><a href="#cb108-261" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(alpha = (alpha - min(alpha))/ (max(alpha) - min(alpha)))</span></span>
<span id="cb108-262"><a href="#cb108-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-263"><a href="#cb108-263" aria-hidden="true" tabindex="-1"></a><span class="do">#################</span></span>
<span id="cb108-264"><a href="#cb108-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-265"><a href="#cb108-265" aria-hidden="true" tabindex="-1"></a>sediment<span class="ot">&lt;-</span>output_80_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb108-266"><a href="#cb108-266" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(True <span class="sc">==</span> <span class="st">"Bare Sediment"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-267"><a href="#cb108-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">case_when</span>(Class <span class="sc">!=</span> True <span class="sc">~</span> <span class="st">"Other"</span>,</span>
<span id="cb108-268"><a href="#cb108-268" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> Class)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-269"><a href="#cb108-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID_80,Class) <span class="sc">%&gt;%</span> </span>
<span id="cb108-270"><a href="#cb108-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">Prob_80 =</span> <span class="fu">unique</span>(Prob_80),</span>
<span id="cb108-271"><a href="#cb108-271" aria-hidden="true" tabindex="-1"></a>          <span class="at">True =</span> <span class="fu">unique</span>(True),</span>
<span id="cb108-272"><a href="#cb108-272" aria-hidden="true" tabindex="-1"></a>          <span class="at">Class =</span> <span class="fu">unique</span>(Class),</span>
<span id="cb108-273"><a href="#cb108-273" aria-hidden="true" tabindex="-1"></a>          <span class="at">Proportion =</span> <span class="fu">sum</span>(Proportion)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-274"><a href="#cb108-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">as.factor</span>(Class),</span>
<span id="cb108-275"><a href="#cb108-275" aria-hidden="true" tabindex="-1"></a>         <span class="at">Class =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(Class,<span class="st">"Bare Sediment"</span>, <span class="at">after =</span> <span class="cn">Inf</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-276"><a href="#cb108-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb108-277"><a href="#cb108-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Proportion , <span class="at">y =</span> <span class="fu">after_stat</span>(ndensity) , <span class="at">fill =</span> Class),<span class="at">alpha =</span> <span class="fl">0.8</span>,<span class="at">show.legend =</span> F,<span class="at">position =</span> <span class="st">"fill"</span>,<span class="at">adjust =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb108-278"><a href="#cb108-278" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~ True)+</span></span>
<span id="cb108-279"><a href="#cb108-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"gray85"</span>,<span class="st">"#70543e"</span>))<span class="sc">+</span></span>
<span id="cb108-280"><a href="#cb108-280" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_alpha_manual(values = c(0.5,1))+</span></span>
<span id="cb108-281"><a href="#cb108-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb108-282"><a href="#cb108-282" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_polygon(data = alpha_sed, mapping = aes(x=x, y = y, alpha = alpha, group = ID),alpha = alpha_sed$alpha,color=NA, fill = "white")+</span></span>
<span id="cb108-283"><a href="#cb108-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> (lm_sediment<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]<span class="sc">*</span><span class="dv">85</span><span class="sc">+</span>lm_sediment<span class="sc">$</span>coefficients[[<span class="dv">1</span>]])<span class="sc">*</span><span class="dv">100</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>,<span class="at">linewidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb108-284"><a href="#cb108-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Bare Sediment"</span>)<span class="sc">+</span></span>
<span id="cb108-285"><a href="#cb108-285" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom="text",x = lm_sediment$coefficients[[2]]*0.85+lm_sediment$coefficients[[1]]+0.05, y = 0.85, label = "p = 0.85", angle = - 90, size = 7)+</span></span>
<span id="cb108-286"><a href="#cb108-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb108-287"><a href="#cb108-287" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>)</span>
<span id="cb108-288"><a href="#cb108-288" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.y = element_blank(),</span></span>
<span id="cb108-289"><a href="#cb108-289" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.x = element_text(size = 20)</span></span>
<span id="cb108-290"><a href="#cb108-290" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb108-291"><a href="#cb108-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-292"><a href="#cb108-292" aria-hidden="true" tabindex="-1"></a>green<span class="ot">&lt;-</span>output_80_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb108-293"><a href="#cb108-293" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(True <span class="sc">==</span> <span class="st">"Green Algae"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-294"><a href="#cb108-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">case_when</span>(Class <span class="sc">!=</span> True <span class="sc">~</span> <span class="st">"Other"</span>,</span>
<span id="cb108-295"><a href="#cb108-295" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> Class)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-296"><a href="#cb108-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID_80,Class) <span class="sc">%&gt;%</span> </span>
<span id="cb108-297"><a href="#cb108-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">Prob_80 =</span> <span class="fu">unique</span>(Prob_80),</span>
<span id="cb108-298"><a href="#cb108-298" aria-hidden="true" tabindex="-1"></a>          <span class="at">True =</span> <span class="fu">unique</span>(True),</span>
<span id="cb108-299"><a href="#cb108-299" aria-hidden="true" tabindex="-1"></a>          <span class="at">Class =</span> <span class="fu">unique</span>(Class),</span>
<span id="cb108-300"><a href="#cb108-300" aria-hidden="true" tabindex="-1"></a>          <span class="at">Proportion =</span> <span class="fu">sum</span>(Proportion)) <span class="sc">%&gt;%</span></span>
<span id="cb108-301"><a href="#cb108-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">as.factor</span>(Class),</span>
<span id="cb108-302"><a href="#cb108-302" aria-hidden="true" tabindex="-1"></a>         <span class="at">Class =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(Class,<span class="st">"Green Algae"</span>, <span class="at">after =</span> <span class="cn">Inf</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-303"><a href="#cb108-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb108-304"><a href="#cb108-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Proportion , <span class="at">y =</span> <span class="fu">after_stat</span>(ndensity) , <span class="at">fill =</span> Class),<span class="at">alpha =</span> <span class="fl">0.8</span>,<span class="at">show.legend =</span> F,<span class="at">position =</span> <span class="st">"fill"</span>,<span class="at">adjust =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb108-305"><a href="#cb108-305" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~ True)+</span></span>
<span id="cb108-306"><a href="#cb108-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"gray85"</span>, <span class="st">"#b3ff1a"</span>))<span class="sc">+</span></span>
<span id="cb108-307"><a href="#cb108-307" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_alpha_manual(values = c(0.5,1))+</span></span>
<span id="cb108-308"><a href="#cb108-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb108-309"><a href="#cb108-309" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_polygon(data = alpha_green, mapping = aes(x=x, y = y, alpha = alpha, group = ID),alpha = alpha_green$alpha,color=NA, fill = "white")+</span></span>
<span id="cb108-310"><a href="#cb108-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> (lm_green<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]<span class="sc">*</span><span class="dv">85</span><span class="sc">+</span>lm_green<span class="sc">$</span>coefficients[[<span class="dv">1</span>]])<span class="sc">*</span><span class="dv">100</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>,<span class="at">linewidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb108-311"><a href="#cb108-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Green Algae"</span>)<span class="sc">+</span></span>
<span id="cb108-312"><a href="#cb108-312" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom="text",x = lm_green$coefficients[[2]]*0.85+lm_green$coefficients[[1]]+0.05, y = 0.85, label = "p = 0.85", angle = - 90, size = 7)+</span></span>
<span id="cb108-313"><a href="#cb108-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb108-314"><a href="#cb108-314" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>)</span>
<span id="cb108-315"><a href="#cb108-315" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.y = element_blank(),</span></span>
<span id="cb108-316"><a href="#cb108-316" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.x = element_text(size = 20)</span></span>
<span id="cb108-317"><a href="#cb108-317" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb108-318"><a href="#cb108-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-319"><a href="#cb108-319" aria-hidden="true" tabindex="-1"></a>magno<span class="ot">&lt;-</span>output_80_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb108-320"><a href="#cb108-320" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(True <span class="sc">==</span> <span class="st">"Magnoliopsida"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-321"><a href="#cb108-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">case_when</span>(Class <span class="sc">!=</span> True <span class="sc">~</span> <span class="st">"Other"</span>,</span>
<span id="cb108-322"><a href="#cb108-322" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> Class)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-323"><a href="#cb108-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID_80,Class) <span class="sc">%&gt;%</span> </span>
<span id="cb108-324"><a href="#cb108-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">Prob_80 =</span> <span class="fu">unique</span>(Prob_80),</span>
<span id="cb108-325"><a href="#cb108-325" aria-hidden="true" tabindex="-1"></a>          <span class="at">True =</span> <span class="fu">unique</span>(True),</span>
<span id="cb108-326"><a href="#cb108-326" aria-hidden="true" tabindex="-1"></a>          <span class="at">Class =</span> <span class="fu">unique</span>(Class),</span>
<span id="cb108-327"><a href="#cb108-327" aria-hidden="true" tabindex="-1"></a>          <span class="at">Proportion =</span> <span class="fu">sum</span>(Proportion)) <span class="sc">%&gt;%</span></span>
<span id="cb108-328"><a href="#cb108-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">as.factor</span>(Class),</span>
<span id="cb108-329"><a href="#cb108-329" aria-hidden="true" tabindex="-1"></a>         <span class="at">Class =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(Class,<span class="st">"Magnoliopsida"</span>, <span class="at">after =</span> <span class="cn">Inf</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb108-330"><a href="#cb108-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb108-331"><a href="#cb108-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Proportion , <span class="at">y =</span> <span class="fu">after_stat</span>(ndensity) , <span class="at">fill =</span> Class),<span class="at">alpha =</span> <span class="fl">0.8</span>,<span class="at">show.legend =</span> F, <span class="at">position =</span> <span class="st">"fill"</span>,<span class="at">adjust =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb108-332"><a href="#cb108-332" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~ True)+</span></span>
<span id="cb108-333"><a href="#cb108-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"gray85"</span>,<span class="st">"#389350"</span>))<span class="sc">+</span></span>
<span id="cb108-334"><a href="#cb108-334" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_alpha_manual(values = c(0.5,1))+</span></span>
<span id="cb108-335"><a href="#cb108-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb108-336"><a href="#cb108-336" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_polygon(data = alpha_magno, mapping = aes(x=x, y = y, alpha = alpha, group = ID),alpha = alpha_magno$alpha,color=NA, fill = "white")+</span></span>
<span id="cb108-337"><a href="#cb108-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> (lm_magno<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]<span class="sc">*</span><span class="dv">85</span><span class="sc">+</span>lm_magno<span class="sc">$</span>coefficients[[<span class="dv">1</span>]])<span class="sc">*</span><span class="dv">100</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>,<span class="at">linewidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb108-338"><a href="#cb108-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Magnoliopsida"</span>)<span class="sc">+</span></span>
<span id="cb108-339"><a href="#cb108-339" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom="text",x = lm_magno$coefficients[[2]]*0.85+lm_magno$coefficients[[1]]+0.05, y = 0.85, label = "p = 0.85", angle = - 90, size = 7)+</span></span>
<span id="cb108-340"><a href="#cb108-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb108-341"><a href="#cb108-341" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>)</span>
<span id="cb108-342"><a href="#cb108-342" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.y = element_blank(),</span></span>
<span id="cb108-343"><a href="#cb108-343" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.x = element_text(size = 20)</span></span>
<span id="cb108-344"><a href="#cb108-344" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb108-345"><a href="#cb108-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-346"><a href="#cb108-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-347"><a href="#cb108-347" aria-hidden="true" tabindex="-1"></a>MPB<span class="ot">&lt;-</span>output_80_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb108-348"><a href="#cb108-348" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(True <span class="sc">==</span> <span class="st">"Microphytobenthos"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-349"><a href="#cb108-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">case_when</span>(Class <span class="sc">!=</span> True <span class="sc">~</span> <span class="st">"Other"</span>,</span>
<span id="cb108-350"><a href="#cb108-350" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> Class)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-351"><a href="#cb108-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID_80,Class) <span class="sc">%&gt;%</span> </span>
<span id="cb108-352"><a href="#cb108-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">Prob_80 =</span> <span class="fu">unique</span>(Prob_80),</span>
<span id="cb108-353"><a href="#cb108-353" aria-hidden="true" tabindex="-1"></a>          <span class="at">True =</span> <span class="fu">unique</span>(True),</span>
<span id="cb108-354"><a href="#cb108-354" aria-hidden="true" tabindex="-1"></a>          <span class="at">Class =</span> <span class="fu">unique</span>(Class),</span>
<span id="cb108-355"><a href="#cb108-355" aria-hidden="true" tabindex="-1"></a>          <span class="at">Proportion =</span> <span class="fu">sum</span>(Proportion)) <span class="sc">%&gt;%</span></span>
<span id="cb108-356"><a href="#cb108-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">as.factor</span>(Class),</span>
<span id="cb108-357"><a href="#cb108-357" aria-hidden="true" tabindex="-1"></a>         <span class="at">Class =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(Class,<span class="st">"Microphytobenthos"</span>, <span class="at">after =</span> <span class="cn">Inf</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb108-358"><a href="#cb108-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb108-359"><a href="#cb108-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Proportion , <span class="at">y =</span> <span class="fu">after_stat</span>(ndensity) , <span class="at">fill =</span> Class),<span class="at">alpha =</span> <span class="fl">0.8</span>,<span class="at">show.legend =</span> F,<span class="at">position =</span> <span class="st">"fill"</span>,<span class="at">adjust =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb108-360"><a href="#cb108-360" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~ True)+</span></span>
<span id="cb108-361"><a href="#cb108-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"gray85"</span>,<span class="st">"#DAA520"</span>))<span class="sc">+</span></span>
<span id="cb108-362"><a href="#cb108-362" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_alpha_manual(values = c(0.5,1))+</span></span>
<span id="cb108-363"><a href="#cb108-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb108-364"><a href="#cb108-364" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_polygon(data = alpha_MPB, mapping = aes(x=x, y = y, alpha = alpha, group = ID),alpha = alpha_MPB$alpha,color=NA, fill = "white")+</span></span>
<span id="cb108-365"><a href="#cb108-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> (lm_MPB<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]<span class="sc">*</span><span class="dv">85</span><span class="sc">+</span>lm_MPB<span class="sc">$</span>coefficients[[<span class="dv">1</span>]])<span class="sc">*</span><span class="dv">100</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>,<span class="at">linewidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb108-366"><a href="#cb108-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Microphytobenthos"</span>)<span class="sc">+</span></span>
<span id="cb108-367"><a href="#cb108-367" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom="text",x = lm_MPB$coefficients[[2]]*0.85+lm_MPB$coefficients[[1]]+0.05, y = 0.85, label = "p = 0.85", angle = - 90, size = 7)+</span></span>
<span id="cb108-368"><a href="#cb108-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb108-369"><a href="#cb108-369" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>)</span>
<span id="cb108-370"><a href="#cb108-370" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.y = element_blank(),</span></span>
<span id="cb108-371"><a href="#cb108-371" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.x = element_text(size = 20)</span></span>
<span id="cb108-372"><a href="#cb108-372" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb108-373"><a href="#cb108-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-374"><a href="#cb108-374" aria-hidden="true" tabindex="-1"></a>rodo<span class="ot">&lt;-</span>output_80_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb108-375"><a href="#cb108-375" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(True <span class="sc">==</span> <span class="st">"Rodophyceae"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-376"><a href="#cb108-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">case_when</span>(Class <span class="sc">!=</span> True <span class="sc">~</span> <span class="st">"Others Classes"</span>,</span>
<span id="cb108-377"><a href="#cb108-377" aria-hidden="true" tabindex="-1"></a>                           Class <span class="sc">==</span> <span class="st">"Rodophyceae"</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb108-378"><a href="#cb108-378" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> Class),</span>
<span id="cb108-379"><a href="#cb108-379" aria-hidden="true" tabindex="-1"></a>         <span class="at">True =</span> <span class="fu">case_when</span>(True <span class="sc">==</span> <span class="st">"Rodophyceae"</span> <span class="sc">~</span> <span class="st">"Rhodophyceae"</span>,</span>
<span id="cb108-380"><a href="#cb108-380" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> True)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-381"><a href="#cb108-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID_80,Class) <span class="sc">%&gt;%</span> </span>
<span id="cb108-382"><a href="#cb108-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">Prob_80 =</span> <span class="fu">unique</span>(Prob_80),</span>
<span id="cb108-383"><a href="#cb108-383" aria-hidden="true" tabindex="-1"></a>          <span class="at">True =</span> <span class="fu">unique</span>(True),</span>
<span id="cb108-384"><a href="#cb108-384" aria-hidden="true" tabindex="-1"></a>          <span class="at">Class =</span> <span class="fu">unique</span>(Class),</span>
<span id="cb108-385"><a href="#cb108-385" aria-hidden="true" tabindex="-1"></a>          <span class="at">Proportion =</span> <span class="fu">sum</span>(Proportion)) <span class="sc">%&gt;%</span></span>
<span id="cb108-386"><a href="#cb108-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">factor</span>(Class, <span class="fu">c</span>(<span class="st">"Others Classes"</span>,<span class="st">"Rhodophyceae"</span>,<span class="st">"Bacillariophyceae"</span>, <span class="st">"Magnoliopsida"</span>,<span class="st">"Chlorophyceae"</span>,<span class="st">"Phaeophyceae"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb108-387"><a href="#cb108-387" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Class = forcats::fct_relevel(Class,"Rodophyceae", after = Inf)) %&gt;%</span></span>
<span id="cb108-388"><a href="#cb108-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb108-389"><a href="#cb108-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Proportion , <span class="at">y =</span> <span class="fu">after_stat</span>(ndensity) , <span class="at">fill =</span> Class),<span class="at">alpha =</span> <span class="fl">0.8</span>,<span class="at">position =</span> <span class="st">"fill"</span>,<span class="at">adjust =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb108-390"><a href="#cb108-390" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~ True)+</span></span>
<span id="cb108-391"><a href="#cb108-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Class"</span>,</span>
<span id="cb108-392"><a href="#cb108-392" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Others Classes"</span>,<span class="st">"Rhodophyceae"</span>,<span class="st">"Bacillariophyceae"</span>, <span class="st">"Magnoliopsida"</span>,<span class="st">"Chlorophyceae"</span>,<span class="st">"Phaeophyceae"</span>),</span>
<span id="cb108-393"><a href="#cb108-393" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span><span class="fu">c</span>(<span class="st">"gray85"</span>,<span class="st">"#b3002d"</span>,<span class="st">"#DAA520"</span>,<span class="st">"#389350"</span>,<span class="st">"#b3ff1a"</span>,<span class="st">"#70543e"</span>),</span>
<span id="cb108-394"><a href="#cb108-394" aria-hidden="true" tabindex="-1"></a>                    <span class="at">drop =</span> F)<span class="sc">+</span></span>
<span id="cb108-395"><a href="#cb108-395" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_alpha_manual(values = c(0.5,1))+</span></span>
<span id="cb108-396"><a href="#cb108-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb108-397"><a href="#cb108-397" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_polygon(data = alpha_Rodo, mapping = aes(x=x, y = y, alpha = alpha, group = ID),alpha = alpha_Rodo$alpha,color=NA, fill = "white")+</span></span>
<span id="cb108-398"><a href="#cb108-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> (lm_Rodo<span class="sc">$</span>coefficients[[<span class="dv">2</span>]]<span class="sc">*</span><span class="dv">85</span><span class="sc">+</span>lm_Rodo<span class="sc">$</span>coefficients[[<span class="dv">1</span>]])<span class="sc">*</span><span class="dv">100</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>,<span class="at">linewidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb108-399"><a href="#cb108-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Rhodophyceae"</span>)<span class="sc">+</span></span>
<span id="cb108-400"><a href="#cb108-400" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom="text",x = lm_Rodo$coefficients[[2]]*0.85+lm_Rodo$coefficients[[1]]+0.05, y = 0.85, label = "p = 0.85", angle = - 90, size = 7)+</span></span>
<span id="cb108-401"><a href="#cb108-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb108-402"><a href="#cb108-402" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb108-403"><a href="#cb108-403" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.y = element_blank(),</span></span>
<span id="cb108-404"><a href="#cb108-404" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.x = element_text(size = 20),</span></span>
<span id="cb108-405"><a href="#cb108-405" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb108-406"><a href="#cb108-406" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">"cm"</span>),</span>
<span id="cb108-407"><a href="#cb108-407" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb108-408"><a href="#cb108-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-409"><a href="#cb108-409" aria-hidden="true" tabindex="-1"></a><span class="co"># xantho&lt;-output_80_filtered %&gt;% </span></span>
<span id="cb108-410"><a href="#cb108-410" aria-hidden="true" tabindex="-1"></a><span class="co">#   dplyr::filter(True == "Xanthophyceae") %&gt;% </span></span>
<span id="cb108-411"><a href="#cb108-411" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot()+</span></span>
<span id="cb108-412"><a href="#cb108-412" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_density(mapping = aes(x = Proportion , y = after_stat(ndensity) , fill = Class),position = "fill",adjust = 3)+</span></span>
<span id="cb108-413"><a href="#cb108-413" aria-hidden="true" tabindex="-1"></a><span class="co">#   # facet_wrap(~ True)+</span></span>
<span id="cb108-414"><a href="#cb108-414" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_manual(values=c("#70543e", "#b3ff1a", "#389350", "#DAA520","#b3002d", "#cccc00"))+</span></span>
<span id="cb108-415"><a href="#cb108-415" aria-hidden="true" tabindex="-1"></a><span class="co">#   # scale_alpha_manual(values = c(0.5,1))+</span></span>
<span id="cb108-416"><a href="#cb108-416" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_Bede()+</span></span>
<span id="cb108-417"><a href="#cb108-417" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_polygon(data = alpha_xantho, mapping = aes(x=x, y = y, alpha = alpha, group = ID),alpha = alpha_xantho$alpha,color=NA, fill = "white")+</span></span>
<span id="cb108-418"><a href="#cb108-418" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_vline(xintercept = lm_xantho$coefficients[[2]]*0.85+lm_xantho$coefficients[[1]])+</span></span>
<span id="cb108-419"><a href="#cb108-419" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Xanthophyceae")+</span></span>
<span id="cb108-420"><a href="#cb108-420" aria-hidden="true" tabindex="-1"></a><span class="co">#   annotate(geom="text",x = lm_xantho$coefficients[[2]]*0.85+lm_xantho$coefficients[[1]]+0.05, y = 0.85, label = "p = 0.85", angle = - 90, size = 7)+</span></span>
<span id="cb108-421"><a href="#cb108-421" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(size = 15, angle = 45, hjust = 0.7),</span></span>
<span id="cb108-422"><a href="#cb108-422" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(size = 15),</span></span>
<span id="cb108-423"><a href="#cb108-423" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.title.y = element_blank(),</span></span>
<span id="cb108-424"><a href="#cb108-424" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.title.x = element_text(size = 20))</span></span>
<span id="cb108-425"><a href="#cb108-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-426"><a href="#cb108-426" aria-hidden="true" tabindex="-1"></a>plot<span class="ot">&lt;-</span>(sediment <span class="sc">+</span> green) <span class="sc">/</span></span>
<span id="cb108-427"><a href="#cb108-427" aria-hidden="true" tabindex="-1"></a>(MPB <span class="sc">+</span> rodo)<span class="sc">+</span></span>
<span id="cb108-428"><a href="#cb108-428" aria-hidden="true" tabindex="-1"></a>magno<span class="sc">+</span></span>
<span id="cb108-429"><a href="#cb108-429" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">&amp;</span></span>
<span id="cb108-430"><a href="#cb108-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb108-431"><a href="#cb108-431" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">25</span>, <span class="at">hjust =</span> <span class="fl">0.55</span>),</span>
<span id="cb108-432"><a href="#cb108-432" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>, <span class="at">hjust =</span> <span class="fl">0.8</span>),</span>
<span id="cb108-433"><a href="#cb108-433" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb108-434"><a href="#cb108-434" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb108-435"><a href="#cb108-435" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_blank</span>())<span class="sc">&amp;</span></span>
<span id="cb108-436"><a href="#cb108-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">100</span>),<span class="at">limits=</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">100.01</span>),<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">&amp;</span></span>
<span id="cb108-437"><a href="#cb108-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">&amp;</span></span>
<span id="cb108-438"><a href="#cb108-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Percent Cover (%)"</span>) <span class="sc">&amp;</span> </span>
<span id="cb108-439"><a href="#cb108-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>)</span>
<span id="cb108-440"><a href="#cb108-440" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-441"><a href="#cb108-441" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"Figures/Upscaling/density_vs_Proportion.png"</span>,plot , <span class="at">width =</span> <span class="dv">833</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height =</span> <span class="dv">1118</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [49]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>output_80_filtered_same<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"./Output/output_80_filtered_same_Upscaling.csv"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Proportion =</span> Proportion <span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="do">################# LM ####################</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>lm_sediment<span class="ot">&lt;-</span>output_80_filtered_same <span class="sc">%&gt;%</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Bare Sediment"</span>) </span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a> lm_sediment<span class="ot">&lt;-</span> <span class="fu">lm</span>(lm_sediment<span class="sc">$</span>Prob_80 <span class="sc">~</span> lm_sediment<span class="sc">$</span>Proportion)</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a> lm_green<span class="ot">&lt;-</span>output_80_filtered_same <span class="sc">%&gt;%</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Green Algae"</span>) </span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>  lm_green<span class="ot">&lt;-</span> <span class="fu">lm</span>(lm_green<span class="sc">$</span>Prob_80 <span class="sc">~</span> lm_green<span class="sc">$</span>Proportion)</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a> lm_magno<span class="ot">&lt;-</span>output_80_filtered_same <span class="sc">%&gt;%</span></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Magnoliopsida"</span>) </span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>   lm_magno<span class="ot">&lt;-</span> <span class="fu">lm</span>(lm_magno<span class="sc">$</span>Prob_80 <span class="sc">~</span> lm_magno<span class="sc">$</span>Proportion)</span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a> lm_MPB<span class="ot">&lt;-</span>output_80_filtered_same <span class="sc">%&gt;%</span></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Microphytobenthos"</span>)</span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>    lm_MPB<span class="ot">&lt;-</span> <span class="fu">lm</span>(lm_MPB<span class="sc">$</span>Prob_80 <span class="sc">~</span> lm_MPB<span class="sc">$</span>Proportion)</span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>lm_Rodo<span class="ot">&lt;-</span>output_80_filtered_same <span class="sc">%&gt;%</span></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Rodophyceae"</span>)</span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>    lm_Rodo<span class="ot">&lt;-</span> <span class="fu">lm</span>(lm_Rodo<span class="sc">$</span>Prob_80 <span class="sc">~</span> lm_Rodo<span class="sc">$</span>Proportion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<p>Using the very high resolution low altitude flight (8 mm pixels), we determined the minimal percent cover required to correctly classify a given class within the corresponding high altitude flight (8cm pixel resolution ; <a href="#fig-upscaling" class="quarto-xref">Figure&nbsp;12</a>).</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [50]:</pre></div><div id="cell-fig-upscaling" class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Figures/Low_res/Upscaling/density_vs_Proportion.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-upscaling" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-upscaling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="Figures/Low_res/Upscaling/density_vs_Proportion.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" title="Figure&nbsp;12: Kernel density plot showing the proportion of pixel well classified based on the percent cover of the class in high altitude flight pixels of Gafanha, Portugal. Each subplot shows all the pixels of the same classes on the high altitude flight. Percent cover of classes was retrieved using the result of the classification of the low altitude flight of Gafanha, Portugal."><img src="Figures/Low_res/Upscaling/density_vs_Proportion.png" class="img-fluid figure-img" style="width:90.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-upscaling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Kernel density plot showing the proportion of pixel well classified based on the percent cover of the class in high altitude flight pixels of Gafanha, Portugal. Each subplot shows all the pixels of the same classes on the high altitude flight. Percent cover of classes was retrieved using the result of the classification of the low altitude flight of Gafanha, Portugal.
</figcaption>
</figure>
</div>
</div>
</div></div>
<p>A percent cover of at least 80% was sufficient to have all the 80 mm pixels correctly classified, with the exception of Magnoliopsida that required a higher cover (&gt;90 %) to be accurately classified. Concerning the probability of each class, there is a linear relationship between the percent cover and the confidence of the model to predict the class. To predict Chlorophyceae with a model likelihood of 0.85, a cover of 93 % was needed, 90 % for Magnoliopsida, 92 % for Rhodophyceae and 97 % for Bacillariophyceae. When the vegetation cover of a given class was 100 %, coarser high-flight pixels were correctly classified for all the classes except for Bare Sediment, which was only correctly classified 80% of the time. This phenomenon may be attributed to the time gap between the two flights, allowing for microphytobenthos migration to the surface during low tide, consequently altering the model’s classification from bare sediment to Bacillariophyceae.</p>
</section>
</section>
<section id="discussion" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Discussion</h1>
<section id="vegetation-discrimination" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="vegetation-discrimination"><span class="header-section-number">4.1</span> Vegetation Discrimination</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [51]:</pre></div><div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>df_pigment<span class="ot">&lt;-</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Classes=</span><span class="fu">c</span>(<span class="st">"Magnoliopsida"</span>,</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Bacillariophyceae"</span>,</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Rhodophyceae"</span>),</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">chlb=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">chlc=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fuco=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">zea=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">diad=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lutein=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Neox=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">PE=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">PC=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">%&gt;%</span></span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Classes) <span class="sc">%&gt;%</span> </span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ext</span>(df_pigment)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">9</span>,<span class="dv">0</span>,<span class="dv">5</span>)</span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>y_axis_text_pigment<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="fl">0.05</span>,<span class="dv">5</span>),</span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>                                <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">1.5</span>,<span class="fl">2.5</span>,<span class="fl">3.5</span>,<span class="fl">4.5</span>), </span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lab =</span> <span class="fu">c</span>(<span class="st">"Rhodophyceae"</span>,</span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Phaeophyceae"</span>,</span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Bacillariophy."</span>,</span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Chlorophyceae"</span>,</span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Magnoliopsida"</span>)</span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>x_axis_text_pigment<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">rep</span>(<span class="fl">5.5</span>,<span class="dv">9</span>),</span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a>                                <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">1.5</span>,<span class="fl">2.5</span>,<span class="fl">3.5</span>,<span class="fl">4.5</span>,<span class="fl">5.5</span>,<span class="fl">6.5</span>,<span class="fl">7.5</span>,<span class="fl">8.5</span>),</span>
<span id="cb111-35"><a href="#cb111-35" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lab =</span> <span class="fu">c</span>(<span class="st">"Chlb"</span>,<span class="st">"Chlc"</span>,<span class="st">"Fuco"</span>,<span class="st">"Zea"</span>,<span class="st">"Diad"</span>,<span class="st">"Lut"</span>,<span class="st">"Neo"</span>,<span class="st">"PE"</span>,<span class="st">"PC"</span>)</span>
<span id="cb111-36"><a href="#cb111-36" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb111-37"><a href="#cb111-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-38"><a href="#cb111-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-39"><a href="#cb111-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-40"><a href="#cb111-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-41"><a href="#cb111-41" aria-hidden="true" tabindex="-1"></a>min_x_line <span class="ot">=</span> <span class="sc">-</span><span class="fl">1.5</span></span>
<span id="cb111-42"><a href="#cb111-42" aria-hidden="true" tabindex="-1"></a>max_y_line <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb111-43"><a href="#cb111-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-44"><a href="#cb111-44" aria-hidden="true" tabindex="-1"></a>line_grid<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">xmin=</span><span class="cn">NA</span>,</span>
<span id="cb111-45"><a href="#cb111-45" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xmax=</span><span class="cn">NA</span>,</span>
<span id="cb111-46"><a href="#cb111-46" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin=</span><span class="cn">NA</span>,</span>
<span id="cb111-47"><a href="#cb111-47" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax=</span><span class="cn">NA</span>,</span>
<span id="cb111-48"><a href="#cb111-48" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group=</span><span class="cn">NA</span>)</span>
<span id="cb111-49"><a href="#cb111-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-50"><a href="#cb111-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>max_y_line){</span>
<span id="cb111-51"><a href="#cb111-51" aria-hidden="true" tabindex="-1"></a>  line_grid[i<span class="sc">+</span><span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">=</span>min_x_line</span>
<span id="cb111-52"><a href="#cb111-52" aria-hidden="true" tabindex="-1"></a>  line_grid[i<span class="sc">+</span><span class="dv">1</span>,<span class="dv">2</span>]<span class="ot">=</span><span class="dv">9</span></span>
<span id="cb111-53"><a href="#cb111-53" aria-hidden="true" tabindex="-1"></a>  line_grid[i<span class="sc">+</span><span class="dv">1</span>,<span class="dv">3</span>]<span class="ot">=</span>i</span>
<span id="cb111-54"><a href="#cb111-54" aria-hidden="true" tabindex="-1"></a>  line_grid[i<span class="sc">+</span><span class="dv">1</span>,<span class="dv">4</span>]<span class="ot">=</span>i</span>
<span id="cb111-55"><a href="#cb111-55" aria-hidden="true" tabindex="-1"></a>  line_grid[i<span class="sc">+</span><span class="dv">1</span>,<span class="dv">5</span>]<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb111-56"><a href="#cb111-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-57"><a href="#cb111-57" aria-hidden="true" tabindex="-1"></a>nrowgrid<span class="ot">=</span><span class="fu">nrow</span>(line_grid)</span>
<span id="cb111-58"><a href="#cb111-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>){</span>
<span id="cb111-59"><a href="#cb111-59" aria-hidden="true" tabindex="-1"></a>  line_grid[i<span class="sc">+</span><span class="dv">1</span><span class="sc">+</span>nrowgrid,<span class="dv">1</span>]<span class="ot">=</span>i</span>
<span id="cb111-60"><a href="#cb111-60" aria-hidden="true" tabindex="-1"></a>  line_grid[i<span class="sc">+</span><span class="dv">1</span><span class="sc">+</span>nrowgrid,<span class="dv">2</span>]<span class="ot">=</span>i</span>
<span id="cb111-61"><a href="#cb111-61" aria-hidden="true" tabindex="-1"></a>  line_grid[i<span class="sc">+</span><span class="dv">1</span><span class="sc">+</span>nrowgrid,<span class="dv">3</span>]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb111-62"><a href="#cb111-62" aria-hidden="true" tabindex="-1"></a>  line_grid[i<span class="sc">+</span><span class="dv">1</span><span class="sc">+</span>nrowgrid,<span class="dv">4</span>]<span class="ot">=</span>max_y_line</span>
<span id="cb111-63"><a href="#cb111-63" aria-hidden="true" tabindex="-1"></a>  line_grid[i<span class="sc">+</span><span class="dv">1</span><span class="sc">+</span>nrowgrid,<span class="dv">5</span>]<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span><span class="sc">+</span>nrowgrid</span>
<span id="cb111-64"><a href="#cb111-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-65"><a href="#cb111-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-66"><a href="#cb111-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-67"><a href="#cb111-67" aria-hidden="true" tabindex="-1"></a> line_grid[<span class="fu">nrow</span>(line_grid)<span class="sc">+</span><span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">=</span> min_x_line</span>
<span id="cb111-68"><a href="#cb111-68" aria-hidden="true" tabindex="-1"></a> line_grid[<span class="fu">nrow</span>(line_grid),<span class="dv">2</span>] <span class="ot">=</span> min_x_line</span>
<span id="cb111-69"><a href="#cb111-69" aria-hidden="true" tabindex="-1"></a> line_grid[<span class="fu">nrow</span>(line_grid),<span class="dv">3</span>] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb111-70"><a href="#cb111-70" aria-hidden="true" tabindex="-1"></a> line_grid[<span class="fu">nrow</span>(line_grid),<span class="dv">4</span>] <span class="ot">=</span> max_y_line</span>
<span id="cb111-71"><a href="#cb111-71" aria-hidden="true" tabindex="-1"></a> line_grid[<span class="fu">nrow</span>(line_grid),<span class="dv">5</span>] <span class="ot">=</span> <span class="fu">nrow</span>(line_grid)</span>
<span id="cb111-72"><a href="#cb111-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-73"><a href="#cb111-73" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb111-74"><a href="#cb111-74" aria-hidden="true" tabindex="-1"></a> line_grid<span class="ot">&lt;-</span> line_grid <span class="sc">%&gt;%</span> </span>
<span id="cb111-75"><a href="#cb111-75" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="dv">9</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">19</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb111-76"><a href="#cb111-76" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>,<span class="sc">-</span><span class="fl">1.5</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">0</span>,<span class="dv">20</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb111-77"><a href="#cb111-77" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">0</span>,<span class="dv">21</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb111-78"><a href="#cb111-78" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">0</span>,<span class="dv">22</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb111-79"><a href="#cb111-79" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">0</span>,<span class="dv">23</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb111-80"><a href="#cb111-80" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">0</span>,<span class="dv">24</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb111-81"><a href="#cb111-81" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">0</span>,<span class="dv">25</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb111-82"><a href="#cb111-82" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">0</span>,<span class="dv">26</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb111-83"><a href="#cb111-83" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">6</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">0</span>,<span class="dv">27</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb111-84"><a href="#cb111-84" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">7</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">0</span>,<span class="dv">28</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb111-85"><a href="#cb111-85" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">8</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">0</span>,<span class="dv">29</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb111-86"><a href="#cb111-86" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">9</span>,<span class="sc">-</span><span class="fl">0.6</span>,<span class="dv">0</span>,<span class="dv">30</span>))</span>
<span id="cb111-87"><a href="#cb111-87" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb111-88"><a href="#cb111-88" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb111-89"><a href="#cb111-89" aria-hidden="true" tabindex="-1"></a> Absorption_wv<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">1.5</span>,<span class="fl">2.5</span>,<span class="fl">3.5</span>,<span class="fl">4.5</span>,<span class="fl">5.5</span>,<span class="fl">6.5</span>,<span class="fl">7.5</span>,<span class="fl">8.5</span>),</span>
<span id="cb111-90"><a href="#cb111-90" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y =</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="fl">0.3</span>,<span class="dv">9</span>),</span>
<span id="cb111-91"><a href="#cb111-91" aria-hidden="true" tabindex="-1"></a>                            <span class="at">lab =</span> <span class="fu">c</span>(<span class="st">"650"</span>,<span class="st">"636"</span>,<span class="st">"550"</span>,<span class="st">"489"</span>,<span class="st">"496"</span>,<span class="st">"490"</span>,<span class="st">"450"</span>,<span class="st">"566"</span>,<span class="st">"615"</span>))</span>
<span id="cb111-92"><a href="#cb111-92" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb111-93"><a href="#cb111-93" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb111-94"><a href="#cb111-94" aria-hidden="true" tabindex="-1"></a>rast_pigment<span class="ot">&lt;-</span><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb111-95"><a href="#cb111-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> (df_pigment),</span>
<span id="cb111-96"><a href="#cb111-96" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># show.legend = F,</span></span>
<span id="cb111-97"><a href="#cb111-97" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb111-98"><a href="#cb111-98" aria-hidden="true" tabindex="-1"></a>                  )<span class="sc">+</span></span>
<span id="cb111-99"><a href="#cb111-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb111-100"><a href="#cb111-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb111-101"><a href="#cb111-101" aria-hidden="true" tabindex="-1"></a>    <span class="co"># colours = c("black","firebrick4","goldenrod","yellow","chartreuse3"),</span></span>
<span id="cb111-102"><a href="#cb111-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># colours = c("khaki1","goldenrod","firebrick3","chartreuse4"),</span></span>
<span id="cb111-103"><a href="#cb111-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"firebrick4"</span>,<span class="st">"orange"</span>,<span class="st">"#007d00"</span>),</span>
<span id="cb111-104"><a href="#cb111-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># colours = c("#7d0000","#00b300","#00b300","#00b300","#007d00"),</span></span>
<span id="cb111-105"><a href="#cb111-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"white"</span>,</span>
<span id="cb111-106"><a href="#cb111-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Absence"</span>,<span class="st">"no se"</span>,<span class="st">"Presence"</span>),</span>
<span id="cb111-107"><a href="#cb111-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb111-108"><a href="#cb111-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb111-109"><a href="#cb111-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> y_axis_text_pigment,</span>
<span id="cb111-110"><a href="#cb111-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> lab),</span>
<span id="cb111-111"><a href="#cb111-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill = "#ffffff99",</span></span>
<span id="cb111-112"><a href="#cb111-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb111-113"><a href="#cb111-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">6</span>,</span>
<span id="cb111-114"><a href="#cb111-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># angle = 20</span></span>
<span id="cb111-115"><a href="#cb111-115" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb111-116"><a href="#cb111-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb111-117"><a href="#cb111-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">lab =</span> <span class="st">"Absorption (nm)"</span>),</span>
<span id="cb111-118"><a href="#cb111-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> lab),</span>
<span id="cb111-119"><a href="#cb111-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill = "#ffffff99",</span></span>
<span id="cb111-120"><a href="#cb111-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb111-121"><a href="#cb111-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb111-122"><a href="#cb111-122" aria-hidden="true" tabindex="-1"></a>    <span class="co"># angle = 20</span></span>
<span id="cb111-123"><a href="#cb111-123" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb111-124"><a href="#cb111-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb111-125"><a href="#cb111-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> Absorption_wv,</span>
<span id="cb111-126"><a href="#cb111-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> lab),</span>
<span id="cb111-127"><a href="#cb111-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill = "#ffffff99",</span></span>
<span id="cb111-128"><a href="#cb111-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb111-129"><a href="#cb111-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">6</span>,</span>
<span id="cb111-130"><a href="#cb111-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># angle = 20</span></span>
<span id="cb111-131"><a href="#cb111-131" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb111-132"><a href="#cb111-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb111-133"><a href="#cb111-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> x_axis_text_pigment,</span>
<span id="cb111-134"><a href="#cb111-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> lab),</span>
<span id="cb111-135"><a href="#cb111-135" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill = "#ffffff99",</span></span>
<span id="cb111-136"><a href="#cb111-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb111-137"><a href="#cb111-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb111-138"><a href="#cb111-138" aria-hidden="true" tabindex="-1"></a>    <span class="co"># angle = 20</span></span>
<span id="cb111-139"><a href="#cb111-139" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb111-140"><a href="#cb111-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> line_grid, </span>
<span id="cb111-141"><a href="#cb111-141" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> xmin, <span class="at">xend =</span> xmax, <span class="at">y =</span> ymin, <span class="at">yend =</span> ymax, <span class="at">group =</span> group),</span>
<span id="cb111-142"><a href="#cb111-142" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb111-143"><a href="#cb111-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">9</span>))<span class="sc">+</span></span>
<span id="cb111-144"><a href="#cb111-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="fl">6.1</span>))<span class="sc">+</span></span>
<span id="cb111-145"><a href="#cb111-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_Bede</span>()<span class="sc">+</span></span>
<span id="cb111-146"><a href="#cb111-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb111-147"><a href="#cb111-147" aria-hidden="true" tabindex="-1"></a>  <span class="co"># axis.title.x = element_text(size = 35),</span></span>
<span id="cb111-148"><a href="#cb111-148" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.title.y = element_text(size = 35),</span></span>
<span id="cb111-149"><a href="#cb111-149" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-150"><a href="#cb111-150" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-151"><a href="#cb111-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-152"><a href="#cb111-152" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.text.x = element_text(size = 30),</span></span>
<span id="cb111-153"><a href="#cb111-153" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-154"><a href="#cb111-154" aria-hidden="true" tabindex="-1"></a>        <span class="co"># axis.text.y = element_text(size = 25),</span></span>
<span id="cb111-155"><a href="#cb111-155" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-156"><a href="#cb111-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-157"><a href="#cb111-157" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-158"><a href="#cb111-158" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-159"><a href="#cb111-159" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-160"><a href="#cb111-160" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line=</span><span class="fu">element_blank</span>(),</span>
<span id="cb111-161"><a href="#cb111-161" aria-hidden="true" tabindex="-1"></a>        <span class="co"># legend.position = "top",</span></span>
<span id="cb111-162"><a href="#cb111-162" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb111-163"><a href="#cb111-163" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction=</span><span class="st">"horizontal"</span>,</span>
<span id="cb111-164"><a href="#cb111-164" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>,<span class="st">"cm"</span>),</span>
<span id="cb111-165"><a href="#cb111-165" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb111-166"><a href="#cb111-166" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">vjust =</span> <span class="dv">2</span>),</span>
<span id="cb111-167"><a href="#cb111-167" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title.align =</span> <span class="fl">0.5</span>,</span>
<span id="cb111-168"><a href="#cb111-168" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="st">"center"</span>)</span>
<span id="cb111-169"><a href="#cb111-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-170"><a href="#cb111-170" aria-hidden="true" tabindex="-1"></a><span class="co"># rast_pigment</span></span>
<span id="cb111-171"><a href="#cb111-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-172"><a href="#cb111-172" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"./Figures/Disc_Pigment_Table.png"</span>,rast_pigment, <span class="at">width=</span> <span class="dv">1066</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">height=</span><span class="dv">516</span><span class="sc">*</span><span class="dv">4</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<p>The primary objective of this study was to develop a method for the accurate classification of emerged macrophytes observed during low tide on tidal flats, specifically focusing on distinguishing between Chlorophyceae (green macroalgae) and marine Magnoliopsida (seagrasses) using a multispectral resolution. The discrimination between seagrasses and green macroalgae is challenging due to their optical similarity in the visible range <span class="citation" data-cites="oiry2021using bannari2022 veettil2020opportunities">(<a href="#ref-bannari2022" role="doc-biblioref">Bannari et al., 2022</a>; <a href="#ref-oiry2021using" role="doc-biblioref">Oiry and Barillé, 2021</a>; <a href="#ref-veettil2020opportunities" role="doc-biblioref">Veettil et al., 2020</a>)</span>. These two macrophytes share a similar pigment composition: chlorophyll-a (common to all vegetation types), chlorophyll-b (an additional photosynthetic pigment), and accessory carotenoids such as zeaxanthin, lutein and neoxanthin (<a href="#fig-Pigm" class="quarto-xref">Figure&nbsp;13</a>). Their spectral responses could be close, particularly at a multispectral resolution. Seagrass and green macroalgae frequently co-occur in intertidal areas, and can intermingle within a remote sensing pixel if the spatial resolution is too low. Here, the issue of intra-pixel mixing was resolved thanks to the very high spatial resolution of the drone (from 8 to 80 mm). In this study the risk of spectral confusion was avoided with a machine-learning approach exploiting a neural networks classifier. Our drone flights and a recent study based on <em>in situ</em> radiometry, suggested that a sensor with at least eight spectral bands ranging from 500 to 850 nm, and including a green band at 530 nm and a RedEdge band at 730 nm, was crucial to accurately discriminate green macroalgae from seagrasses <span class="citation" data-cites="Davies2023">(<a href="#ref-Davies2023" role="doc-biblioref">Davies et al., 2023a</a>)</span>.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [52]:</pre></div><div id="cell-fig-Pigm" class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"./Figures/Low_res/Disc_Pigment_Table.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Pigm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Pigm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="./Figures/Low_res/Disc_Pigment_Table.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" title="Figure&nbsp;13: Photosynthetic and carotenoid pigments present (Green) or absent (Red) in each taxonomic class present in the Neural Network Classifier, along with their absorption wavelength measured with spectroradiometer, Chl-b: chlorophyll-b, Chl-c: chlorophyll-c, Fuco: fucoxanthin, Zea: zeaxanthin, Diad: diadinoxanthin, Lut: lutein, Neo: neoxanthin, PE: phycoerythrin, PC: phycocyanin [@ralph2002 ; @Douay2022 @christensen1977seaweeds ; @cartaxana2016regulation ; @meleder2013vivo]."><img src="./Figures/Low_res/Disc_Pigment_Table.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Pigm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Photosynthetic and carotenoid pigments present (Green) or absent (Red) in each taxonomic class present in the Neural Network Classifier, along with their absorption wavelength measured with spectroradiometer, Chl-b: chlorophyll-b, Chl-c: chlorophyll-c, Fuco: fucoxanthin, Zea: zeaxanthin, Diad: diadinoxanthin, Lut: lutein, Neo: neoxanthin, PE: phycoerythrin, PC: phycocyanin <span class="citation" data-cites="ralph2002 Douay2022 cartaxana2016regulation meleder2013vivo">Christensen et al. (<a href="#ref-christensen1977seaweeds" role="doc-biblioref">1977</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div></div>
<div class="columns">
<div class="column">
<div class="cell-container"><div class="cell-decorator"><pre>In [53]:</pre></div><div id="cell-fig-ValidationGreen" class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"./Figures/Low_res/Validation/ConfusionMatrixGreen.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ValidationGreen" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ValidationGreen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="./Figures/Low_res/Validation/ConfusionMatrixGreen.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16" title="Figure&nbsp;14: Sample of Figure&nbsp;9 focusing on green macrophytes. The labels inside the matrix indicate the number of pixels."><img src="./Figures/Low_res/Validation/ConfusionMatrixGreen.png" class="img-fluid figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ValidationGreen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Sample of <a href="#fig-Validation" class="quarto-xref">Figure&nbsp;9</a> focusing on green macrophytes. The labels inside the matrix indicate the number of pixels.
</figcaption>
</figure>
</div>
</div>
</div></div>
</div><div class="column">
<p>Meeting these two criteria, the Micasense RedEdge-MX DUAL camera used in this study, enabled the classifier to achieve 97% of accuracy between these two classes (<a href="#fig-ValidationGreen" class="quarto-xref">Figure&nbsp;14</a>). Even if their pigment composition is similar, differences in the spectral shape can be observed, with green algae having a higher reflectance peak at 560 nm as well as a higher NIR plateau than seagrass (<a href="#fig-vegetation" class="quarto-xref">Figure&nbsp;2</a>). Such differences were previously attributed to differences in pigments concentration and/or ratios <span class="citation" data-cites="bargain2013seasonal">(<a href="#ref-bargain2013seasonal" role="doc-biblioref">Bargain et al., 2013</a>)</span>, cellular structure as well as in the orientation of the plant at the sediment surface <span class="citation" data-cites="beach1997vivo kirk1994light hedley2018influence">(<a href="#ref-beach1997vivo" role="doc-biblioref">Beach et al., 1997</a>; <a href="#ref-hedley2018influence" role="doc-biblioref">Hedley et al., 2018</a>; <a href="#ref-kirk1994light" role="doc-biblioref">Kirk, 1994</a>)</span>.</p>
</div>
</div>
<p>The variable importance analysis (<a href="#fig-VIP" class="quarto-xref">Figure&nbsp;10</a>) identified that the band at 531 nm was the most important for accurately identifying Chlorophyceae. In fact, at this wavelength, Chlorophyceae exhibited the highest reflectance among all other classes, highlighting the difference in carotenoid to chlorophyll-a ratios between seagrasses and green macroalgae <span class="citation" data-cites="repolho2017seagrass">(<a href="#ref-repolho2017seagrass" role="doc-biblioref">Repolho et al., 2017</a>)</span>. Concerning Phaeophyceae, the thick cell walls of these macroalgae <span class="citation" data-cites="charrier2021growth">(<a href="#ref-charrier2021growth" role="doc-biblioref">Charrier et al., 2021</a>)</span> make it more reflective in the infrared part of the spectra <span class="citation" data-cites="Slaton2001">(<a href="#ref-Slaton2001" role="doc-biblioref">Slaton et al., 2001</a>)</span>, while the presence of fucoxanthin and zeaxanthin result in a low reflectance in the visible region (<a href="#fig-VIP" class="quarto-xref">Figure&nbsp;10</a> ; <a href="#fig-Pigm" class="quarto-xref">Figure&nbsp;13</a>). These two key features have been identified by the Neural Network as the two principal predictors to accurately identify brown algae (<a href="#fig-VIP" class="quarto-xref">Figure&nbsp;10</a>). Similarly, the presence of phycoerythrin and phycocyanin in Rhodophyceae contribute to the lowest reflectance among all classes in the spectral range from 560 to 615 nm (<a href="#fig-VIP" class="quarto-xref">Figure&nbsp;10</a>). Indeed the band at 560 nm has been identified as important for identifying this class, likely due to phycoerythrin absorption at this wavelength. Regarding Bacillariophyceae, 475 nm was the most important predictor for this class (<a href="#fig-VIP" class="quarto-xref">Figure&nbsp;10</a>). Indeed, the reflectance at 475 nm was higher for Bacillariophyceae than for any other vegetation class (<a href="#fig-vegetation" class="quarto-xref">Figure&nbsp;2</a>), very likely due to the low biomass (and associated concentration of blue-absorbing pigments) of these unicellular organisms compared to seagrass and macroalgae.</p>
</section>
<section id="altitude-and-temporal-effects-on-vegetation-prediction-accuracy" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="altitude-and-temporal-effects-on-vegetation-prediction-accuracy"><span class="header-section-number">4.2</span> Altitude and Temporal Effects on Vegetation Prediction Accuracy</h2>
<p>The ability to differentiate between various types of vegetation plays a critical role in ecological monitoring and coastal management <span class="citation" data-cites="WFD2000">(<a href="#ref-WFD2000" role="doc-biblioref">European-Commission, 2000</a>)</span>. By distinguishing between seagrasses and macroalgae, our approach facilitates targeted conservation strategies, enabling more effective preservation and restoration efforts in coastal ecosystems. While comparing the reflectance at two different altitudes (12 m and 120 m with a spatial resolution of 8 and 80 mm, respectively), a nearly one-to-one relationship was observed, with a Root Mean Square Error (RMSE) of 0.02 (<a href="#fig-CompareRef" class="quarto-xref">Figure&nbsp;4</a>). This result indicates that the reflectance measured by remote sensing (RS) sensors is not significantly influenced by pixel size. This finding is valuable for integrating drone-based data into larger-scale mapping projects (e.g., combining satellite and drone mapping in side-by-side analyses). The consistency of reflectance across altitudes suggests that drones can be effectively used for finer-scale mapping without compromising data accuracy when merging with other platforms. However, it was observed that there is an underestimation of the infrared part of the spectra in the high-altitude dataset (<a href="#fig-CompareRef" class="quarto-xref">Figure&nbsp;4</a>). Such disparity in infrared reflectance may stem from temporal differences between the flights, possibly resulting in a slightly drier intertidal area and consequently higher infrared reflectance. This disparity poses an issue for the methodology followed in the present study, relying solely on one flight height for training. To address this issue, we employed min/max standardized reflectance spectra as predictors for the model <a href="#eq-std" class="quarto-xref">Equation&nbsp;1</a>. This approach allowed us to eliminate the slight reflectance difference between the flights (<a href="#fig-CompareRef" class="quarto-xref">Figure&nbsp;4</a> B) and to focus on the shape of the spectra in the visible part of the electromagnetic spectra, where different pigmentation are associated to taxonomic diagnostic features. In contrast to subtidal seagrasses, which maintain a relatively constant biomass throughout the year, intertidal seagrasses, like the one studied in this work, exhibit strong seasonal phenology <span class="citation" data-cites="davies2024sentinel">(<a href="#ref-davies2024sentinel" role="doc-biblioref">Davies et al., 2024b</a>)</span>. At some sites, they completely disappear during the winter and reach their peak above-ground biomass in the summer and early autumn. Along with these seasonal changes in biomass, the pigment composition and ratios also vary throughout the year, reflecting the plants’ adaptations to different environmental conditions <span class="citation" data-cites="bargain2013seasonal legare2022remote">(<a href="#ref-bargain2013seasonal" role="doc-biblioref">Bargain et al., 2013</a>; <a href="#ref-legare2022remote" role="doc-biblioref">Légaré et al., 2022</a>)</span>. Standardization of spectral signatures helps to mitigate the impact of changing biomass on the spectral profile, enabling the development of a model that can reliably predict vegetation across different geographical locations and seasons. This approach allows for consistent classification of vegetation despite variations in biomass and fluctuations in light conditions, providing a robust tool for monitoring and predicting vegetation dynamics <span class="citation" data-cites="fyfe2003spatial COSTA2021107018 piaser2023impact">(<a href="#ref-COSTA2021107018" role="doc-biblioref">Costa et al., 2021</a>; <a href="#ref-fyfe2003spatial" role="doc-biblioref">Fyfe, 2003</a>; <a href="#ref-piaser2023impact" role="doc-biblioref">Piaser et al., 2023</a>)</span>. We found 90 % seagrass cover was necessary at an 8 cm resolution for confident prediction of its presence (<a href="#fig-upscaling" class="quarto-xref">Figure&nbsp;12</a>). However, due to the strong phenology of intertidal seagrass meadows in Europe, the period when a meadow is well-established can be temporally restricted, limiting the ideal window for accurate detection.</p>
</section>
<section id="impact-of-pixel-resolution-on-the-prediction-and-implications-for-satellite-remote-sensing" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="impact-of-pixel-resolution-on-the-prediction-and-implications-for-satellite-remote-sensing"><span class="header-section-number">4.3</span> Impact of Pixel Resolution on the prediction and Implications for Satellite Remote Sensing</h2>
<p>Pixel resolution plays a critical role in accuratly retrieving vegetation area from remote sensing data. As pixel size increases, we found a consistent decline in area retrieval is observed across all vegetation types, with more pronounced effects for certain types, such as green algae (<a href="#fig-pixelsize" class="quarto-xref">Figure&nbsp;11</a>). This highlights the sensitivity of spatial resolution in detecting smaller or more fragmented vegetation features. Green algae, being particularly patchy across all study sites, shows the steepest decline in areal agreement as pixel size increases, which aligns with expectations given the limitations of coarser resolution in capturing fine-scale details.</p>
<p>This resolution-area relationship has important implications for satellite missions like Sentinel-2 and Landsat, which are commonly used in marine and coastal vegetation studies. Both satellites offer high-resolution imagery, with pixel sizes of 10m and 30m, respectively. While these resolutions are suitable for broad-scale environmental monitoring, they may be too coarse to capture finer-scale heterogeneity, particularly in fragmented vegetation like green algae. Our findings suggest that, while the 30m resolution of Landsat may be adequate for homogeneous vegetation types, such as seagrass, a higher resolution is essential for accurately mapping patchy vegetation like green algae. These findings have direct implications for environmental management and conservation planning. Overlooking fine-scale vegetation features, such as those seen in green algae, could result in inadequate protection or restoration efforts, particularly in ecologically sensitive coastal zones, as early stages of green tides could be challenging to monitor at coarse resolutions.</p>
<p>Very high-resolution imagery offers more accurate vegetation mapping but comes with trade-offs. As resolution increases, data costs rise, and processing becomes more resource-intensive due to the larger file sizes and computational demands. Consequently, high-resolution data requires more storage and can slow down real-time applications. For large-scale monitoring of homogeneous vegetation types, 10 m resolution of S2/MSI or even the 30 m of Landsat/OLI are often sufficient. However, when mapping fragmented vegetation like green algae, the precision provided by higher-resolution imagery is crucial, despite the additional costs and processing challenges it imposes.</p>
</section>
<section id="towards-climate-and-biodiversity-applications" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="towards-climate-and-biodiversity-applications"><span class="header-section-number">4.4</span> Towards climate and biodiversity applications</h2>
<p>Climate change, global warming, eutrophication, alien and invasive species development, coastal erosion, and sea level rise are expected to continue impacting coastal ecosystems in the future <span class="citation" data-cites="SCHIBALSKI2022101414 holon2018predictive marquet2024global">(<a href="#ref-holon2018predictive" role="doc-biblioref">Holon et al., 2018</a>; <a href="#ref-marquet2024global" role="doc-biblioref">Marquet et al., 2024</a>; <a href="#ref-SCHIBALSKI2022101414" role="doc-biblioref">Schibalski et al., 2022</a>)</span> and the demand for meaningful and efficient monitoring of coastal habitats has never been higher<span class="citation" data-cites="muller2018satellite villalobos2023remote oiry2021using">(<a href="#ref-muller2018satellite" role="doc-biblioref">Muller-Karger et al., 2018</a>; <a href="#ref-oiry2021using" role="doc-biblioref">Oiry and Barillé, 2021</a>; <a href="#ref-villalobos2023remote" role="doc-biblioref">Villalobos Perna et al., 2023</a>)</span>. Our findings, particularly the improved discrimination of intertidal seagrass and green macroalgae from other intertidal vegetation classes, highlight the potential of drone-based remote sensing to support diverse applications, from conservation of biodiversity to climate change adaptation strategies.</p>
<p>Due to increasing coastal eutrophication, macroalgal blooms are becoming increasingly common in many regions around the world <span class="citation" data-cites="sutton2011european ye2011green">(<a href="#ref-sutton2011european" role="doc-biblioref">Sutton et al., 2011</a>; <a href="#ref-ye2011green" role="doc-biblioref">Ye et al., 2011</a>)</span>. These blooms can have negative impacts on human health and local economic activities, including human health, fishing and aquaculture, tourism, and recreational activities <span class="citation" data-cites="villares1999nitrogen ye2011green">(<a href="#ref-villares1999nitrogen" role="doc-biblioref">Villares et al., 1999</a>; <a href="#ref-ye2011green" role="doc-biblioref">Ye et al., 2011</a>)</span>. The first green tide events (i.e.&nbsp;bloom of green macroalgae of the genus <em>Ulva</em>) were reported in Brittany, France, in the 1970s and have since been a concern for local stakeholders and economic activities <span class="citation" data-cites="menesguen2018marees">(<a href="#ref-menesguen2018marees" role="doc-biblioref">Ménesguen, 2018</a>)</span>. Some regions of the world have witnessed an increase in brown macroalgae blooms, predominantly involving algae of the genus <em>Sargassum</em> washing along the Caribbean coastlines <span class="citation" data-cites="louime2017sargassum">(<a href="#ref-louime2017sargassum" role="doc-biblioref">Louime et al., 2017</a>)</span>, and more recently <em>Rugulopteryx okamurea</em> in southern Europe <span class="citation" data-cites="Roca2022">(<a href="#ref-Roca2022" role="doc-biblioref">Roca et al., 2022</a>)</span>. Satellite remote sensing has proven to be a valuable tool for mapping the spatial and temporal extent of macroalgal blooms worldwide. However, due to limitations in spatial resolution, it can only effectively map well-developed blooms <span class="citation" data-cites="rs13081408 klemas2012remote haro2023biointertidal">(<a href="#ref-haro2023biointertidal" role="doc-biblioref">Haro et al., 2023</a>; <a href="#ref-klemas2012remote" role="doc-biblioref">Klemas, 2012</a>; <a href="#ref-rs13081408" role="doc-biblioref">Schreyers et al., 2021</a>)</span>. High spatial resolution drone imagery, coupled with accurate classification algorithm, could be used to map the early stages of macroalgal blooms in areas known to have regular blooms or in new sites. Indeed, this approach could provide early warning alerts to local managers and complimentary to traditional sampling methods to monitor coastal ecosystems. These methods are generally time and resource-intensive, and the findings are often difficult to scale-up when applied alone. Earth Observation can bridge this gap and meet the needs for systematic monitoring of coastal ecosystems over large areas <span class="citation" data-cites="papathanasopoulou2019satellite">(<a href="#ref-papathanasopoulou2019satellite" role="doc-biblioref">Papathanasopoulou et al., 2019</a>)</span>. The retrieval of Essential Biodiversity Variables and Essential Ocean Variables through satellite observations has been increasingly common, enabling comprehensive monitoring of entire ecosystems over extended time periods <span class="citation" data-cites="ratnarajah2023monitoring Zoffoli2021">(<a href="#ref-ratnarajah2023monitoring" role="doc-biblioref">Ratnarajah et al., 2023</a>; <a href="#ref-Zoffoli2021" role="doc-biblioref">Zoffoli et al., 2021</a>)</span>. The Water Framework Directive <span class="citation" data-cites="WFD2000">(<a href="#ref-WFD2000" role="doc-biblioref">European-Commission, 2000</a>)</span> mandates the achievement and maintenance of “good ecological status” for all European waters, which necessitates a comprehensive understanding and monitoring of aquatic ecosystems, including coastal habitats like seagrass beds <span class="citation" data-cites="foden2007angiosperms nordlund2024one Zoffoli2021">(<a href="#ref-foden2007angiosperms" role="doc-biblioref">Foden and Brazier, 2007</a>; <a href="#ref-nordlund2024one" role="doc-biblioref">Nordlund et al., 2024</a>; <a href="#ref-Zoffoli2021" role="doc-biblioref">Zoffoli et al., 2021</a>)</span>.</p>
<p>Effective and efficient monitoring tools are essential for identifying the impacts of human activities and natural changes on coastal ecosystems. On-demand, multispectral drone observations at very high spatial-resolution provide a novel and powerful tool to rapidly and accurately acquire ground truth data which can be used to develop machine-learning algorithm for satellite sensors <span class="citation" data-cites="davies2024intertidal">(<a href="#ref-davies2024intertidal" role="doc-biblioref">Davies et al., 2024a</a>)</span>. Spatially resolved data are indeed critical for calibrating and validating satellite remote sensing observations, thereby enhancing our capacity to monitor vast coastal areas. The integration of drone technology facilitates a scalable approach to environmental surveillance while taking into account patchiness of secondary vegetation, offering significant advancements in the spatial and temporal resolution of data collection. This, in turn, supports the EU WFD’s objectives by enabling more informed and timely management decisions for the conservation and restoration of aquatic ecosystems.</p>
</section>
</section>
<section id="conclusion" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Conclusion</h1>
<p>The utilization of very high spatial resolution (from 8 to 80 mm) drone-based remote sensing coupled with machine learning techniques has proven to be an effective method for the discrimination of intertidal seagrasses from green macroalgae with a multispectral resolution sensor. Standardized reflectance was incorporated in the Neural Network model allowing for a better discrimination of spectral features related to pigment absorption in the visible region of the spectrum. There was a striking difference between the variable of importance to discriminate Magnoliopsida from Chlorophyceae. The latter was essentially identified with the 451 nm spectral band while more spectral bands were needed to identify the former, notably 650, 560, 668, and 705 nm. As the spectral bands of the Micasense RedEdge Dual MX are very similar to those of Sentinel-2/MSI, we suggest that multispectral satellite data have the potential to perform this discrimination between these green macrophytes. The findings underscore the importance of adopting advanced remote sensing tools in ecological studies and environmental monitoring, providing a foundation for future research and policy implementation aimed at ecosystem conservation and restoration.</p>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-adade2021" class="csl-entry" role="listitem">
Adade, R., Aibinu, A.M., Ekumah, B., Asaana, J., 2021. Unmanned aerial vehicle (UAV) applications in coastal zone management—a review. Environmental Monitoring and Assessment 193, 1–12.
</div>
<div id="ref-agisoft" class="csl-entry" role="listitem">
Agisoft, 2019. <a href="https://www.agisoft.com/">Agisoft metashape</a>.
</div>
<div id="ref-angnuureng2022" class="csl-entry" role="listitem">
Angnuureng, D.B., Brempong, K., Jayson-Quashigah, P., Dada, O., Akuoko, S., Frimpomaa, J., Mattah, P., Almar, R., 2022. Satellite, drone and video camera multi-platform monitoring of coastal erosion at an engineered pocket beach: A showcase for coastal management at elmina bay, ghana (west africa). Regional Studies in Marine Science 53, 102437.
</div>
<div id="ref-bannari2022" class="csl-entry" role="listitem">
Bannari, A., Ali, T.S., Abahussain, A., 2022. The capabilities of sentinel-MSI (2A/2B) and landsat-OLI (8/9) in seagrass and algae species differentiation using spectral reflectance. Ocean Science 18, 361–388.
</div>
<div id="ref-bargain2013seasonal" class="csl-entry" role="listitem">
Bargain, A., Robin, M., Méléder, V., Rosa, P., Le Menn, E., Harin, N., Barillé, L., 2013. Seasonal spectral variation of zostera noltii and its influence on pigment-based vegetation indices. Journal of experimental marine biology and ecology 446, 86–94.
</div>
<div id="ref-beach1997vivo" class="csl-entry" role="listitem">
Beach, K., Borgeas, H., Nishimura, N., Smith, C., 1997. In vivo absorbance spectra and the ecophysiology of reef macroalgae. Coral Reefs 16, 21–28.
</div>
<div id="ref-Brunier2022Topographic" class="csl-entry" role="listitem">
Brunier, G., Oiry, S., Gruet, Y., Dubois, S.F., Barillé, L., 2022. Topographic analysis of intertidal polychaete reefs (sabellaria alveolata) at a very high spatial resolution. Remote Sensing 2022, Vol. 14, Page 307 14, 307. <a href="https://doi.org/10.3390/RS14020307">https://doi.org/10.3390/RS14020307</a>
</div>
<div id="ref-Cao2017" class="csl-entry" role="listitem">
Cao, J., Thorson, J.T., Richards, R.A., Chen, Y., 2017. Spatiotemporal index standardization improves the stock assessment of northern shrimp in the gulf of maine. Canadian Journal of Fisheries and Aquatic Sciences 74, 1781–1793. <a href="https://doi.org/10.1139/cjfas-2016-0137">https://doi.org/10.1139/cjfas-2016-0137</a>
</div>
<div id="ref-cartaxana2016regulation" class="csl-entry" role="listitem">
Cartaxana, P., Cruz, S., Gameiro, C., Kühl, M., 2016. Regulation of intertidal microphytobenthos photosynthesis over a diel emersion period is strongly affected by diatom migration patterns. Frontiers in microbiology 7, 872.
</div>
<div id="ref-casella2020" class="csl-entry" role="listitem">
Casella, E., Drechsel, J., Winter, C., Benninghoff, M., Rovere, A., 2020. Accuracy of sand beach topography surveying by drones and photogrammetry. Geo-Marine Letters 40, 255–268.
</div>
<div id="ref-charrier2021growth" class="csl-entry" role="listitem">
Charrier, B., Boscq, S., Nelson, B.J., Läubli, N.F., 2021. Growth and labelling of cell wall components of the brown alga ectocarpus in microfluidic chips. Frontiers in Marine Science 8, 745654.
</div>
<div id="ref-chefaoui2018dramatic" class="csl-entry" role="listitem">
Chefaoui, R.M., Duarte, C.M., Serrão, E.A., 2018. Dramatic loss of seagrass habitat under projected climate change in the mediterranean sea. Global change biology 24, 4919–4928.
</div>
<div id="ref-christensen1977seaweeds" class="csl-entry" role="listitem">
Christensen, T., Dixon, P.S., Irvine, L.M., 1977. Seaweeds of the british isles: Tribophyceae (xanthophyceae). British Museum (Natural History).
</div>
<div id="ref-coffer2023" class="csl-entry" role="listitem">
Coffer, M.M., Graybill, D.D., Whitman, P.J., Schaeffer, B.A., Salls, W.B., Zimmerman, R.C., Hill, V., Lebrasse, M.C., Li, J., Keith, D.J., others, 2023. Providing a framework for seagrass mapping in united states coastal ecosystems using high spatial resolution satellite imagery. Journal of Environmental Management 337, 117669.
</div>
<div id="ref-collin2019improving" class="csl-entry" role="listitem">
Collin, A., Dubois, S., James, D., Houet, T., 2019. Improving intertidal reef mapping using UAV surface, red edge, and near-infrared data. Drones 3, 67.
</div>
<div id="ref-COSTA2021107018" class="csl-entry" role="listitem">
Costa, V., Serôdio, J., Lillebø, A.I., Sousa, A.I., 2021. Use of hyperspectral reflectance to non-destructively estimate seagrass zostera noltei biomass. Ecological Indicators 121, 107018. https://doi.org/<a href="https://doi.org/10.1016/j.ecolind.2020.107018">https://doi.org/10.1016/j.ecolind.2020.107018</a>
</div>
<div id="ref-Davies2023" class="csl-entry" role="listitem">
Davies, B.F.R., Gernez, P., Geraud, A., Oiry, Simon, Rosa, P., Zoffoli, M.L., Barillé, L., 2023a. Multi- and hyperspectral classification of soft-bottom intertidal vegetation using a spectral library for coastal biodiversity remote sensing. Remote Sensing of Environment 290, 113554. <a href="https://doi.org/10.1016/j.rse.2023.113554">https://doi.org/10.1016/j.rse.2023.113554</a>
</div>
<div id="ref-davies2024sentinel" class="csl-entry" role="listitem">
Davies, B.F.R., Oiry, S., Rosa, P., Zoffoli, M.L., Sousa, A.I., Thomas, O.R., Smale, D.A., Austen, M.C., Biermann, L., Attrill, M.J., others, 2024b. A sentinel watching over inter-tidal seagrass phenology across western europe and north africa. Communications Earth &amp; Environment 5, 382.
</div>
<div id="ref-davies2024intertidal" class="csl-entry" role="listitem">
Davies, B.F.R., Oiry, S., Rosa, P., Zoffoli, M.L., Sousa, A.I., Thomas, O.R., Smale, D.A., Austen, M.C., Biermann, L., Attrill, M.J., others, 2024a. Intertidal seagrass extent from sentinel-2 time-series show distinct trajectories in western europe. Remote Sensing of Environment 312, 114340.
</div>
<div id="ref-BedeGbif" class="csl-entry" role="listitem">
Davies, B.F.R., Sousa, A.I., Figueira, R., Oiry, S., Gernez, P., Barillé, L., 2023b. Benthic intertidal vegetation from the tagus estuary and aveiro lagoon. <a href="https://doi.org/10.15468/n4ak6x">https://doi.org/10.15468/n4ak6x</a>
</div>
<div id="ref-devlin2023nutrients" class="csl-entry" role="listitem">
Devlin, M., Brodie, J., 2023. Nutrients and eutrophication, in: Marine Pollution–Monitoring, Management and Mitigation. Springer, pp. 75–100.
</div>
<div id="ref-Douay2022" class="csl-entry" role="listitem">
Douay, F., Verpoorter, C., Duong, G., Spilmont, N., Gevaert, F., 2022. New hyperspectral procedure to discriminate intertidal macroalgae. Remote Sensing 14. <a href="https://doi.org/10.3390/rs14020346">https://doi.org/10.3390/rs14020346</a>
</div>
<div id="ref-duffy2019" class="csl-entry" role="listitem">
Duffy, J.E., Benedetti-Cecchi, L., Trinanes, J., Muller-Karger, F.E., Ambo-Rappe, R., Boström, C., Buschmann, A.H., Byrnes, J., Coles, R.G., Creed, J., others, 2019. Toward a coordinated global observing system for seagrasses and marine macroalgae. Frontiers in Marine Science 6, 317.
</div>
<div id="ref-WFD2000" class="csl-entry" role="listitem">
European-Commission, 2000. <span class="nocase"><span>“DIRECTIVE 2000/60/EC OF THE EUROPEAN PARLIAMENT AND OF THE COUNCIL of 23 October 2000 establishing a framework for Community action in the field of water policy”</span> or, in short, the EU Water Framework Directive</span>. Official Journal of the European Communities L 327, 1–72.
</div>
<div id="ref-fairley2022drone" class="csl-entry" role="listitem">
Fairley, I., Williamson, B.J., McIlvenny, J., King, N., Masters, I., Lewis, M., Neill, S., Glasby, D., Coles, D., Powell, B., others, 2022. Drone-based large-scale particle image velocimetry applied to tidal stream energy resource assessment. Renewable Energy 196, 839–855.
</div>
<div id="ref-foden2007angiosperms" class="csl-entry" role="listitem">
Foden, J., Brazier, D., 2007. Angiosperms (seagrass) within the EU water framework directive: A UK perspective. Marine Pollution Bulletin 55, 181–195.
</div>
<div id="ref-fyfe2003spatial" class="csl-entry" role="listitem">
Fyfe, S., 2003. Spatial and temporal variation in spectral reflectance: Are seagrass species spectrally distinct? Limnology and Oceanography 48, 464–479.
</div>
<div id="ref-gardner2018" class="csl-entry" role="listitem">
Gardner, R.C., Finlayson, C., 2018. Global wetland outlook: State of the world’s wetlands and their services to people. Stetson Law.
</div>
<div id="ref-haro2023biointertidal" class="csl-entry" role="listitem">
Haro, S., Jimenez-Reina, J., Bermejo, R., Morrison, L., 2023. BioIntertidal mapper software: A satellite approach for NDVI-based intertidal habitat mapping. SoftwareX 24, 101520.
</div>
<div id="ref-hedley2018influence" class="csl-entry" role="listitem">
Hedley, J.D., Mirhakak, M., Wentworth, A., Dierssen, H.M., 2018. Influence of three-dimensional coral structures on hyperspectral benthic reflectance and water-leaving reflectance. Applied Sciences 8, 2688.
</div>
<div id="ref-holon2018predictive" class="csl-entry" role="listitem">
Holon, F., Marre, G., Parravicini, V., Mouquet, N., Bockel, T., Descamp, P., Tribot, A.-S., Boissery, P., Deter, J., 2018. A predictive model based on multiple coastal anthropogenic pressures explains the degradation status of a marine ecosystem: Implications for management and conservation. Biological Conservation 222, 125–135.
</div>
<div id="ref-howard2018fastai" class="csl-entry" role="listitem">
Howard, J., others, 2018. Fastai.
</div>
<div id="ref-jankowska2019" class="csl-entry" role="listitem">
Jankowska, E., Michel, L.N., Lepoint, G., Włodarska-Kowalczuk, M., 2019. Stabilizing effects of seagrass meadows on coastal water benthic food webs. Journal of Experimental Marine Biology and Ecology 510, 54–63.
</div>
<div id="ref-joyce2023" class="csl-entry" role="listitem">
Joyce, K.E., Fickas, K.C., Kalamandeen, M., 2023. The unique value proposition for using drones to map coastal ecosystems. Cambridge Prisms: Coastal Futures 1, e6.
</div>
<div id="ref-kirk1994light" class="csl-entry" role="listitem">
Kirk, J.T., 1994. Light and photosynthesis in aquatic ecosystems. Cambridge university press.
</div>
<div id="ref-klemas2012remote" class="csl-entry" role="listitem">
Klemas, V., 2012. Remote sensing of algal blooms: An overview with case studies. Journal of coastal research 28, 34–43.
</div>
<div id="ref-legare2022remote" class="csl-entry" role="listitem">
Légaré, B., Bélanger, S., Singh, R.K., Bernatchez, P., Cusson, M., 2022. Remote sensing of coastal vegetation phenology in a cold temperate intertidal system: Implications for classification of coastal habitats. Remote Sensing 14, 3000.
</div>
<div id="ref-lin2018" class="csl-entry" role="listitem">
Lin, H., Sun, T., Zhou, Y., Gu, R., Zhang, X., Yang, W., 2018. Which genes in a typical intertidal seagrass (zostera japonica) indicate copper-, lead-, and cadmium pollution? Frontiers in Plant Science 9, 1545.
</div>
<div id="ref-deSantos2019" class="csl-entry" role="listitem">
Los Santos, C.B. de, Krause-Jensen, D., Alcoverro, T., Marbà, N., Duarte, C.M., Van Katwijk, M.M., Pérez, M., Romero, J., Sánchez-Lizaso, J.L., Roca, G., others, 2019. Recent trend reversal for declining european seagrass meadows. Nature communications 10, 3356.
</div>
<div id="ref-louime2017sargassum" class="csl-entry" role="listitem">
Louime, C., Fortune, J., Gervais, G., 2017. Sargassum invasion of coastal environments: A growing concern. American Journal of Environmental Sciences 13, 58–64.
</div>
<div id="ref-marquet2024global" class="csl-entry" role="listitem">
Marquet, P.A., Buschmann, A.H., Corcoran, D., Dı́az, P.A., Fuentes-Castillo, T., Garreaud, R., Pliscoff, P., Salazar, A., 2024. Global change and acceleration of anthropic pressures on patagonian ecosystems, in: Conservation in Chilean Patagonia: Assessing the State of Knowledge, Opportunities, and Challenges. Springer International Publishing Cham, pp. 33–65.
</div>
<div id="ref-meleder2013vivo" class="csl-entry" role="listitem">
Méléder, V., Laviale, M., Jesus, B., Mouget, J.L., Lavaud, J., Kazemipour, F., Launeau, P., Barillé, L., 2013. In vivo estimation of pigment composition and optical absorption cross-section by spectroradiometry in four aquatic photosynthetic micro-organisms. Journal of Photochemistry and Photobiology B: Biology 129, 115–124.
</div>
<div id="ref-menesguen2018marees" class="csl-entry" role="listitem">
Ménesguen, A., 2018. Les mar<span>é</span>es vertes: 40 cl<span>é</span>s pour comprendre. Editions Quae.
</div>
<div id="ref-Miloslavich2018" class="csl-entry" role="listitem">
Miloslavich, P., Bax, N.J., Simmons, S.E., Klein, E., Appeltans, W., Aburto-Oropeza, O., Garcia, M.A., Batten, S.D., Benedetti-Cecchi, L., Checkley, D.M., Chiba, S., Duffy, J.E., Dunn, D.C., Fischer, A., Gunn, J., Kudela, R., Marsac, F., Muller-Karger, F.E., Obura, D., Shin, Y.J., 2018. Essential ocean variables for global sustained observations of biodiversity and ecosystem changes. Global Change Biology 24, 2416–2433. <a href="https://doi.org/10.1111/GCB.14108">https://doi.org/10.1111/GCB.14108</a>
</div>
<div id="ref-muller2018satellite" class="csl-entry" role="listitem">
Muller-Karger, F.E., Hestir, E., Ade, C., Turpie, K., Roberts, D.A., Siegel, D., Miller, R.J., Humm, D., Izenberg, N., Keller, M., others, 2018. Satellite sensor requirements for monitoring essential biodiversity variables of coastal ecosystems. Ecological applications 28, 749–760.
</div>
<div id="ref-nebel2020review" class="csl-entry" role="listitem">
Nebel, S., Beege, M., Schneider, S., Rey, G.D., 2020. A review of photogrammetry and photorealistic 3D models in education from a psychological perspective, in: Frontiers in Education. Frontiers Media SA, p. 144.
</div>
<div id="ref-nguyen2021" class="csl-entry" role="listitem">
Nguyen, H.M., Ralph, P.J., Marı́n-Guirao, L., Pernice, M., Procaccini, G., 2021. Seagrasses in an era of ocean warming: A review. Biological Reviews 96, 2009–2030.
</div>
<div id="ref-nijland2019" class="csl-entry" role="listitem">
Nijland, W., Reshitnyk, L., Rubidge, E., 2019. Satellite remote sensing of canopy-forming kelp on a complex coastline: A novel procedure using the landsat image archive. Remote Sensing of Environment 220, 41–50.
</div>
<div id="ref-nordlund2024one" class="csl-entry" role="listitem">
Nordlund, L.M., Unsworth, R.K., Wallner-Hahn, S., Ratnarajah, L., Beca-Carretero, P., Boikova, E., Bull, J.C., Chefaoui, R.M., Santos, C.B. de los, Gagnon, K., others, 2024. One hundred priority questions for advancing seagrass conservation in europe. Plants, People, Planet.
</div>
<div id="ref-oh2017use" class="csl-entry" role="listitem">
Oh, J., Kim, D., Lee, H., 2017. Use of a drone for mapping and time series image acquisition of tidal zones. Journal of the Korean Institute of Intelligent Systems 27, 119–125.
</div>
<div id="ref-oiry2021using" class="csl-entry" role="listitem">
Oiry, S., Barillé, L., 2021. Using sentinel-2 satellite imagery to develop microphytobenthos-based water quality indices in estuaries. Ecological Indicators 121, 107184.
</div>
<div id="ref-orth2006" class="csl-entry" role="listitem">
Orth, R.J., Carruthers, T.J., Dennison, W.C., Duarte, C.M., Fourqurean, J.W., Heck, K.L., Hughes, A.R., Kendrick, G.A., Kenworthy, W.J., Olyarnik, S., others, 2006. A global crisis for seagrass ecosystems. Bioscience 56, 987–996.
</div>
<div id="ref-papathanasopoulou2019satellite" class="csl-entry" role="listitem">
Papathanasopoulou, E., Simis, S., Alikas, K., Ansper, A., Anttila, J., Barillé, A., Barillé, L., Brando, V., Bresciani, M., Bučas, M., others, 2019. Satellite-assisted monitoring of water quality to support the implementation of the water framework directive. EOMORES white paper.
</div>
<div id="ref-Pereira2013" class="csl-entry" role="listitem">
Pereira, H.M., Ferrier, S., Walters, M., Geller, G.N., Jongman, R.H., Scholes, R.J., Bruford, M.W., Brummitt, N., Butchart, S.H., Cardoso, A., others, 2013. Essential biodiversity variables. Science 339, 277–278.
</div>
<div id="ref-piaser2023impact" class="csl-entry" role="listitem">
Piaser, E., Berton, A., Bolpagni, R., Caccia, M., Castellani, M.B., Coppi, A., Dalla Vecchia, A., Gallivanone, F., Sona, G., Villa, P., 2023. Impact of radiometric variability on ultra-high resolution hyperspectral imagery over aquatic vegetation: Preliminary results. IEEE Journal of Selected Topics in Applied Earth Observations and Remote Sensing.
</div>
<div id="ref-ralph2002" class="csl-entry" role="listitem">
Ralph, P., Polk, S., Moore, K., Orth, R., Smith Jr, W., 2002. Operation of the xanthophyll cycle in the seagrass zostera marina in response to variable irradiance. Journal of Experimental Marine Biology and Ecology 271, 189–207.
</div>
<div id="ref-rasheed2011long" class="csl-entry" role="listitem">
Rasheed, M.A., Unsworth, R.K., 2011. Long-term climate-associated dynamics of a tropical seagrass meadow: Implications for the future. Marine Ecology Progress Series 422, 93–103.
</div>
<div id="ref-ratnarajah2023monitoring" class="csl-entry" role="listitem">
Ratnarajah, L., Abu-Alhaija, R., Atkinson, A., Batten, S., Bax, N.J., Bernard, K.S., Canonico, G., Cornils, A., Everett, J.D., Grigoratou, M., others, 2023. Monitoring and modelling marine zooplankton in a changing climate. Nature Communications 14, 564.
</div>
<div id="ref-repolho2017seagrass" class="csl-entry" role="listitem">
Repolho, T., Duarte, B., Dionı́sio, G., Paula, J.R., Lopes, A.R., Rosa, I.C., Grilo, T.F., Caçador, I., Calado, R., Rosa, R., 2017. Seagrass ecophysiological performance under ocean warming and acidification. Scientific Reports 7, 41443.
</div>
<div id="ref-Roca2022" class="csl-entry" role="listitem">
Roca, M., Dunbar, M.B., Román, A., Caballero, I., Zoffoli, M.L., Gernez, P., Navarro, G., 2022. Monitoring the marine invasive alien species rugulopteryx okamurae using unmanned aerial vehicles and satellites. Frontiers in Marine Science 9. <a href="https://doi.org/10.3389/fmars.2022.1004012">https://doi.org/10.3389/fmars.2022.1004012</a>
</div>
<div id="ref-Roman2021" class="csl-entry" role="listitem">
Román, A., Tovar-Sánchez, A., Olivé, I., Navarro, G., 2021. Using a UAV-mounted multispectral camera for the monitoring of marine macrophytes. Frontiers in Marine Science 1225.
</div>
<div id="ref-rossiter2020uav" class="csl-entry" role="listitem">
Rossiter, T., Furey, T., McCarthy, T., Stengel, D.B., 2020. UAV-mounted hyperspectral mapping of intertidal macroalgae. Estuarine, Coastal and Shelf Science 242, 106789.
</div>
<div id="ref-SCHIBALSKI2022101414" class="csl-entry" role="listitem">
Schibalski, A., Kleyer, M., Maier, M., Schröder, B., 2022. Spatiotemporally explicit prediction of future ecosystem service provisioning in response to climate change, sea level rise, and adaptation strategies. Ecosystem Services 54, 101414. https://doi.org/<a href="https://doi.org/10.1016/j.ecoser.2022.101414">https://doi.org/10.1016/j.ecoser.2022.101414</a>
</div>
<div id="ref-schneider2012nih" class="csl-entry" role="listitem">
Schneider, C.A., Rasband, W.S., Eliceiri, K.W., 2012. NIH image to ImageJ: 25 years of image analysis. Nature methods 9, 671–675.
</div>
<div id="ref-rs13081408" class="csl-entry" role="listitem">
Schreyers, L., Emmerik, T. van, Biermann, L., Le Lay, Y.-F., 2021. Spotting green tides over brittany from space: Three decades of monitoring with landsat imagery. Remote Sensing 13. <a href="https://doi.org/10.3390/rs13081408">https://doi.org/10.3390/rs13081408</a>
</div>
<div id="ref-Slaton2001" class="csl-entry" role="listitem">
Slaton, M.R., Raymond Hunt Jr., E., Smith, W.K., 2001. Estimating near-infrared leaf reflectance from leaf structural characteristics. American Journal of Botany 88, 278–284. https://doi.org/<a href="https://doi.org/10.2307/2657019">https://doi.org/10.2307/2657019</a>
</div>
<div id="ref-soissons2018" class="csl-entry" role="listitem">
Soissons, L.M., Haanstra, E.P., Van Katwijk, M.M., Asmus, R., Auby, I., Barillé, L., Brun, F.G., Cardoso, P.G., Desroy, N., Fournier, J., others, 2018. Latitudinal patterns in european seagrass carbon reserves: Influence of seasonal fluctuations versus short-term stress and disturbance events. Frontiers in Plant Science 9, 88.
</div>
<div id="ref-sousa2017blue" class="csl-entry" role="listitem">
Sousa, A.I., Santos, D.B., Silva, E.F. da, Sousa, L.P., Cleary, D.F., Soares, A.M., Lillebø, A.I., 2017. ‘Blue carbon’and nutrient stocks of salt marshes at a temperate coastal lagoon (ria de aveiro, portugal). Scientific reports 7, 41225.
</div>
<div id="ref-sousa2019blue" class="csl-entry" role="listitem">
Sousa, A.I., Silva, J.F. da, Azevedo, A., Lillebø, A.I., 2019. Blue carbon stock in zostera noltei meadows at ria de aveiro coastal lagoon (portugal) over a decade. Scientific reports 9, 14387.
</div>
<div id="ref-sutton2011european" class="csl-entry" role="listitem">
Sutton, M.A., Van Grinsven, H., Billen, G., Bleeker, A., Bouwman, A., Oenema, O., 2011. European nitrogen assessement-summary for policy makers, in: The European Nitrogen Assessment. Sources, Effects and Policy Perspectives. pp. xxiv–xxxiv.
</div>
<div id="ref-tallam2023" class="csl-entry" role="listitem">
Tallam, K., Nguyen, N., Ventura, J., Fricker, A., Calhoun, S., O’Leary, J., Fitzgibbons, M., Robbins, I., Walter, R.K., 2023. Application of deep learning for classification of intertidal eelgrass from drone-acquired imagery. Remote Sensing 15, 2321.
</div>
<div id="ref-Traganos2018" class="csl-entry" role="listitem">
Traganos, D., Reinartz, P., 2018. Mapping mediterranean seagrasses with sentinel-2 imagery. Marine Pollution Bulletin 134, 197–209. <a href="https://doi.org/10.1016/j.marpolbul.2017.06.075">https://doi.org/10.1016/j.marpolbul.2017.06.075</a>
</div>
<div id="ref-tuya2013" class="csl-entry" role="listitem">
Tuya, F., Hernandez-Zerpa, H., Espino, F., Haroun, R., 2013. Drastic decadal decline of the seagrass cymodocea nodosa at gran canaria (eastern atlantic): Interactions with the green algae caulerpa prolifera. Aquatic Botany 105, 1–6.
</div>
<div id="ref-unsworth2022" class="csl-entry" role="listitem">
Unsworth, R.K., Cullen-Unsworth, L.C., Jones, B.L., Lilley, R.J., 2022. The planetary role of seagrass conservation. Science 377, 609–613.
</div>
<div id="ref-veettil2020opportunities" class="csl-entry" role="listitem">
Veettil, B.K., Ward, R.D., Lima, M.D.A.C., Stankovic, M., Hoai, P.N., Quang, N.X., 2020. Opportunities for seagrass research derived from remote sensing: A review of current methods. Ecological Indicators 117, 106560.
</div>
<div id="ref-villalobos2023remote" class="csl-entry" role="listitem">
Villalobos Perna, P., Di Febbraro, M., Carranza, M.L., Marzialetti, F., Innangi, M., 2023. Remote sensing and invasive plants in coastal ecosystems: What we know so far and future prospects. Land 12, 341.
</div>
<div id="ref-villares1999nitrogen" class="csl-entry" role="listitem">
Villares, R., Puente, X., Carballeira, A., 1999. Nitrogen and phosphorus in ulva sp. In the galician rias bajas (northwest spain): Seasonal fluctuations and influence on growth. Boletin-Instituto Espa<span>ñ</span>ol de Oceanografia 15, 337–342.
</div>
<div id="ref-wang2022" class="csl-entry" role="listitem">
Wang, Z., Fang, Z., Liang, J., Song, X., 2022. Assessment of global habitat suitability and risk of ocean green tides. Harmful Algae 119, 102324.
</div>
<div id="ref-WEI2015399" class="csl-entry" role="listitem">
Wei, P., Lu, Z., Song, J., 2015. Variable importance analysis: A comprehensive review. Reliability Engineering and System Safety 142, 399–432. https://doi.org/<a href="https://doi.org/10.1016/j.ress.2015.05.018">https://doi.org/10.1016/j.ress.2015.05.018</a>
</div>
<div id="ref-xu2021" class="csl-entry" role="listitem">
Xu, S., Xu, S., Zhou, Y., Yue, S., Zhang, X., Gu, R., Zhang, Y., Qiao, Y., Liu, M., 2021. Long-term changes in the unique and largest seagrass meadows in the bohai sea (china) using satellite (1974–2019) and sonar data: Implication for conservation and restoration. Remote Sensing 13, 856.
</div>
<div id="ref-ye2011green" class="csl-entry" role="listitem">
Ye, N., Zhang, X., Mao, Y., Liang, C., Xu, D., Zou, J., Zhuang, Z., Wang, Q., 2011. <span>“Green tides”</span> are overwhelming the coastline of our blue planet: Taking the world’s largest example. Ecological Research 26, 477–485.
</div>
<div id="ref-Zoffoli2021" class="csl-entry" role="listitem">
Zoffoli, M.L., Gernez, P., Godet, L., Peters, S., Oiry, S., Barillé, L., 2021. Decadal increase in the ecological status of a north-atlantic intertidal seagrass meadow observed with multi-mission satellite time-series. Ecological Indicators 130, 108033. <a href="https://doi.org/10.1016/j.ecolind.2021.108033">https://doi.org/10.1016/j.ecolind.2021.108033</a>
</div>
<div id="ref-Zoffoli2022" class="csl-entry" role="listitem">
Zoffoli, M.L., Gernez, P., Oiry, S., Godet, L., Dalloyau, S., Davies, B.F.R., Barillé, L., 2022. Remote sensing in seagrass ecology: Coupled dynamics between migratory herbivorous birds and intertidal meadows observed by satellite during four decades. Remote Sensing in Ecology and Conservation. <a href="https://doi.org/10.1002/rse2.319">https://doi.org/10.1002/rse2.319</a>
</div>
<div id="ref-ZOFFOLI2020112020" class="csl-entry" role="listitem">
Zoffoli, M.L., Gernez, P., Rosa, P., Le Bris, A., Brando, V.E., Barillé, A.-L., Harin, N., Peters, S., Poser, K., Spaias, L., Peralta, G., Barillé, L., 2020. Sentinel-2 remote sensing of zostera noltei-dominated intertidal seagrass meadows. Remote Sensing of Environment 251, 112020. https://doi.org/<a href="https://doi.org/10.1016/j.rse.2020.112020">https://doi.org/10.1016/j.rse.2020.112020</a>
</div>
</div>
</section>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content -->  <script>var lightboxQuarto = GLightbox({"selector":".lightbox","loop":false,"closeEffect":"zoom","openEffect":"zoom","descPosition":"bottom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script> 
  
</body></html>